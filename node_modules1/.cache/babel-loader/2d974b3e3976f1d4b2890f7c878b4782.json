{"remainingRequest":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\eslint-loader\\index.js??ref--13-0!C:\\Users\\何小龙\\Desktop\\platformweb-fb\\src\\components\\Table\\util\\methods.js","dependencies":[{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\src\\components\\Table\\util\\methods.js","mtime":1694505521569},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\babel.config.js","mtime":1694505520209},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:ZnVuY3Rpb24gX3JlZ2VuZXJhdG9yUnVudGltZSgpIHsgInVzZSBzdHJpY3QiOyAvKiEgcmVnZW5lcmF0b3ItcnVudGltZSAtLSBDb3B5cmlnaHQgKGMpIDIwMTQtcHJlc2VudCwgRmFjZWJvb2ssIEluYy4gLS0gbGljZW5zZSAoTUlUKTogaHR0cHM6Ly9naXRodWIuY29tL2ZhY2Vib29rL3JlZ2VuZXJhdG9yL2Jsb2IvbWFpbi9MSUNFTlNFICovIF9yZWdlbmVyYXRvclJ1bnRpbWUgPSBmdW5jdGlvbiBfcmVnZW5lcmF0b3JSdW50aW1lKCkgeyByZXR1cm4gZTsgfTsgdmFyIHQsIGUgPSB7fSwgciA9IE9iamVjdC5wcm90b3R5cGUsIG4gPSByLmhhc093blByb3BlcnR5LCBvID0gT2JqZWN0LmRlZmluZVByb3BlcnR5IHx8IGZ1bmN0aW9uICh0LCBlLCByKSB7IHRbZV0gPSByLnZhbHVlOyB9LCBpID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sID8gU3ltYm9sIDoge30sIGEgPSBpLml0ZXJhdG9yIHx8ICJAQGl0ZXJhdG9yIiwgYyA9IGkuYXN5bmNJdGVyYXRvciB8fCAiQEBhc3luY0l0ZXJhdG9yIiwgdSA9IGkudG9TdHJpbmdUYWcgfHwgIkBAdG9TdHJpbmdUYWciOyBmdW5jdGlvbiBkZWZpbmUodCwgZSwgcikgeyByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsIGUsIHsgdmFsdWU6IHIsIGVudW1lcmFibGU6ICEwLCBjb25maWd1cmFibGU6ICEwLCB3cml0YWJsZTogITAgfSksIHRbZV07IH0gdHJ5IHsgZGVmaW5lKHt9LCAiIik7IH0gY2F0Y2ggKHQpIHsgZGVmaW5lID0gZnVuY3Rpb24gZGVmaW5lKHQsIGUsIHIpIHsgcmV0dXJuIHRbZV0gPSByOyB9OyB9IGZ1bmN0aW9uIHdyYXAodCwgZSwgciwgbikgeyB2YXIgaSA9IGUgJiYgZS5wcm90b3R5cGUgaW5zdGFuY2VvZiBHZW5lcmF0b3IgPyBlIDogR2VuZXJhdG9yLCBhID0gT2JqZWN0LmNyZWF0ZShpLnByb3RvdHlwZSksIGMgPSBuZXcgQ29udGV4dChuIHx8IFtdKTsgcmV0dXJuIG8oYSwgIl9pbnZva2UiLCB7IHZhbHVlOiBtYWtlSW52b2tlTWV0aG9kKHQsIHIsIGMpIH0pLCBhOyB9IGZ1bmN0aW9uIHRyeUNhdGNoKHQsIGUsIHIpIHsgdHJ5IHsgcmV0dXJuIHsgdHlwZTogIm5vcm1hbCIsIGFyZzogdC5jYWxsKGUsIHIpIH07IH0gY2F0Y2ggKHQpIHsgcmV0dXJuIHsgdHlwZTogInRocm93IiwgYXJnOiB0IH07IH0gfSBlLndyYXAgPSB3cmFwOyB2YXIgaCA9ICJzdXNwZW5kZWRTdGFydCIsIGwgPSAic3VzcGVuZGVkWWllbGQiLCBmID0gImV4ZWN1dGluZyIsIHMgPSAiY29tcGxldGVkIiwgeSA9IHt9OyBmdW5jdGlvbiBHZW5lcmF0b3IoKSB7fSBmdW5jdGlvbiBHZW5lcmF0b3JGdW5jdGlvbigpIHt9IGZ1bmN0aW9uIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlKCkge30gdmFyIHAgPSB7fTsgZGVmaW5lKHAsIGEsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0pOyB2YXIgZCA9IE9iamVjdC5nZXRQcm90b3R5cGVPZiwgdiA9IGQgJiYgZChkKHZhbHVlcyhbXSkpKTsgdiAmJiB2ICE9PSByICYmIG4uY2FsbCh2LCBhKSAmJiAocCA9IHYpOyB2YXIgZyA9IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLnByb3RvdHlwZSA9IEdlbmVyYXRvci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHApOyBmdW5jdGlvbiBkZWZpbmVJdGVyYXRvck1ldGhvZHModCkgeyBbIm5leHQiLCAidGhyb3ciLCAicmV0dXJuIl0uZm9yRWFjaChmdW5jdGlvbiAoZSkgeyBkZWZpbmUodCwgZSwgZnVuY3Rpb24gKHQpIHsgcmV0dXJuIHRoaXMuX2ludm9rZShlLCB0KTsgfSk7IH0pOyB9IGZ1bmN0aW9uIEFzeW5jSXRlcmF0b3IodCwgZSkgeyBmdW5jdGlvbiBpbnZva2UociwgbywgaSwgYSkgeyB2YXIgYyA9IHRyeUNhdGNoKHRbcl0sIHQsIG8pOyBpZiAoInRocm93IiAhPT0gYy50eXBlKSB7IHZhciB1ID0gYy5hcmcsIGggPSB1LnZhbHVlOyByZXR1cm4gaCAmJiAib2JqZWN0IiA9PSBfdHlwZW9mKGgpICYmIG4uY2FsbChoLCAiX19hd2FpdCIpID8gZS5yZXNvbHZlKGguX19hd2FpdCkudGhlbihmdW5jdGlvbiAodCkgeyBpbnZva2UoIm5leHQiLCB0LCBpLCBhKTsgfSwgZnVuY3Rpb24gKHQpIHsgaW52b2tlKCJ0aHJvdyIsIHQsIGksIGEpOyB9KSA6IGUucmVzb2x2ZShoKS50aGVuKGZ1bmN0aW9uICh0KSB7IHUudmFsdWUgPSB0LCBpKHUpOyB9LCBmdW5jdGlvbiAodCkgeyByZXR1cm4gaW52b2tlKCJ0aHJvdyIsIHQsIGksIGEpOyB9KTsgfSBhKGMuYXJnKTsgfSB2YXIgcjsgbyh0aGlzLCAiX2ludm9rZSIsIHsgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKHQsIG4pIHsgZnVuY3Rpb24gY2FsbEludm9rZVdpdGhNZXRob2RBbmRBcmcoKSB7IHJldHVybiBuZXcgZShmdW5jdGlvbiAoZSwgcikgeyBpbnZva2UodCwgbiwgZSwgcik7IH0pOyB9IHJldHVybiByID0gciA/IHIudGhlbihjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZywgY2FsbEludm9rZVdpdGhNZXRob2RBbmRBcmcpIDogY2FsbEludm9rZVdpdGhNZXRob2RBbmRBcmcoKTsgfSB9KTsgfSBmdW5jdGlvbiBtYWtlSW52b2tlTWV0aG9kKGUsIHIsIG4pIHsgdmFyIG8gPSBoOyByZXR1cm4gZnVuY3Rpb24gKGksIGEpIHsgaWYgKG8gPT09IGYpIHRocm93IG5ldyBFcnJvcigiR2VuZXJhdG9yIGlzIGFscmVhZHkgcnVubmluZyIpOyBpZiAobyA9PT0gcykgeyBpZiAoInRocm93IiA9PT0gaSkgdGhyb3cgYTsgcmV0dXJuIHsgdmFsdWU6IHQsIGRvbmU6ICEwIH07IH0gZm9yIChuLm1ldGhvZCA9IGksIG4uYXJnID0gYTs7KSB7IHZhciBjID0gbi5kZWxlZ2F0ZTsgaWYgKGMpIHsgdmFyIHUgPSBtYXliZUludm9rZURlbGVnYXRlKGMsIG4pOyBpZiAodSkgeyBpZiAodSA9PT0geSkgY29udGludWU7IHJldHVybiB1OyB9IH0gaWYgKCJuZXh0IiA9PT0gbi5tZXRob2QpIG4uc2VudCA9IG4uX3NlbnQgPSBuLmFyZztlbHNlIGlmICgidGhyb3ciID09PSBuLm1ldGhvZCkgeyBpZiAobyA9PT0gaCkgdGhyb3cgbyA9IHMsIG4uYXJnOyBuLmRpc3BhdGNoRXhjZXB0aW9uKG4uYXJnKTsgfSBlbHNlICJyZXR1cm4iID09PSBuLm1ldGhvZCAmJiBuLmFicnVwdCgicmV0dXJuIiwgbi5hcmcpOyBvID0gZjsgdmFyIHAgPSB0cnlDYXRjaChlLCByLCBuKTsgaWYgKCJub3JtYWwiID09PSBwLnR5cGUpIHsgaWYgKG8gPSBuLmRvbmUgPyBzIDogbCwgcC5hcmcgPT09IHkpIGNvbnRpbnVlOyByZXR1cm4geyB2YWx1ZTogcC5hcmcsIGRvbmU6IG4uZG9uZSB9OyB9ICJ0aHJvdyIgPT09IHAudHlwZSAmJiAobyA9IHMsIG4ubWV0aG9kID0gInRocm93Iiwgbi5hcmcgPSBwLmFyZyk7IH0gfTsgfSBmdW5jdGlvbiBtYXliZUludm9rZURlbGVnYXRlKGUsIHIpIHsgdmFyIG4gPSByLm1ldGhvZCwgbyA9IGUuaXRlcmF0b3Jbbl07IGlmIChvID09PSB0KSByZXR1cm4gci5kZWxlZ2F0ZSA9IG51bGwsICJ0aHJvdyIgPT09IG4gJiYgZS5pdGVyYXRvci5yZXR1cm4gJiYgKHIubWV0aG9kID0gInJldHVybiIsIHIuYXJnID0gdCwgbWF5YmVJbnZva2VEZWxlZ2F0ZShlLCByKSwgInRocm93IiA9PT0gci5tZXRob2QpIHx8ICJyZXR1cm4iICE9PSBuICYmIChyLm1ldGhvZCA9ICJ0aHJvdyIsIHIuYXJnID0gbmV3IFR5cGVFcnJvcigiVGhlIGl0ZXJhdG9yIGRvZXMgbm90IHByb3ZpZGUgYSAnIiArIG4gKyAiJyBtZXRob2QiKSksIHk7IHZhciBpID0gdHJ5Q2F0Y2gobywgZS5pdGVyYXRvciwgci5hcmcpOyBpZiAoInRocm93IiA9PT0gaS50eXBlKSByZXR1cm4gci5tZXRob2QgPSAidGhyb3ciLCByLmFyZyA9IGkuYXJnLCByLmRlbGVnYXRlID0gbnVsbCwgeTsgdmFyIGEgPSBpLmFyZzsgcmV0dXJuIGEgPyBhLmRvbmUgPyAocltlLnJlc3VsdE5hbWVdID0gYS52YWx1ZSwgci5uZXh0ID0gZS5uZXh0TG9jLCAicmV0dXJuIiAhPT0gci5tZXRob2QgJiYgKHIubWV0aG9kID0gIm5leHQiLCByLmFyZyA9IHQpLCByLmRlbGVnYXRlID0gbnVsbCwgeSkgOiBhIDogKHIubWV0aG9kID0gInRocm93Iiwgci5hcmcgPSBuZXcgVHlwZUVycm9yKCJpdGVyYXRvciByZXN1bHQgaXMgbm90IGFuIG9iamVjdCIpLCByLmRlbGVnYXRlID0gbnVsbCwgeSk7IH0gZnVuY3Rpb24gcHVzaFRyeUVudHJ5KHQpIHsgdmFyIGUgPSB7IHRyeUxvYzogdFswXSB9OyAxIGluIHQgJiYgKGUuY2F0Y2hMb2MgPSB0WzFdKSwgMiBpbiB0ICYmIChlLmZpbmFsbHlMb2MgPSB0WzJdLCBlLmFmdGVyTG9jID0gdFszXSksIHRoaXMudHJ5RW50cmllcy5wdXNoKGUpOyB9IGZ1bmN0aW9uIHJlc2V0VHJ5RW50cnkodCkgeyB2YXIgZSA9IHQuY29tcGxldGlvbiB8fCB7fTsgZS50eXBlID0gIm5vcm1hbCIsIGRlbGV0ZSBlLmFyZywgdC5jb21wbGV0aW9uID0gZTsgfSBmdW5jdGlvbiBDb250ZXh0KHQpIHsgdGhpcy50cnlFbnRyaWVzID0gW3sgdHJ5TG9jOiAicm9vdCIgfV0sIHQuZm9yRWFjaChwdXNoVHJ5RW50cnksIHRoaXMpLCB0aGlzLnJlc2V0KCEwKTsgfSBmdW5jdGlvbiB2YWx1ZXMoZSkgeyBpZiAoZSB8fCAiIiA9PT0gZSkgeyB2YXIgciA9IGVbYV07IGlmIChyKSByZXR1cm4gci5jYWxsKGUpOyBpZiAoImZ1bmN0aW9uIiA9PSB0eXBlb2YgZS5uZXh0KSByZXR1cm4gZTsgaWYgKCFpc05hTihlLmxlbmd0aCkpIHsgdmFyIG8gPSAtMSwgaSA9IGZ1bmN0aW9uIG5leHQoKSB7IGZvciAoOyArK28gPCBlLmxlbmd0aDspIGlmIChuLmNhbGwoZSwgbykpIHJldHVybiBuZXh0LnZhbHVlID0gZVtvXSwgbmV4dC5kb25lID0gITEsIG5leHQ7IHJldHVybiBuZXh0LnZhbHVlID0gdCwgbmV4dC5kb25lID0gITAsIG5leHQ7IH07IHJldHVybiBpLm5leHQgPSBpOyB9IH0gdGhyb3cgbmV3IFR5cGVFcnJvcihfdHlwZW9mKGUpICsgIiBpcyBub3QgaXRlcmFibGUiKTsgfSByZXR1cm4gR2VuZXJhdG9yRnVuY3Rpb24ucHJvdG90eXBlID0gR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsIG8oZywgImNvbnN0cnVjdG9yIiwgeyB2YWx1ZTogR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsIGNvbmZpZ3VyYWJsZTogITAgfSksIG8oR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsICJjb25zdHJ1Y3RvciIsIHsgdmFsdWU6IEdlbmVyYXRvckZ1bmN0aW9uLCBjb25maWd1cmFibGU6ICEwIH0pLCBHZW5lcmF0b3JGdW5jdGlvbi5kaXNwbGF5TmFtZSA9IGRlZmluZShHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSwgdSwgIkdlbmVyYXRvckZ1bmN0aW9uIiksIGUuaXNHZW5lcmF0b3JGdW5jdGlvbiA9IGZ1bmN0aW9uICh0KSB7IHZhciBlID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgdCAmJiB0LmNvbnN0cnVjdG9yOyByZXR1cm4gISFlICYmIChlID09PSBHZW5lcmF0b3JGdW5jdGlvbiB8fCAiR2VuZXJhdG9yRnVuY3Rpb24iID09PSAoZS5kaXNwbGF5TmFtZSB8fCBlLm5hbWUpKTsgfSwgZS5tYXJrID0gZnVuY3Rpb24gKHQpIHsgcmV0dXJuIE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5zZXRQcm90b3R5cGVPZih0LCBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSkgOiAodC5fX3Byb3RvX18gPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSwgZGVmaW5lKHQsIHUsICJHZW5lcmF0b3JGdW5jdGlvbiIpKSwgdC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKGcpLCB0OyB9LCBlLmF3cmFwID0gZnVuY3Rpb24gKHQpIHsgcmV0dXJuIHsgX19hd2FpdDogdCB9OyB9LCBkZWZpbmVJdGVyYXRvck1ldGhvZHMoQXN5bmNJdGVyYXRvci5wcm90b3R5cGUpLCBkZWZpbmUoQXN5bmNJdGVyYXRvci5wcm90b3R5cGUsIGMsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0pLCBlLkFzeW5jSXRlcmF0b3IgPSBBc3luY0l0ZXJhdG9yLCBlLmFzeW5jID0gZnVuY3Rpb24gKHQsIHIsIG4sIG8sIGkpIHsgdm9pZCAwID09PSBpICYmIChpID0gUHJvbWlzZSk7IHZhciBhID0gbmV3IEFzeW5jSXRlcmF0b3Iod3JhcCh0LCByLCBuLCBvKSwgaSk7IHJldHVybiBlLmlzR2VuZXJhdG9yRnVuY3Rpb24ocikgPyBhIDogYS5uZXh0KCkudGhlbihmdW5jdGlvbiAodCkgeyByZXR1cm4gdC5kb25lID8gdC52YWx1ZSA6IGEubmV4dCgpOyB9KTsgfSwgZGVmaW5lSXRlcmF0b3JNZXRob2RzKGcpLCBkZWZpbmUoZywgdSwgIkdlbmVyYXRvciIpLCBkZWZpbmUoZywgYSwgZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpczsgfSksIGRlZmluZShnLCAidG9TdHJpbmciLCBmdW5jdGlvbiAoKSB7IHJldHVybiAiW29iamVjdCBHZW5lcmF0b3JdIjsgfSksIGUua2V5cyA9IGZ1bmN0aW9uICh0KSB7IHZhciBlID0gT2JqZWN0KHQpLCByID0gW107IGZvciAodmFyIG4gaW4gZSkgci5wdXNoKG4pOyByZXR1cm4gci5yZXZlcnNlKCksIGZ1bmN0aW9uIG5leHQoKSB7IGZvciAoOyByLmxlbmd0aDspIHsgdmFyIHQgPSByLnBvcCgpOyBpZiAodCBpbiBlKSByZXR1cm4gbmV4dC52YWx1ZSA9IHQsIG5leHQuZG9uZSA9ICExLCBuZXh0OyB9IHJldHVybiBuZXh0LmRvbmUgPSAhMCwgbmV4dDsgfTsgfSwgZS52YWx1ZXMgPSB2YWx1ZXMsIENvbnRleHQucHJvdG90eXBlID0geyBjb25zdHJ1Y3RvcjogQ29udGV4dCwgcmVzZXQ6IGZ1bmN0aW9uIHJlc2V0KGUpIHsgaWYgKHRoaXMucHJldiA9IDAsIHRoaXMubmV4dCA9IDAsIHRoaXMuc2VudCA9IHRoaXMuX3NlbnQgPSB0LCB0aGlzLmRvbmUgPSAhMSwgdGhpcy5kZWxlZ2F0ZSA9IG51bGwsIHRoaXMubWV0aG9kID0gIm5leHQiLCB0aGlzLmFyZyA9IHQsIHRoaXMudHJ5RW50cmllcy5mb3JFYWNoKHJlc2V0VHJ5RW50cnkpLCAhZSkgZm9yICh2YXIgciBpbiB0aGlzKSAidCIgPT09IHIuY2hhckF0KDApICYmIG4uY2FsbCh0aGlzLCByKSAmJiAhaXNOYU4oK3Iuc2xpY2UoMSkpICYmICh0aGlzW3JdID0gdCk7IH0sIHN0b3A6IGZ1bmN0aW9uIHN0b3AoKSB7IHRoaXMuZG9uZSA9ICEwOyB2YXIgdCA9IHRoaXMudHJ5RW50cmllc1swXS5jb21wbGV0aW9uOyBpZiAoInRocm93IiA9PT0gdC50eXBlKSB0aHJvdyB0LmFyZzsgcmV0dXJuIHRoaXMucnZhbDsgfSwgZGlzcGF0Y2hFeGNlcHRpb246IGZ1bmN0aW9uIGRpc3BhdGNoRXhjZXB0aW9uKGUpIHsgaWYgKHRoaXMuZG9uZSkgdGhyb3cgZTsgdmFyIHIgPSB0aGlzOyBmdW5jdGlvbiBoYW5kbGUobiwgbykgeyByZXR1cm4gYS50eXBlID0gInRocm93IiwgYS5hcmcgPSBlLCByLm5leHQgPSBuLCBvICYmIChyLm1ldGhvZCA9ICJuZXh0Iiwgci5hcmcgPSB0KSwgISFvOyB9IGZvciAodmFyIG8gPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgbyA+PSAwOyAtLW8pIHsgdmFyIGkgPSB0aGlzLnRyeUVudHJpZXNbb10sIGEgPSBpLmNvbXBsZXRpb247IGlmICgicm9vdCIgPT09IGkudHJ5TG9jKSByZXR1cm4gaGFuZGxlKCJlbmQiKTsgaWYgKGkudHJ5TG9jIDw9IHRoaXMucHJldikgeyB2YXIgYyA9IG4uY2FsbChpLCAiY2F0Y2hMb2MiKSwgdSA9IG4uY2FsbChpLCAiZmluYWxseUxvYyIpOyBpZiAoYyAmJiB1KSB7IGlmICh0aGlzLnByZXYgPCBpLmNhdGNoTG9jKSByZXR1cm4gaGFuZGxlKGkuY2F0Y2hMb2MsICEwKTsgaWYgKHRoaXMucHJldiA8IGkuZmluYWxseUxvYykgcmV0dXJuIGhhbmRsZShpLmZpbmFsbHlMb2MpOyB9IGVsc2UgaWYgKGMpIHsgaWYgKHRoaXMucHJldiA8IGkuY2F0Y2hMb2MpIHJldHVybiBoYW5kbGUoaS5jYXRjaExvYywgITApOyB9IGVsc2UgeyBpZiAoIXUpIHRocm93IG5ldyBFcnJvcigidHJ5IHN0YXRlbWVudCB3aXRob3V0IGNhdGNoIG9yIGZpbmFsbHkiKTsgaWYgKHRoaXMucHJldiA8IGkuZmluYWxseUxvYykgcmV0dXJuIGhhbmRsZShpLmZpbmFsbHlMb2MpOyB9IH0gfSB9LCBhYnJ1cHQ6IGZ1bmN0aW9uIGFicnVwdCh0LCBlKSB7IGZvciAodmFyIHIgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgciA+PSAwOyAtLXIpIHsgdmFyIG8gPSB0aGlzLnRyeUVudHJpZXNbcl07IGlmIChvLnRyeUxvYyA8PSB0aGlzLnByZXYgJiYgbi5jYWxsKG8sICJmaW5hbGx5TG9jIikgJiYgdGhpcy5wcmV2IDwgby5maW5hbGx5TG9jKSB7IHZhciBpID0gbzsgYnJlYWs7IH0gfSBpICYmICgiYnJlYWsiID09PSB0IHx8ICJjb250aW51ZSIgPT09IHQpICYmIGkudHJ5TG9jIDw9IGUgJiYgZSA8PSBpLmZpbmFsbHlMb2MgJiYgKGkgPSBudWxsKTsgdmFyIGEgPSBpID8gaS5jb21wbGV0aW9uIDoge307IHJldHVybiBhLnR5cGUgPSB0LCBhLmFyZyA9IGUsIGkgPyAodGhpcy5tZXRob2QgPSAibmV4dCIsIHRoaXMubmV4dCA9IGkuZmluYWxseUxvYywgeSkgOiB0aGlzLmNvbXBsZXRlKGEpOyB9LCBjb21wbGV0ZTogZnVuY3Rpb24gY29tcGxldGUodCwgZSkgeyBpZiAoInRocm93IiA9PT0gdC50eXBlKSB0aHJvdyB0LmFyZzsgcmV0dXJuICJicmVhayIgPT09IHQudHlwZSB8fCAiY29udGludWUiID09PSB0LnR5cGUgPyB0aGlzLm5leHQgPSB0LmFyZyA6ICJyZXR1cm4iID09PSB0LnR5cGUgPyAodGhpcy5ydmFsID0gdGhpcy5hcmcgPSB0LmFyZywgdGhpcy5tZXRob2QgPSAicmV0dXJuIiwgdGhpcy5uZXh0ID0gImVuZCIpIDogIm5vcm1hbCIgPT09IHQudHlwZSAmJiBlICYmICh0aGlzLm5leHQgPSBlKSwgeTsgfSwgZmluaXNoOiBmdW5jdGlvbiBmaW5pc2godCkgeyBmb3IgKHZhciBlID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGUgPj0gMDsgLS1lKSB7IHZhciByID0gdGhpcy50cnlFbnRyaWVzW2VdOyBpZiAoci5maW5hbGx5TG9jID09PSB0KSByZXR1cm4gdGhpcy5jb21wbGV0ZShyLmNvbXBsZXRpb24sIHIuYWZ0ZXJMb2MpLCByZXNldFRyeUVudHJ5KHIpLCB5OyB9IH0sIGNhdGNoOiBmdW5jdGlvbiBfY2F0Y2godCkgeyBmb3IgKHZhciBlID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGUgPj0gMDsgLS1lKSB7IHZhciByID0gdGhpcy50cnlFbnRyaWVzW2VdOyBpZiAoci50cnlMb2MgPT09IHQpIHsgdmFyIG4gPSByLmNvbXBsZXRpb247IGlmICgidGhyb3ciID09PSBuLnR5cGUpIHsgdmFyIG8gPSBuLmFyZzsgcmVzZXRUcnlFbnRyeShyKTsgfSByZXR1cm4gbzsgfSB9IHRocm93IG5ldyBFcnJvcigiaWxsZWdhbCBjYXRjaCBhdHRlbXB0Iik7IH0sIGRlbGVnYXRlWWllbGQ6IGZ1bmN0aW9uIGRlbGVnYXRlWWllbGQoZSwgciwgbikgeyByZXR1cm4gdGhpcy5kZWxlZ2F0ZSA9IHsgaXRlcmF0b3I6IHZhbHVlcyhlKSwgcmVzdWx0TmFtZTogciwgbmV4dExvYzogbiB9LCAibmV4dCIgPT09IHRoaXMubWV0aG9kICYmICh0aGlzLmFyZyA9IHQpLCB5OyB9IH0sIGU7IH0KZnVuY3Rpb24gYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCBrZXksIGFyZykgeyB0cnkgeyB2YXIgaW5mbyA9IGdlbltrZXldKGFyZyk7IHZhciB2YWx1ZSA9IGluZm8udmFsdWU7IH0gY2F0Y2ggKGVycm9yKSB7IHJlamVjdChlcnJvcik7IHJldHVybjsgfSBpZiAoaW5mby5kb25lKSB7IHJlc29sdmUodmFsdWUpOyB9IGVsc2UgeyBQcm9taXNlLnJlc29sdmUodmFsdWUpLnRoZW4oX25leHQsIF90aHJvdyk7IH0gfQpmdW5jdGlvbiBfYXN5bmNUb0dlbmVyYXRvcihmbikgeyByZXR1cm4gZnVuY3Rpb24gKCkgeyB2YXIgc2VsZiA9IHRoaXMsIGFyZ3MgPSBhcmd1bWVudHM7IHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7IHZhciBnZW4gPSBmbi5hcHBseShzZWxmLCBhcmdzKTsgZnVuY3Rpb24gX25leHQodmFsdWUpIHsgYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAibmV4dCIsIHZhbHVlKTsgfSBmdW5jdGlvbiBfdGhyb3coZXJyKSB7IGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgInRocm93IiwgZXJyKTsgfSBfbmV4dCh1bmRlZmluZWQpOyB9KTsgfTsgfQpmdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkoYXJyKSB7IHJldHVybiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5KGFycikgfHwgX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KGFycikgfHwgX25vbkl0ZXJhYmxlU3ByZWFkKCk7IH0KZnVuY3Rpb24gX25vbkl0ZXJhYmxlU3ByZWFkKCkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gc3ByZWFkIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKTsgfQpmdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5KGl0ZXIpIHsgaWYgKHR5cGVvZiBTeW1ib2wgIT09ICJ1bmRlZmluZWQiICYmIGl0ZXJbU3ltYm9sLml0ZXJhdG9yXSAhPSBudWxsIHx8IGl0ZXJbIkBAaXRlcmF0b3IiXSAhPSBudWxsKSByZXR1cm4gQXJyYXkuZnJvbShpdGVyKTsgfQpmdW5jdGlvbiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB7IGlmIChBcnJheS5pc0FycmF5KGFycikpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheShhcnIpOyB9CmZ1bmN0aW9uIG93bktleXMoZSwgcikgeyB2YXIgdCA9IE9iamVjdC5rZXlzKGUpOyBpZiAoT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scykgeyB2YXIgbyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoZSk7IHIgJiYgKG8gPSBvLmZpbHRlcihmdW5jdGlvbiAocikgeyByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihlLCByKS5lbnVtZXJhYmxlOyB9KSksIHQucHVzaC5hcHBseSh0LCBvKTsgfSByZXR1cm4gdDsgfQpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKGUpIHsgZm9yICh2YXIgciA9IDE7IHIgPCBhcmd1bWVudHMubGVuZ3RoOyByKyspIHsgdmFyIHQgPSBudWxsICE9IGFyZ3VtZW50c1tyXSA/IGFyZ3VtZW50c1tyXSA6IHt9OyByICUgMiA/IG93bktleXMoT2JqZWN0KHQpLCAhMCkuZm9yRWFjaChmdW5jdGlvbiAocikgeyBfZGVmaW5lUHJvcGVydHkoZSwgciwgdFtyXSk7IH0pIDogT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMgPyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhlLCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyh0KSkgOiBvd25LZXlzKE9iamVjdCh0KSkuZm9yRWFjaChmdW5jdGlvbiAocikgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkoZSwgciwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0LCByKSk7IH0pOyB9IHJldHVybiBlOyB9CmZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHsga2V5ID0gX3RvUHJvcGVydHlLZXkoa2V5KTsgaWYgKGtleSBpbiBvYmopIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTsgfSBlbHNlIHsgb2JqW2tleV0gPSB2YWx1ZTsgfSByZXR1cm4gb2JqOyB9CmZ1bmN0aW9uIF90b1Byb3BlcnR5S2V5KGFyZykgeyB2YXIga2V5ID0gX3RvUHJpbWl0aXZlKGFyZywgInN0cmluZyIpOyByZXR1cm4gX3R5cGVvZihrZXkpID09PSAic3ltYm9sIiA/IGtleSA6IFN0cmluZyhrZXkpOyB9CmZ1bmN0aW9uIF90b1ByaW1pdGl2ZShpbnB1dCwgaGludCkgeyBpZiAoX3R5cGVvZihpbnB1dCkgIT09ICJvYmplY3QiIHx8IGlucHV0ID09PSBudWxsKSByZXR1cm4gaW5wdXQ7IHZhciBwcmltID0gaW5wdXRbU3ltYm9sLnRvUHJpbWl0aXZlXTsgaWYgKHByaW0gIT09IHVuZGVmaW5lZCkgeyB2YXIgcmVzID0gcHJpbS5jYWxsKGlucHV0LCBoaW50IHx8ICJkZWZhdWx0Iik7IGlmIChfdHlwZW9mKHJlcykgIT09ICJvYmplY3QiKSByZXR1cm4gcmVzOyB0aHJvdyBuZXcgVHlwZUVycm9yKCJAQHRvUHJpbWl0aXZlIG11c3QgcmV0dXJuIGEgcHJpbWl0aXZlIHZhbHVlLiIpOyB9IHJldHVybiAoaGludCA9PT0gInN0cmluZyIgPyBTdHJpbmcgOiBOdW1iZXIpKGlucHV0KTsgfQpmdW5jdGlvbiBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihvLCBhbGxvd0FycmF5TGlrZSkgeyB2YXIgaXQgPSB0eXBlb2YgU3ltYm9sICE9PSAidW5kZWZpbmVkIiAmJiBvW1N5bWJvbC5pdGVyYXRvcl0gfHwgb1siQEBpdGVyYXRvciJdOyBpZiAoIWl0KSB7IGlmIChBcnJheS5pc0FycmF5KG8pIHx8IChpdCA9IF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShvKSkgfHwgYWxsb3dBcnJheUxpa2UgJiYgbyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSB7IGlmIChpdCkgbyA9IGl0OyB2YXIgaSA9IDA7IHZhciBGID0gZnVuY3Rpb24gRigpIHt9OyByZXR1cm4geyBzOiBGLCBuOiBmdW5jdGlvbiBuKCkgeyBpZiAoaSA+PSBvLmxlbmd0aCkgcmV0dXJuIHsgZG9uZTogdHJ1ZSB9OyByZXR1cm4geyBkb25lOiBmYWxzZSwgdmFsdWU6IG9baSsrXSB9OyB9LCBlOiBmdW5jdGlvbiBlKF9lKSB7IHRocm93IF9lOyB9LCBmOiBGIH07IH0gdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGl0ZXJhdGUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpOyB9IHZhciBub3JtYWxDb21wbGV0aW9uID0gdHJ1ZSwgZGlkRXJyID0gZmFsc2UsIGVycjsgcmV0dXJuIHsgczogZnVuY3Rpb24gcygpIHsgaXQgPSBpdC5jYWxsKG8pOyB9LCBuOiBmdW5jdGlvbiBuKCkgeyB2YXIgc3RlcCA9IGl0Lm5leHQoKTsgbm9ybWFsQ29tcGxldGlvbiA9IHN0ZXAuZG9uZTsgcmV0dXJuIHN0ZXA7IH0sIGU6IGZ1bmN0aW9uIGUoX2UyKSB7IGRpZEVyciA9IHRydWU7IGVyciA9IF9lMjsgfSwgZjogZnVuY3Rpb24gZigpIHsgdHJ5IHsgaWYgKCFub3JtYWxDb21wbGV0aW9uICYmIGl0LnJldHVybiAhPSBudWxsKSBpdC5yZXR1cm4oKTsgfSBmaW5hbGx5IHsgaWYgKGRpZEVycikgdGhyb3cgZXJyOyB9IH0gfTsgfQpmdW5jdGlvbiBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkobywgbWluTGVuKSB7IGlmICghbykgcmV0dXJuOyBpZiAodHlwZW9mIG8gPT09ICJzdHJpbmciKSByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTsgdmFyIG4gPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobykuc2xpY2UoOCwgLTEpOyBpZiAobiA9PT0gIk9iamVjdCIgJiYgby5jb25zdHJ1Y3RvcikgbiA9IG8uY29uc3RydWN0b3IubmFtZTsgaWYgKG4gPT09ICJNYXAiIHx8IG4gPT09ICJTZXQiKSByZXR1cm4gQXJyYXkuZnJvbShvKTsgaWYgKG4gPT09ICJBcmd1bWVudHMiIHx8IC9eKD86VWl8SSludCg/Ojh8MTZ8MzIpKD86Q2xhbXBlZCk/QXJyYXkkLy50ZXN0KG4pKSByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTsgfQpmdW5jdGlvbiBfYXJyYXlMaWtlVG9BcnJheShhcnIsIGxlbikgeyBpZiAobGVuID09IG51bGwgfHwgbGVuID4gYXJyLmxlbmd0aCkgbGVuID0gYXJyLmxlbmd0aDsgZm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkobGVuKTsgaSA8IGxlbjsgaSsrKSBhcnIyW2ldID0gYXJyW2ldOyByZXR1cm4gYXJyMjsgfQpmdW5jdGlvbiBfdHlwZW9mKG8pIHsgIkBiYWJlbC9oZWxwZXJzIC0gdHlwZW9mIjsgcmV0dXJuIF90eXBlb2YgPSAiZnVuY3Rpb24iID09IHR5cGVvZiBTeW1ib2wgJiYgInN5bWJvbCIgPT0gdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA/IGZ1bmN0aW9uIChvKSB7IHJldHVybiB0eXBlb2YgbzsgfSA6IGZ1bmN0aW9uIChvKSB7IHJldHVybiBvICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIFN5bWJvbCAmJiBvLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgbyAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG87IH0sIF90eXBlb2Yobyk7IH0KLyogZXNsaW50LWRpc2FibGUgbm8tdXNlbGVzcy1lc2NhcGUgKi8KLyogZXNsaW50LWRpc2FibGUgbm8tZXZhbCAqLwovKiBlc2xpbnQtZGlzYWJsZSBuby1uZXctZnVuYyAqLwovLyBtZXRob2RzICAgQXV0aG9yOlRpdGFuc0AyMzk2NzU3NTkxQHFxLmNvbQppbXBvcnQgeyB0YWJsZUNvbHVtbnMsIGZpbHRlclR5cGVNYXAgfSBmcm9tICcuLi9jb25maWcvdGFibGVEZWZhdWx0Q29uZmlnJzsKaW1wb3J0IGZvcm1hdHRlcnMgZnJvbSAnLi9mb3JtYXR0ZXInOwppbXBvcnQgdXRpbCBmcm9tICcuLi90b29sL3V0aWwuanMnOwppbXBvcnQgZXZhbENhbGNVdGlsIGZyb20gJy4uLy4uL3Rvb2wvZXZhbC9pbmRleC5qcyc7CmltcG9ydCB7IGdldENvbHVtbk1vbmV5RmlsdGVyQ29uZmlnIH0gZnJvbSAnLi4vdG9vbC90YWJsZUNvbHVtbk1vbmV5RmlsdGVyJzsKaW1wb3J0IFhFVXRpbHMgZnJvbSAneGUtdXRpbHMnOwoKLy8g5ZSv5LiA6KGMaWTlsZ7mgKflkI3np7AKZXhwb3J0IHZhciByb3dVdWlkS2V5TmFtZSA9ICdfX0JPU1NfVVVJRCc7Ci8vIOagkeW9ouiKgueCuea3seW6pgpleHBvcnQgdmFyIHJvd1VuaXF1ZUxldmVsS2V5ID0gJ19fQk9TU19UUkVFX05PREVfTEVWRUwnOwoKLy8g6K6+572u5qCR5b2i6KGo5qC85ZSv5LiA6ZSuCnZhciBzZXRSb3dVdWlkS2V5ID0gZnVuY3Rpb24gc2V0Um93VXVpZEtleShyb3dzLCBpbnN0YW5jZSkgewogIHZhciBsZXZlbCA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogMDsKICBpZiAoX3R5cGVvZihyb3dzKSAhPT0gJ29iamVjdCcpIHJldHVybjsKICB2YXIgX2l0ZXJhdG9yID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIoQXJyYXkuaXNBcnJheShyb3dzKSA/IHJvd3MgOiBbcm93c10pLAogICAgX3N0ZXA7CiAgdHJ5IHsKICAgIGZvciAoX2l0ZXJhdG9yLnMoKTsgIShfc3RlcCA9IF9pdGVyYXRvci5uKCkpLmRvbmU7KSB7CiAgICAgIHZhciBfcm93JGNoaWxkcmVuOwogICAgICB2YXIgcm93ID0gX3N0ZXAudmFsdWU7CiAgICAgIC8vIOiuvue9ruWUr+S4gOagh+ivhgogICAgICAhcm93W3Jvd1V1aWRLZXlOYW1lXSAmJiBSZWZsZWN0LnNldChyb3csIHJvd1V1aWRLZXlOYW1lLCBYRVV0aWxzLnVuaXF1ZUlkKCIiLmNvbmNhdChyb3dVdWlkS2V5TmFtZSwgIl8iKSkpOwogICAgICAvLyDorr7nva7oioLngrnlsYLnuqcKICAgICAgIXJvd1tyb3dVbmlxdWVMZXZlbEtleV0gJiYgUmVmbGVjdC5zZXQocm93LCByb3dVbmlxdWVMZXZlbEtleSwgbGV2ZWwpOwogICAgICBpZiAocm93ICE9PSBudWxsICYmIHJvdyAhPT0gdm9pZCAwICYmIHJvdy5jaGlsZHJlbiAmJiByb3cgIT09IG51bGwgJiYgcm93ICE9PSB2b2lkIDAgJiYgKF9yb3ckY2hpbGRyZW4gPSByb3cuY2hpbGRyZW4pICE9PSBudWxsICYmIF9yb3ckY2hpbGRyZW4gIT09IHZvaWQgMCAmJiBfcm93JGNoaWxkcmVuLmxlbmd0aCkgewogICAgICAgIHNldFJvd1V1aWRLZXkocm93LmNoaWxkcmVuLCBpbnN0YW5jZSwgbGV2ZWwgKyAxKTsKICAgICAgfQogICAgfQogIH0gY2F0Y2ggKGVycikgewogICAgX2l0ZXJhdG9yLmUoZXJyKTsKICB9IGZpbmFsbHkgewogICAgX2l0ZXJhdG9yLmYoKTsKICB9Cn07CnZhciBzb3J0TWV0aG9kcyA9IHsKICBhcnJTb3J0R2xvYWJhbDogZnVuY3Rpb24gYXJyU29ydEdsb2FiYWwoZGF0YSwgcHJvcGVydHksIHR5cGUpIHsKICAgIHZhciBvcmRlciA9IGFyZ3VtZW50cy5sZW5ndGggPiAzICYmIGFyZ3VtZW50c1szXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzNdIDogJ2FzYyc7CiAgICAvLyDpgJrnlKgg5o6S5bqPCiAgICBkYXRhLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgaWYgKG9yZGVyID09PSAnYXNjJykgewogICAgICAgIGlmICh0eXBlID09PSAnbnVtYmVyJykgewogICAgICAgICAgcmV0dXJuIGFbcHJvcGVydHldIC0gYltwcm9wZXJ0eV07CiAgICAgICAgfQogICAgICAgIHJldHVybiBTdHJpbmcoYVtwcm9wZXJ0eV0pLmxvY2FsZUNvbXBhcmUoU3RyaW5nKGJbcHJvcGVydHldKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHR5cGUgPT09ICdudW1iZXInKSB7CiAgICAgICAgICByZXR1cm4gYltwcm9wZXJ0eV0gLSBhW3Byb3BlcnR5XTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFN0cmluZyhiW3Byb3BlcnR5XSkubG9jYWxlQ29tcGFyZShTdHJpbmcoYVtwcm9wZXJ0eV0pKTsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gZGF0YTsKICB9LAogIGFyclNvcnRTdHJpbmc6IGZ1bmN0aW9uIGFyclNvcnRTdHJpbmcoX3JlZikgewogICAgdmFyICR0YWJsZSA9IF9yZWYuJHRhYmxlLAogICAgICBkYXRhID0gX3JlZi5kYXRhLAogICAgICBjb2x1bW4gPSBfcmVmLmNvbHVtbiwKICAgICAgcHJvcGVydHkgPSBfcmVmLnByb3BlcnR5LAogICAgICBvcmRlciA9IF9yZWYub3JkZXI7CiAgICAvLyDlrZfnrKYg5o6S5bqPCiAgICBkYXRhLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgaWYgKG9yZGVyID09PSAnYXNjJykgewogICAgICAgIHJldHVybiBTdHJpbmcoYVtwcm9wZXJ0eV0pLmxvY2FsZUNvbXBhcmUoU3RyaW5nKGJbcHJvcGVydHldKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIFN0cmluZyhiW3Byb3BlcnR5XSkubG9jYWxlQ29tcGFyZShTdHJpbmcoYVtwcm9wZXJ0eV0pKTsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gZGF0YTsKICB9LAogIGFyclNvcnROdW1iZXI6IGZ1bmN0aW9uIGFyclNvcnROdW1iZXIoX3JlZjIpIHsKICAgIHZhciAkdGFibGUgPSBfcmVmMi4kdGFibGUsCiAgICAgIGRhdGEgPSBfcmVmMi5kYXRhLAogICAgICBjb2x1bW4gPSBfcmVmMi5jb2x1bW4sCiAgICAgIHByb3BlcnR5ID0gX3JlZjIucHJvcGVydHksCiAgICAgIG9yZGVyID0gX3JlZjIub3JkZXI7CiAgICAvLyDmlbDlrZcg5o6S5bqPCiAgICBkYXRhLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgaWYgKG9yZGVyID09PSAnYXNjJykgewogICAgICAgIHJldHVybiBhW3Byb3BlcnR5XSAtIGJbcHJvcGVydHldOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBiW3Byb3BlcnR5XSAtIGFbcHJvcGVydHldOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiBkYXRhOwogIH0sCiAgYXJyU29ydFN0cmluZ1N1ZmZpeDogZnVuY3Rpb24gYXJyU29ydFN0cmluZ1N1ZmZpeChfcmVmMykgewogICAgdmFyICR0YWJsZSA9IF9yZWYzLiR0YWJsZSwKICAgICAgZGF0YSA9IF9yZWYzLmRhdGEsCiAgICAgIGNvbHVtbiA9IF9yZWYzLmNvbHVtbiwKICAgICAgcHJvcGVydHkgPSBfcmVmMy5wcm9wZXJ0eSwKICAgICAgb3JkZXIgPSBfcmVmMy5vcmRlciwKICAgICAgclR5cGVTdWZmaXggPSBfcmVmMy5yVHlwZVN1ZmZpeDsKICAgIC8vIOmAmueUqCDmjpLluo8gbmV3CiAgICBkYXRhLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgaWYgKG9yZGVyID09PSAnYXNjJykgewogICAgICAgIHJldHVybiBTdHJpbmcoYVtwcm9wZXJ0eV0pLmxvY2FsZUNvbXBhcmUoU3RyaW5nKGJbcHJvcGVydHldKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIFN0cmluZyhiW3Byb3BlcnR5XSkubG9jYWxlQ29tcGFyZShTdHJpbmcoYVtwcm9wZXJ0eV0pKTsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gZGF0YTsKICB9LAogIGFyclNvcnROdW1iZXJTdWZmaXg6IGZ1bmN0aW9uIGFyclNvcnROdW1iZXJTdWZmaXgoX3JlZjQpIHsKICAgIHZhciAkdGFibGUgPSBfcmVmNC4kdGFibGUsCiAgICAgIGRhdGEgPSBfcmVmNC5kYXRhLAogICAgICBjb2x1bW4gPSBfcmVmNC5jb2x1bW4sCiAgICAgIHByb3BlcnR5ID0gX3JlZjQucHJvcGVydHksCiAgICAgIG9yZGVyID0gX3JlZjQub3JkZXIsCiAgICAgIHJUeXBlU3VmZml4ID0gX3JlZjQuclR5cGVTdWZmaXg7CiAgICAvLyDlhbzlrrnmoJHlvaLooajmoLwgPT4g6YCS5b2S5o6S5bqP5ZCO5Luj6IqC54K5CiAgICBmdW5jdGlvbiBzb3J0SW5uZXIoZGF0YSkgewogICAgICAvLyDpgJrnlKgg5o6S5bqPIG5ldwogICAgICBkYXRhLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBpZiAob3JkZXIgPT09ICdhc2MnKSB7CiAgICAgICAgICByZXR1cm4gcGFyc2VGbG9hdChhW3Byb3BlcnR5XSkgLSBwYXJzZUZsb2F0KGJbcHJvcGVydHldKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIHBhcnNlRmxvYXQoYltwcm9wZXJ0eV0pIC0gcGFyc2VGbG9hdChhW3Byb3BlcnR5XSk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgJHRhYmxlLnRyZWVDb25maWcgJiYgZGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgdmFyIF9pdGVtJGNoaWxkcmVuOwogICAgICAgIGlmIChpdGVtICE9PSBudWxsICYmIGl0ZW0gIT09IHZvaWQgMCAmJiAoX2l0ZW0kY2hpbGRyZW4gPSBpdGVtLmNoaWxkcmVuKSAhPT0gbnVsbCAmJiBfaXRlbSRjaGlsZHJlbiAhPT0gdm9pZCAwICYmIF9pdGVtJGNoaWxkcmVuLmxlbmd0aCkgewogICAgICAgICAgc29ydElubmVyKGl0ZW0uY2hpbGRyZW4pOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICBzb3J0SW5uZXIoZGF0YSk7CiAgICByZXR1cm4gZGF0YTsKICB9LAogIGFyclNvcnQ6IGZ1bmN0aW9uIGFyclNvcnQoX3JlZjUpIHsKICAgIHZhciAkdGFibGUgPSBfcmVmNS4kdGFibGUsCiAgICAgIGRhdGEgPSBfcmVmNS5kYXRhLAogICAgICBjb2x1bW4gPSBfcmVmNS5jb2x1bW4sCiAgICAgIHByb3BlcnR5ID0gX3JlZjUucHJvcGVydHksCiAgICAgIG9yZGVyID0gX3JlZjUub3JkZXI7CiAgICAvLyDmjpLluo8KICAgIHZhciBzZWxmID0gdGhpczsKICAgIHZhciBzb3J0VHlwZU1hcCA9IHsKICAgICAgLy8gbnVtYmVy57G75Z6L5o6S5bqPCiAgICAgICR2eGVNb25leTogJ2FyclNvcnROdW1iZXJTdWZmaXgnLAogICAgICAkdnhlRGF5czogJ2FyclNvcnROdW1iZXJTdWZmaXgnLAogICAgICAkdnhlQ2FsY3VsYXRlOiAnYXJyU29ydE51bWJlclN1ZmZpeCcsCiAgICAgIC8vIOWtl+espuexu+Wei+aOkuW6jwogICAgICAkdnhlVHJlZTogJ2FyclNvcnRTdHJpbmdTdWZmaXgnLAogICAgICAkdnhlSW5wdXQ6ICdhcnJTb3J0U3RyaW5nU3VmZml4JywKICAgICAgJHZ4ZVNlbGVjdDogJ2FyclNvcnRTdHJpbmdTdWZmaXgnLAogICAgICAkdnhlRWRpdERvd25UZXh0YXJlYTogJ2FyclNvcnRTdHJpbmdTdWZmaXgnLAogICAgICAkdnhlVGltZTogJ2FyclNvcnRTdHJpbmdTdWZmaXgnLAogICAgICAkdnhlUmFkaW86ICdhcnJTb3J0U3RyaW5nU3VmZml4JywKICAgICAgJHZ4ZUNoZWNrYm94OiAnYXJyU29ydFN0cmluZ1N1ZmZpeCcsCiAgICAgICQkdnhlRWRpdERvd25Kc29uOiAnYXJyU29ydFN0cmluZ1N1ZmZpeCcsCiAgICAgICR2eGVFZGl0RG93bkNvbmRpdGlvbnM6ICdhcnJTb3J0U3RyaW5nU3VmZml4JywKICAgICAgJHZ4ZUludGVybGV0OiAnYXJyU29ydFN0cmluZ1N1ZmZpeCcKICAgIH07CiAgICB2YXIgcmVuZGVyID0gY29sdW1uLm93biAmJiAoY29sdW1uLm93bi5lZGl0UmVuZGVyIHx8IGNvbHVtbi5vd24uY2VsbFJlbmRlciB8fCBjb2x1bW4ub3duLmNvbnRlbnRSZW5kZXIpOwogICAgaWYgKHJlbmRlciAmJiByZW5kZXIubmFtZSAmJiBzb3J0VHlwZU1hcFtyZW5kZXIubmFtZV0pIHsKICAgICAgcmV0dXJuIHNlbGZbc29ydFR5cGVNYXBbcmVuZGVyLm5hbWVdXSh7CiAgICAgICAgJHRhYmxlOiAkdGFibGUsCiAgICAgICAgZGF0YTogZGF0YSwKICAgICAgICBjb2x1bW46IGNvbHVtbiwKICAgICAgICBwcm9wZXJ0eTogcHJvcGVydHksCiAgICAgICAgb3JkZXI6IG9yZGVyLAogICAgICAgIHJUeXBlU3VmZml4OiAnX192aWV3U29ydCcKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICBkYXRhLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICBpZiAob3JkZXIgPT09ICdhc2MnKSB7CiAgICAgICAgICBpZiAoaXNOYU4oTnVtYmVyKGFbcHJvcGVydHldKSkpIHsKICAgICAgICAgICAgcmV0dXJuIGFbcHJvcGVydHldLnRvU3RyaW5nKCkubG9jYWxlQ29tcGFyZShiW3Byb3BlcnR5XS50b1N0cmluZygpKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBhW3Byb3BlcnR5XSAtIGJbcHJvcGVydHldOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoaXNOYU4oTnVtYmVyKGFbcHJvcGVydHldKSkpIHsKICAgICAgICAgICAgcmV0dXJuIGJbcHJvcGVydHldLnRvU3RyaW5nKCkubG9jYWxlQ29tcGFyZShhW3Byb3BlcnR5XS50b1N0cmluZygpKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBiW3Byb3BlcnR5XSAtIGFbcHJvcGVydHldOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICByZXR1cm4gZGF0YTsKICB9Cn07CnZhciByZWdpc3RGbiA9IHsKICByZWdpc3RHbG9ibGVGb3JtYXR0ZXJzOiBmdW5jdGlvbiByZWdpc3RHbG9ibGVGb3JtYXR0ZXJzKG9iaikgewogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgT2JqZWN0LmtleXMob2JqKS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtLCBpbmRleCkgewogICAgICBzZWxmLiRWWEVUYWJsZS5mb3JtYXRzLmFkZChpdGVtLCBvYmpbaXRlbV0uYmluZChzZWxmKSk7CiAgICB9KTsKICB9LAogIHJlZ2lzdEdsb2FibGVDb25sdW1zQ29uZmlnOiBmdW5jdGlvbiByZWdpc3RHbG9hYmxlQ29ubHVtc0NvbmZpZygpIHsKICAgIHZhciBhcnIgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IFtdOwogICAgLy8g5rOo5YaM5YiX5qC85byP5YyW77yM5riy5p+T5Zmo77yM6L+H5ruk6aG555uu562J5YWo5bGA5Ye95pWwCiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICBmdW5jdGlvbiByZXZlclJlZ2lzdEdsb2FibGVDb25sdW1zQ29uZmlnKGFycmMpIHsKICAgICAgYXJyYy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtLCBpbmRleCkgewogICAgICAgIHNlbGYucmVnaXN0U2luZ2VsUm93Q29uZmlnKGFycmMsIGl0ZW0sIGluZGV4KTsKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShpdGVtLmNoaWxkcmVuKSAmJiBpdGVtLmNoaWxkcmVuLmxlbmd0aCkgewogICAgICAgICAgc2VsZi5yZWdpc3RHbG9hYmxlQ29ubHVtc0NvbmZpZyhpdGVtLmNoaWxkcmVuKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogICAgcmV2ZXJSZWdpc3RHbG9hYmxlQ29ubHVtc0NvbmZpZyhhcnIpOwogIH0sCiAgcmVnaXN0U2luZ2VsUm93Q29uZmlnOiBmdW5jdGlvbiByZWdpc3RTaW5nZWxSb3dDb25maWcoYXJyLCBpdGVtLCBpbmRleCkgewogICAgLy8g5rOo5YaMIOWNleadoeaVsOaNrumFjee9rumhuQogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgYXJyW2luZGV4XSA9IHNlbGYucmVnaXN0U2luZ2VsUm93RmlsdGVyKGl0ZW0pOwogICAgLy8gc2VsZi5yZWdpc3RTaW5nZWxSb3dGb3JtYXRlcihpdGVtKQogICAgLy8gc2VsZi5yZWdpc3RTaW5nZWxSb3dTb3J0cyhpdGVtKQogICAgLy8gc2VsZi5yZWdpc3RTaW5nZWxSb3dSZW5kZXJlcihpdGVtKQogICAgLy8gc2VsZi5yZWdpc3RTaW5nUm93Q2FsY1JlbmRlcmVyKGl0ZW0pCiAgfSwKICByZWdpc3RTaW5nUm93Q2FsY1JlbmRlcmVyOiBmdW5jdGlvbiByZWdpc3RTaW5nUm93Q2FsY1JlbmRlcmVyKGl0ZW0pIHsKICAgIC8vIOazqOWGjOWNleadoeaVsOaNruiuoeeul+a4suafk+WZqAogICAgaWYgKGl0ZW0uZm9ybXVsYSAmJiAhaXRlbS5lZGl0UmVuZGVyKSB7CiAgICAgIGl0ZW0uZWRpdFJlbmRlciA9IHsKICAgICAgICBuYW1lOiAnJHZ4ZUNhbGN1bGF0ZScKICAgICAgfTsKICAgIH0KICB9LAogIHJlZ2lzdFNpbmdlbFJvd0ZpbHRlcl9vbGQ6IGZ1bmN0aW9uIHJlZ2lzdFNpbmdlbFJvd0ZpbHRlcl9vbGQoaXRlbSkgewogICAgLy8g57uR5a6a5Y2V5p2h5YiX6L+H5ruk5Zmo6YWN572uCiAgICBpZiAoQXJyYXkuaXNBcnJheShpdGVtLmNoaWxkcmVuKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoaXRlbS5maWx0ZXJzICE9PSB1bmRlZmluZWQgfHwgaXRlbS5maWx0ZXJzIHx8IGl0ZW0uZmlsdGVyUmVuZGVyICE9PSB1bmRlZmluZWQgfHwgaXRlbS5maWx0ZXJSZW5kZXIpIHsKICAgICAgLy8gaWYgKGl0ZW0uZmlsdGVycyA9PT0gZmFsc2UpIHsKICAgICAgLy8gICBkZWxldGUgaXRlbS5maWx0ZXJzCiAgICAgIC8vICAgZGVsZXRlIGl0ZW0uZmlsdGVyUmVuZGVyCiAgICAgIC8vICAgZGVsZXRlIGl0ZW0uZmlsdGVyTWV0aG9kCiAgICAgIC8vIH0KCiAgICAgIC8vIHR5cGUrZWRpdGFibGUKICAgICAgLy8geyB2YWx1ZTogJyR2eGVJbnB1dCcsIGxhYmVsOiAn6L6T5YWl5qGGJyB9LAogICAgICAvLyB7IHZhbHVlOiAnJHZ4ZVNlbGVjdCcsIGxhYmVsOiAn5LiL5ouJ6YCJ5oupJyB9LAogICAgICAvLyB7IHZhbHVlOiAnJHZ4ZUNhbGN1bGF0ZScsIGxhYmVsOiAn6K6h566XJyB9LAogICAgICAvLyB7IHZhbHVlOiAnJHZ4ZU1vbmV5JywgbGFiZWw6ICfph5Hpop0nIH0sCiAgICAgIC8vIHsgdmFsdWU6ICckdnhlRWRpdERvd25UZXh0YXJlYScsIGxhYmVsOiAn5paH5pys6L6T5YWl5qGGJyB9LAogICAgICAvLyB7IHZhbHVlOiAnJHZ4ZURheXMnLCBsYWJlbDogJ+WkqeaVsCcgfSwKICAgICAgLy8geyB2YWx1ZTogJyR2eGVUaW1lJywgbGFiZWw6ICfml7bpl7QnIH0sCiAgICAgIC8vIHsgdmFsdWU6ICckdnhlUmFkaW8nLCBsYWJlbDogJ+WNlemAiScgfSwKICAgICAgLy8geyB2YWx1ZTogJyR2eGVDaGVja2JveCcsIGxhYmVsOiAn5aSN6YCJJyB9LAogICAgICAvLyB7IHZhbHVlOiAnJHRyZWVpbnB1dCcsIGxhYmVsOiAn5LiL5ouJ5qCRJyB9LAogICAgICAvLyB7IHZhbHVlOiAnJEVkaXREb3duSnNvbicsIGxhYmVsOiAnSlNPTicgfSwKICAgICAgLy8geyB2YWx1ZTogJyRocmVmJywgbGFiZWw6ICfpk77mjqUnIH0KICAgICAgcmV0dXJuOwogICAgfQogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgdmFyIGl0ZW1SZW5kZXIgPSBpdGVtLmNlbGxSZW5kZXIgfHwgaXRlbS5lZGl0UmVuZGVyIHx8IGl0ZW0uY29udGVudFJlbmRlcjsKICAgIGlmIChpdGVtLmZpbHRlcnMgPT09IHVuZGVmaW5lZCB8fCBpdGVtLmZpbHRlcnMgPT09IHRydWUpIHsKICAgICAgaWYgKGl0ZW0uZmllbGQgJiYgc2VsZi50YWJsZUNvbmZpZ0NwLmZpbHRlcnNbaXRlbS5maWVsZF0pIHsKICAgICAgICBpdGVtLmZpbHRlcnMgPSBzZWxmLnRhYmxlQ29uZmlnQ3AuZmlsdGVyc1tpdGVtLmZpZWxkXS5maWx0ZXJzID8gc2VsZi50YWJsZUNvbmZpZ0NwLmZpbHRlcnNbaXRlbS5maWVsZF0uZmlsdGVycyA6IFt7CiAgICAgICAgICBkYXRhOiAnJwogICAgICAgIH1dOwogICAgICAgIGlmICh0eXBlb2Ygc2VsZi50YWJsZUNvbmZpZ0NwLmZpbHRlcnNbaXRlbS5maWVsZF0uZmlsdGVyTWV0aG9kID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICBpdGVtLmZpbHRlck1ldGhvZCA9IHNlbGYudGFibGVDb25maWdDcC5maWx0ZXJzW2l0ZW0uZmllbGRdLmZpbHRlck1ldGhvZCA/IHNlbGYudGFibGVDb25maWdDcC5maWx0ZXJzW2l0ZW0uZmllbGRdLmZpbHRlck1ldGhvZCA6IGZ1bmN0aW9uIChfcmVmNikgewogICAgICAgICAgICB2YXIgb3B0aW9uID0gX3JlZjYub3B0aW9uLAogICAgICAgICAgICAgIHJvdyA9IF9yZWY2LnJvdywKICAgICAgICAgICAgICBjb2x1bW4gPSBfcmVmNi5jb2x1bW47CiAgICAgICAgICAgIHJldHVybiByb3dbY29sdW1uLnByb3BlcnR5XSA9PT0gTnVtYmVyKG9wdGlvbi5kYXRhKTsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGl0ZW0uZmllbGQgJiYgaXRlbVJlbmRlcikgewogICAgICAgIHN3aXRjaCAoaXRlbVJlbmRlci5uYW1lKSB7CiAgICAgICAgICBjYXNlICckc2VsZWN0JzoKICAgICAgICAgICAgaXRlbS5maWx0ZXJzID0gQXJyYXkuaXNBcnJheShpdGVtUmVuZGVyLm9wdGlvbnMpID8gaXRlbVJlbmRlci5vcHRpb25zIDogW107CiAgICAgICAgICAgIGl0ZW0uZmlsdGVyTXVsdGlwbGUgPSB0cnVlOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgJyR2eGVTZWxlY3QnOgogICAgICAgICAgICBpdGVtLmZpbHRlcnMgPSBBcnJheS5pc0FycmF5KGl0ZW1SZW5kZXIub3B0aW9ucykgPyBpdGVtUmVuZGVyLm9wdGlvbnMgOiBbXTsKICAgICAgICAgICAgaXRlbS5maWx0ZXJNdWx0aXBsZSA9IHRydWU7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAnJGNhbGN1bGF0ZVJlbmRlcic6CiAgICAgICAgICAgIGl0ZW0uZmlsdGVycyA9IFt7CiAgICAgICAgICAgICAgZGF0YTogewogICAgICAgICAgICAgICAgdHlwZTogJ2hhcycsCiAgICAgICAgICAgICAgICBpc0Nhc2U6IGZhbHNlLAogICAgICAgICAgICAgICAgdmFsdWU6ICcnLAogICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdmbG9hdCcKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH1dOwogICAgICAgICAgICBpdGVtLmZpbHRlclJlbmRlciA9IHsKICAgICAgICAgICAgICBuYW1lOiAnRmlsdGVyQ29tcGxleCcKICAgICAgICAgICAgfTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICckdnhlQ2FsY3VsYXRlJzoKICAgICAgICAgICAgaXRlbS5maWx0ZXJzID0gW3sKICAgICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgICB0eXBlOiAnaGFzJywKICAgICAgICAgICAgICAgIGlzQ2FzZTogZmFsc2UsCiAgICAgICAgICAgICAgICB2YWx1ZTogJycsCiAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ2Zsb2F0JwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfV07CiAgICAgICAgICAgIGl0ZW0uZmlsdGVyUmVuZGVyID0gewogICAgICAgICAgICAgIG5hbWU6ICdGaWx0ZXJDb21wbGV4JwogICAgICAgICAgICB9OwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgJyRtb25leVJlbmRlcic6CiAgICAgICAgICAgIGl0ZW0uZmlsdGVycyA9IFt7CiAgICAgICAgICAgICAgZGF0YTogewogICAgICAgICAgICAgICAgdHlwZTogJ2hhcycsCiAgICAgICAgICAgICAgICBpc0Nhc2U6IGZhbHNlLAogICAgICAgICAgICAgICAgdmFsdWU6ICcnLAogICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdmbG9hdCcKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH1dOwogICAgICAgICAgICBpdGVtLmZpbHRlclJlbmRlciA9IHsKICAgICAgICAgICAgICBuYW1lOiAnRmlsdGVyQ29tcGxleCcKICAgICAgICAgICAgfTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICckdnhlTW9uZXknOgogICAgICAgICAgICBpdGVtLmZpbHRlcnMgPSBbewogICAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICAgIHR5cGU6ICdoYXMnLAogICAgICAgICAgICAgICAgaXNDYXNlOiBmYWxzZSwKICAgICAgICAgICAgICAgIHZhbHVlOiAnJywKICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnZmxvYXQnCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9XTsKICAgICAgICAgICAgaXRlbS5maWx0ZXJSZW5kZXIgPSB7CiAgICAgICAgICAgICAgbmFtZTogJ0ZpbHRlckNvbXBsZXgnCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAnJGhyZWYnOgogICAgICAgICAgICBpdGVtLmZpbHRlcnMgPSBbewogICAgICAgICAgICAgIGRhdGE6ICcnCiAgICAgICAgICAgIH1dOwogICAgICAgICAgICBpdGVtLmZpbHRlclJlbmRlciA9IHsKICAgICAgICAgICAgICBuYW1lOiAnRmlsdGVySW5wdXQnCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAnJHZ4ZVJhZGlvJzoKICAgICAgICAgICAgaXRlbS5maWx0ZXJzID0gQXJyYXkuaXNBcnJheShpdGVtUmVuZGVyLm9wdGlvbnMpID8gaXRlbVJlbmRlci5vcHRpb25zIDogW107CiAgICAgICAgICAgIGl0ZW0uZmlsdGVyTXVsdGlwbGUgPSB0cnVlOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgJyR2eGVDaGVja2JveCc6CiAgICAgICAgICAgIGl0ZW0uZmlsdGVycyA9IFt7CiAgICAgICAgICAgICAgZGF0YTogewogICAgICAgICAgICAgICAgdmFsczogW10sCiAgICAgICAgICAgICAgICBzVmFsOiAnJwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfV07CiAgICAgICAgICAgIGl0ZW0uZmlsdGVyUmVuZGVyID0gewogICAgICAgICAgICAgIG5hbWU6ICdGaWx0ZXJDaG9vc2UnCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAnJHZ4ZUlucHV0JzoKICAgICAgICAgICAgLy8gdGV4dCwgc2VhcmNoLCBudW1iZXIsIGludGVnZXIsIGZsb2F0LCBwYXNzd29yZCwgZGF0ZSwgZGF0ZXRpbWUsIHdlZWssIG1vbnRoLCB5ZWFyCiAgICAgICAgICAgIGlmICh0aGlzLmdldGJhc2ljRGF0YVR5cGUoaXRlbVJlbmRlci5wcm9wcykgPT09ICdPYmplY3QnICYmIGl0ZW1SZW5kZXIucHJvcHMudHlwZSkgewogICAgICAgICAgICAgIHN3aXRjaCAoaXRlbVJlbmRlci5wcm9wcy50eXBlKSB7CiAgICAgICAgICAgICAgICBjYXNlICd0ZXh0JzoKICAgICAgICAgICAgICAgICAgaXRlbS5maWx0ZXJzID0gW3sKICAgICAgICAgICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgICAgICAgICB2YWxzOiBbXSwKICAgICAgICAgICAgICAgICAgICAgIHNWYWw6ICcnCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9XTsKICAgICAgICAgICAgICAgICAgaXRlbS5maWx0ZXJSZW5kZXIgPSB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ0ZpbHRlckNvbnRlbnQnCiAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnZmxvYXQnOgogICAgICAgICAgICAgICAgICBpdGVtLmZpbHRlcnMgPSBbewogICAgICAgICAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdoYXMnLAogICAgICAgICAgICAgICAgICAgICAgaXNDYXNlOiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiAnJywKICAgICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnZmxvYXQnCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9XTsKICAgICAgICAgICAgICAgICAgaXRlbS5maWx0ZXJSZW5kZXIgPSB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ0ZpbHRlckNvbXBsZXgnCiAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnbnVtYmVyJzoKICAgICAgICAgICAgICAgICAgaXRlbS5maWx0ZXJzID0gW3sKICAgICAgICAgICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnaGFzJywKICAgICAgICAgICAgICAgICAgICAgIGlzQ2FzZTogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogJycsCiAgICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ251bWJlcicKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH1dOwogICAgICAgICAgICAgICAgICBpdGVtLmZpbHRlclJlbmRlciA9IHsKICAgICAgICAgICAgICAgICAgICBuYW1lOiAnRmlsdGVyQ29tcGxleCcKICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlICd5ZWFyJzoKICAgICAgICAgICAgICAgICAgaXRlbS5maWx0ZXJzID0gW3sKICAgICAgICAgICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnaGFzJywKICAgICAgICAgICAgICAgICAgICAgIGlzQ2FzZTogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogJycsCiAgICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogJ3llYXInCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9XTsKICAgICAgICAgICAgICAgICAgaXRlbS5maWx0ZXJSZW5kZXIgPSB7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ0ZpbHRlckNvbXBsZXgnCiAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAnZGF0ZSc6CiAgICAgICAgICAgICAgICAgIGl0ZW0uZmlsdGVycyA9IFt7CiAgICAgICAgICAgICAgICAgICAgZGF0YTogewogICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2hhcycsCiAgICAgICAgICAgICAgICAgICAgICBpc0Nhc2U6IGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICcnLAogICAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6ICdkYXRlJwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfV07CiAgICAgICAgICAgICAgICAgIGl0ZW0uZmlsdGVyUmVuZGVyID0gewogICAgICAgICAgICAgICAgICAgIG5hbWU6ICdGaWx0ZXJDb21wbGV4JwogICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgIGlmIChpdGVtUmVuZGVyLm5hbWUgPT09ICckb3B0aW9uU29ydCcgfHwgaXRlbVJlbmRlci5uYW1lID09PSAnb3B0aW9uUm93JykgewogICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBpdGVtLmZpbHRlcnM7CiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uZmlsdGVyUmVuZGVyOwogICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBpdGVtLmZpbHRlck1ldGhvZDsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpdGVtLmZpbHRlcnMgPSBbewogICAgICAgICAgICAgICAgICAgICAgZGF0YTogJycKICAgICAgICAgICAgICAgICAgICB9XTsKICAgICAgICAgICAgICAgICAgICBpdGVtLmZpbHRlclJlbmRlciA9IHsKICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICdGaWx0ZXJJbnB1dCcKICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBpdGVtLmZpbHRlcnMgPSBbewogICAgICAgICAgICAgICAgZGF0YTogJycKICAgICAgICAgICAgICB9XTsKICAgICAgICAgICAgICBpdGVtLmZpbHRlclJlbmRlciA9IHsKICAgICAgICAgICAgICAgIG5hbWU6ICdGaWx0ZXJJbnB1dCcKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAnJEVkaXREb3duVGV4dGFyZWEnOgogICAgICAgICAgICBpdGVtLmZpbHRlcnMgPSBbewogICAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICAgIHZhbHM6IFtdLAogICAgICAgICAgICAgICAgc1ZhbDogJycKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH1dOwogICAgICAgICAgICBpdGVtLmZpbHRlclJlbmRlciA9IHsKICAgICAgICAgICAgICBuYW1lOiAnRmlsdGVyQ29udGVudCcKICAgICAgICAgICAgfTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICckdnhlRWRpdERvd25UZXh0YXJlYSc6CiAgICAgICAgICAgIGl0ZW0uZmlsdGVycyA9IFt7CiAgICAgICAgICAgICAgZGF0YTogewogICAgICAgICAgICAgICAgdmFsczogW10sCiAgICAgICAgICAgICAgICBzVmFsOiAnJwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfV07CiAgICAgICAgICAgIGl0ZW0uZmlsdGVyUmVuZGVyID0gewogICAgICAgICAgICAgIG5hbWU6ICdGaWx0ZXJDb250ZW50JwogICAgICAgICAgICB9OwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgJyR0cmVlaW5wdXQnOgogICAgICAgICAgICBpdGVtLmZpbHRlcnMgPSBbewogICAgICAgICAgICAgIGRhdGE6IHsKICAgICAgICAgICAgICAgIHZhbHM6IFtdLAogICAgICAgICAgICAgICAgc1ZhbDogJycKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH1dOwogICAgICAgICAgICBpdGVtLmZpbHRlclJlbmRlciA9IHsKICAgICAgICAgICAgICBuYW1lOiAnRmlsdGVyQ29udGVudCcKICAgICAgICAgICAgfTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBpZiAoWydzZXEnLCAnY2hlY2tib3gnLCAnZHJhZ1NvcnQnLCAncmFkaW8nLCAnb3B0aW9uUm93J10uaW5kZXhPZihpdGVtLnR5cGUpKSB7CiAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uZmlsdGVyczsKICAgICAgICAgICAgICBkZWxldGUgaXRlbS5maWx0ZXJSZW5kZXI7CiAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uZmlsdGVyTWV0aG9kOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGl0ZW0uZmlsdGVycyA9IFt7CiAgICAgICAgICAgICAgICBkYXRhOiAnJwogICAgICAgICAgICAgIH1dOwogICAgICAgICAgICAgIGl0ZW0uZmlsdGVyUmVuZGVyID0gewogICAgICAgICAgICAgICAgbmFtZTogJ0ZpbHRlcklucHV0JwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGl0ZW0uZmlsdGVycyA9IFt7CiAgICAgICAgICBkYXRhOiAnJwogICAgICAgIH1dOwogICAgICAgIGl0ZW0uZmlsdGVyUmVuZGVyID0gewogICAgICAgICAgbmFtZTogJ0ZpbHRlcklucHV0JwogICAgICAgIH07CiAgICAgIH0KICAgIH0KICB9LAogIHJlZ2lzdFNpbmdlbFJvd0ZpbHRlcjogZnVuY3Rpb24gcmVnaXN0U2luZ2VsUm93RmlsdGVyKGl0ZW0pIHsKICAgIC8vIOe7keWumuWNleadoeWIl+i/h+a7pOWZqOmFjee9rgogICAgaWYgKEFycmF5LmlzQXJyYXkoaXRlbS5jaGlsZHJlbikpIHsKICAgICAgcmV0dXJuIGl0ZW07CiAgICB9CiAgICB0cnkgewogICAgICB2YXIgaXRlbVJlbmRlciA9IGl0ZW0uY2VsbFJlbmRlciB8fCBpdGVtLmVkaXRSZW5kZXI7CiAgICAgIGlmIChpdGVtUmVuZGVyICYmIChpdGVtLmZpbHRlcnMgKyAnJyA9PT0gJ3RydWUnIHx8IGl0ZW0uZmlsdGVycyArICcnID09PSAndW5kZWZpbmVkJykpIHsKICAgICAgICBpZiAoaXRlbVJlbmRlci5uYW1lICYmIGZpbHRlclR5cGVNYXBbaXRlbVJlbmRlci5uYW1lXSkgewogICAgICAgICAgaWYgKGl0ZW1SZW5kZXIubmFtZSA9PT0gJyR2eGVJbnB1dCcpIHsKICAgICAgICAgICAgaWYgKHRoaXMuZ2V0YmFzaWNEYXRhVHlwZShpdGVtUmVuZGVyLnByb3BzKSA9PT0gJ09iamVjdCcgJiYgZmlsdGVyVHlwZU1hcFsnJHZ4ZUlucHV0J11baXRlbVJlbmRlci5uYW1lICsgaXRlbVJlbmRlci5wcm9wcy50eXBlXSkgewogICAgICAgICAgICAgIGl0ZW0gPSBPYmplY3QuYXNzaWduKHt9LCBpdGVtLCBmaWx0ZXJUeXBlTWFwWyckdnhlSW5wdXQnXVtpdGVtUmVuZGVyLm5hbWUgKyBpdGVtUmVuZGVyLnByb3BzLnR5cGVdKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBpdGVtID0gT2JqZWN0LmFzc2lnbih7fSwgaXRlbSwgZmlsdGVyVHlwZU1hcFsnJHZ4ZUlucHV0J11baXRlbVJlbmRlci5uYW1lICsgJ2dsb2JhbCddKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaXRlbSA9IE9iamVjdC5hc3NpZ24oe30sIGl0ZW0sIGZpbHRlclR5cGVNYXBbaXRlbVJlbmRlci5uYW1lXSk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN3aXRjaCAoaXRlbVJlbmRlci5uYW1lKSB7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgaWYgKFsnc2VxJywgJ2NoZWNrYm94JywgJ2RyYWdTb3J0JywgJ3JhZGlvJywgJ29wdGlvblJvdyddLmluZGV4T2YoaXRlbS50eXBlKSA+PSAwKSB7CiAgICAgICAgICAgICAgICBkZWxldGUgaXRlbS5maWx0ZXJzOwogICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uZmlsdGVyUmVuZGVyOwogICAgICAgICAgICAgICAgZGVsZXRlIGl0ZW0uZmlsdGVyTWV0aG9kOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpdGVtLmZpbHRlcnMgPSBbewogICAgICAgICAgICAgICAgICBkYXRhOiAnJwogICAgICAgICAgICAgICAgfV07CiAgICAgICAgICAgICAgICBpdGVtLmZpbHRlclJlbmRlciA9IHsKICAgICAgICAgICAgICAgICAgbmFtZTogJ0ZpbHRlcklucHV0JwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKCEoX3R5cGVvZihpdGVtLmZpbHRlcnMpID09PSAnb2JqZWN0JykpIHsKICAgICAgICBpdGVtLmZpbHRlcnMgPSBmYWxzZTsKICAgICAgfSBlbHNlIHt9CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIHRocm93IGU7CiAgICB9CiAgICByZXR1cm4gaXRlbTsKICB9LAogIHJlZ2lzdFNpbmdlbFJvd0Zvcm1hdGVyOiBmdW5jdGlvbiByZWdpc3RTaW5nZWxSb3dGb3JtYXRlcihpdGVtKSB7CiAgICAvLyDnu5HlrprljZXmnaHliJfmoLzlvI/ljJbphY3nva4g5bqf5byDCiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICBpZiAoaXRlbS5maWVsZCAmJiBzZWxmLnRhYmxlQ29uZmlnQ3AuZm9ybWF0dGVyc1tpdGVtLmZpZWxkXSkgewogICAgICBpdGVtLmZvcm1hdHRlciA9IHNlbGYudGFibGVDb25maWdDcC5mb3JtYXR0ZXJzW2l0ZW0uZmllbGRdOwogICAgfQogIH0sCiAgcmVnaXN0U2luZ2VsUm93UmVuZGVyZXI6IGZ1bmN0aW9uIHJlZ2lzdFNpbmdlbFJvd1JlbmRlcmVyKGl0ZW0pIHsKICAgIC8vIOe7keWumuWNleadoeWIl+a4suafk+WZqOmFjee9riDlup/lvIMKICAgIHZhciBzZWxmID0gdGhpczsKICAgIHZhciBpdGVtUmVuZGVyID0gaXRlbS5jZWxsUmVuZGVyIHx8IGl0ZW0uZWRpdFJlbmRlciB8fCBpdGVtLmNvbnRlbnRSZW5kZXI7CiAgICBpZiAoaXRlbS5maWVsZCAmJiBzZWxmLnRhYmxlQ29uZmlnQ3AuY2VsbFJlbmRlckNvbmZpZ1tpdGVtLmZpZWxkXSAmJiAhaXRlbVJlbmRlcikgewogICAgICBpdGVtW3NlbGYudGFibGVDb25maWdDcC5jZWxsUmVuZGVyQ29uZmlnW2l0ZW0uZmllbGRdLnR5cGVdID0gc2VsZi50YWJsZUNvbmZpZ0NwLmNlbGxSZW5kZXJDb25maWdbaXRlbS5maWVsZF07CiAgICB9CiAgfSwKICByZWdpc3RTaW5nZWxSb3dTb3J0czogZnVuY3Rpb24gcmVnaXN0U2luZ2VsUm93U29ydHMoaXRlbSkgewogICAgLy8g57uR5a6a5Y2V5p2h5YiX5o6S5bqP6YWN572uCiAgICBpZiAoIWl0ZW0uY2hpbGRyZW4gJiYgaXRlbVsnc29ydGFibGUnXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIGl0ZW1bJ3NvcnRhYmxlJ10gPSBpdGVtWydzb3J0YWJsZSddIHx8IHRydWU7CiAgICB9CiAgfSwKICByZWdpc3RSZW5kZXJlcnM6IGZ1bmN0aW9uIHJlZ2lzdFJlbmRlcmVycygpIHsKICAgIHZhciBhcnIgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IFtdOwogICAgLy8g5Yid5aeL5YyW57uR5a6a5YiX5riy5p+T5ZmoCiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICBmdW5jdGlvbiByZXZlclJlZ2lzdFJlbmRlcmVycyhhcnJjKSB7CiAgICAgIGFycmMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHsKICAgICAgICByZXZlclJlZ2lzdFJlbmRlcmVycyhpdGVtKTsKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShpdGVtLmNoaWxkcmVuKSAmJiBpdGVtLmNoaWxkcmVuLmxlbmd0aCkgewogICAgICAgICAgc2VsZi5yZWdpc3RSZW5kZXJlcnMoaXRlbS5jaGlsZHJlbik7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICAgIHJldmVyUmVnaXN0UmVuZGVyZXJzKGFycik7CiAgfSwKICByZWdpc3RGaWx0ZXJzOiBmdW5jdGlvbiByZWdpc3RGaWx0ZXJzKCkgewogICAgdmFyIGFyciA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogW107CiAgICAvLyDliJ3lp4vljJbnu5HlrprliJfov4fmu6Tlmajlh73mlbAg5bqf5byDCiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICBhcnIuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHsKICAgICAgc2VsZi5yZWdpc3RTaW5nZWxSb3dGaWx0ZXIoaXRlbSk7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KGl0ZW0uY2hpbGRyZW4pICYmIGl0ZW0uY2hpbGRyZW4ubGVuZ3RoKSB7CiAgICAgICAgc2VsZi5yZWdpc3RGb3JtYXR0ZXJzKGl0ZW0uY2hpbGRyZW4pOwogICAgICB9CiAgICB9KTsKICB9LAogIHJlZ2lzdEZvcm1hdHRlcnM6IGZ1bmN0aW9uIHJlZ2lzdEZvcm1hdHRlcnMoKSB7CiAgICB2YXIgYXJyID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiBbXTsKICAgIC8vIOWIneWni+WMlue7keWumuWIl+agvOW8j+WMluWHveaVsCDlup/lvIMKICAgIHZhciBzZWxmID0gdGhpczsKICAgIGFyci5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtLCBpbmRleCkgewogICAgICBzZWxmLnJlZ2lzdFNpbmdlbFJvd0Zvcm1hdGVyKGl0ZW0pOwogICAgICBpZiAoQXJyYXkuaXNBcnJheShpdGVtLmNoaWxkcmVuKSAmJiBpdGVtLmNoaWxkcmVuLmxlbmd0aCkgewogICAgICAgIHNlbGYucmVnaXN0Rm9ybWF0dGVycyhpdGVtLmNoaWxkcmVuKTsKICAgICAgfQogICAgfSk7CiAgfSwKICByZWdpc3RUYWJsZVJlbmRlcjogZnVuY3Rpb24gcmVnaXN0VGFibGVSZW5kZXIocmVuZGVyZXJzKSB7CiAgICAvLyDms6jlhozmuLLmn5PlmagKICAgIGZvciAodmFyIGkgaW4gcmVuZGVyZXJzKSB7CiAgICAgIHRoaXMuJFZYRVRhYmxlLnJlbmRlcmVyLmFkZChpLCByZW5kZXJlcnNbaV0pOwogICAgfQogIH0KfTsKdmFyIGluaXRNZXRob2RzID0gewogIGluaXRDcmVhdGVkOiBmdW5jdGlvbiBpbml0Q3JlYXRlZCgpIHsKICAgIHRoaXMuaW5pdENvbHVtbk1vbmV5RmlsdGVyKCk7CgogICAgLy8g5Yid5aeL5YyWQ3JlYXRlZAogICAgLy8g5Y2z5bCG5bqf5byDCiAgICAvLyB0aGlzLnJlZ2lzdFRhYmxlUmVuZGVyKGRlZmF1bHRSZW5kZXJlcnMpCiAgICAvLyB0aGlzLnJlZ2lzdEdsb2JsZUZvcm1hdHRlcnMoZGVmYXVsdEZvcm1hdHRlcnMpCiAgICAvLyB0aGlzLnRhYmxlR2xvYmFsQ29uZmlnLmRyYWdDb2x1bW5zQ29uZmlnICYmIHRoaXMudGFibGVHbG9iYWxDb25maWcuZHJhZ0NvbHVtbnNDb25maWcub3BlbkRyYWcgJiYgdGhpcy5zZXRDb2x1bW5Ecm9wKCkKICB9LAogIGluaXRNb3VudGVkOiBmdW5jdGlvbiBpbml0TW91bnRlZCgpIHsKICAgIC8vIOWIneWni+WMlk1vdW50ZWQKICAgIHRoaXMuaW5pdEZpcnN0KCk7CiAgICBpZiAodGhpcy50YWJsZUdsb2JhbENvbmZpZ0luLmRyYWdDb2x1bW5zQ29uZmlnICYmIHRoaXMudGFibGVHbG9iYWxDb25maWdJbi5kcmFnQ29sdW1uc0NvbmZpZy5vcGVuRHJhZyB8fCB0aGlzLnRhYmxlR2xvYmFsQ29uZmlnSW4uY29sdW1uRHJvcCkgewogICAgICB0aGlzLnNldENvbHVtbkRyb3AoKTsKICAgIH0KICAgIGlmICh0aGlzLnRhYmxlR2xvYmFsQ29uZmlnSW4ucm93RHJvcCkgewogICAgICB0aGlzLnNldFJvd0Ryb3AoKTsKICAgIH0KICB9LAogIGluaXRGaXJzdDogZnVuY3Rpb24gaW5pdEZpcnN0KCkgewogICAgLy8g57uE5Lu25Yid5aeL5YyWCiAgICB0aGlzLmluaXRUYWJsZUdsb2JhbENvbmZpZygpOwogICAgdGhpcy5pbml0Q29udGV4dE1lbnVDb25maWcoKTsKICAgIHRoaXMuaW5pdFNlcUNvbmZpZygpOwogICAgdGhpcy5pbml0RXhwYW5kQ29uZmlnKCk7CiAgICB0aGlzLmluaXRUb29sYmFyKCk7CiAgICB0aGlzLmluaXRFZGl0Q29uZmlnKCk7CiAgICB0aGlzLmluaXRUYWJsZUZvcm1Db25maWcoKTsKICAgIHRoaXMuaW5pdENhbGN1bGF0ZUNvbnN0cmFpbnRDb25maWcoKTsKICAgIHRoaXMuaW5pdFRhYmxlQ29uZmlnKCk7CiAgICB0aGlzLmluaXRFZGl0UnVsZXMoKTsKICAgIHRoaXMuaW5pdFRhYmxlKCk7CiAgICB0aGlzLmluaXRUYWJsZURhdGEoKTsKICB9LAogIGluaXRUYWJsZTogZnVuY3Rpb24gaW5pdFRhYmxlKCkgewogICAgdGhpcy5pbml0VGFibGVDb25sdW1zKCk7CiAgICB0aGlzLnNldFBhZ2VyQ29uZmlnKCk7CiAgfSwKICBpbml0Q29sdW1uTW9uZXlGaWx0ZXI6IGZ1bmN0aW9uIGluaXRDb2x1bW5Nb25leUZpbHRlcigpIHsKICAgIC8vIOmHkeminei/h+a7pAogICAgdGhpcy5zZXRDb2x1bW5Nb25leUZpbHRlcih0aGlzLnRhYmxlQ29sdW1uc0NvbmZpZyk7CiAgICB0aGlzLmNvbXBsZXRlTW9uZXlGaWx0ZXIgPSB0cnVlOwogIH0sCiAgaW5pdFRhYmxlR2xvYmFsQ29uZmlnOiBmdW5jdGlvbiBpbml0VGFibGVHbG9iYWxDb25maWcoKSB7CiAgICAvLyDliJ3lp4vljJblhajlsYDphY3nva4KICAgIHRoaXMudGFibGVHbG9iYWxDb25maWdJbiA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMudGFibGVHbG9iYWxDb25maWdJbiwgdGhpcy50YWJsZUdsb2JhbENvbmZpZyk7CiAgfSwKICBpbml0VGFibGVDb25maWc6IGZ1bmN0aW9uIGluaXRUYWJsZUNvbmZpZygpIHsKICAgIC8vIOWIneWni+WMluihqOagvOWIl+WSjOa4suafk+WZqOmFjee9rgogICAgdGhpcy50YWJsZUNvbmZpZ0NwID0gT2JqZWN0LmFzc2lnbih7CiAgICAgIGdsb2JhbENvbmZpZzogewogICAgICAgIGNoZWNrVHlwZTogJ2NoZWNrYm94JywKICAgICAgICBzZXE6IHRydWUsCiAgICAgICAgZmlsdGVyczogdHJ1ZSwKICAgICAgICBzb3J0YWJsZTogZmFsc2UKICAgICAgfQogICAgfSwgdGhpcy50YWJsZUNvbmZpZyB8fCB0aGlzLnRhYmxlR2xvYmFsQ29uZmlnSW4udGFibGVDb25maWcpOwogICAgdGhpcy5pbml0VGFibGVDb25sdW1zKCk7CiAgICB0aGlzLnJlZ2lzdFRhYmxlUmVuZGVyKHRoaXMudGFibGVDb25maWdDcC5yZW5kZXJlcnMpOwogIH0sCiAgaW5pdENhY2hlQ29sdW1uOiBmdW5jdGlvbiBpbml0Q2FjaGVDb2x1bW4oKSB7CiAgICB2YXIgZGF0YSA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0odGhpcy50YWJsZUlkIHx8ICcnKSB8fCAnW10nKS5tYXAoZnVuY3Rpb24gKGssIHYpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBmaWVsZDogaywKICAgICAgICBpbmRleDogdgogICAgICB9OwogICAgfSk7CiAgICB2YXIgdGFibGVDb2x1bW5zQ29uZmlnID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeSh0aGlzLnRhYmxlQ29sdW1uc0NvbmZpZykpOwogICAgdmFyIGFyciA9IGRhdGEubGVuZ3RoID8gdGFibGVDb2x1bW5zQ29uZmlnLm1hcChmdW5jdGlvbiAoaXRlbSkgewogICAgICB2YXIgb2JqID0ge307CiAgICAgIHZhciBfaXRlcmF0b3IyID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIoZGF0YSksCiAgICAgICAgX3N0ZXAyOwogICAgICB0cnkgewogICAgICAgIGZvciAoX2l0ZXJhdG9yMi5zKCk7ICEoX3N0ZXAyID0gX2l0ZXJhdG9yMi5uKCkpLmRvbmU7KSB7CiAgICAgICAgICB2YXIgaXRlbTIgPSBfc3RlcDIudmFsdWU7CiAgICAgICAgICBpZiAoaXRlbS5maWVsZCA9PT0gaXRlbTIuZmllbGQpIHsKICAgICAgICAgICAgb2JqID0gX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKHt9LCBpdGVtKSwgaXRlbTIpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgX2l0ZXJhdG9yMi5lKGVycik7CiAgICAgIH0gZmluYWxseSB7CiAgICAgICAgX2l0ZXJhdG9yMi5mKCk7CiAgICAgIH0KICAgICAgcmV0dXJuIG9iajsKICAgIH0pIDogW107CiAgICBhcnIuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICByZXR1cm4gYS5pbmRleCAtIGIuaW5kZXg7CiAgICB9KTsKICAgIHJldHVybiBhcnIubGVuZ3RoID8gYXJyIDogdGFibGVDb2x1bW5zQ29uZmlnOwogIH0sCiAgaW5pdFRhYmxlQ29ubHVtczogZnVuY3Rpb24gaW5pdFRhYmxlQ29ubHVtcyhjb2x1bW5zQ29uZmlnKSB7CiAgICAvLyDliJ3lp4vljJbliJfphY3nva4KICAgIHRoaXMuY2FsY3VsYXRlQ29uc3RyYWludENvbmZpZ0luID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5jYWxjdWxhdGVDb25zdHJhaW50Q29uZmlnSW4pOwogICAgdmFyIHRhYmxlQ29sdW1uc0NvbmZpZyA9IHRoaXMudGFibGVHbG9iYWxDb25maWcuZHJhZ0NvbHVtbnNDb25maWcgJiYgdGhpcy50YWJsZUdsb2JhbENvbmZpZy5kcmFnQ29sdW1uc0NvbmZpZy5jYWNoZVN0YXR1cyA/IHRoaXMuaW5pdENhY2hlQ29sdW1uKCkgOiBjb2x1bW5zQ29uZmlnIHx8IHRoaXMudGFibGVDb2x1bW5zQ29uZmlnOwogICAgaWYgKHRhYmxlQ29sdW1uc0NvbmZpZy5sZW5ndGgpIHsKICAgICAgdGhpcy5nZW5lcmF0ZUNhbGNDb2xGb3JtdWxhTWFwKHRhYmxlQ29sdW1uc0NvbmZpZyk7CiAgICAgIHRoaXMudGFibGVDb2x1bW5zQ29uZmlnSW4gPSB0aGlzLnVuaWRpcmVjdGlvbmFsRGF0YSA/IHRoaXMuZGVlcENvcHkodGhpcy5nZW5lcmF0ZVRhYmxlQ29ubHVtcyh0YWJsZUNvbHVtbnNDb25maWcsIHRoaXMudGFibGVDb25maWdDcC5nbG9iYWxDb25maWcpKSA6IHRoaXMuZ2VuZXJhdGVUYWJsZUNvbmx1bXModGFibGVDb2x1bW5zQ29uZmlnLCB0aGlzLnRhYmxlQ29uZmlnQ3AuZ2xvYmFsQ29uZmlnKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMudGFibGVDb2x1bW5zQ29uZmlnSW4gPSBbXTsKICAgIH0KICAgIHJldHVybiB0aGlzLnRhYmxlQ29sdW1uc0NvbmZpZ0luOwogIH0sCiAgaW5pdFNjcm9sbExvYWRDb25maWc6IGZ1bmN0aW9uIGluaXRTY3JvbGxMb2FkQ29uZmlnKHNjcm9sbExvYWRDb25maWcpIHsKICAgIHRoaXMuc2Nyb2xsTG9hZENvbmZpZ0NwID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5zY3JvbGxMb2FkQ29uZmlnQ3AsIHNjcm9sbExvYWRDb25maWcgfHwgdGhpcy5zY3JvbGxMb2FkQ29uZmlnKTsKICB9LAogIGdlbmVyYXRlVGFibGVDb25sdW1zOiBmdW5jdGlvbiBnZW5lcmF0ZVRhYmxlQ29ubHVtcyhjb25sdW1zLCBnbG9iYWxDb25maWcpIHsKICAgIC8vIOeUn+aIkOihqOWktAogICAgdmFyIHRhYmxlQ29sdW1uc0NvbmZpZ0luID0gW107CiAgICBpZiAoZ2xvYmFsQ29uZmlnLnJvd0Ryb3ApIHsKICAgICAgdGFibGVDb2x1bW5zQ29uZmlnSW4ucHVzaCh0YWJsZUNvbHVtbnNbJ3Jvd0Ryb3AnXSk7CiAgICB9CiAgICBpZiAoZ2xvYmFsQ29uZmlnLmNoZWNrVHlwZSkgewogICAgICB0YWJsZUNvbHVtbnNDb25maWdJbi5wdXNoKHRhYmxlQ29sdW1uc1tnbG9iYWxDb25maWcuY2hlY2tUeXBlXSk7CiAgICB9CiAgICBpZiAoZ2xvYmFsQ29uZmlnLnNlcSkgewogICAgICB0YWJsZUNvbHVtbnNDb25maWdJbi5wdXNoKHRhYmxlQ29sdW1uc1snc2VxJ10pOwogICAgfQogICAgdGFibGVDb2x1bW5zQ29uZmlnSW4gPSBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KHRhYmxlQ29sdW1uc0NvbmZpZ0luKSwgX3RvQ29uc3VtYWJsZUFycmF5KGNvbmx1bXMpKTsKICAgIGlmIChnbG9iYWxDb25maWcub3B0aW9uU29ydCkgewogICAgICB0YWJsZUNvbHVtbnNDb25maWdJbi5wdXNoKHRhYmxlQ29sdW1uc1snb3B0aW9uU29ydCddKTsKICAgIH0KICAgIHRoaXMucmVnaXN0R2xvYWJsZUNvbmx1bXNDb25maWcodGFibGVDb2x1bW5zQ29uZmlnSW4pOwogICAgcmV0dXJuIHRhYmxlQ29sdW1uc0NvbmZpZ0luOwogIH0sCiAgZ2VuZXJhdGVPcHRpb25Sb3c6IGZ1bmN0aW9uIGdlbmVyYXRlT3B0aW9uUm93KHRhYmxlQ29sdW1uc0NvbmZpZ0luLCBnbG9iYWxDb25maWcpIHsKICAgIC8vIOWIneWni+WMluaTjeS9nOWIlyDlup/lvIMKICAgIGlmIChnbG9iYWxDb25maWcuaGFzT3B0aW9uUm93KSB7CiAgICAgIHZhciBvcHRpb25Sb3cgPSB0YWJsZUNvbHVtbnNbJ29wdGlvblJvdyddOwogICAgICBpZiAodGhpcy5nZXRiYXNpY0RhdGFUeXBlKHRoaXMudGFibGVDb25maWdDcC5jZWxsUmVuZGVyQ29uZmlnLm9wdGlvblJvdykgPT09ICdPYmplY3QnKSB7CiAgICAgICAgdmFyIGNlbGxSZW5kZXIgPSBvcHRpb25Sb3cuY2VsbFJlbmRlcjsKICAgICAgICBjZWxsUmVuZGVyID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy50YWJsZUNvbmZpZ0NwLmNlbGxSZW5kZXJDb25maWcub3B0aW9uUm93KTsKICAgICAgICBvcHRpb25Sb3dbdGhpcy50YWJsZUNvbmZpZ0NwLmNlbGxSZW5kZXJDb25maWcub3B0aW9uUm93LnR5cGVdID0gY2VsbFJlbmRlcjsKICAgICAgfQogICAgICB0YWJsZUNvbHVtbnNDb25maWdJbi5wdXNoKG9wdGlvblJvdyk7CiAgICB9CiAgICByZXR1cm4gdGFibGVDb2x1bW5zQ29uZmlnSW47CiAgfSwKICBnZW5lcmF0ZUJvdHRvbUdyb3VwVG90YWw6IGZ1bmN0aW9uIGdlbmVyYXRlQm90dG9tR3JvdXBUb3RhbCgpIHsKICAgIC8vIOagueaNruihqOagvOS4iumdouW3sueul+WlveeahOWIhue7hOWQiOiuoe+8jOaxguacgOS4i+mdoueahOWIhue7hOWQiOiuoQogIH0sCiAgaW5pdENhbGN1bGF0ZUNvbnN0cmFpbnRDb25maWc6IGZ1bmN0aW9uIGluaXRDYWxjdWxhdGVDb25zdHJhaW50Q29uZmlnKCkgewogICAgLy8g5Yid5aeL5YyW6K6h566X5ZKM57qm5p2f6YWN572uCiAgICB0aGlzLmNhbGN1bGF0ZUNvbnN0cmFpbnRDb25maWdJbiA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuY2FsY3VsYXRlQ29uc3RyYWludENvbmZpZ0luLCB0aGlzLmNhbGN1bGF0ZUNvbnN0cmFpbnRDb25maWcpOwogICAgaWYgKHRoaXMuY2FsY3VsYXRlQ29uc3RyYWludENvbmZpZ0luLmNlbGxEYXRhQ29uZmlnICYmIHRoaXMuY2FsY3VsYXRlQ29uc3RyYWludENvbmZpZ0luLmNlbGxEYXRhQ29uZmlnLmxlbmd0aCkgewogICAgICB0aGlzLmdlbmVyYXRHZXREYXRhQ29uZmlnTWFwKHRoaXMuY2FsY3VsYXRlQ29uc3RyYWludENvbmZpZ0luLmNlbGxEYXRhQ29uZmlnKTsKICAgIH0KICAgIHRoaXMuY29uc3RyYWluUm93RGF0YU1hcCA9IHt9OwogIH0sCiAgaW5pdFRvb2xiYXI6IGZ1bmN0aW9uIGluaXRUb29sYmFyKHRvb2xiYXJDb25maWcpIHsKICAgIC8vIOWIneWni+WMluW3peWFt+agjwogICAgdmFyIGN1cnRvb2xiYXJDb25maWcgPSB0b29sYmFyQ29uZmlnIHx8IHRoaXMudG9vbGJhckNvbmZpZzsKICAgIGlmICh0aGlzLmdldGJhc2ljRGF0YVR5cGUoY3VydG9vbGJhckNvbmZpZykgPT09ICdCb29sZWFuJykgewogICAgICB0aGlzLnRvb2xiYXJDb25maWdJbiA9IHVuZGVmaW5lZDsKICAgICAgdGhpcy50b29sYmFyQ29uZmlnSW5Db3B5ID0gdGhpcy50b29sYmFyQ29uZmlnSW5DcCB8fCB7fTsKICAgIH0gZWxzZSB7CiAgICAgIGlmIChjdXJ0b29sYmFyQ29uZmlnLnZpc2libGUgPT09IGZhbHNlKSB7CiAgICAgICAgdGhpcy50b29sYmFyQ29uZmlnSW4gPSB1bmRlZmluZWQ7CiAgICAgICAgdGhpcy50b29sYmFyQ29uZmlnSW5Db3B5ID0gdGhpcy50b29sYmFyQ29uZmlnSW5DcDsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnRvb2xiYXJDb25maWdJbiA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMudG9vbGJhckNvbmZpZ0luQ3AsIGN1cnRvb2xiYXJDb25maWcpOwogICAgICAgIHRoaXMudG9vbGJhckNvbmZpZ0luQ29weSA9IHRoaXMudG9vbGJhckNvbmZpZ0luOwogICAgICB9CiAgICAgIGlmICh0aGlzLnRvb2xiYXJDb25maWdJbkNvcHkueWVhcmxpc3QubGVuZ3RoKSB7CiAgICAgICAgdGhpcy5mb3JtU2VhcmNoRGF0YS55ZWFyID0gdGhpcy50b29sYmFyQ29uZmlnSW5Db3B5LnllYXJsaXN0WzBdOwogICAgICB9CiAgICAgIHRoaXMuc2V0TW9uZXlVbml0KHRoaXMubW9uZXlVbml0KTsKICAgIH0KICB9LAogIGxvYWRTY3JvbGxUYWJsZURhdGE6IGZ1bmN0aW9uIGxvYWRTY3JvbGxUYWJsZURhdGEoZGF0YSkgewogICAgLy8g5Yqg6L295rua5Yqo5Yqg6L295pWw5o2uCiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICB0aGlzLmluaXRDYWxjdWxhdGVDb25zdHJhaW50Q29uZmlnKCk7CiAgICAvLyDliJ3lp4vljJbooajmoLzmlbDmja4KICAgIHRoaXMuc2VsZWN0aW9uID0gW107CiAgICBpZiAodGhpcy4kcmVmcy54R3JpZCkgewogICAgICB0aGlzLiRyZWZzLnhHcmlkLiRyZWZzLnhUYWJsZS50YWJsZVNvdXJjZURhdGEgPSBbXTsKICAgICAgdGhpcy4kcmVmcy54R3JpZC5yZW1vdmVDaGVja2JveFJvdygpOwogICAgfQogICAgdGhpcy50YWJsZURhdGFJbiA9IHRoaXMuZ2V0VGFibGVEYXRhKCkuZnVsbERhdGEuY29uY2F0KHRoaXMuYWRkTWlzc2luZ0ZpZWxkc0FuZENhbGNDb2xGb3JtdWxhKGRhdGEpKTsKICAgIHRoaXMuJG5leHRUaWNrKCkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgIGlmIChzZWxmLiRyZWZzLnhHcmlkKSB7CiAgICAgICAgc2VsZi4kcmVmcy54R3JpZC5yZWxvYWREYXRhKHNlbGYudGFibGVEYXRhSW4pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgc2VsZi4kcmVmcy54R3JpZC5jbGVhckZpbHRlcigpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICBzZWxmLiRyZWZzLnhHcmlkLiRyZWZzLnhUYWJsZS50YWJsZVNvdXJjZURhdGEgPSBzZWxmLmRlZXBDb3B5KHNlbGYuZ2V0VGFibGVEYXRhKCkuZnVsbERhdGEpOwogICAgICAgICAgICBzZWxmLiRyZWZzLnhHcmlkLiRyZWZzLnhUYWJsZS5oYW5kbGVEZWZhdWx0cygpOwogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIHRoaXMudGFibGVEYXRhSW47CiAgfSwKICBpbml0Q2FsY1B1YmxpY0RhdGE6IGZ1bmN0aW9uIGluaXRDYWxjUHVibGljRGF0YSgpIHsKICAgIC8vIGNhbGNQdWJsaWNEYXRhOiB7CiAgICAvLyB9CiAgICAvLyByb3dDYWxjRGF0YTogeyB9LAogICAgLy8gY2VsbENhY2xEYXRhOiB7IH0sCiAgICAvLyBjZWxsQ29kZUNhbGNEYXRhOiB7IH0KICAgIC8vIH0KICB9LAogIGluaXRUYWJsZURhdGE6IGZ1bmN0aW9uIGluaXRUYWJsZURhdGEoZGF0YSkgewogICAgdmFyIF90aGlzID0gdGhpczsKICAgIC8vIOWIneWni+WMluihqOagvOaVsOaNrgogICAgLy8g5omn6KGM6aG65bqP77yaIOWPluaVsC0tPuihjOWGheiuoeeuly0tPuWIhue6p+axh+aAuy0tPueItue6p+ihjOWGheiuoeeuly0tPuWNleWFg+agvOS6pOWPieiuoeeulyjmtonlj4rnmoTooYzorqHnrpcpLS0+6KGM57qm5p2fLS0+5Y2V5YWD5qC857qm5p2fCiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICB0aGlzLmluaXRDYWxjdWxhdGVDb25zdHJhaW50Q29uZmlnKCk7CiAgICB0aGlzLnNlbGVjdGlvbiA9IFtdOwogICAgZGF0YSA9IEFycmF5LmlzQXJyYXkoZGF0YSB8fCB0aGlzLnRhYmxlRGF0YSkgPyBkYXRhIHx8IHRoaXMudGFibGVEYXRhIDogW107CgogICAgLy8g5Li65qCR5b2i5pWw5o2u6K6+572u5ZSv5LiA5bGe5oCnCiAgICBzZXRSb3dVdWlkS2V5KGRhdGEsIHRoaXMpOwogICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgX3RoaXMucmVQZXJmb3JtQWxsQ2FsY0FuZENvbnN0cmFpbnRCeURhdGEoc2VsZi51bmlkaXJlY3Rpb25hbERhdGEgPyBzZWxmLmRlZXBDb3B5KGRhdGEpIDogZGF0YSwgdHJ1ZSkudGhlbihmdW5jdGlvbiAoX3JlZjcpIHsKICAgICAgICB2YXIgZGF0YUNvZGVSb3dNYXAgPSBfcmVmNy5kYXRhQ29kZVJvd01hcCwKICAgICAgICAgIGRhdGFDb2RlUm93QXJyID0gX3JlZjcuZGF0YUNvZGVSb3dBcnIsCiAgICAgICAgICBhZnRlckNhbGNEYXRhID0gX3JlZjcuYWZ0ZXJDYWxjRGF0YTsKICAgICAgICBzZWxmLnRhYmxlRGF0YU1hcCA9IGRhdGFDb2RlUm93TWFwOwogICAgICAgIHNlbGYudGFibGVEYXRhSW4gPSBzZWxmLmFkZE1pc3NpbmdGaWVsZHMoc2VsZi5kZWVwQ29weShhZnRlckNhbGNEYXRhKSk7CiAgICAgICAgc2VsZi4kbmV4dFRpY2soKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciB4R3JpZCA9IHNlbGYuJHJlZnMueEdyaWQ7CiAgICAgICAgICBpZiAoeEdyaWQpIHsKICAgICAgICAgICAgeEdyaWQucmVsb2FkRGF0YShzZWxmLnRhYmxlRGF0YUluKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICB4R3JpZC5jbGVhckZpbHRlcigpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgeEdyaWQuJHJlZnMueFRhYmxlLnRhYmxlU291cmNlRGF0YSA9IHNlbGYuZGVlcENvcHkoc2VsZi5nZXRUYWJsZURhdGEoKS5mdWxsRGF0YSk7CiAgICAgICAgICAgICAgICB4R3JpZC4kcmVmcy54VGFibGUuaGFuZGxlRGVmYXVsdHMoKTsKICAgICAgICAgICAgICAgIHNlbGYuJGVtaXQoJ29uVGFibGVEYXRhTG9hZGVkJywgc2VsZi50YWJsZURhdGFJbiwgc2VsZiwgeEdyaWQpOwogICAgICAgICAgICAgICAgcmVzb2x2ZShzZWxmLnRhYmxlRGF0YUluKTsKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXNvbHZlKHNlbGYudGFibGVEYXRhSW4pOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0pOwogIH0sCiAgaW5pdFRhYmxlRm9ybUNvbmZpZzogZnVuY3Rpb24gaW5pdFRhYmxlRm9ybUNvbmZpZygpIHsKICAgIGlmICh0aGlzLmdldGJhc2ljRGF0YVR5cGUodGhpcy50YWJsZUZvcm1Db25maWcpID09PSAnQm9vbGVhbicpIHsKICAgICAgdGhpcy50YWJsZUZvcm1Db25maWdJbiA9IHVuZGVmaW5lZDsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMudGFibGVGb3JtQ29uZmlnSW4gPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLnRhYmxlRm9ybUNvbmZpZyk7CiAgICB9CiAgfSwKICBpbml0U2VxQ29uZmlnOiBmdW5jdGlvbiBpbml0U2VxQ29uZmlnKCkgewogICAgdmFyIHN0YXJ0SW5kZXggPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IDA7CiAgICAvLyDliJ3lp4vljJbluo/lj7fphY3nva7pobkKICAgIHZhciBzZWxmID0gdGhpczsKICAgIHRoaXMuc2VxQ29uZmlnID0gewogICAgICBzdGFydEluZGV4OiAxLAogICAgICAvLyDorr7nva7luo/lj7fnmoTotbflp4vlgLwgbnVtYmVyMAogICAgICBzZXFNZXRob2Q6IGZ1bmN0aW9uIHNlcU1ldGhvZChkYXRhKSB7CiAgICAgICAgdmFyIHNlcSA9IGRhdGEuc2VxLAogICAgICAgICAgJHNlcSA9IGRhdGEuJHNlcSwKICAgICAgICAgIHJvdyA9IGRhdGEucm93OwogICAgICAgIGlmIChzZWxmLnBhZ2VyQ29uZmlnSW4gJiYgIXNlbGYudHJlZUNvbmZpZykgewogICAgICAgICAgcmV0dXJuIChzZWxmLnBhZ2VyQ29uZmlnSW4ucGFnZVNpemUgPiAwID8gc2VsZi5wYWdlckNvbmZpZ0luLnBhZ2VTaXplIDogMjApICogKChzZWxmLnBhZ2VyQ29uZmlnSW4uY3VycmVudFBhZ2UgPiAwID8gc2VsZi5wYWdlckNvbmZpZ0luLmN1cnJlbnRQYWdlIDogMSkgLSAxKSArIHNlcTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIGZpbmFsU2VxID0gJHNlcSA9PT0gJycgfHwgJHNlcSA9PT0gdW5kZWZpbmVkID8gc2VxIDogJHNlcSArICcuJyArIHNlcTsKICAgICAgICAgIGlmIChzZWxmLmlzVHJlZVNlcVRvRmxhdCkgewogICAgICAgICAgICB2YXIgX2FyciQ7CiAgICAgICAgICAgIHZhciBhcnIgPSBYRVV0aWxzLnRvVHJlZUFycmF5KHNlbGYuZ2V0VGFibGVEYXRhKCkudHJlZUV4cGFuZERhdGEpOwogICAgICAgICAgICB2YXIgaW5kZXggPSBhcnIuZmluZEluZGV4KGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGl0ZW1bcm93VXVpZEtleU5hbWVdID09PSByb3dbcm93VXVpZEtleU5hbWVdOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgLy8g5qC55o2u56ys5LiA6KGM5piv5ZCm5piv5ZCI6K6h6KGM5Yik5patCiAgICAgICAgICAgIGlmICgoKF9hcnIkID0gYXJyWzBdKSA9PT0gbnVsbCB8fCBfYXJyJCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2FyciQuaWQpID09PSAnIycpIHsKICAgICAgICAgICAgICBmaW5hbFNlcSA9IHJvdy5pZCA9PT0gJyMnID8gJyMnIDogaW5kZXg7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgZmluYWxTZXEgPSBpbmRleCArIDE7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICAvLyByZXR1cm4gJHNlcSA9PT0gJycgfHwgJHNlcSA9PT0gdW5kZWZpbmVkID8gc2VxIDogJHNlcSArICcuJyArIHNlcQogICAgICAgICAgcmV0dXJuIGZpbmFsU2VxOwogICAgICAgIH0KICAgICAgfQogICAgfTsKICB9LAogIGluaXRFZGl0Q29uZmlnOiBmdW5jdGlvbiBpbml0RWRpdENvbmZpZygpIHsKICAgIC8vIOe8lui+kemFjee9rgogICAgLy8g5pqC5pe25oCn5pa55qGI77yM5ZCO5pyf6LCD5pW0CiAgICBpZiAodGhpcy5nZXRiYXNpY0RhdGFUeXBlKHRoaXMuZWRpdENvbmZpZykgPT09ICdCb29sZWFuJykgewogICAgICAvLyB0aGlzLmVkaXRDb25maWdJbiA9IGZhbHNlCiAgICAgIHRoaXMuZWRpdENvbmZpZ0luID0gewogICAgICAgIHRyaWdnZXI6ICdkYmxjbGljaycsCiAgICAgICAgbW9kZTogJ2NlbGwnLAogICAgICAgIGFjdGl2ZU1ldGhvZDogZnVuY3Rpb24gYWN0aXZlTWV0aG9kKF9yZWY4KSB7CiAgICAgICAgICB2YXIgcm93ID0gX3JlZjgucm93LAogICAgICAgICAgICByb3dJbmRleCA9IF9yZWY4LnJvd0luZGV4LAogICAgICAgICAgICBjb2x1bW4gPSBfcmVmOC5jb2x1bW4sCiAgICAgICAgICAgIGNvbHVtbkluZGV4ID0gX3JlZjguY29sdW1uSW5kZXg7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfSwKICAgICAgICBzaG93U3RhdHVzOiBmYWxzZQogICAgICB9OwogICAgfSBlbHNlIGlmICh0aGlzLmdldGJhc2ljRGF0YVR5cGUodGhpcy5lZGl0Q29uZmlnKSA9PT0gJ09iamVjdCcpIHsKICAgICAgaWYgKHRoaXMuZWRpdENvbmZpZy5lZGl0YWJsZSAhPT0gZmFsc2UpIHsKICAgICAgICB0aGlzLmVkaXRDb25maWdJbiA9IE9iamVjdC5hc3NpZ24odGhpcy5lZGl0Q29uZmlnSW5DcCwgdGhpcy5lZGl0Q29uZmlnKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmVkaXRDb25maWdJbiA9IHsKICAgICAgICAgIHRyaWdnZXI6ICdkYmxjbGljaycsCiAgICAgICAgICBtb2RlOiAnY2VsbCcsCiAgICAgICAgICBhY3RpdmVNZXRob2Q6IGZ1bmN0aW9uIGFjdGl2ZU1ldGhvZChfcmVmOSkgewogICAgICAgICAgICB2YXIgcm93ID0gX3JlZjkucm93LAogICAgICAgICAgICAgIHJvd0luZGV4ID0gX3JlZjkucm93SW5kZXgsCiAgICAgICAgICAgICAgY29sdW1uID0gX3JlZjkuY29sdW1uLAogICAgICAgICAgICAgIGNvbHVtbkluZGV4ID0gX3JlZjkuY29sdW1uSW5kZXg7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0sCiAgICAgICAgICBzaG93U3RhdHVzOiBmYWxzZQogICAgICAgIH07CiAgICAgIH0KICAgIH0KICB9LAogIHJlZnJlc2hUYWJsZUlzRWRpdDogZnVuY3Rpb24gcmVmcmVzaFRhYmxlSXNFZGl0KCkgewogICAgLy8g6YeN5paw5riy5p+T5Yi35paw6KGo5qC8CiAgfSwKICBpbml0RXhwYW5kQ29uZmlnOiBmdW5jdGlvbiBpbml0RXhwYW5kQ29uZmlnKCkgewogICAgLy8g57yW6L6R5bGV5byA6YWN572uCiAgICBpZiAodGhpcy5nZXRiYXNpY0RhdGFUeXBlKHRoaXMuZXhwYW5kQ29uZmlnKSA9PT0gJ1VuZGVmaW5lZCcgfHwgdGhpcy5nZXRiYXNpY0RhdGFUeXBlKHRoaXMuZXhwYW5kQ29uZmlnKSA9PT0gJ0Jvb2xlYW4nKSB7CiAgICAgIHRoaXMuZXhwYW5kQ29uZmlnSW4gPSB7CiAgICAgICAgZXhwYW5kQWxsOiBmYWxzZQogICAgICB9OwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5leHBhbmRDb25maWdJbiA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuZXhwYW5kQ29uZmlnKTsKICAgIH0KICB9LAogIGluaXRDb250ZXh0TWVudUNvbmZpZzogZnVuY3Rpb24gaW5pdENvbnRleHRNZW51Q29uZmlnKCkgewogICAgLy8g5pu05paw5Y+z6ZSu6YWN572uCiAgICBpZiAodGhpcy5nZXRiYXNpY0RhdGFUeXBlKHRoaXMuY29udGV4dE1lbnVDb25maWcpID09PSAnVW5kZWZpbmVkJyB8fCB0aGlzLmdldGJhc2ljRGF0YVR5cGUodGhpcy5jb250ZXh0TWVudUNvbmZpZykgPT09ICdCb29sZWFuJykgewogICAgICB0aGlzLmNvbnRleHRNZW51Q29uZmlnSW4gPSB7fTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuY29udGV4dE1lbnVDb25maWdJbiA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuY29udGV4dE1lbnVDb25maWdJbiwgdGhpcy5jb250ZXh0TWVudUNvbmZpZyk7CiAgICB9CiAgfSwKICBpbml0VHJlZUNvbmZpZzogZnVuY3Rpb24gaW5pdFRyZWVDb25maWcoKSB7CiAgICAvLyDooajmoLzmoJHphY3nva4KICAgIGlmICh0aGlzLmdldGJhc2ljRGF0YVR5cGUodGhpcy50cmVlQ29uZmlnKSA9PT0gJ0Jvb2xlYW4nKSB7CiAgICAgIHRoaXMudHJlZUNvbmZpZ0luID0gdGhpcy50cmVlQ29uZmlnOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy50cmVlQ29uZmlnSW4gPSBPYmplY3QuYXNzaWduKHsKICAgICAgICBkYmxFeHBhbmRBbGw6IGZhbHNlLAogICAgICAgIC8vIOWPjOWHu+WxleW8gOW9k+WJjeiKgueCueagkeW9ouaVsOaNrgogICAgICAgIG9ubHlEYmxUcmVlTm9kZUV4cGFuZDogZmFsc2UsCiAgICAgICAgLy8g5Zyo5LiN5YWB6K6457yW6L6R5qih5byP5LiL5piv5ZCm5LuF5LuF5Y+M5Ye75qCR5YiX5omN5YWB6K645omn6KGM5bGV5byACiAgICAgICAgZGJsRXhwYW5kOiBmYWxzZSwKICAgICAgICAvLyDmmK/lkKbmiafooYzlj4zlh7vlsZXlvIDmoJHlvaLmlbDmja4KICAgICAgICBjaGlsZHJlbjogJ2NoaWxkcmVuJywKICAgICAgICAvLyDmmK/lkKbkuLrmiYvpo47nkLTmlYjmnpwKICAgICAgICBhY2NvcmRpb246IGZhbHNlCiAgICAgIH0sIHRoaXMudHJlZUNvbmZpZyk7CiAgICB9CiAgfSwKICBpbml0Rm9vdGVyQ29uZmlnOiBmdW5jdGlvbiBpbml0Rm9vdGVyQ29uZmlnKCkgewogICAgLy8g5pu05pawZm9vdGVy6YWN572uCiAgICB0aGlzLmZvb3RlckNvbmZpZ0luID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5mb290ZXJDb25maWdJbiwgdGhpcy5mb290ZXJDb25maWcpOwogIH0sCiAgaW5pdEVkaXRSdWxlczogZnVuY3Rpb24gaW5pdEVkaXRSdWxlcygpIHsKICAgIC8vIOe8lui+keagoemqjOinhOWImQogICAgdGhpcy5lZGl0UnVsZXNJbiA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuZWRpdFJ1bGVzKTsKICAgIC8vIHRoaXMuZWRpdFJ1bGVzSW4gPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLmVkaXRSdWxlc0luLCB0aGlzLmFkZFRyZWVSZWcoeyAuLi50aGlzLmVkaXRSdWxlcyB9KSkKICB9Cn07Cgp2YXIgdGFibGVPcHRpb25GbiA9IHsKICByZXBsYWNlQ29sdW1uU2xvdEtleTogZnVuY3Rpb24gcmVwbGFjZUNvbHVtblNsb3RLZXkoa2V5KSB7CiAgICB2YXIgX2tleSRyZXBsYWNlLCBfa2V5JHJlcGxhY2UyLCBfa2V5JHJlcGxhY2UzLCBfa2V5JHJlcGxhY2U0OwogICAgaWYgKCFrZXkpIHJldHVybiAnJzsKICAgIGNvbnNvbGUubG9nKChfa2V5JHJlcGxhY2UgPSBrZXkgPT09IG51bGwgfHwga2V5ID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX2tleSRyZXBsYWNlMiA9IGtleS5yZXBsYWNlKSA9PT0gbnVsbCB8fCBfa2V5JHJlcGxhY2UyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfa2V5JHJlcGxhY2UyLmNhbGwoa2V5LCAvY29sdW1uLS8sICcnKSkgIT09IG51bGwgJiYgX2tleSRyZXBsYWNlICE9PSB2b2lkIDAgPyBfa2V5JHJlcGxhY2UgOiAnJyk7CiAgICByZXR1cm4gKF9rZXkkcmVwbGFjZTMgPSBrZXkgPT09IG51bGwgfHwga2V5ID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX2tleSRyZXBsYWNlNCA9IGtleS5yZXBsYWNlKSA9PT0gbnVsbCB8fCBfa2V5JHJlcGxhY2U0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfa2V5JHJlcGxhY2U0LmNhbGwoa2V5LCAvY29sdW1uLS8sICcnKSkgIT09IG51bGwgJiYgX2tleSRyZXBsYWNlMyAhPT0gdm9pZCAwID8gX2tleSRyZXBsYWNlMyA6ICcnOwogIH0sCiAgLy8g6I635Y+W5Lyg5YWl6KGo5aS05pWw5o2uCiAgdHJhbnNUYWJsZUNsb3VtblRvU291cmNlOiBmdW5jdGlvbiB0cmFuc1RhYmxlQ2xvdW1uVG9Tb3VyY2UoY2xvdW1uKSB7CiAgICB2YXIgX3RoaXMyID0gdGhpczsKICAgIGlmICghY2xvdW1uKSByZXR1cm4gW107CiAgICB2YXIgbmV3Q29sdW1uID0gW107CiAgICBjbG91bW4uZm9yRWFjaChmdW5jdGlvbiAoaywgdikgewogICAgICBrLm93biAmJiBuZXdDb2x1bW4ucHVzaChrLm93bik7CiAgICAgIGlmIChrICYmIGsuY2hpbGRyZW4pIHsKICAgICAgICB2YXIgX25ld0NvbHVtbiR2JGNoaWxkcmVuOwogICAgICAgIG5ld0NvbHVtblt2XS5jaGlsZHJlbiA9IFtdOwogICAgICAgIChfbmV3Q29sdW1uJHYkY2hpbGRyZW4gPSBuZXdDb2x1bW5bdl0uY2hpbGRyZW4pLnB1c2guYXBwbHkoX25ld0NvbHVtbiR2JGNoaWxkcmVuLCBfdG9Db25zdW1hYmxlQXJyYXkoX3RoaXMyLnRyYW5zVGFibGVDbG91bW5Ub1NvdXJjZShrLmNoaWxkcmVuKSkpOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiBuZXdDb2x1bW47CiAgfSwKICB0YWJsZU9wdGlvbkZuOiBmdW5jdGlvbiB0YWJsZU9wdGlvbkZuKCkgewogICAgLy8g5YWo5bGA6KGo5qC857uE5Lu2eGdyaWTosIPnlKjlrp7kvosKICAgIHJldHVybiB0aGlzLiRyZWZzLnhHcmlkOwogIH0sCiAgdXBkYXRlRm9vdGVyOiBmdW5jdGlvbiB1cGRhdGVGb290ZXIoKSB7CiAgICAvLyDmm7TmlrDooajlsL4KICAgIHJldHVybiB0aGlzLiRyZWZzLnhHcmlkLnVwZGF0ZUZvb3RlcigpOwogIH0sCiAgdXBkYXRlRGF0YTogZnVuY3Rpb24gdXBkYXRlRGF0YSgpIHsKICAgIHZhciBfdGhpczMgPSB0aGlzOwogICAgLy8g5Yi35paw5pWw5o2uCiAgICB0aGlzLiRyZWZzLnhHcmlkLnVwZGF0ZURhdGEoKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgX3RoaXMzLiRyZWZzLnhHcmlkLnVwZGF0ZUZvb3RlcigpOwogICAgfSk7CiAgfSwKICBleHBvcnREYXRhOiBmdW5jdGlvbiBleHBvcnREYXRhKG9iaikgewogICAgLy8g5a+85Ye65pWw5o2uCiAgICB0aGlzLiRyZWZzLnhHcmlkLm9wZW5FeHBvcnQoewogICAgICAvLyDpu5jorqTli77pgInmupAKICAgICAgb3JpZ2luYWw6IHRydWUKICAgIH0pOwogIH0sCiAgaW1wb3J0RGF0YUV2ZW50OiBmdW5jdGlvbiBpbXBvcnREYXRhRXZlbnQoKSB7CiAgICAvLyDlr7zlhaXmlbDmja4KICAgIHRoaXMuJHJlZnMueEdyaWQuaW1wb3J0RGF0YSgpOwogIH0sCiAgc2V0QWxsQ2hlY2tib3hSb3c6IGZ1bmN0aW9uIHNldEFsbENoZWNrYm94Um93KCkgewogICAgdmFyIF90aGlzNCA9IHRoaXM7CiAgICAvLyDorr7nva7miYDmnInpgInkuK0KICAgIHRoaXMuJHJlZnMueEdyaWQuc2V0QWxsQ2hlY2tib3hSb3codHJ1ZSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgIF90aGlzNC51cGRhdGVGb290ZXIoKS50aGVuKGZ1bmN0aW9uICgpIHt9KS5jYXRjaChmdW5jdGlvbiAoKSB7fSk7CiAgICB9KTsKICB9LAogIGNsZWFyQ2hlY2tib3hSb3c6IGZ1bmN0aW9uIGNsZWFyQ2hlY2tib3hSb3coKSB7CiAgICB2YXIgX3RoaXM1ID0gdGhpczsKICAgIC8vIOa4hemZpOaJgOaciemAieS4rQogICAgdGhpcy4kcmVmcy54R3JpZC5jbGVhckNoZWNrYm94Um93KCkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgIF90aGlzNS51cGRhdGVGb290ZXIoKS50aGVuKGZ1bmN0aW9uICgpIHt9KS5jYXRjaChmdW5jdGlvbiAoKSB7fSk7CiAgICB9KTsKICB9LAogIHJlbW92ZUNoZWNrYm94Um93OiBmdW5jdGlvbiByZW1vdmVDaGVja2JveFJvdygpIHsKICAgIC8vIOWIoOmZpOmAieS4reihjOaTjeS9nAogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgc2VsZi4kcmVmcy54R3JpZC5yZW1vdmVDaGVja2JveFJvdygpOwogIH0sCiAgcmV2ZXJ0RXZlbnQ6IGZ1bmN0aW9uIHJldmVydEV2ZW50KCkgewogICAgdmFyIF90aGlzNiA9IHRoaXM7CiAgICAvLyDmkqTplIDmk43kvZwKICAgIHRoaXMuJFhNb2RhbC5jb25maXJtKCfmgqjnoa7lrpropoHov5jljp/mlbDmja7lkJc/JykudGhlbihmdW5jdGlvbiAodHlwZSkgewogICAgICBpZiAodHlwZSA9PT0gJ2NvbmZpcm0nKSB7CiAgICAgICAgLy8gdGhpcy4kcmVmcy54R3JpZC5yZXZlcnREYXRhKCkKICAgICAgICBfdGhpczYucmVMb2FkVGFibGUoKTsKICAgICAgfQogICAgfSk7CiAgfSwKICBkZWxldGVTZWxlY3RlZFJvdzogZnVuY3Rpb24gZGVsZXRlU2VsZWN0ZWRSb3coKSB7CiAgICAvLyDliKDpmaTpgInkuK3orrDlvZXooYznmoTmlbDmja7vvIjkuI3mmK/lpI3pgInmoYbnmoTvvIkKICAgIHZhciBzZWxmID0gdGhpczsKICAgIHRoaXMuJFhNb2RhbC5jb25maXJtKCfmgqjnoa7lrpropoHliKDpmaTmiYDpgInkuK3mlbDmja7lkJc/JykudGhlbihmdW5jdGlvbiAodHlwZSkgewogICAgICBpZiAodHlwZSA9PT0gJ2NvbmZpcm0nKSB7CiAgICAgICAgc2VsZi4kcmVmcy54R3JpZC5yZW1vdmVDdXJyZW50Um93KCk7CiAgICAgIH0KICAgIH0pOwogIH0sCiAgZGVsZXRlUm93RGF0YTogZnVuY3Rpb24gZGVsZXRlUm93RGF0YShyb3dzKSB7CiAgICAvLyDliKDpmaTpgInkuK3ooYzmk43kvZwKICAgIHZhciBzZWxmID0gdGhpczsKICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgIHNlbGYuJFhNb2RhbC5jb25maXJtKCfmgqjnoa7lrpropoHliKDpmaTmiYDpgInkuK3mlbDmja7lkJc/JykudGhlbihmdW5jdGlvbiAodHlwZSkgewogICAgICAgIGlmICh0eXBlID09PSAnY29uZmlybScpIHsKICAgICAgICAgIHNlbGYuJHJlZnMueEdyaWQucmVtb3ZlQ2hlY2tib3hSb3cocm93cykudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICAgIHJlc29sdmUocmVzKTsKICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgIHJlamVjdChlKTsKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXNvbHZlKGZhbHNlKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSk7CiAgfSwKICBjb3B5U2VsZWN0aW9uUm93RGF0YTogZnVuY3Rpb24gY29weVNlbGVjdGlvblJvd0RhdGEoKSB7CiAgICB2YXIgX2FyZ3VtZW50cyA9IGFyZ3VtZW50cywKICAgICAgX3RoaXM3ID0gdGhpczsKICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgIHZhciBvYmosIHNlbGY7CiAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgIHdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIG9iaiA9IF9hcmd1bWVudHMubGVuZ3RoID4gMCAmJiBfYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBfYXJndW1lbnRzWzBdIDoge307CiAgICAgICAgICAgIC8vIOWkjeWItumAieS4reihjOaVsOaNrgogICAgICAgICAgICBzZWxmID0gX3RoaXM3OwogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgICAgICAgdmFyIHJvd0luZGV4VG8gPSBvYmoucm93SW5kZXhUbywKICAgICAgICAgICAgICAgIGRhdGEgPSBvYmouZGF0YTsKICAgICAgICAgICAgICB2YXIgcm93VG8gPSByb3dJbmRleFRvID09PSB1bmRlZmluZWQgPyAtMSA6IHJvd0luZGV4VG87CiAgICAgICAgICAgICAgdmFyIG5ld1Jvd1NlbGVjdGlvbnNEYXRhID0gZGF0YSB8fCBzZWxmLiRyZWZzLnhHcmlkLmdldENoZWNrYm94UmVjb3JkcygpOwogICAgICAgICAgICAgIGlmIChuZXdSb3dTZWxlY3Rpb25zRGF0YS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIG5ld1Jvd1NlbGVjdGlvbnNEYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7CiAgICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKGl0ZW0pLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgICAgICAgICAgICAgIGlmIChrZXkuaW5kZXhPZignX18nKSA+PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgaXRlbVtrZXldOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIGl0ZW0gPSBPYmplY3QuYXNzaWduKHt9LCBpdGVtLCB7CiAgICAgICAgICAgICAgICAgICAgaW5zZXJ0TWFyazogJ+aWsOaVsOaNricsCiAgICAgICAgICAgICAgICAgICAgZGF0ZTogbmV3IERhdGUoKS5mb3JtYXQoJ1lZWVktTU0tREQgaGg6bW06c3M6YycpLAogICAgICAgICAgICAgICAgICAgIGlzTmV3OiB0cnVlLAogICAgICAgICAgICAgICAgICAgIF9YSUQ6ICcnCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBzZWxmLiRyZWZzLnhHcmlkLmluc2VydChuZXdSb3dTZWxlY3Rpb25zRGF0YSkudGhlbihmdW5jdGlvbiAoX3JlZjEwKSB7CiAgICAgICAgICAgICAgICAgIHZhciByb3cgPSBfcmVmMTAucm93LAogICAgICAgICAgICAgICAgICAgIHJvd3MgPSBfcmVmMTAucm93czsKICAgICAgICAgICAgICAgICAgc2VsZi4kcmVmcy54R3JpZC5zZXRBY3RpdmVDZWxsKHJvd1RvKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHsKICAgICAgICAgICAgICAgICAgICAgIHRhYmxlRGF0YTogc2VsZi5nZXRUYWJsZURhdGEsCiAgICAgICAgICAgICAgICAgICAgICByb3c6IHJvdwogICAgICAgICAgICAgICAgICAgIH0sIHNlbGYpOwogICAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgICAgIHJlamVjdChlKTsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgICByZWplY3QoZSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcign6K+35YWI6YCJ5oup5paw5aKe5pWw5o2u55qE5qih54mIIScpKTsKICAgICAgICAgICAgICAgIHNlbGYuJFhNb2RhbC5tZXNzYWdlKHsKICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ+ivt+WFiOmAieaLqeaWsOWinuaVsOaNrueahOaooeeJiCEnCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgfQogICAgICB9LCBfY2FsbGVlKTsKICAgIH0pKSgpOwogIH0sCiAgY29weVJvd0RhdGE6IGZ1bmN0aW9uIGNvcHlSb3dEYXRhKCkgewogICAgdmFyIF9hcmd1bWVudHMyID0gYXJndW1lbnRzLAogICAgICBfdGhpczggPSB0aGlzOwogICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZSgpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoKSB7CiAgICAgIHZhciBvYmosIHNlbGYsIHJvd1NvdXJjZSwgcm93SW5kZXhUbywgcm93U291cmNlRGF0YSwgcm93VG8sIG5ld1Jvd0RhdGFPYmosIF95aWVsZCRzZWxmJCRyZWZzJHhHciwgcm93OwogICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZSgpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgIHdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgb2JqID0gX2FyZ3VtZW50czIubGVuZ3RoID4gMCAmJiBfYXJndW1lbnRzMlswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3VtZW50czJbMF0gOiB7fTsKICAgICAgICAgICAgLy8g5aSN5Yi26KGMCiAgICAgICAgICAgIHNlbGYgPSBfdGhpczg7CiAgICAgICAgICAgIHJvd1NvdXJjZSA9IG9iai5yb3dTb3VyY2UsIHJvd0luZGV4VG8gPSBvYmoucm93SW5kZXhUbzsKICAgICAgICAgICAgcm93U291cmNlRGF0YSA9IHJvd1NvdXJjZSA9PT0gdW5kZWZpbmVkID8gMCA6IHJvd1NvdXJjZTsKICAgICAgICAgICAgcm93VG8gPSByb3dJbmRleFRvID09PSB1bmRlZmluZWQgPyAtMSA6IHJvd0luZGV4VG87IC8vIOWkjeWItuihjAogICAgICAgICAgICBuZXdSb3dEYXRhT2JqID0gX29iamVjdFNwcmVhZCh7fSwgc2VsZi4kcmVmcy54R3JpZC5nZXREYXRhKHJvd1NvdXJjZURhdGEpKTsKICAgICAgICAgICAgT2JqZWN0LmtleXMobmV3Um93RGF0YU9iaikuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgICAgICAgaWYgKGtleS5pbmRleE9mKCdfXycpID49IDApIHsKICAgICAgICAgICAgICAgIGRlbGV0ZSBuZXdSb3dEYXRhT2JqW2tleV07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgbmV3Um93RGF0YU9iaiA9IE9iamVjdC5hc3NpZ24oe30sIG5ld1Jvd0RhdGFPYmosIHsKICAgICAgICAgICAgICBpbnNlcnRNYXJrOiAn5paw5pWw5o2uJywKICAgICAgICAgICAgICBkYXRlOiBuZXcgRGF0ZSgpLmZvcm1hdCgnWVlZWS1NTS1ERCBoaDptbTpzczpjJyksCiAgICAgICAgICAgICAgaXNOZXc6IHRydWUsCiAgICAgICAgICAgICAgX1hJRDogJycKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMTA7CiAgICAgICAgICAgIHJldHVybiBzZWxmLiRyZWZzLnhHcmlkLmluc2VydEF0KG5ld1Jvd0RhdGFPYmosIHJvd1RvKTsKICAgICAgICAgIGNhc2UgMTA6CiAgICAgICAgICAgIF95aWVsZCRzZWxmJCRyZWZzJHhHciA9IF9jb250ZXh0Mi5zZW50OwogICAgICAgICAgICByb3cgPSBfeWllbGQkc2VsZiQkcmVmcyR4R3Iucm93OwogICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDE0OwogICAgICAgICAgICByZXR1cm4gc2VsZi4kcmVmcy54R3JpZC5zZXRDdXJyZW50Um93KHJvdyk7CiAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDE2OwogICAgICAgICAgICByZXR1cm4gc2VsZi4kcmVmcy54R3JpZC5zZXRBY3RpdmVDZWxsKHJvdyk7CiAgICAgICAgICBjYXNlIDE2OgogICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDE4OwogICAgICAgICAgICByZXR1cm4gc2VsZi4kcmVmcy54R3JpZC52YWxpZGF0ZShyb3cpLmNhdGNoKGZ1bmN0aW9uIChlcnJNYXApIHsKICAgICAgICAgICAgICByZXR1cm4gZXJyTWFwOwogICAgICAgICAgICB9KTsKICAgICAgICAgIGNhc2UgMTg6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0sIF9jYWxsZWUyKTsKICAgIH0pKSgpOwogIH0sCiAgaW5zZXJ0Um93RGF0YTogZnVuY3Rpb24gaW5zZXJ0Um93RGF0YSgpIHsKICAgIHZhciBfYXJndW1lbnRzMyA9IGFyZ3VtZW50cywKICAgICAgX3RoaXM5ID0gdGhpczsKICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKCkgewogICAgICB2YXIgb2JqLCBzZWxmOwogICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZSgpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTMkKF9jb250ZXh0MykgewogICAgICAgIHdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgb2JqID0gX2FyZ3VtZW50czMubGVuZ3RoID4gMCAmJiBfYXJndW1lbnRzM1swXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3VtZW50czNbMF0gOiB7fTsKICAgICAgICAgICAgLy8g5paw5aKe6KGMCiAgICAgICAgICAgIHNlbGYgPSBfdGhpczk7CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuYWJydXB0KCJyZXR1cm4iLCBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgICAgICAgdmFyIGRhdGEgPSBvYmouZGF0YSwKICAgICAgICAgICAgICAgIHJvd0luZGV4VG8gPSBvYmoucm93SW5kZXhUbzsKICAgICAgICAgICAgICB2YXIgcm93VG8gPSByb3dJbmRleFRvID09PSB1bmRlZmluZWQgPyAtMSA6IHJvd0luZGV4VG87CiAgICAgICAgICAgICAgdmFyIGRhdGFPYmogPSBPYmplY3QuYXNzaWduKHt9LCBkYXRhID09PSB1bmRlZmluZWQgPyB7fSA6IGRhdGEsIHsKICAgICAgICAgICAgICAgIGluc2VydE1hcms6ICfmlrDmlbDmja4nLAogICAgICAgICAgICAgICAgZGF0ZTogbmV3IERhdGUoKS5mb3JtYXQoJ1lZWVktTU0tREQgaGg6bW06c3M6YycpLAogICAgICAgICAgICAgICAgaXNOZXc6IHRydWUsCiAgICAgICAgICAgICAgICBfWElEOiAnJwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIE9iamVjdC5rZXlzKGRhdGFPYmopLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgICAgICAgICAgaWYgKGtleS5pbmRleE9mKCdfXycpID49IDApIHsKICAgICAgICAgICAgICAgICAgZGVsZXRlIGRhdGFPYmpba2V5XTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBzZWxmLiRyZWZzLnhHcmlkLmluc2VydEF0KGRhdGFPYmosIHJvd1RvKS50aGVuKGZ1bmN0aW9uIChfcmVmMTEpIHsKICAgICAgICAgICAgICAgIHZhciByb3cgPSBfcmVmMTEucm93OwogICAgICAgICAgICAgICAgc2VsZi4kcmVmcy54R3JpZC5zZXRDdXJyZW50Um93KHJvdykudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIHNlbGYuJHJlZnMueEdyaWQuc2V0QWN0aXZlQ2VsbChyb3cpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIHNlbGYuJHJlZnMueEdyaWQudmFsaWRhdGUocm93KS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoewogICAgICAgICAgICAgICAgICAgICAgICB0YWJsZURhdGE6IHNlbGYuZ2V0VGFibGVEYXRhLAogICAgICAgICAgICAgICAgICAgICAgICByb3c6IHJvdwogICAgICAgICAgICAgICAgICAgICAgfSwgc2VsZik7CiAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVyck1hcCkgewogICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3ZhbGlkYXRlJywgZXJyTWFwKTsKICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoewogICAgICAgICAgICAgICAgICAgICAgICB0YWJsZURhdGE6IHNlbGYuZ2V0VGFibGVEYXRhLAogICAgICAgICAgICAgICAgICAgICAgICByb3c6IHJvdywKICAgICAgICAgICAgICAgICAgICAgICAgZXJyTWFwOiBlcnJNYXAKICAgICAgICAgICAgICAgICAgICAgIH0sIHNlbGYpOwogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgICAgIHJlamVjdChlKTsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgICByZWplY3QoZSk7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgcmVqZWN0KGUpOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KSk7CiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0sIF9jYWxsZWUzKTsKICAgIH0pKSgpOwogIH0sCiAgcmVMb2FkVGFibGU6IGZ1bmN0aW9uIHJlTG9hZFRhYmxlKCkgewogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgdmFyIHhHcmlkID0gdGhpcy4kcmVmcy54R3JpZDsKICAgIHRoaXMuaW5pdFRhYmxlKCk7CiAgICAvLyB4R3JpZC5yZWxvYWREYXRhKHhHcmlkLmdldFRhYmxlRGF0YSgpLmZ1bGxEYXRhKQogICAgeEdyaWQucmVsb2FkQ29sdW1uKHNlbGYuaW5pdFRhYmxlQ29ubHVtcygpKTsKICAgIHhHcmlkLnJlbG9hZERhdGEoc2VsZi5pbml0VGFibGVEYXRhKCkpLnRoZW4oKS5jYXRjaCgpOwogIH0sCiAgcmVMb2FkVGFibGVEYXRhOiBmdW5jdGlvbiByZUxvYWRUYWJsZURhdGEoKSB7CiAgICB2YXIgeEdyaWQgPSB0aGlzLiRyZWZzLnhHcmlkOwogICAgLy8geEdyaWQucmVsb2FkRGF0YSh4R3JpZC5nZXRUYWJsZURhdGEoKS5mdWxsRGF0YSkKICAgIHhHcmlkLnJlbG9hZERhdGEodGhpcy5pbml0VGFibGVEYXRhKCkpLnRoZW4oKS5jYXRjaCgpOwogIH0sCiAgcmVmcmVzaFRhYmxlOiBmdW5jdGlvbiByZWZyZXNoVGFibGUoZGF0YSkgewogICAgdmFyIF90aGlzMTAgPSB0aGlzOwogICAgLy8g6YeN5paw5Yqg6L295omA5pyJCiAgICBpZiAoZGF0YSkgewogICAgICAvLyDph43mlrDliqDovb3mlbDmja7liLfmlrDop4blm74g6LCD5pW0IOWNs+WwhuW6n+W8gwogICAgICB2YXIgeEdyaWQgPSB0aGlzLiRyZWZzLnhHcmlkOwogICAgICAvLyB4R3JpZC5yZWxvYWREYXRhKHhHcmlkLmdldFRhYmxlRGF0YSgpLmZ1bGxEYXRhKQogICAgICB4R3JpZC5yZWxvYWREYXRhKGRhdGEgfHwgdGhpcy50YWJsZURhdGFJbikudGhlbigpLmNhdGNoKCk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmluaXRNb3VudGVkKCk7CiAgICAgIHRoaXMuaWZSZW5kZXJUYWJsZSA9IGZhbHNlOwogICAgICB0aGlzLiRuZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgX3RoaXMxMC5pZlJlbmRlclRhYmxlID0gdHJ1ZTsKICAgICAgfSk7CiAgICB9CiAgfSwKICByZWxvYWRUYWJsZUNvbmx1bXM6IGZ1bmN0aW9uIHJlbG9hZFRhYmxlQ29ubHVtcyhjb25sdW1zKSB7CiAgICAvLyDph43liqDovb3ooajlpLQKICAgIHRoaXMuJHJlZnMueEdyaWQucmVsb2FkQ29sdW1uKGNvbmx1bXMgPyB0aGlzLmdlbmVyYXRlVGFibGVDb25sdW1zKGNvbmx1bXMsIHRoaXMudGFibGVDb25maWdDcC5nbG9iYWxDb25maWcpIDogc2VsZi5pbml0VGFibGVDb25sdW1zKCkpLnRoZW4oKS5jYXRjaCgpOwogIH0sCiAgcmVsb2FkVGFibGVSZW5kZXJEYXRhOiBmdW5jdGlvbiByZWxvYWRUYWJsZVJlbmRlckRhdGEoKSB7CiAgICB2YXIgZGF0YSA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogW107CiAgICAvLyDph43liqDovb3muLLmn5PmlbDmja4KICAgIHZhciB4R3JpZCA9IHRoaXMuJHJlZnMueEdyaWQ7CiAgICB4R3JpZC5yZWxvYWREYXRhKGRhdGEpOwogICAgdGhpcy5zZWxlY3Rpb24gPSBbXTsKICAgIGlmICh4R3JpZCkgewogICAgICB4R3JpZC5yZW1vdmVDaGVja2JveFJvdygpOwogICAgfQogIH0sCiAgcmVDYWxjQW5kUmVMb2FkVGFibGVEYXRhOiBmdW5jdGlvbiByZUNhbGNBbmRSZUxvYWRUYWJsZURhdGEoX3JlZjEyKSB7CiAgICB2YXIgZGF0YSA9IF9yZWYxMi5kYXRhLAogICAgICBtb2RpZnlJdGVtID0gX3JlZjEyLm1vZGlmeUl0ZW0sCiAgICAgIG1vZGlmeURhdGEgPSBfcmVmMTIubW9kaWZ5RGF0YTsKICAgIC8vIOmHjeaWsOiuoeeul3RhYmxlRGF0YeW5tuWIt+aWsOinhuWbvgogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgc2VsZi5yZVBlcmZvcm1BbGxDYWxjQW5kQ29uc3RyYWludEJ5RGF0YShkYXRhLCB0cnVlKS50aGVuKGZ1bmN0aW9uIChfcmVmMTMpIHsKICAgICAgICB2YXIgZGF0YUNvZGVSb3dNYXAgPSBfcmVmMTMuZGF0YUNvZGVSb3dNYXAsCiAgICAgICAgICBkYXRhQ29kZVJvd0FyciA9IF9yZWYxMy5kYXRhQ29kZVJvd0FyciwKICAgICAgICAgIGFmdGVyQ2FsY0RhdGEgPSBfcmVmMTMuYWZ0ZXJDYWxjRGF0YTsKICAgICAgICBzZWxmLnVwZGF0ZUZvb3RlcigpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgcmVzb2x2ZSh7CiAgICAgICAgICAgIGRhdGE6IGFmdGVyQ2FsY0RhdGEsCiAgICAgICAgICAgIG1vZGlmeUl0ZW06IG1vZGlmeUl0ZW0sCiAgICAgICAgICAgIG1vZGlmeURhdGE6IG1vZGlmeURhdGEKICAgICAgICAgIH0pOwogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICByZWplY3QoZSk7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSk7CiAgfSwKICBjbGVhckRhdGFSZW5kZXJGaWVsZDogZnVuY3Rpb24gY2xlYXJEYXRhUmVuZGVyRmllbGQoZGF0YSkgewogICAgLy8g5Yig6ZmkX1/lrZfmrrUKICAgIHZhciBzZWxmID0gdGhpczsKICAgIHJldHVybiBkYXRhLm1hcChmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHsKICAgICAgdmFyIGl0ZW1OID0gT2JqZWN0LmFzc2lnbih7fSwgaXRlbSk7CiAgICAgIE9iamVjdC5rZXlzKGl0ZW1OKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXksIGtpKSB7CiAgICAgICAgaWYgKGtleS5pbmRleE9mKCdfXycpID49IDApIHsKICAgICAgICAgIGRlbGV0ZSBpdGVtTltrZXldOwogICAgICAgIH0KICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShpdGVtTi5jaGlsZHJlbikgJiYgaXRlbU4uY2hpbGRyZW4ubGVuZ3RoKSB7CiAgICAgICAgICBpdGVtTi5jaGlsZHJlbiA9IHNlbGYuY2xlYXJEYXRhUmVuZGVyRmllbGQoaXRlbU4uY2hpbGRyZW4pOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHJldHVybiBpdGVtTjsKICAgIH0pOwogIH0sCiAgLyoqDQogICAqIOagueaNruWIl+ihqOWxleW8gOaDheWGtei/h+a7pOWvvOWHuuaVsOaNrg0KICAgKiBAcGFyYW0gZnVsbERhdGENCiAgICogQHBhcmFtIGNsb25lRnVsbERhdGENCiAgICogQHJldHVybnMgeyp9DQogICAqLwogIGZsaXRlclRhYmxlRGF0YVVuZXhwYW5kOiBmdW5jdGlvbiBmbGl0ZXJUYWJsZURhdGFVbmV4cGFuZChmdWxsRGF0YSkgewogICAgdmFyIF90aGlzMTEgPSB0aGlzOwogICAgdmFyIGNsb25lRnVsbERhdGEgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHRoaXMuJFhFVXRpbHMuY2xvbmUoZnVsbERhdGEsIHRydWUpOwogICAgZnVsbERhdGEuZm9yRWFjaChmdW5jdGlvbiAocm93LCByb3dJbmRleCkgewogICAgICB2YXIgX3RoaXMxMSQkcmVmcyR4R3JpZDsKICAgICAgaWYgKCEoKF90aGlzMTEkJHJlZnMkeEdyaWQgPSBfdGhpczExLiRyZWZzLnhHcmlkKSAhPT0gbnVsbCAmJiBfdGhpczExJCRyZWZzJHhHcmlkICE9PSB2b2lkIDAgJiYgX3RoaXMxMSQkcmVmcyR4R3JpZC5pc1RyZWVFeHBhbmRCeVJvdyhyb3cpKSkgewogICAgICAgIFJlZmxlY3QuZGVsZXRlUHJvcGVydHkoY2xvbmVGdWxsRGF0YVtyb3dJbmRleF0sICdjaGlsZHJlbicpOwogICAgICB9IGVsc2UgewogICAgICAgIF90aGlzMTEuZmxpdGVyVGFibGVEYXRhVW5leHBhbmQocm93LmNoaWxkcmVuLCBjbG9uZUZ1bGxEYXRhW3Jvd0luZGV4XS5jaGlsZHJlbik7CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIGNsb25lRnVsbERhdGE7CiAgfSwKICBnZXRUYWJsZURhdGE6IGZ1bmN0aW9uIGdldFRhYmxlRGF0YSgpIHsKICAgIC8vIOiOt+WPluihqOagvOaVsOaNrgogICAgLy8gY29uc3QgbGlzdERhdGEgPSB0aGlzLmdldExpc3REYXRhKCkKICAgIHZhciBpbnNlcnRSZWNvcmRzID0gdGhpcy4kcmVmcy54R3JpZC5nZXRJbnNlcnRSZWNvcmRzKCk7CiAgICB2YXIgdXBkYXRlUmVjb3JkcyA9IHRoaXMuJHJlZnMueEdyaWQuZ2V0VXBkYXRlUmVjb3JkcygpOwogICAgdmFyIHJlbW92ZVJlY29yZHMgPSB0aGlzLiRyZWZzLnhHcmlkLmdldFJlbW92ZVJlY29yZHMoKTsKICAgIHZhciBfdGhpcyQkcmVmcyR4R3JpZCQkcmUgPSB0aGlzLiRyZWZzLnhHcmlkLiRyZWZzLnhUYWJsZSwKICAgICAga2VlcFNvdXJjZSA9IF90aGlzJCRyZWZzJHhHcmlkJCRyZS5rZWVwU291cmNlLAogICAgICB0YWJsZVNvdXJjZURhdGEgPSBfdGhpcyQkcmVmcyR4R3JpZCQkcmUudGFibGVTb3VyY2VEYXRhOwogICAgdmFyIF90aGlzJCRyZWZzJHhHcmlkJGdldCA9IHRoaXMuJHJlZnMueEdyaWQuZ2V0VGFibGVEYXRhKCksCiAgICAgIGZ1bGxEYXRhID0gX3RoaXMkJHJlZnMkeEdyaWQkZ2V0LmZ1bGxEYXRhLAogICAgICB2aXNpYmxlRGF0YSA9IF90aGlzJCRyZWZzJHhHcmlkJGdldC52aXNpYmxlRGF0YSwKICAgICAgdGFibGVEYXRhID0gX3RoaXMkJHJlZnMkeEdyaWQkZ2V0LnRhYmxlRGF0YSwKICAgICAgZm9vdGVyRGF0YSA9IF90aGlzJCRyZWZzJHhHcmlkJGdldC5mb290ZXJEYXRhOwogICAgdmFyIHRyZWVFeHBhbmREYXRhID0gdGhpcy5mbGl0ZXJUYWJsZURhdGFVbmV4cGFuZChmdWxsRGF0YSk7CiAgICB2YXIgc2VsZWN0aW9uID0gdGhpcy4kcmVmcy54R3JpZC5nZXRDaGVja2JveFJlY29yZHModHJ1ZSk7CiAgICB2YXIgdGFibGVDb2x1bW5zQ29uZmlnID0gdGhpcy50YWJsZUNvbHVtbnNDb25maWcsCiAgICAgIGVkaXRSdWxlcyA9IHRoaXMuZWRpdFJ1bGVzOwogICAgLy8gY29uc3QgY29tYmluZWREYXRhID0gdGhpcy5nZXRDb21iaW5lZERhdGEoZnVsbERhdGEsIHRhYmxlQ29sdW1uc0NvbmZpZykKICAgIHZhciBjb21iaW5lZERhdGEgPSBbXTsKICAgIHJldHVybiB7CiAgICAgIGNvbWJpbmVkRGF0YTogY29tYmluZWREYXRhLAogICAgICBrZWVwU291cmNlOiBrZWVwU291cmNlLAogICAgICB0YWJsZVNvdXJjZURhdGE6IHRhYmxlU291cmNlRGF0YSwKICAgICAgZnVsbERhdGE6IGZ1bGxEYXRhLAogICAgICB2aXNpYmxlRGF0YTogdmlzaWJsZURhdGEsCiAgICAgIHRhYmxlRGF0YTogdGFibGVEYXRhLAogICAgICBmb290ZXJEYXRhOiBmb290ZXJEYXRhLAogICAgICB0YWJsZUNvbHVtbnNDb25maWc6IHRhYmxlQ29sdW1uc0NvbmZpZywKICAgICAgc2VsZWN0aW9uOiBzZWxlY3Rpb24sCiAgICAgIGVkaXRSdWxlczogZWRpdFJ1bGVzLAogICAgICBpbnNlcnRSZWNvcmRzOiBpbnNlcnRSZWNvcmRzLAogICAgICByZW1vdmVSZWNvcmRzOiByZW1vdmVSZWNvcmRzLAogICAgICB1cGRhdGVSZWNvcmRzOiB1cGRhdGVSZWNvcmRzLAogICAgICB0cmVlRXhwYW5kRGF0YTogdHJlZUV4cGFuZERhdGEKICAgIH07CiAgfSwKICBnZXRDb21iaW5lZERhdGE6IGZ1bmN0aW9uIGdldENvbWJpbmVkRGF0YShkYXRhLCB0YWJsZUNvbHVtbnNDb25maWcpIHsKICAgIHZhciBfdGhpczEyID0gdGhpczsKICAgIHZhciBjb21iaW5lZERhdGEgPSBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBhcmd1bWVudHNbMl0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1syXSA6IHt9OwogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgZGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChyb3csIGluZGV4KSB7CiAgICAgIHRhYmxlQ29sdW1uc0NvbmZpZy5mb3JFYWNoKGZ1bmN0aW9uIChjb2x1bW4sIGNvbHVtbkluZGV4KSB7CiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoY29sdW1uLmNoaWxkcmVuKSAmJiBjb2x1bW4uY2hpbGRyZW4ubGVuZ3RoKSB7CiAgICAgICAgICBzZWxmLmdldENvbWJpbmVkRGF0YShkYXRhLCBjb2x1bW4uY2hpbGRyZW4sIGNvbWJpbmVkRGF0YSk7CiAgICAgICAgfSBlbHNlIGlmIChjb2x1bW4uY29tYmluZWRUeXBlICYmIGNvbHVtbi5jb21iaW5lZFR5cGUuaW5kZXhPZigndG90YWwnKSA+PSAwKSB7CiAgICAgICAgICBjb21iaW5lZERhdGFbY29sdW1uLmZpZWxkXSA9IF90aGlzMTIuYWNjdXJhdGVKaWFmYShjb21iaW5lZERhdGFbY29sdW1uLmZpZWxkXSB8fCAwLCArX3RoaXMxMi50cmFuc1RvTnVtYmVyKHJvd1tjb2x1bW4uZmllbGRdLCAzKSB8fCAwKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSk7CiAgICByZXR1cm4gY29tYmluZWREYXRhOwogIH0sCiAgZ2V0UHVyZVRhYmxlRGF0YTogZnVuY3Rpb24gZ2V0UHVyZVRhYmxlRGF0YSgpIHsKICAgIC8vIOiOt+WPluihqOagvOe6r+WHgOaVsOaNrgogICAgdmFyIGxpc3REYXRhID0gdGhpcy5nZXRMaXN0RGF0YSgpOwogICAgdmFyIGluc2VydFJlY29yZHMgPSB0aGlzLiRyZWZzLnhHcmlkLmdldEluc2VydFJlY29yZHMoKTsKICAgIHZhciB1cGRhdGVSZWNvcmRzID0gdGhpcy4kcmVmcy54R3JpZC5nZXRVcGRhdGVSZWNvcmRzKCk7CiAgICB2YXIgcmVtb3ZlUmVjb3JkcyA9IHRoaXMuJHJlZnMueEdyaWQuZ2V0UmVtb3ZlUmVjb3JkcygpOwogICAgdmFyIF90aGlzJCRyZWZzJHhHcmlkJCRyZTIgPSB0aGlzLiRyZWZzLnhHcmlkLiRyZWZzLnhUYWJsZSwKICAgICAga2VlcFNvdXJjZSA9IF90aGlzJCRyZWZzJHhHcmlkJCRyZTIua2VlcFNvdXJjZSwKICAgICAgdGFibGVTb3VyY2VEYXRhID0gX3RoaXMkJHJlZnMkeEdyaWQkJHJlMi50YWJsZVNvdXJjZURhdGE7CiAgICB2YXIgX3RoaXMkJHJlZnMkeEdyaWQkZ2V0MiA9IHRoaXMuJHJlZnMueEdyaWQuZ2V0VGFibGVEYXRhKCksCiAgICAgIGZ1bGxEYXRhID0gX3RoaXMkJHJlZnMkeEdyaWQkZ2V0Mi5mdWxsRGF0YSwKICAgICAgdmlzaWJsZURhdGEgPSBfdGhpcyQkcmVmcyR4R3JpZCRnZXQyLnZpc2libGVEYXRhLAogICAgICB0YWJsZURhdGEgPSBfdGhpcyQkcmVmcyR4R3JpZCRnZXQyLnRhYmxlRGF0YSwKICAgICAgZm9vdGVyRGF0YSA9IF90aGlzJCRyZWZzJHhHcmlkJGdldDIuZm9vdGVyRGF0YTsKICAgIHZhciBzZWxlY3Rpb24gPSB0aGlzLiRyZWZzLnhHcmlkLmdldENoZWNrYm94UmVjb3JkcygpOwogICAgdmFyIHRhYmxlQ29sdW1uc0NvbmZpZyA9IHRoaXMudGFibGVDb2x1bW5zQ29uZmlnLAogICAgICBlZGl0UnVsZXMgPSB0aGlzLmVkaXRSdWxlczsKICAgIC8vIGNvbnN0IGNvbWJpbmVkRGF0YSA9IHRoaXMuZ2V0Q29tYmluZWREYXRhKGZ1bGxEYXRhLCB0YWJsZUNvbHVtbnNDb25maWcpCiAgICB2YXIgY29tYmluZWREYXRhID0gW107CiAgICByZXR1cm4gewogICAgICBjb21iaW5lZERhdGE6IGNvbWJpbmVkRGF0YSwKICAgICAga2VlcFNvdXJjZToga2VlcFNvdXJjZSwKICAgICAgdGFibGVTb3VyY2VEYXRhOiB0aGlzLmNsZWFyRGF0YVJlbmRlckZpZWxkKHRhYmxlU291cmNlRGF0YSksCiAgICAgIGZ1bGxEYXRhOiB0aGlzLmNsZWFyRGF0YVJlbmRlckZpZWxkKGZ1bGxEYXRhKSwKICAgICAgdmlzaWJsZURhdGE6IHRoaXMuY2xlYXJEYXRhUmVuZGVyRmllbGQodmlzaWJsZURhdGEpLAogICAgICB0YWJsZURhdGE6IHRoaXMuY2xlYXJEYXRhUmVuZGVyRmllbGQodGFibGVEYXRhKSwKICAgICAgZm9vdGVyRGF0YTogZm9vdGVyRGF0YSwKICAgICAgdGFibGVDb2x1bW5zQ29uZmlnOiB0YWJsZUNvbHVtbnNDb25maWcsCiAgICAgIHNlbGVjdGlvbjogdGhpcy5jbGVhckRhdGFSZW5kZXJGaWVsZChzZWxlY3Rpb24pLAogICAgICBlZGl0UnVsZXM6IGVkaXRSdWxlcywKICAgICAgbGlzdERhdGE6IHRoaXMuY2xlYXJEYXRhUmVuZGVyRmllbGQobGlzdERhdGEpLAogICAgICBpbnNlcnRSZWNvcmRzOiB0aGlzLmNsZWFyRGF0YVJlbmRlckZpZWxkKGluc2VydFJlY29yZHMpLAogICAgICB1cGRhdGVSZWNvcmRzOiB0aGlzLmNsZWFyRGF0YVJlbmRlckZpZWxkKHVwZGF0ZVJlY29yZHMpLAogICAgICByZW1vdmVSZWNvcmRzOiB0aGlzLmNsZWFyRGF0YVJlbmRlckZpZWxkKHJlbW92ZVJlY29yZHMpCiAgICB9OwogIH0sCiAgZ2V0T3B0aW9uRGF0YTogZnVuY3Rpb24gZ2V0T3B0aW9uRGF0YSgpIHsKICAgIC8vIOiOt+WPluW9k+WJjeaTjeS9nOaVsOaNrgogICAgcmV0dXJuIHRoaXMuJHJlZnMueEdyaWQuZ2V0UmVjb3Jkc2V0KCk7CiAgfSwKICBnZXRJbnNlcnRSb3dEYXRhOiBmdW5jdGlvbiBnZXRJbnNlcnRSb3dEYXRhKCkgewogICAgLy8g6I635Y+W5paw5aKe6KGMCiAgICByZXR1cm4gdGhpcy4kcmVmcy54R3JpZC5nZXRJbnNlcnRSZWNvcmRzKCk7CiAgICAvLyB0aGlzLiRYTW9kYWwuYWxlcnQoaW5zZXJ0UmVjb3Jkcy5sZW5ndGgpCiAgfSwKICBnZXRTZWxlY3Rpb25EYXRhOiBmdW5jdGlvbiBnZXRTZWxlY3Rpb25EYXRhKCkgewogICAgLy8g6I635Y+W6YCJ5LitCiAgICByZXR1cm4gdGhpcy4kcmVmcy54R3JpZC5nZXRDaGVja2JveFJlY29yZHMoKTsKICAgIC8vIHRoaXMuJFhNb2RhbC5hbGVydChzZWxlY3RSZWNvcmRzLmxlbmd0aCkKICB9LAogIGdldERhdGE6IGZ1bmN0aW9uIGdldERhdGEoKSB7CiAgICB2YXIgcm93SW5kZXggPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IFtdOwogICAgcmV0dXJuIHRoaXMuJHJlZnMueEdyaWQuZ2V0RGF0YShyb3dJbmRleCk7CiAgfSwKICB2YWxpZGF0ZTogZnVuY3Rpb24gdmFsaWRhdGUoKSB7CiAgICB2YXIgcm93ID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiB0cnVlOwogICAgcmV0dXJuIHRoaXMuJHJlZnMueEdyaWQudmFsaWRhdGUocm93KTsKICB9LAogIHZhbGlkYXRlQ2hhbmdlRGF0YTogZnVuY3Rpb24gdmFsaWRhdGVDaGFuZ2VEYXRhKCkgewogICAgLy8g5Y+q5qCh6aqM5Li05pe25Y+Y5Yqo55qE5pWw5o2u77yM5L6L5aaC5paw5aKe5oiW5L+u5pS5CiAgICByZXR1cm4gdGhpcy4kcmVmcy54R3JpZC52YWxpZGF0ZSgpOwogIH0sCiAgdmFsaWRFdmVudDogZnVuY3Rpb24gdmFsaWRFdmVudCgpIHsKICAgIHZhciBfYXJndW1lbnRzNCA9IGFyZ3VtZW50cywKICAgICAgX3RoaXMxMyA9IHRoaXM7CiAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlNCgpIHsKICAgICAgdmFyIHJvdywgZXJyTWFwOwogICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZSgpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTQkKF9jb250ZXh0NCkgewogICAgICAgIHdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgcm93ID0gX2FyZ3VtZW50czQubGVuZ3RoID4gMCAmJiBfYXJndW1lbnRzNFswXSAhPT0gdW5kZWZpbmVkID8gX2FyZ3VtZW50czRbMF0gOiB0cnVlOwogICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDM7CiAgICAgICAgICAgIHJldHVybiBfdGhpczEzLiRyZWZzLnhHcmlkLnZhbGlkYXRlKHJvdykuY2F0Y2goZnVuY3Rpb24gKGVyck1hcCkgewogICAgICAgICAgICAgIHJldHVybiBlcnJNYXA7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICBlcnJNYXAgPSBfY29udGV4dDQuc2VudDsKICAgICAgICAgICAgaWYgKGVyck1hcCkgewogICAgICAgICAgICAgIF90aGlzMTMuJFhNb2RhbC5tZXNzYWdlKHsKICAgICAgICAgICAgICAgIHN0YXR1czogJ2Vycm9yJywKICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICfmoKHpqozkuI3pgJrov4fvvIEnCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgX3RoaXMxMy4kWE1vZGFsLm1lc3NhZ2UoewogICAgICAgICAgICAgICAgc3RhdHVzOiAnc3VjY2VzcycsCiAgICAgICAgICAgICAgICBtZXNzYWdlOiAn5qCh6aqM5oiQ5Yqf77yBJwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0sIF9jYWxsZWU0KTsKICAgIH0pKSgpOwogIH0sCiAgZnVsbFZhbGlkRXZlbnQ6IGZ1bmN0aW9uIGZ1bGxWYWxpZEV2ZW50KCkgewogICAgdmFyIF9hcmd1bWVudHM1ID0gYXJndW1lbnRzLAogICAgICBfdGhpczE0ID0gdGhpczsKICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU1KCkgewogICAgICB2YXIgcm93LCBoLCBlcnJNYXAsIG1zZ0xpc3Q7CiAgICAgIHJldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlNSQoX2NvbnRleHQ1KSB7CiAgICAgICAgd2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQ1LnByZXYgPSBfY29udGV4dDUubmV4dCkgewogICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICByb3cgPSBfYXJndW1lbnRzNS5sZW5ndGggPiAwICYmIF9hcmd1bWVudHM1WzBdICE9PSB1bmRlZmluZWQgPyBfYXJndW1lbnRzNVswXSA6IHRydWU7CiAgICAgICAgICAgIGggPSBfdGhpczE0LiRjcmVhdGVFbGVtZW50OwogICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDQ7CiAgICAgICAgICAgIHJldHVybiBfdGhpczE0LiRyZWZzLnhHcmlkLmZ1bGxWYWxpZGF0ZShyb3cpLmNhdGNoKGZ1bmN0aW9uIChlcnJNYXApIHsKICAgICAgICAgICAgICByZXR1cm4gZXJyTWFwOwogICAgICAgICAgICB9KTsKICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgZXJyTWFwID0gX2NvbnRleHQ1LnNlbnQ7CiAgICAgICAgICAgIGlmIChlcnJNYXApIHsKICAgICAgICAgICAgICBtc2dMaXN0ID0gW107CiAgICAgICAgICAgICAgT2JqZWN0LnZhbHVlcyhlcnJNYXApLmZvckVhY2goZnVuY3Rpb24gKGVyckxpc3QpIHsKICAgICAgICAgICAgICAgIGVyckxpc3QuZm9yRWFjaChmdW5jdGlvbiAocGFyYW1zKSB7CiAgICAgICAgICAgICAgICAgIHZhciByb3dJbmRleCA9IHBhcmFtcy5yb3dJbmRleCwKICAgICAgICAgICAgICAgICAgICBjb2x1bW4gPSBwYXJhbXMuY29sdW1uLAogICAgICAgICAgICAgICAgICAgIHJ1bGVzID0gcGFyYW1zLnJ1bGVzOwogICAgICAgICAgICAgICAgICBydWxlcy5mb3JFYWNoKGZ1bmN0aW9uIChydWxlKSB7CiAgICAgICAgICAgICAgICAgICAgbXNnTGlzdC5wdXNoKCJcdTdCMkMgIi5jb25jYXQocm93SW5kZXgsICIgXHU4ODRDICIpLmNvbmNhdChjb2x1bW4udGl0bGUsICIgXHU2ODIxXHU5QThDXHU5NTE5XHU4QkVGXHVGRjFBIikuY29uY2F0KHJ1bGUubWVzc2FnZSkpOwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIF90aGlzMTQuJFhNb2RhbC5tZXNzYWdlKHsKICAgICAgICAgICAgICAgIHN0YXR1czogJ2Vycm9yJywKICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGZ1bmN0aW9uIG1lc3NhZ2UoKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBbaCgiZGl2IiwgewogICAgICAgICAgICAgICAgICAgICJjbGFzcyI6ICJyZWQiLAogICAgICAgICAgICAgICAgICAgICJzdHlsZSI6ICJtYXgtaGVpZ2h0OiA0MDBweDtvdmVyZmxvdzogYXV0bzsiCiAgICAgICAgICAgICAgICAgIH0sIFttc2dMaXN0Lm1hcChmdW5jdGlvbiAobXNnKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGgoImRpdiIsIFttc2ddKTsKICAgICAgICAgICAgICAgICAgfSldKV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgX3RoaXMxNC4kWE1vZGFsLm1lc3NhZ2UoewogICAgICAgICAgICAgICAgc3RhdHVzOiAnc3VjY2VzcycsCiAgICAgICAgICAgICAgICBtZXNzYWdlOiAn5qCh6aqM5oiQ5Yqf77yBJwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0sIF9jYWxsZWU1KTsKICAgIH0pKSgpOwogIH0sCiAgc2VsZWN0VmFsaWRFdmVudDogZnVuY3Rpb24gc2VsZWN0VmFsaWRFdmVudCgpIHsKICAgIHZhciBfdGhpczE1ID0gdGhpczsKICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU2KCkgewogICAgICB2YXIgc2VsZWN0UmVjb3JkcywgZXJyTWFwOwogICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZSgpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTYkKF9jb250ZXh0NikgewogICAgICAgIHdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0Ni5wcmV2ID0gX2NvbnRleHQ2Lm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgLy8g6YCJ5Lit5qCh6aqMCiAgICAgICAgICAgIHNlbGVjdFJlY29yZHMgPSBfdGhpczE1LiRyZWZzLnhHcmlkLmdldENoZWNrYm94UmVjb3JkcygpOwogICAgICAgICAgICBpZiAoIShzZWxlY3RSZWNvcmRzLmxlbmd0aCA+IDApKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAxNDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDQ7CiAgICAgICAgICAgIHJldHVybiBfdGhpczE1LiRyZWZzLnhHcmlkLnZhbGlkYXRlKHNlbGVjdFJlY29yZHMpLmNhdGNoKGZ1bmN0aW9uIChlcnJNYXApIHsKICAgICAgICAgICAgICByZXR1cm4gZXJyTWFwOwogICAgICAgICAgICB9KTsKICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgZXJyTWFwID0gX2NvbnRleHQ2LnNlbnQ7CiAgICAgICAgICAgIGlmICghZXJyTWFwKSB7CiAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSAxMDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBfdGhpczE1LiRYTW9kYWwubWVzc2FnZSh7CiAgICAgICAgICAgICAgc3RhdHVzOiAnZXJyb3InLAogICAgICAgICAgICAgIG1lc3NhZ2U6ICfmoKHpqozkuI3pgJrov4fvvIEnCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LmFicnVwdCgicmV0dXJuIiwgZmFsc2UpOwogICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgX3RoaXMxNS4kWE1vZGFsLm1lc3NhZ2UoewogICAgICAgICAgICAgIHN0YXR1czogJ3N1Y2Nlc3MnLAogICAgICAgICAgICAgIG1lc3NhZ2U6ICfmoKHpqozmiJDlip/vvIEnCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LmFicnVwdCgicmV0dXJuIiwgdHJ1ZSk7CiAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDE1OwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgIF90aGlzMTUuJFhNb2RhbC5tZXNzYWdlKHsKICAgICAgICAgICAgICBzdGF0dXM6ICd3YXJuaW5nJywKICAgICAgICAgICAgICBtZXNzYWdlOiAn5pyq6YCJ5Lit5pWw5o2u77yBJwogICAgICAgICAgICB9KTsKICAgICAgICAgIGNhc2UgMTU6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0sIF9jYWxsZWU2KTsKICAgIH0pKSgpOwogIH0sCiAgaW5zZXJ0RXZlbnQ6IGZ1bmN0aW9uIGluc2VydEV2ZW50KHJvdywgY29sdW1uKSB7CiAgICAvLyDmj5LlhaXmlbDmja4KICAgIHZhciB4VGFibGUgPSB0aGlzLiRyZWZzLnhUYWJsZTsKICAgIHhUYWJsZS5pbnNlcnRBdChudWxsLCByb3cpLnRoZW4oZnVuY3Rpb24gKF9yZWYxNCkgewogICAgICB2YXIgcm93ID0gX3JlZjE0LnJvdzsKICAgICAgcmV0dXJuIHhUYWJsZS5zZXRBY3RpdmVDZWxsKHJvdywgY29sdW1uLnByb3BlcnR5KTsKICAgIH0pOwogIH0sCiAgdHJhbnNUYWJsZUNvbHVtbnNUb1NvdXJjZTogZnVuY3Rpb24gdHJhbnNUYWJsZUNvbHVtbnNUb1NvdXJjZShjb2x1bW5zKSB7CiAgICAvLyDooajmoLzmuLLmn5PmlbDmja7ovazmjaLkuLrkvKDlhaXmlbDmja7moLzlvI8KICAgIGlmICghY29sdW1ucykgcmV0dXJuIFtdOwogICAgdmFyIG5ld0NvbHVtbnMgPSBbXTsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIGNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uLCBjb2x1bW5JbmRleCkgewogICAgICBuZXdDb2x1bW5zLnB1c2goY29sdW1uLm93biB8fCB7fSk7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KGNvbHVtbi5jaGlsZHJlbikgJiYgY29sdW1uLmNoaWxkcmVuLmxlbmd0aCkgewogICAgICAgIG5ld0NvbHVtbnNbY29sdW1uSW5kZXhdLmNoaWxkcmVuID0gc2VsZi50cmFuc1RhYmxlQ29sdW1uVG9Tb3VyY2UoY29sdW1uLmNoaWxkcmVuKTsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gbmV3Q29sdW1uczsKICB9Cn07CnZhciB0YWJsZUV2ZW50Rm4gPSB7CiAgc2V0Um93RHJvcDogZnVuY3Rpb24gc2V0Um93RHJvcCgpIHsKICAgIHZhciBfdGhpczE2ID0gdGhpczsKICAgIC8vIOihjOaLluaLveaOkuW6jwogICAgdGhpcy4kbmV4dFRpY2soZnVuY3Rpb24gKCkgewogICAgICB2YXIgeFRhYmxlID0gX3RoaXMxNi4kcmVmcy54R3JpZDsKICAgICAgaWYgKCF4VGFibGUpIHJldHVybjsKICAgICAgdmFyIFNvcnRhYmxlID0gX3RoaXMxNi4kU29ydGFibGU7CiAgICAgIHZhciBYRVV0aWxzID0gX3RoaXMxNi4kWEVVdGlsczsKICAgICAgX3RoaXMxNi5zb3J0YWJsZSA9IFNvcnRhYmxlLmNyZWF0ZSh4VGFibGUuJGVsLnF1ZXJ5U2VsZWN0b3IoJy5ib2R5LS13cmFwcGVyPi52eGUtdGFibGUtLWJvZHkgdGJvZHknKSwgewogICAgICAgIGhhbmRsZTogJy5kcmFnLWJ0bicsCiAgICAgICAgb25FbmQ6IGZ1bmN0aW9uIG9uRW5kKF9yZWYxNSkgewogICAgICAgICAgdmFyIGl0ZW0gPSBfcmVmMTUuaXRlbSwKICAgICAgICAgICAgb2xkSW5kZXggPSBfcmVmMTUub2xkSW5kZXg7CiAgICAgICAgICB2YXIgb3B0aW9ucyA9IHsKICAgICAgICAgICAgY2hpbGRyZW46ICdjaGlsZHJlbicKICAgICAgICAgIH07CiAgICAgICAgICB2YXIgdGFyZ2V0VHJFbGVtID0gaXRlbTsKICAgICAgICAgIHZhciB3cmFwcGVyRWxlbSA9IHRhcmdldFRyRWxlbS5wYXJlbnROb2RlOwogICAgICAgICAgdmFyIHByZXZUckVsZW0gPSB0YXJnZXRUckVsZW0ucHJldmlvdXNFbGVtZW50U2libGluZzsKICAgICAgICAgIHZhciB0YWJsZVRyZWVEYXRhID0gX3RoaXMxNi50YWJsZURhdGFJbjsKICAgICAgICAgIHZhciBzZWxmUm93ID0geFRhYmxlLmdldFJvd05vZGUodGFyZ2V0VHJFbGVtKS5pdGVtOwogICAgICAgICAgdmFyIHNlbGZOb2RlID0gWEVVdGlscy5maW5kVHJlZSh0YWJsZVRyZWVEYXRhLCBmdW5jdGlvbiAocm93KSB7CiAgICAgICAgICAgIHJldHVybiByb3cgPT09IHNlbGZSb3c7CiAgICAgICAgICB9LCBvcHRpb25zKTsKICAgICAgICAgIGlmIChwcmV2VHJFbGVtKSB7CiAgICAgICAgICAgIC8vIOenu+WKqOWIsOiKgueCuQogICAgICAgICAgICB2YXIgcHJldlJvdyA9IHhUYWJsZS5nZXRSb3dOb2RlKHByZXZUckVsZW0pLml0ZW07CiAgICAgICAgICAgIHZhciBwcmV2Tm9kZSA9IFhFVXRpbHMuZmluZFRyZWUodGFibGVUcmVlRGF0YSwgZnVuY3Rpb24gKHJvdykgewogICAgICAgICAgICAgIHJldHVybiByb3cgPT09IHByZXZSb3c7CiAgICAgICAgICAgIH0sIG9wdGlvbnMpOwogICAgICAgICAgICBpZiAoWEVVdGlscy5maW5kVHJlZShzZWxmUm93W29wdGlvbnMuY2hpbGRyZW5dLCBmdW5jdGlvbiAocm93KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHByZXZSb3cgPT09IHJvdzsKICAgICAgICAgICAgfSwgb3B0aW9ucykpIHsKICAgICAgICAgICAgICAvLyDplJnor6/nmoTnp7vliqgKICAgICAgICAgICAgICB2YXIgb2xkVHJFbGVtID0gd3JhcHBlckVsZW0uY2hpbGRyZW5bb2xkSW5kZXhdOwogICAgICAgICAgICAgIHdyYXBwZXJFbGVtLmluc2VydEJlZm9yZSh0YXJnZXRUckVsZW0sIG9sZFRyRWxlbSk7CiAgICAgICAgICAgICAgcmV0dXJuIF90aGlzMTYuJFhNb2RhbC5tZXNzYWdlKHsKICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICfkuI3lhYHorrjoh6rlt7Hnu5noh6rlt7Hmi5bliqjvvIEnLAogICAgICAgICAgICAgICAgc3RhdHVzOiAnZXJyb3InCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGN1cnJSb3cgPSBzZWxmTm9kZS5pdGVtcy5zcGxpY2Uoc2VsZk5vZGUuaW5kZXgsIDEpWzBdOwogICAgICAgICAgICBpZiAoeFRhYmxlLmlzVHJlZUV4cGFuZEJ5Um93KHByZXZSb3cpKSB7CiAgICAgICAgICAgICAgLy8g56e75Yqo5Yiw5b2T5YmN55qE5a2Q6IqC54K5CiAgICAgICAgICAgICAgcHJldlJvd1tvcHRpb25zLmNoaWxkcmVuXS5zcGxpY2UoMCwgMCwgY3VyclJvdyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgLy8g56e75Yqo5Yiw55u46YK76IqC54K5CiAgICAgICAgICAgICAgcHJldk5vZGUuaXRlbXMuc3BsaWNlKHByZXZOb2RlLmluZGV4ICsgKHNlbGZOb2RlLmluZGV4IDwgcHJldk5vZGUuaW5kZXggPyAwIDogMSksIDAsIGN1cnJSb3cpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyDnp7vliqjliLDnrKzkuIDooYwKICAgICAgICAgICAgdmFyIF9jdXJyUm93ID0gc2VsZk5vZGUuaXRlbXMuc3BsaWNlKHNlbGZOb2RlLmluZGV4LCAxKVswXTsKICAgICAgICAgICAgdGFibGVUcmVlRGF0YS51bnNoaWZ0KF9jdXJyUm93KTsKICAgICAgICAgIH0KICAgICAgICAgIC8vIOWmguaenOWPmOWKqOS6huagkeWxgue6p++8jOmcgOimgeWIt+aWsOaVsOaNrgogICAgICAgICAgX3RoaXMxNi50YWJsZURhdGFJbiA9IF90b0NvbnN1bWFibGVBcnJheSh0YWJsZVRyZWVEYXRhKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSk7CiAgfSwKICBzZXRDb2x1bW5Ecm9wOiBmdW5jdGlvbiBzZXRDb2x1bW5Ecm9wKCkgewogICAgdmFyIF90aGlzMTcgPSB0aGlzOwogICAgLy8g6K6+572u5YiX5ouW5ou9CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICB2YXIgU29ydGFibGUgPSB0aGlzLiRTb3J0YWJsZTsKICAgIHRoaXMuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIHhUYWJsZSA9IF90aGlzMTcuJHJlZnMueEdyaWQ7CiAgICAgIF90aGlzMTcuc29ydGFibGUgPSBTb3J0YWJsZS5jcmVhdGUoeFRhYmxlLiRlbC5xdWVyeVNlbGVjdG9yKCcuYm9keS0td3JhcHBlcj4udnhlLXRhYmxlLS1oZWFkZXIgLnZ4ZS1oZWFkZXItLXJvdycpLCB7CiAgICAgICAgaGFuZGxlOiAnLnZ4ZS1oZWFkZXItLWNvbHVtbjpub3QoLmNvbC0tZml4ZWQpJywKICAgICAgICBvbkVuZDogZnVuY3Rpb24gb25FbmQoX3JlZjE2KSB7CiAgICAgICAgICB2YXIgaXRlbSA9IF9yZWYxNi5pdGVtLAogICAgICAgICAgICBuZXdJbmRleCA9IF9yZWYxNi5uZXdJbmRleCwKICAgICAgICAgICAgb2xkSW5kZXggPSBfcmVmMTYub2xkSW5kZXg7CiAgICAgICAgICB2YXIgX3hUYWJsZSRnZXRUYWJsZUNvbHVtID0geFRhYmxlLmdldFRhYmxlQ29sdW1uKCksCiAgICAgICAgICAgIGZ1bGxDb2x1bW4gPSBfeFRhYmxlJGdldFRhYmxlQ29sdW0uZnVsbENvbHVtbiwKICAgICAgICAgICAgdGFibGVDb2x1bW4gPSBfeFRhYmxlJGdldFRhYmxlQ29sdW0udGFibGVDb2x1bW47CiAgICAgICAgICB2YXIgdGFyZ2V0VGhFbGVtID0gaXRlbTsKICAgICAgICAgIHZhciB3cmFwcGVyRWxlbSA9IHRhcmdldFRoRWxlbS5wYXJlbnROb2RlOwogICAgICAgICAgdmFyIG5ld0NvbHVtbiA9IGZ1bGxDb2x1bW5bbmV3SW5kZXhdOwogICAgICAgICAgaWYgKG5ld0NvbHVtbi5maXhlZCkgewogICAgICAgICAgICAvLyDplJnor6/nmoTnp7vliqgKICAgICAgICAgICAgaWYgKG5ld0luZGV4ID4gb2xkSW5kZXgpIHsKICAgICAgICAgICAgICB3cmFwcGVyRWxlbS5pbnNlcnRCZWZvcmUodGFyZ2V0VGhFbGVtLCB3cmFwcGVyRWxlbS5jaGlsZHJlbltvbGRJbmRleF0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHdyYXBwZXJFbGVtLmluc2VydEJlZm9yZSh3cmFwcGVyRWxlbS5jaGlsZHJlbltvbGRJbmRleF0sIHRhcmdldFRoRWxlbSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIF90aGlzMTcuJFhNb2RhbC5tZXNzYWdlKHsKICAgICAgICAgICAgICBtZXNzYWdlOiAn5Zu65a6a5YiX5LiN5YWB6K645ouW5Yqo77yBJywKICAgICAgICAgICAgICBzdGF0dXM6ICdlcnJvcicKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICAvLyDovazmjaLnnJ/lrp7ntKLlvJUKICAgICAgICAgIHZhciBvbGRDb2x1bW5JbmRleCA9IHhUYWJsZS5nZXRDb2x1bW5JbmRleCh0YWJsZUNvbHVtbltvbGRJbmRleF0pOwogICAgICAgICAgdmFyIG5ld0NvbHVtbkluZGV4ID0geFRhYmxlLmdldENvbHVtbkluZGV4KHRhYmxlQ29sdW1uW25ld0luZGV4XSk7CiAgICAgICAgICAvLyDnp7vliqjliLDnm67moIfliJcKICAgICAgICAgIHZhciBjdXJyUm93ID0gZnVsbENvbHVtbi5zcGxpY2Uob2xkQ29sdW1uSW5kZXgsIDEpWzBdOwogICAgICAgICAgZnVsbENvbHVtbi5zcGxpY2UobmV3Q29sdW1uSW5kZXgsIDAsIGN1cnJSb3cpOwogICAgICAgICAgLy8g5piv5ZCm5byA5ZCv5YiX6aG65bqP57yT5a2YCiAgICAgICAgICBpZiAoX3RoaXMxNy50YWJsZUdsb2JhbENvbmZpZy5kcmFnQ29sdW1uc0NvbmZpZy5jYWNoZVN0YXR1cykgewogICAgICAgICAgICAvLyByZXNpemXkuYvlkI7nmoTlrr3luqbmi7/kuI3liLDvvIzmlYXmmoLml7blj6rnvJPlrZjlrZfmrrXlkI0KICAgICAgICAgICAgdmFyIHN0b3JhZ2VDb2x1bW4gPSBfdGhpczE3LnRyYW5zVGFibGVDbG91bW5Ub1NvdXJjZShmdWxsQ29sdW1uKS5maWx0ZXIoZnVuY3Rpb24gKGspIHsKICAgICAgICAgICAgICByZXR1cm4gISFrLmZpZWxkOwogICAgICAgICAgICB9KS5tYXAoZnVuY3Rpb24gKGspIHsKICAgICAgICAgICAgICByZXR1cm4gayAmJiBrLmZpZWxkOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgX3RoaXMxNy4kc3RvcmUuY29tbWl0KCdzZXRDYWNoZUNvbHVtbicsIHsKICAgICAgICAgICAgICBrZXk6IF90aGlzMTcudGFibGVJZCwKICAgICAgICAgICAgICB2YWx1ZTogc3RvcmFnZUNvbHVtbgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIHhUYWJsZS5sb2FkQ29sdW1uKGZ1bGxDb2x1bW4pOwogICAgICAgICAgc2VsZi4kZW1pdCgnUHJveHlFdmVudCcsICdjb2x1bW5EcmFnJywgdGFibGVDb2x1bW4pOwogICAgICAgICAgc2VsZi4kZW1pdCgnY29sdW1uRHJhZycsIHRhYmxlQ29sdW1uKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSk7CiAgfSwKICBvbkNvbnRleHRNZW51Q2xpY2s6IGZ1bmN0aW9uIG9uQ29udGV4dE1lbnVDbGljayhfcmVmMTcsIGV2ZW50KSB7CiAgICB2YXIgbWVudSA9IF9yZWYxNy5tZW51LAogICAgICByb3cgPSBfcmVmMTcucm93LAogICAgICBjb2x1bW4gPSBfcmVmMTcuY29sdW1uLAogICAgICBjb2x1bW5JbmRleCA9IF9yZWYxNy5jb2x1bW5JbmRleCwKICAgICAgcm93SW5kZXggPSBfcmVmMTcucm93SW5kZXg7CiAgICAvLyDlj7PplK7oj5zljZUKICAgIGV2ZW50ID0gZXZlbnQgfHwgd2luZG93LmV2ZW50OwogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgdmFyIHhHcmlkID0gdGhpcy4kcmVmcy54R3JpZDsKICAgIHN3aXRjaCAobWVudS5jb2RlKSB7CiAgICAgIGNhc2UgJ2hpZGVDb2x1bW4nOgogICAgICAgIC8vIOmakOiXj+W9k+WJjeWIlwogICAgICAgIHhHcmlkLmhpZGVDb2x1bW4oY29sdW1uKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2hvd0FsbENvbHVtbic6CiAgICAgICAgLy8g5pi+56S65omA5pyJ5YiXCiAgICAgICAgeEdyaWQucmVzZXRDb2x1bW4oKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAncmVjb3Zlcl9hbGwnOgogICAgICAgIC8vIOaYvuekuuaJgOacieWIlwogICAgICAgIHNlbGYucmVsb2FkVGFibGVDb25sdW1zKHNlbGYudGFibGVDb2x1bW5zQ29uZmlnKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAncmVzZXRDb2x1bW4nOgogICAgICAgIC8vIOmHjeaWsOWKoOi9vQogICAgICAgIHhHcmlkLnJlc2V0Q29sdW1uKHsKICAgICAgICAgIHZpc2libGU6IHRydWUsCiAgICAgICAgICByZXNpemFibGU6IHRydWUKICAgICAgICB9KTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAndG9nZ2xlQWxsQ2hlY2tib3hSb3cnOgogICAgICAgIC8vIOmHjeaWsOWKoOi9vQogICAgICAgIHhHcmlkLnRvZ2dsZUFsbENoZWNrYm94Um93KCk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3JlbG9hZCc6CiAgICAgICAgLy8g6YeN5paw5Yqg6L29CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2luc2VydEF0JzoKICAgICAgICAvLyDmj5LlhaXmlbDmja4KICAgICAgICAvLyBzZWxmLmNvcHlTZWxlY3Rpb25Sb3dEYXRhKCkKICAgICAgICBzZWxmLmluc2VydFJvd0RhdGEoe30pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdyZW1vdmUnOgogICAgICAgIC8vIOenu+mZpOaVsOaNrgogICAgICAgIHhHcmlkLnJlbW92ZShyb3cpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdjbGVhcic6CiAgICAgICAgLy8g5riF6Zmk5Y2V5YWD5qC85pWw5o2uCiAgICAgICAgeEdyaWQuY2xlYXJEYXRhKHJvdywgY29sdW1uLnByb3BlcnR5KTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAndmVyaWZ5JzoKICAgICAgICAvLyDmoKHpqozlubblrprkvY3liLDnrKzkuIDkuKrplJnor68KICAgICAgICAvLyB0aGlzLnZhbGlkYXRlKCkuY2F0Y2goZXJyTWFwID0+IGNvbnNvbGUubG9nKGVyck1hcCkpCiAgICAgICAgdGhpcy52YWxpZEV2ZW50KCk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ21heGltaXplJzoKICAgICAgICAvLyDooajmoLzmnIDlpKfljJYKICAgICAgICB4R3JpZC5tYXhpbWl6ZSgpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdyZXZlcnQnOgogICAgICAgIC8vIOihqOagvOi/mOWOnwogICAgICAgIHNlbGYucmV2ZXJ0RXZlbnQoKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnem9vbSc6CiAgICAgICAgLy8g5YiH5o2i6KGo5qC85pyA5aSn5YyWCiAgICAgICAgeEdyaWQuem9vbSgpOwogICAgICAgIGJyZWFrOwogICAgICAvLyBjYXNlICdjb3B5JzogLy8g5aSN5Yi25paH5pysCiAgICAgIC8vICAgaWYgKHNlbGYuJFhFQ2xpcGJvYXJkLmNvcHkocm93W2NvbHVtbi5wcm9wZXJ0eV0pKSB7CiAgICAgIC8vICAgICBzZWxmLiRYTW9kYWwubWVzc2FnZSh7IG1lc3NhZ2U6ICflt7LlpI3liLbliLDliarotLTmnb/vvIEnLCBzdGF0dXM6ICdzdWNjZXNzJyB9KQogICAgICAvLyAgIH0KICAgICAgLy8gICBicmVhawogICAgICAvLyBjYXNlICdwYXN0ZSc6IC8vIOWkjeWItuaWh+acrAogICAgICAvLyAgIGRlYnVnZ2VyCiAgICAgIC8vICAgbGV0IGNsaXBib2FyZERhdGEgPSAoZXZlbnQuY2xpcGJvYXJkRGF0YSB8fCBldmVudC5vcmlnaW5hbEV2ZW50LmNsaXBib2FyZERhdGEpCiAgICAgIC8vICAgZGVidWdnZXIKICAgICAgLy8gICByb3dbY29sdW1uLnByb3BlcnR5XSA9IGNsaXBib2FyZERhdGEKICAgICAgLy8gICBicmVhawogICAgICAvLyAgY2FzZSAnc2F2ZSc6CiAgICAgIC8vICBzZWxmLiRYTW9kYWwubWVzc2FnZSh7IG1lc3NhZ2U6ICfkv53lrZjmiJDlip8nLCBzdGF0dXM6ICdzdWNjZXNzJyB9KQogICAgICAvLyAgYnJlYWsKICAgICAgY2FzZSAnZXhwb3J0RGF0YVhsc3gnOgogICAgICAgIGNvbnNvbGUubG9nKCd0aGlzLiRFeHBvcnQnLCB0aGlzLCB0aGlzLiRFeHBvcnQpOwogICAgICAgIHRoaXMudHJpZ2dlckV4cG9ydE9wdGlvbigpOwogICAgICAgIC8vIHRoaXMuJEV4cG9ydC5leHBvcnRFeGNlbCh7CiAgICAgICAgLy8gICBjb2x1bW5zOiB0aGlzLnRhYmxlQ29sdW1uc0NvbmZpZywKICAgICAgICAvLyAgIGRhdGFzOiB0aGlzLmdldFRhYmxlRGF0YSgpLmZ1bGxEYXRhCiAgICAgICAgLy8gfSkKICAgICAgICAvLyB4R3JpZC5vcGVuRXhwb3J0KHsKICAgICAgICAvLyAgIGZpbGVuYW1lOiAnZXhwb3J0JywKICAgICAgICAvLyAgIHNoZWV0TmFtZTogJ1NoZWV0MScsCiAgICAgICAgLy8gICB0eXBlOiAneGxzeCcsCiAgICAgICAgLy8gICBpc1ByaW50OiB0cnVlCiAgICAgICAgLy8gfSkKICAgICAgICBicmVhazsKICAgICAgY2FzZSAncHJpbnQnOgogICAgICAgIHhHcmlkLnByaW50KHsKICAgICAgICAgIGZpbGVuYW1lOiAncHJpbnREYXRhJywKICAgICAgICAgIG1vZGU6ICdjdXJyZW50JywKICAgICAgICAgIGlzSGVhZGVyOiB0cnVlLAogICAgICAgICAgaXNGb290ZXI6IHRydWUKICAgICAgICB9KTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnbG9nQ3VycmVudERhdGEnOgogICAgICAgIGNvbnNvbGUubG9nKCflvZPliY3ooYzmlbDmja46Jywgcm93LCAnXG4nLCAn5b2T5YmN5Y2V5YWD5qC85pWw5o2uOicsIHJvdyAmJiByb3dbY29sdW1uLnByb3BlcnR5XSwgJ1xuJywgJ+W9k+WJjeWIl+mFjee9ruaVsOaNrjonLCBjb2x1bW4sICdcbicsICflvZPliY3ooYzntKLlvJU6Jywgcm93SW5kZXgsICdcbicsICflvZPliY3liJfntKLlvJU6JywgY29sdW1uSW5kZXgsICdcbicpOwogICAgICAgIC8vIGNvbnNvbGUubG9nKHJvdyAmJiByb3dbY29sdW1uLnByb3BlcnR5XSwgcm93LCBjb2x1bW4sIGNvbHVtbkluZGV4LCByb3dJbmRleCkKICAgICAgICBjb25zb2xlLmxvZygn5b2T5YmN6KGo5qC85pWw5o2uOicsIHRoaXMuZ2V0VGFibGVEYXRhKCkpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdleHBvcnREYXRhUGRmJzoKICAgICAgICB4R3JpZC5leHBvcnREYXRhKHsKICAgICAgICAgIGZpbGVuYW1lOiAn5a+85Ye6JywKICAgICAgICAgIHR5cGU6ICdwZGYnCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2NsZWFyU29ydCc6CiAgICAgICAgeEdyaWQuY2xlYXJTb3J0KCk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NvcnRBc2MnOgogICAgICAgIHhHcmlkLnNvcnQoY29sdW1uLnByb3BlcnR5LCAnYXNjJyk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NvcnREZXNjJzoKICAgICAgICB4R3JpZC5zb3J0KGNvbHVtbi5wcm9wZXJ0eSwgJ2Rlc2MnKTsKICAgICAgICBicmVhazsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9LAogIHRyaWdnZXJSZXZlcnNlQ2hlY2s6IGZ1bmN0aW9uIHRyaWdnZXJSZXZlcnNlQ2hlY2soKSB7CiAgICAvLyDlj43pgIkKICAgIHZhciBzZWxmID0gdGhpczsKICAgIHZhciB4R3JpZCA9IHNlbGYuJHJlZnMueEdyaWQ7CiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAvLyBsZXQgc2VsZWN0aW9uTmV3ID0gW10KICAgICAgdmFyIHNlbGVjdGlvbiA9IHhHcmlkLmdldENoZWNrYm94UmVjb3JkcygpOwogICAgICB2YXIgX3hHcmlkJGdldFRhYmxlRGF0YSA9IHhHcmlkLmdldFRhYmxlRGF0YSgpLAogICAgICAgIHRhYmxlRGF0YSA9IF94R3JpZCRnZXRUYWJsZURhdGEudGFibGVEYXRhOwogICAgICAvLyB0YWJsZURhdGEuZm9yRWFjaCgocm93LCByb3dJbmRleCkgPT4gewogICAgICAvLyAgIGlmICghc2VsZWN0aW9uLnNvbWUoKGl0ZW0sIGluZGV4KSA9PiB7CiAgICAgIC8vICAgICByZXR1cm4gcm93Ll9YSUQgPT09IGl0ZW0uX1hJRAogICAgICAvLyAgIH0pKSB7CiAgICAgIC8vICAgICBzZWxlY3Rpb25OZXcucHVzaChyb3cpCiAgICAgIC8vICAgfQogICAgICAvLyB9KQogICAgICAvLyB4R3JpZC5jbGVhckNoZWNrYm94Um93KCkudGhlbigoKSA9PiB7CiAgICAgIHhHcmlkLnNldENoZWNrYm94Um93KHRhYmxlRGF0YSwgdHJ1ZSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgeEdyaWQuc2V0Q2hlY2tib3hSb3coc2VsZWN0aW9uLCBmYWxzZSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICBzZWxmLnNlbGVjdGlvbiA9IHhHcmlkLmdldENoZWNrYm94UmVjb3JkcygpOwogICAgICAgICAgcmVzb2x2ZShzZWxmLnNlbGVjdGlvbik7CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHJlamVjdChlKTsKICAgICAgICB9KTsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICByZWplY3QoZSk7CiAgICAgIH0pOwogICAgICAvLyB9KS5jYXRjaChlID0+IHsKICAgICAgLy8gICByZWplY3QoZSkKICAgICAgLy8gfSkKICAgIH0pOwogIH0sCiAgaGFuZGxlQ2hlY2tib3hDaGFuZ2U6IGZ1bmN0aW9uIGhhbmRsZUNoZWNrYm94Q2hhbmdlKG9iaiwgZSkgewogICAgdmFyIF90aGlzMTggPSB0aGlzOwogICAgLy8g5aSa6YCJ6YCJ5Lit5oiW5Y676YCJ5p+Q5LiA5p2h5LqL5Lu2CiAgICB0aGlzLnNlbGVjdGlvbiA9IG9iaiA/IG9iai5yZWNvcmRzIDogdGhpcy5nZXRTZWxlY3Rpb25EYXRhKCk7CiAgICB0aGlzLnVwZGF0ZUZvb3RlcigpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICBfdGhpczE4LiRlbWl0KCdjaGVja2JveENoYW5nZScsIG9iaiwgZSk7CiAgICAgIF90aGlzMTguJGVtaXQoJ1Byb3h5RXZlbnQnLCAnY2hlY2tib3hDaGFuZ2UnLCBvYmosIF90aGlzMTgsIF90aGlzMTguJHJlZnMueEdyaWQpOwogICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkge30pOwogIH0sCiAgaGFuZGxlQ2hlY2tib3hBbGxDaGFuZ2U6IGZ1bmN0aW9uIGhhbmRsZUNoZWNrYm94QWxsQ2hhbmdlKG9iaiwgZSkgewogICAgdmFyIF90aGlzMTkgPSB0aGlzOwogICAgLy8g5YWo6YCJ6YCJ5Lit5oiW5Y676YCJ5p+Q5LiA5p2h5LqL5Lu2CiAgICB0aGlzLnNlbGVjdGlvbiA9IG9iai5yZWNvcmRzOwogICAgdGhpcy51cGRhdGVGb290ZXIoKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgX3RoaXMxOS4kZW1pdCgnY2hlY2tib3hBbGwnLCBvYmosIGUpOwogICAgICBfdGhpczE5LiRlbWl0KCdQcm94eUV2ZW50JywgJ2NoZWNrYm94QWxsJywgb2JqLCBfdGhpczE5LCBfdGhpczE5LiRyZWZzLnhHcmlkKTsKICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHt9KTsKICB9LAogIG9uT3B0aW9uUm93Q2xpY2s6IGZ1bmN0aW9uIG9uT3B0aW9uUm93Q2xpY2sob2JqKSB7CiAgICAvLyDmk43kvZzliJfngrnlh7vkuovku7YKICAgIHRoaXMuJGVtaXQoJ29uT3B0aW9uUm93Q2xpY2snLCBvYmosIHRoaXMpOwogICAgdGhpcy4kZW1pdCgnUHJveHlFdmVudCcsICdvbk9wdGlvblJvd0NsaWNrJywgb2JqLCB0aGlzLCB0aGlzLiRyZWZzLnhHcmlkKTsKICAgIHZhciBtZXRob2RzID0gdGhpcy50YWJsZUNvbmZpZ0NwLm1ldGhvZHM7CiAgICB0eXBlb2YgbWV0aG9kcy5vbk9wdGlvblJvd0NsaWNrID09PSAnZnVuY3Rpb24nICYmIG1ldGhvZHMub25PcHRpb25Sb3dDbGljayhvYmosIHRoaXMpOwogIH0sCiAgb25PcHRpb25Tb3J0Um93Q2xpY2s6IGZ1bmN0aW9uIG9uT3B0aW9uU29ydFJvd0NsaWNrKF9yZWYxOCkgewogICAgdmFyIHJvdyA9IF9yZWYxOC5yb3csCiAgICAgIGNvbHVtbiA9IF9yZWYxOC5jb2x1bW4sCiAgICAgICRyb3dJbmRleCA9IF9yZWYxOC4kcm93SW5kZXgsCiAgICAgIGRhdGEgPSBfcmVmMTguZGF0YSwKICAgICAgaXRlbXMgPSBfcmVmMTguaXRlbXMsCiAgICAgIG9wdGlvblR5cGUgPSBfcmVmMTgub3B0aW9uVHlwZTsKICAgIHN3aXRjaCAob3B0aW9uVHlwZSkgewogICAgICBjYXNlICd1cFNvcnQnOgogICAgICAgIGlmICgkcm93SW5kZXggPiAwKSB7CiAgICAgICAgICB2YXIgdGVtcCA9IGRhdGFbJHJvd0luZGV4IC0gMV07CiAgICAgICAgICBkYXRhWyRyb3dJbmRleCAtIDFdID0gZGF0YVskcm93SW5kZXhdOwogICAgICAgICAgZGF0YVskcm93SW5kZXhdID0gdGVtcDsKICAgICAgICAgIC8vIFtkYXRhWyRyb3dJbmRleCAtIDFdXSwgZGF0YVskcm93SW5kZXhdXSA9IFtkYXRhWyRyb3dJbmRleF0sIGRhdGFbJHJvd0luZGV4LTFdXSB0cwogICAgICAgIH0KCiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2Rvd25Tb3J0JzoKICAgICAgICBpZiAoJHJvd0luZGV4IDwgZGF0YS5sZW5ndGggLSAxKSB7CiAgICAgICAgICB2YXIgX3RlbXAgPSBkYXRhWyRyb3dJbmRleCArIDFdOwogICAgICAgICAgZGF0YVskcm93SW5kZXggKyAxXSA9IGRhdGFbJHJvd0luZGV4XTsKICAgICAgICAgIGRhdGFbJHJvd0luZGV4XSA9IF90ZW1wOwogICAgICAgICAgLy8gW2RhdGFbJHJvd0luZGV4ICsgMV1dLCBkYXRhWyRyb3dJbmRleF1dID0gW2RhdGFbJHJvd0luZGV4XSwgZGF0YVskcm93SW5kZXggKyAxXV0gdHMKICAgICAgICB9CgogICAgICAgIGJyZWFrOwogICAgICBjYXNlICd0b3BTb3J0JzoKICAgICAgICBpZiAoJHJvd0luZGV4ID4gMCkgewogICAgICAgICAgZGF0YS51bnNoaWZ0KGRhdGEuc3BsaWNlKCRyb3dJbmRleCwgMSlbMF0pOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYm90dG9tU29ydCc6CiAgICAgICAgaWYgKCRyb3dJbmRleCA8IGRhdGEubGVuZ3RoIC0gMSkgewogICAgICAgICAgZGF0YS5wdXNoKGRhdGEuc3BsaWNlKCRyb3dJbmRleCwgMSlbMF0pOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgZGVmYXVsdDoKICAgICAgICBicmVhazsKICAgIH0KICAgIHRoaXMuJHJlZnMueEdyaWQucmVsb2FkRGF0YShkYXRhKS50aGVuKCkuY2F0Y2goKTsKICB9Cn07CnZhciB0b29sQmFyRXZlbnQgPSB7CiAgdG9vbGJhckJ1dHRvbkNsaWNrRXZlbnQ6IGZ1bmN0aW9uIHRvb2xiYXJCdXR0b25DbGlja0V2ZW50KG9iaiwgZSkgewogICAgLy8gdG9vbGJhcuS6i+S7tuS7o+eQhgogICAgLy8g5bel5YW35qCP5bem5L6n5oyJ6ZKu54K55Ye75LqL5Lu2CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICBzZWxmLiRlbWl0KCdvblRvb2xiYXJCdG5DbGljaycsIG9iaiwgdGhpcyk7CiAgICB2YXIgbWV0aG9kcyA9IHRoaXMudGFibGVDb25maWdDcC5tZXRob2RzOwogICAgaWYgKHR5cGVvZiBvYmouYnV0dG9uLmNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7CiAgICAgIG9iai5idXR0b24uY2FsbGJhY2sob2JqLCBzZWxmLCBlKTsKICAgIH0gZWxzZSB7CiAgICAgIHR5cGVvZiBtZXRob2RzLnRvb2xiYXJCdXR0b25DbGlja0V2ZW50ID09PSAnZnVuY3Rpb24nICYmIG1ldGhvZHMudG9vbGJhckJ1dHRvbkNsaWNrRXZlbnQob2JqLCBzZWxmLCBlKTsKICAgIH0KICB9LAogIG9uVG9vbGJhck9wZXJyYXRlQ2xpY2s6IGZ1bmN0aW9uIG9uVG9vbGJhck9wZXJyYXRlQ2xpY2soY29kZSkgewogICAgdmFyIF90aGlzMjAgPSB0aGlzOwogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgc3dpdGNoIChjb2RlKSB7CiAgICAgIGNhc2UgJ3JldmVyc2VDaGVjayc6CiAgICAgICAgdGhpcy50cmlnZ2VyUmV2ZXJzZUNoZWNrKCkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgICAgICBfdGhpczIwLiRlbWl0KCd0cmlnZ2VyUmV2ZXJzZUNoZWNrJywgewogICAgICAgICAgICByZWNvcmRzOiByZXMKICAgICAgICAgIH0sIF90aGlzMjApOwogICAgICAgICAgX3RoaXMyMC4kZW1pdCgnUHJveHlFdmVudCcsICd0cmlnZ2VyUmV2ZXJzZUNoZWNrJywgewogICAgICAgICAgICByZWNvcmRzOiByZXMKICAgICAgICAgIH0sIF90aGlzMjApOwogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICBjb25zb2xlLmxvZyhlKTsKICAgICAgICAgIHRocm93IGU7CiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3JlZnJlc2gnOgogICAgICAgIHRoaXMuJGVtaXQoJ29uVG9vbGJhckJ0bkNsaWNrJywgewogICAgICAgICAgY29udGV4dDogdGhpcywKICAgICAgICAgIHhHcmlkOiB0aGlzLiRyZWZzLnhHcmlkLAogICAgICAgICAgY29kZTogJ3JlZnJlc2gnCiAgICAgICAgfSk7CiAgICAgICAgLy8gdGhpcy5yZWxvYWRUYWJsZUNvbmx1bXModGhpcy50YWJsZUNvbHVtbnNDb25maWcpCiAgICAgICAgLy8gdGhpcy5yZWZyZXNoVGFibGUoKQogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdjYWxjdWxhdG9yJzoKICAgICAgICB0aGlzLiRYTW9kYWwubWVzc2FnZSh7CiAgICAgICAgICBzdGF0dXM6ICdpbmZvJywKICAgICAgICAgIG1lc3NhZ2U6ICfmraTlip/og73mraPlnKjlvIDlj5HkuK0nCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3pvb20nOgogICAgICAgIHRoaXMuJHJlZnMueEdyaWQuem9vbSgpLnRoZW4oZnVuY3Rpb24gKCkge30pLmNhdGNoKGZ1bmN0aW9uICgpIHt9KTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnZXhwb3J0JzoKICAgICAgICBjb25zb2xlLmluZm8oJ3Rvb2xiYXJDb25maWdJbi5leHBvcnRDdXN0b209PScgKyB0aGlzLnRvb2xiYXJDb25maWdJbi5leHBvcnRDdXN0b20pOwogICAgICAgIGlmICh0aGlzLnRvb2xiYXJDb25maWdJbiAmJiB0aGlzLnRvb2xiYXJDb25maWdJbi5leHBvcnRDdXN0b20pIHsKICAgICAgICAgIHRoaXMuJGVtaXQoJ29uVG9vbGJhckJ0bkNsaWNrJywgewogICAgICAgICAgICBjb250ZXh0OiB0aGlzLAogICAgICAgICAgICB4R3JpZDogdGhpcy4kcmVmcy54R3JpZCwKICAgICAgICAgICAgY29kZTogJ2V4cG9ydCcKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLnRyaWdnZXJFeHBvcnRPcHRpb24oKTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2N1c3RvbSc6CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2ltcG9ydCc6CiAgICAgICAgdGhpcy50cmlnZ2VySW1wb3J0T3B0aW9uKHsKICAgICAgICAgIGRvd25sb2FkVGVtcGxhdGVDYWxsYmFjazogZnVuY3Rpb24gZG93bmxvYWRUZW1wbGF0ZUNhbGxiYWNrKENiKSB7CiAgICAgICAgICAgIHNlbGYuZG93bkxvYWRJbXBvcnRUZW1wbGF0ZSgpOwogICAgICAgICAgfSwKICAgICAgICAgIGltcG9ydFN1Y2Nlc3NDYWxsYmFjazogZnVuY3Rpb24gaW1wb3J0U3VjY2Vzc0NhbGxiYWNrKHJlcykgewogICAgICAgICAgICB0aGlzLiRlbWl0KCdpbXBvcnRTdWNjZXNzQ2FsbGJhY2snLCByZXMpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdleHBhbmRBbGwnOgogICAgICAgIHRoaXMuZXhwZW5kQWxsTG9hZGluZyA9IHRydWU7CiAgICAgICAgLy8g6K6+572u5a6P5Lu75Yqh77yM5bu26L+f5omn6KGM6YG/5YWNanPov5vnqIvlkIzmraXov5DooYzlpKfph4/mk43kvZzlr7zoh7TmuLLmn5Pov5vnqItsb2FkaW5n5YGH5q27CiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgaGFuZGxlID0gX3RoaXMyMC5leHBhbmRBbGxTdGF0ZSA/IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIF90aGlzMjAkJHJlZnMkeEdyaWQsIF90aGlzMjAkJHJlZnMkeEdyaWQkYzsKICAgICAgICAgICAgcmV0dXJuIChfdGhpczIwJCRyZWZzJHhHcmlkID0gX3RoaXMyMC4kcmVmcy54R3JpZCkgPT09IG51bGwgfHwgX3RoaXMyMCQkcmVmcyR4R3JpZCA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF90aGlzMjAkJHJlZnMkeEdyaWQkYyA9IF90aGlzMjAkJHJlZnMkeEdyaWQuY2xlYXJUcmVlRXhwYW5kKSA9PT0gbnVsbCB8fCBfdGhpczIwJCRyZWZzJHhHcmlkJGMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF90aGlzMjAkJHJlZnMkeEdyaWQkYy5jYWxsKF90aGlzMjAkJHJlZnMkeEdyaWQpOwogICAgICAgICAgfSA6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIF90aGlzMjAkJHJlZnMkeEdyaWQyLCBfdGhpczIwJCRyZWZzJHhHcmlkMiQ7CiAgICAgICAgICAgIHJldHVybiAoX3RoaXMyMCQkcmVmcyR4R3JpZDIgPSBfdGhpczIwLiRyZWZzLnhHcmlkKSA9PT0gbnVsbCB8fCBfdGhpczIwJCRyZWZzJHhHcmlkMiA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF90aGlzMjAkJHJlZnMkeEdyaWQyJCA9IF90aGlzMjAkJHJlZnMkeEdyaWQyLnNldEFsbFRyZWVFeHBhbmQpID09PSBudWxsIHx8IF90aGlzMjAkJHJlZnMkeEdyaWQyJCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3RoaXMyMCQkcmVmcyR4R3JpZDIkLmNhbGwoX3RoaXMyMCQkcmVmcyR4R3JpZDIsIHRydWUpOwogICAgICAgICAgfTsKICAgICAgICAgIGhhbmRsZSgpLmZpbmFsbHkoZnVuY3Rpb24gKCkgewogICAgICAgICAgICBfdGhpczIwLmV4cGFuZEFsbFN0YXRlID0gIV90aGlzMjAuZXhwYW5kQWxsU3RhdGU7CiAgICAgICAgICAgIF90aGlzMjAuZXhwZW5kQWxsTG9hZGluZyA9IGZhbHNlOwogICAgICAgICAgfSk7CiAgICAgICAgfSwgMTYuNjcpOwogICAgICAgIGJyZWFrOwogICAgfQogIH0sCiAgc2V0TW9uZXlVbml0OiBmdW5jdGlvbiBzZXRNb25leVVuaXQoVW5pdGxldmVsLCBvbGRVbml0bGV2ZWwpIHsKICAgIHZhciBfdGhpczIxID0gdGhpczsKICAgIC8vIOiuvue9rumHkemineWNleS9jQogICAgdGhpcy50b29sYmFyQ29uZmlnSW5Db3B5Lm1vbmV5VW5pdE9wdGlvbnMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHsKICAgICAgaWYgKGl0ZW0udmFsdWUgPT09IFVuaXRsZXZlbCkgewogICAgICAgIF90aGlzMjEuY3VyU2VsZWN0TW9uZXlVbml0T3B0aW9uID0gaXRlbTsKICAgICAgfQogICAgfSk7CiAgICB2YXIgeEdyaWQgPSB0aGlzLiRyZWZzLnhHcmlkOwogICAgaWYgKCF4R3JpZCkgewogICAgICByZXR1cm47CiAgICB9CiAgICB4R3JpZC4kZm9yY2VVcGRhdGUoKTsKICAgIHhHcmlkLnVwZGF0ZUZvb3RlcigpLnRoZW4oZnVuY3Rpb24gKCkge30pLmNhdGNoKGZ1bmN0aW9uICgpIHt9KTsKICB9LAogIC8qKg0KICAgKiDlj6PlvoTor7TmmI7ngrnlh7vvvIjmmL7npLrlvLnnqpfvvIkNCiAgICovCiAgY2FsaWJlckRlY2xhcmVIYW5kbGU6IGZ1bmN0aW9uIGNhbGliZXJEZWNsYXJlSGFuZGxlKCkgewogICAgdGhpcy5jYWxpYmVyRGVjbGFyZVZpc2libGUgPSAhdGhpcy5jYWxpYmVyRGVjbGFyZVZpc2libGU7CiAgfQp9Owp2YXIgcGFnZUV2ZW50ID0gewogIC8vIOWIhumhteS6i+S7tgogIHNldFBhZ2VyQ29uZmlnOiBmdW5jdGlvbiBzZXRQYWdlckNvbmZpZygpIHsKICAgIC8vIOabtOaWsOWIhumhtemFjee9rgogICAgaWYgKHRoaXMuZ2V0YmFzaWNEYXRhVHlwZSh0aGlzLnBhZ2VyQ29uZmlnKSA9PT0gJ0Jvb2xlYW4nKSB7CiAgICAgIHRoaXMucGFnZXJDb25maWdJbiA9IHVuZGVmaW5lZDsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMucGFnZXJDb25maWdJbiA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMucGFnZXJDb25maWdJbiA/IHRoaXMucGFnZXJDb25maWdJbiA6IHRoaXMucGFnZXJDb25maWdJbkNwLCB0aGlzLnBhZ2VyQ29uZmlnKTsKICAgIH0KICB9LAogIGhhbmRsZVBhZ2VDaGFuZ2U6IGZ1bmN0aW9uIGhhbmRsZVBhZ2VDaGFuZ2UoX3JlZjE5KSB7CiAgICB2YXIgY3VycmVudFBhZ2UgPSBfcmVmMTkuY3VycmVudFBhZ2UsCiAgICAgIHBhZ2VTaXplID0gX3JlZjE5LnBhZ2VTaXplOwogICAgLy8g5YiG6aG15pS55Y+Y5LqL5Lu2CiAgICB0aGlzLnBhZ2VyQ29uZmlnSW4uY3VycmVudFBhZ2UgPSBjdXJyZW50UGFnZTsKICAgIHRoaXMucGFnZXJDb25maWdJbi5wYWdlU2l6ZSA9IHBhZ2VTaXplOwogICAgdGhpcy5sb2FkRGF0YSgpOwogIH0sCiAgaGFuZGxlUmVmcmVzaDogZnVuY3Rpb24gaGFuZGxlUmVmcmVzaCgpIHsKICAgIC8vIOWIt+aWsAogICAgdGhpcy5mb3JtU2VhcmNoU3VibWl0KHsKICAgICAgZGF0YToge30KICAgIH0pOwogIH0sCiAgZ2V0Q29sdW1uc0xpc3Q6IGZ1bmN0aW9uIGdldENvbHVtbnNMaXN0KCkgewogICAgdmFyIG5ld0NvbHVtbnNMaXN0ID0gW107CiAgICB0aGlzLnRhYmxlQ29sdW1uc0NvbmZpZy5mb3JFYWNoKGZ1bmN0aW9uICh2KSB7CiAgICAgIG5ld0NvbHVtbnNMaXN0LnB1c2godi5maWVsZCk7CiAgICB9KTsKICAgIHJldHVybiBuZXdDb2x1bW5zTGlzdDsKICB9LAogIGRlbFNlYXJjaGZyb21NYWluOiBmdW5jdGlvbiBkZWxTZWFyY2hmcm9tTWFpbigpIHsKICAgIC8vIOeItue7hOS7tuiwg+eUqOatpOaWueazlea4heepuuafpeivouaVsOaNrgogICAgdGhpcy5mb3JtU2VhcmNoRGF0YS5maWx0ZXJWYWx1ZSA9ICcnOwogIH0sCiAgZm9ybVNlYXJjaFN1Ym1pdDogZnVuY3Rpb24gZm9ybVNlYXJjaFN1Ym1pdChfcmVmMjApIHsKICAgIHZhciBfdGhpczIyID0gdGhpczsKICAgIHZhciBkYXRhID0gX3JlZjIwLmRhdGEsCiAgICAgICRldmVudCA9IF9yZWYyMC4kZXZlbnQ7CiAgICB2YXIgbmV3VGJsZURhdGFzID0gW107CiAgICAvLyB0aGlzLmZvcm1TZWFyY2hEYXRhLmZpbHRlclZhbHVlCiAgICB2YXIgc2VhcmNoID0gdGhpcy5mb3JtU2VhcmNoRGF0YS5maWx0ZXJWYWx1ZTsKICAgIGlmIChzZWFyY2ggIT09ICcnKSB7CiAgICAgIHRoaXMudGFibGVEYXRhSW4uZm9yRWFjaChmdW5jdGlvbiAoZGF0YU5ld3MpIHsKICAgICAgICB2YXIgbmV3Q29sdW1uc0xpc3QgPSBfdGhpczIyLnRhYmxlQ29sdW1uc0ZpZWxkQXJyOwogICAgICAgIGNvbnNvbGUubG9nKG5ld0NvbHVtbnNMaXN0KTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IE9iamVjdC5rZXlzKGRhdGFOZXdzKS5sZW5ndGg7IGkrKykgewogICAgICAgICAgaWYgKG5ld0NvbHVtbnNMaXN0LmluY2x1ZGVzKE9iamVjdC5rZXlzKGRhdGFOZXdzKVtpXSkgJiYgU3RyaW5nKGRhdGFOZXdzW09iamVjdC5rZXlzKGRhdGFOZXdzKVtpXV0pLmluZGV4T2Yoc2VhcmNoKSA+IC0xKSB7CiAgICAgICAgICAgIG5ld1RibGVEYXRhcy5wdXNoKGRhdGFOZXdzKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgICAgdGhpcy5yZWxvYWRUYWJsZVJlbmRlckRhdGEobmV3VGJsZURhdGFzKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMucmVsb2FkVGFibGVSZW5kZXJEYXRhKHRoaXMudGFibGVEYXRhSW4pOwogICAgfQogIH0sCiAgb25GdXp6eVNlYXJjaEVudGVyOiBmdW5jdGlvbiBvbkZ1enp5U2VhcmNoRW50ZXIoKSB7CiAgICBpZiAodGhpcy50b29sYmFyQ29uZmlnSW5Db3B5LnNlYXJjaCAhPT0gJ3JlbW90ZVNlYXJjaCcpIHsKICAgICAgaWYgKHdpbmRvdy5ldmVudC5rZXlDb2RlID09PSAxMyAmJiB0aGlzLmZpbHRlcnRleHQpIHt9CiAgICB9IGVsc2UgewogICAgICBpZiAod2luZG93LmV2ZW50LmtleUNvZGUgPT09IDEzICYmIHRoaXMuZmlsdGVydGV4dCkgewogICAgICAgIHRoaXMuZmlsdGVydGV4dENwID0gdGhpcy5maWx0ZXJ0ZXh0OwogICAgICAgIHRoaXMuJHJlZnMueEdyaWQudXBkYXRlRGF0YSgpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZmlsdGVydGV4dENwID0gJyc7CiAgICAgICAgdGhpcy4kcmVmcy54R3JpZC51cGRhdGVEYXRhKCk7CiAgICAgIH0KICAgIH0KICB9LAogIGdldEhpZ2hsaWdodGVkRmlsdGVyVGV4dDogZnVuY3Rpb24gZ2V0SGlnaGxpZ2h0ZWRGaWx0ZXJUZXh0KHZhbCkgewogICAgLy8g5riy5p+T5pa95Yqg6auY5LquCiAgICBpZiAodGhpcy5maWx0ZXJ0ZXh0Q3ApIHsKICAgICAgdmFyIHJlZ2YgPSBuZXcgUmVnRXhwKHRoaXMuZmlsdGVydGV4dENwLCAnaWcnKTsKICAgICAgcmV0dXJuIFN0cmluZyh2YWwpLnJlcGxhY2UocmVnZiwgZnVuY3Rpb24gKG1hdGNoKSB7CiAgICAgICAgaWYgKG1hdGNoKSB7CiAgICAgICAgICByZXR1cm4gIjxzcGFuIGNsYXNzPVwiZmlsdGVyLWxpZ2h0aW5nXCI+Ii5jb25jYXQobWF0Y2gsICI8L3NwYW4+Iik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIHZhbDsKICAgIH0KICB9LAogIGxvYWREYXRhOiBmdW5jdGlvbiBsb2FkRGF0YSgpIHsKICAgIC8vIOWKoOi9veaVsOaNrgogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgdmFyIHNlYXJjaFBhcmFtcyA9IHsKICAgICAgcGFyYW1zOiB0aGlzLmZvcm1TZWFyY2hEYXRhLAogICAgICBjdXJyZW50UGFnZTogdGhpcy5wYWdlckNvbmZpZ0luLmN1cnJlbnRQYWdlLAogICAgICBwYWdlU2l6ZTogdGhpcy5wYWdlckNvbmZpZ0luLnBhZ2VTaXplCiAgICB9OwogICAgc2VsZi4kZW1pdCgnYWpheERhdGEnLCBzZWFyY2hQYXJhbXMsIHRoaXMpOwogIH0sCiAgb25BZHZhbmNlZFNlYXJjaEJ0bkNsaWNrOiBmdW5jdGlvbiBvbkFkdmFuY2VkU2VhcmNoQnRuQ2xpY2soKSB7CiAgICB0aGlzLiRlbWl0KCdvbkFkdmFuY2VkU2VhcmNoQnRuQ2xpY2snLCB7CiAgICAgIHBhcmFtczogdGhpcy5mb3JtU2VhcmNoRGF0YSwKICAgICAgY3VycmVudFBhZ2U6IHRoaXMucGFnZXJDb25maWdJbi5jdXJyZW50UGFnZSwKICAgICAgcGFnZVNpemU6IHRoaXMucGFnZXJDb25maWdJbi5wYWdlU2l6ZQogICAgfSwgdGhpcyk7CiAgfQp9Owp2YXIgcHJveHlGbiA9IHsKICAvLyByZXNnaXN0RXZlbnRQcm94eSgpIHsKICAvLyBsZXQgYXJnPVsuLi5hcmd1bWVudHNdCiAgLy8gICAvLyDms6jlhozkuovku7bku6PnkIYKICAvLyAgIGxldCBzZWxmID0gdGhpcwogIC8vICAgT2JqZWN0LmtleXMoc2VsZi50YWJsZUV2ZW50SW4pLmZvckVhY2goKGl0ZW0sIGluZGV4KSA9PiB7CiAgLy8gICAgIHNlbGYuJG9uKHNlbGYuaHlwaGVuYXRlKGl0ZW0pLCBzZWxmLnRhYmxlRXZlbnRJbltpdGVtXS5iaW5kKHNlbGYpKQogIC8vICAgfSkKICAvLyB9CiAgaGFuZGxlU2VhcmNoOiBmdW5jdGlvbiBoYW5kbGVTZWFyY2goKSB7CiAgICB2YXIgX3RoaXMyMyA9IHRoaXM7CiAgICB2YXIgZmlsdGVyTmFtZSA9IHRoaXMuJFhFVXRpbHMudG9TdHJpbmcodGhpcy5maWx0ZXJOYW1lKS50cmltKCkudG9Mb3dlckNhc2UoKTsKICAgIGlmIChmaWx0ZXJOYW1lKSB7CiAgICAgIHZhciBmaWx0ZXJSRSA9IG5ldyBSZWdFeHAoZmlsdGVyTmFtZSwgJ2dpJyk7CiAgICAgIHZhciBvcHRpb25zID0gewogICAgICAgIGNoaWxkcmVuOiAnbGlzdCcKICAgICAgfTsKICAgICAgdmFyIHNlYXJjaFByb3BzID0gWyduYW1lJywgJ2Rlc2MnLCAndHlwZScsICdlbnVtJywgJ2RlZlZhbCddOwogICAgICB2YXIgcmVzdCA9IHRoaXMuJFhFVXRpbHMuc2VhcmNoVHJlZSh0aGlzLnRhYmxlRGF0YSwgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICByZXR1cm4gc2VhcmNoUHJvcHMuc29tZShmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgICByZXR1cm4gaXRlbVtrZXldLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihmaWx0ZXJOYW1lKSA+IC0xOwogICAgICAgIH0pOwogICAgICB9LCBvcHRpb25zKTsKICAgICAgdGhpcy4kWEVVdGlscy5lYWNoVHJlZShyZXN0LCBmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIHNlYXJjaFByb3BzLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICAgICAgaXRlbVtrZXldID0gaXRlbVtrZXldLnJlcGxhY2UoZmlsdGVyUkUsIGZ1bmN0aW9uIChtYXRjaCkgewogICAgICAgICAgICByZXR1cm4gIjxzcGFuIGNsYXNzPVwia2V5d29yZC1saWdodGVuXCI+Ii5jb25jYXQobWF0Y2gsICI8L3NwYW4+Iik7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfSwgb3B0aW9ucyk7CiAgICAgIHRoaXMuYXBpTGlzdCA9IHJlc3Q7CiAgICAgIHRoaXMuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoX3RoaXMyMy4kcmVmcy54VGFibGUpIHsKICAgICAgICAgIF90aGlzMjMuJHJlZnMueFRhYmxlLnNldEFsbFRyZWVFeHBhbmQodHJ1ZSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuYXBpTGlzdCA9IHRoaXMudGFibGVEYXRhOwogICAgICB0aGlzLiRuZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKF90aGlzMjMuJHJlZnMueFRhYmxlKSB7CiAgICAgICAgICBfdGhpczIzLiRyZWZzLnhUYWJsZS5zZXRUcmVlRXhwYW5kKF90aGlzMjMuZGVmYXVsdEV4cGFuZFJvd3MsIHRydWUpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfSwKICAvLyDosIPnlKjpopHnjofpl7TpmpQgNTAwIOavq+enkgogIHNlYXJjaEV2ZW50OiBmdW5jdGlvbiBzZWFyY2hFdmVudCgpIHsKICAgIHRoaXMuJFhFVXRpbHMuZGVib3VuY2UoZnVuY3Rpb24gKCkgewogICAgICB0aGlzLmhhbmRsZVNlYXJjaCgpOwogICAgfSwgNTAwLCB7CiAgICAgIGxlYWRpbmc6IGZhbHNlLAogICAgICB0cmFpbGluZzogdHJ1ZQogICAgfSk7CiAgfQp9Owp2YXIgYXhpb3NFdmVudCA9IHsKICAkYXN5bmNHZXQ6IGZ1bmN0aW9uICRhc3luY0dldCh1cmwsIHBhcmFtcywgY2IpIHsKICAgIHZhciBfdGhpczI0ID0gdGhpczsKICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU3KCkgewogICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZSgpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTckKF9jb250ZXh0NykgewogICAgICAgIHdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0Ny5wcmV2ID0gX2NvbnRleHQ3Lm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgX2NvbnRleHQ3Lm5leHQgPSAyOwogICAgICAgICAgICByZXR1cm4gX3RoaXMyNC4kaHR0cC5nZXQodXJsLCBwYXJhbXMsIG9yaWdpbik7CiAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ3LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0sIF9jYWxsZWU3KTsKICAgIH0pKSgpOwogIH0sCiAgJGFzeW5jUG9zdDogZnVuY3Rpb24gJGFzeW5jUG9zdCh1cmwsIHBhcmFtcywgY2IpIHsKICAgIHZhciBfdGhpczI1ID0gdGhpczsKICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU4KCkgewogICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZSgpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTgkKF9jb250ZXh0OCkgewogICAgICAgIHdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0OC5wcmV2ID0gX2NvbnRleHQ4Lm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgX2NvbnRleHQ4Lm5leHQgPSAyOwogICAgICAgICAgICByZXR1cm4gX3RoaXMyNS4kaHR0cC5wb3N0KHVybCwgcGFyYW1zLCBvcmlnaW4pOwogICAgICAgICAgY2FzZSAyOgogICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OC5zdG9wKCk7CiAgICAgICAgfQogICAgICB9LCBfY2FsbGVlOCk7CiAgICB9KSkoKTsKICB9LAogICRwb3N0OiBmdW5jdGlvbiAkcG9zdCh1cmwsIHBhcmFtcywgb3JpZ2luKSB7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICBzZWxmLiRodHRwLnBvc3QodXJsLCB7CiAgICAgICAgcGFyYW1zOiBwYXJhbXMKICAgICAgfSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICBpZiAocmVzcG9uc2UuY29kZSA9PT0gMjAwKSB7CiAgICAgICAgICByZXNvbHZlKHJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXNvbHZlKFtdKTsKICAgICAgICB9CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgIHJlamVjdChlcnJvcik7CiAgICAgIH0pOwogICAgfSk7CiAgfSwKICAkZ2V0OiBmdW5jdGlvbiAkZ2V0KHVybCwgcGFyYW1zLCBvcmlnaW4pIHsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgIHNlbGYuJGh0dHAuZ2V0KHVybCwgewogICAgICAgIHBhcmFtczogcGFyYW1zCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgaWYgKHJlc3BvbnNlLmNvZGUgPT09IDIwMCkgewogICAgICAgICAgcmVzb2x2ZShyZXNwb25zZS5kYXRhKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmVzb2x2ZShbXSk7CiAgICAgICAgfQogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICByZWplY3QoZXJyb3IpOwogICAgICB9KTsKICAgIH0pOwogIH0KfTsKdmFyIHRhYmxlRXZlbnQgPSB7CiAgY2VsbE9wdGlvbkNhbGxCYWNrOiBmdW5jdGlvbiBjZWxsT3B0aW9uQ2FsbEJhY2soKSB7CiAgICAvLyDmuLLmn5Plmajlm57osIPkuovku7YKICAgIHRoaXMuJGVtaXQuYXBwbHkodGhpcywgWydjZWxsT3B0aW9uQ2FsbEJhY2snXS5jb25jYXQoQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKSwgW3RoaXMsIHRoaXMuJHJlZnMueEdyaWRdKSk7CiAgICB0aGlzLiRlbWl0LmFwcGx5KHRoaXMsIFsnUHJveHlFdmVudCcsICdjZWxsT3B0aW9uQ2FsbEJhY2snXS5jb25jYXQoQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKSwgW3RoaXMsIHRoaXMuJHJlZnMueEdyaWRdKSk7CiAgfSwKICAvLyBjZWxsQ2hhbmdlKCkgeyAvLyDmuLLmn5Plmajlm57osIPkuovku7YKICAvLyAgIHRoaXMuJGVtaXQoJ2NlbGxDaGFuZ2UnLCAuLi5hcmd1bWVudHMsIHRoaXMsIHRoaXMuJHJlZnMueEdyaWQpCiAgLy8gfSwKICBrZXlkb3duOiBmdW5jdGlvbiBrZXlkb3duKG9iaikgewogICAgLy8g5re75YqgZW50ZXIg5YiH5o2i5LiL5LiA5Liq57yW6L6R5Y2V5YWD5qC8CiAgICAvLyBsZXQgc2VsZiA9IHRoaXMKICAgIC8vIGxldCBldmVudCA9IG9iai5ldmVudCB8fCB3aW5kb3cuZXZlbnQKICAgIC8vIGNvbnN0IHsgeEdyaWQgfSA9IHNlbGYuJHJlZnMKICAgIC8vIGNvbnN0IHsgcm93LCByb3dJbmRleCwgY29sdW1uIH0gPSB4R3JpZC5nZXRBY3RpdmVSZWNvcmQoKQogICAgLy8gaWYgKGV2ZW50LmtleUNvZGUgPT09IDEzICYmIHJvdyAhPT0gbnVsbCkgewogICAgLy8gICBjb25zdCB7IGZ1bGxEYXRhIH0gPSBzZWxmLmdldFRhYmxlRGF0YSgpCiAgICAvLyAgIGxldCBpbmRleG9mID0gc2VsZi50YWJsZUNvbHVtbnNTaW5nRWRpdEZpZWxkQXJyLmluZGV4T2YoY29sdW1uLnByb3BlcnR5KQogICAgLy8gICBpZiAoaW5kZXhvZiArIDEgPCBzZWxmLnRhYmxlQ29sdW1uc1NpbmdFZGl0RmllbGRBcnIubGVuZ3RoKSB7CiAgICAvLyAgICAgeEdyaWQuc2V0QWN0aXZlQ2VsbChyb3csIHNlbGYudGFibGVDb2x1bW5zU2luZ0VkaXRGaWVsZEFycltpbmRleG9mICsgMV0pCiAgICAvLyAgIH0gZWxzZSB7CiAgICAvLyAgICAgeEdyaWQuc2V0Q3VycmVudFJvdyhmdWxsRGF0YVtyb3dJbmRleCArIDFdKS50aGVuKCgpID0+IHsKICAgIC8vICAgICAgIHhHcmlkLnNldEFjdGl2ZUNlbGwoZnVsbERhdGFbcm93SW5kZXggKyAxXSwgc2VsZi50YWJsZUNvbHVtbnNTaW5nRWRpdEZpZWxkQXJyWzBdKQogICAgLy8gICAgIH0pCiAgICAvLyAgIH0KICAgIC8vIH0gZWxzZSB7CiAgICB0aGlzLiRlbWl0KCdrZXlkb3duJywgb2JqLCB0aGlzLCB0aGlzLiRyZWZzLnhHcmlkKTsKICAgIHRoaXMuJGVtaXQoJ1Byb3h5RXZlbnQnLCAna2V5ZG93bicsIG9iaiwgdGhpcywgdGhpcy4kcmVmcy54R3JpZCk7CiAgICAvLyB9CiAgfSwKICAvLyDlvZPooajmoLzooqvmv4DmtLvkuJTplK7nm5jooqvmjInkuIvml7bkvJrop6blj5HnmoTkuovku7YgIHsgJGV2ZW50IH0KICByYWRpb0NoYW5nZTogZnVuY3Rpb24gcmFkaW9DaGFuZ2Uob2JqKSB7CiAgICB0aGlzLiRlbWl0KCdyYWRpb0NoYW5nZScsIG9iaiwgdGhpcywgdGhpcy4kcmVmcy54R3JpZCk7CiAgICB0aGlzLiRlbWl0KCdQcm94eUV2ZW50JywgJ3JhZGlvQ2hhbmdlJywgb2JqLCB0aGlzLCB0aGlzLiRyZWZzLnhHcmlkKTsKICB9LAogIC8vIOWPquWvuSB0eXBlID0gcmFkaW8g5pyJ5pWI77yMIOW9k+aJi+WKqOWLvumAieW5tuS4lOWAvOWPkeeUn+aUueWPmOaXtuinpuWPkeeahOS6i+S7tiB7IHJvdywgcm93SW5kZXgsICRyb3dJbmRleCwgY29sdW1uLCBjb2x1bW5JbmRleCwgJGNvbHVtbkluZGV4LCAkZXZlbnQgfQogIGNlbGxDbGljazogZnVuY3Rpb24gY2VsbENsaWNrKG9iaikgewogICAgdmFyIF90aGlzMjYgPSB0aGlzOwogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgdmFyIHhHcmlkID0gdGhpcy4kcmVmcy54R3JpZDsKICAgIGlmICh0aGlzLnRhYmxlQ29uZmlnQ3AuZ2xvYmFsQ29uZmlnLmNlbGxDbGlja0NoZWNrICYmIHRoaXMudGFibGVHbG9iYWxDb25maWdJbi5jZWxsQ2xpY2tDaGVjaykgewogICAgICAvLyBjb25zdCB7IHJvdywgcm93SW5kZXgsICRyb3dJbmRleCwgY29sdW1uLCBjb2x1bW5JbmRleCwgJGNvbHVtbkluZGV4LCB0cmlnZ2VyUmFkaW8sIHRyaWdnZXJDaGVja2JveCwgdHJpZ2dlclRyZWVOb2RlLCB0cmlnZ2VyRXhwYW5kTm9kZSwgJGV2ZW50IH0gPSBvYmoKICAgICAgdmFyIHJvdyA9IG9iai5yb3csCiAgICAgICAgJGV2ZW50ID0gb2JqLiRldmVudCwKICAgICAgICBjb2x1bW4gPSBvYmouY29sdW1uOwogICAgICBpZiAoY29sdW1uLnR5cGUgIT09ICdjaGVja2JveCcpIHsKICAgICAgICBpZiAoJGV2ZW50LnNoaWZ0S2V5KSB7CiAgICAgICAgICAvLyBvcHRpb24KICAgICAgICB9IGVsc2UgewogICAgICAgICAgeEdyaWQuc2V0Q2hlY2tib3hSb3coW3Jvd10sICF4R3JpZC5pc0NoZWNrZWRCeUNoZWNrYm94Um93KHJvdykpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICBzZWxmLnNlbGVjdGlvbiA9IF90aGlzMjYuJHJlZnMueEdyaWQuZ2V0Q2hlY2tib3hSZWNvcmRzKCk7CiAgICAgICAgICAgIHNlbGYudXBkYXRlRm9vdGVyKCkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgeEdyaWQuc2V0Q3VycmVudFJvdyhyb3cpLnRoZW4oZnVuY3Rpb24gKCkge30pOwogICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7fSk7CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHRoaXMuJGVtaXQoJ2NlbGxDbGljaycsIG9iaiwgdGhpcywgdGhpcy4kcmVmcy54R3JpZCk7CiAgICB0aGlzLiRlbWl0KCdQcm94eUV2ZW50JywgJ2NlbGxDbGljaycsIG9iaiwgdGhpcywgdGhpcy4kcmVmcy54R3JpZCk7CiAgfSwKICAvLyDljZXlhYPmoLzooqvngrnlh7vml7bkvJrop6blj5Hor6Xkuovku7YgeyByb3csIHJvd0luZGV4LCAkcm93SW5kZXgsIGNvbHVtbiwgY29sdW1uSW5kZXgsICRjb2x1bW5JbmRleCwgJGV2ZW50IH0KICBjZWxsRGJsY2xpY2s6IGZ1bmN0aW9uIGNlbGxEYmxjbGljayhvYmopIHsKICAgIHZhciByb3cgPSBvYmoucm93LAogICAgICBjb2x1bW4gPSBvYmouY29sdW1uOwogICAgaWYgKHRoaXMudHJlZUNvbmZpZ0luICYmIHRoaXMudHJlZUNvbmZpZ0luLmRibEV4cGFuZCkgewogICAgICBpZiAodGhpcy5lZGl0Q29uZmlnSW4gJiYgY29sdW1uLnRyZWVOb2RlKSB7CiAgICAgICAgaWYgKHRoaXMudHJlZUNvbmZpZ0luLmRibEV4cGFuZEFsbCkgewogICAgICAgICAgdGhpcy5kYmxSb3dFeHBhbmRBbGwocm93KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy50YWJsZU9wdGlvbkZuKCkudG9nZ2xlVHJlZUV4cGFuZChyb3cpLnRoZW4oZnVuY3Rpb24gKCkge30pOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICghdGhpcy5lZGl0Q29uZmlnSW4gJiYgdGhpcy50cmVlQ29uZmlnSW4ub25seURibFRyZWVOb2RlRXhwYW5kICYmIGNvbHVtbi50cmVlTm9kZSkgewogICAgICAgIGlmICh0aGlzLnRyZWVDb25maWdJbi5kYmxFeHBhbmRBbGwpIHsKICAgICAgICAgIHRoaXMuZGJsUm93RXhwYW5kQWxsKHJvdyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMudGFibGVPcHRpb25GbigpLnRvZ2dsZVRyZWVFeHBhbmQocm93KS50aGVuKGZ1bmN0aW9uICgpIHt9KTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoIXRoaXMuZWRpdENvbmZpZ0luKSB7CiAgICAgICAgaWYgKHRoaXMudHJlZUNvbmZpZ0luLmRibEV4cGFuZEFsbCkgewogICAgICAgICAgdGhpcy5kYmxSb3dFeHBhbmRBbGwocm93KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy50YWJsZU9wdGlvbkZuKCkudG9nZ2xlVHJlZUV4cGFuZChyb3cpLnRoZW4oZnVuY3Rpb24gKCkge30pOwogICAgICAgIH0KICAgICAgfSBlbHNlIHt9CiAgICB9IGVsc2UgewogICAgICB0aGlzLiRlbWl0KCdjZWxsRGJsY2xpY2snLCBvYmosIHRoaXMsIHRoaXMuJHJlZnMueEdyaWQpOwogICAgICB0aGlzLiRlbWl0KCdQcm94eUV2ZW50JywgJ2NlbGxEYmxjbGljaycsIG9iaiwgdGhpcywgdGhpcy4kcmVmcy54R3JpZCk7CiAgICB9CiAgfSwKICAvLyDljZXlhYPmoLzooqvlj4zlh7vml7bkvJrop6blj5Hor6Xkuovku7YgeyByb3csIHJvd0luZGV4LCAkcm93SW5kZXgsIGNvbHVtbiwgY29sdW1uSW5kZXgsICRjb2x1bW5JbmRleCwgJGV2ZW50IH0KICBkYmxSb3dFeHBhbmRBbGw6IGZ1bmN0aW9uIGRibFJvd0V4cGFuZEFsbChyb3cpIHsKICAgIHZhciBfdGhpczI3ID0gdGhpczsKICAgIHZhciBzZWxmID0gdGhpczsKICAgIHNlbGYudGFibGVPcHRpb25GbigpLnRvZ2dsZVRyZWVFeHBhbmQocm93KS50aGVuKGZ1bmN0aW9uIChyZXMpIHsKICAgICAgaWYgKEFycmF5LmlzQXJyYXkocm93W190aGlzMjcudHJlZUNvbmZpZ0luLmNoaWxkcmVuXSkgJiYgcm93W190aGlzMjcudHJlZUNvbmZpZ0luLmNoaWxkcmVuXS5sZW5ndGgpIHsKICAgICAgICByb3dbX3RoaXMyNy50cmVlQ29uZmlnSW4uY2hpbGRyZW5dLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7CiAgICAgICAgICBzZWxmLmRibFJvd0V4cGFuZEFsbChpdGVtKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSk7CiAgfSwKICBjZWxsQ29udGV4dE1lbnU6IGZ1bmN0aW9uIGNlbGxDb250ZXh0TWVudShvYmopIHsKICAgIHRoaXMuJGVtaXQoJ2NlbGxDb250ZXh0TWVudScsIG9iaiwgdGhpcywgdGhpcy4kcmVmcy54R3JpZCk7CiAgICB0aGlzLiRlbWl0KCdQcm94eUV2ZW50JywgJ2NlbGxDb250ZXh0TWVudScsIG9iaiwgdGhpcywgdGhpcy4kcmVmcy54R3JpZCk7CiAgfSwKICAvLyDlj6rlr7kgY29udGV4dCAtIG1lbnUg6YWN572u5pe25pyJ5pWI77yMIOWNleWFg+agvOiiq+m8oOagh+WPs+mUruaXtuinpuWPkeivpeS6i+S7tiB7IHR5cGUsIHJvdywgcm93SW5kZXgsICRyb3dJbmRleCwgY29sdW1uLCBjb2x1bW5JbmRleCwgJGNvbHVtbkluZGV4LCAkZXZlbnQgfQogIGNlbGxNb3VzZWVudGVyOiBmdW5jdGlvbiBjZWxsTW91c2VlbnRlcihvYmopIHsKICAgIHRoaXMuJGVtaXQoJ2NlbGxNb3VzZWVudGVyJywgb2JqLCB0aGlzLCB0aGlzLiRyZWZzLnhHcmlkKTsKICAgIHRoaXMuJGVtaXQoJ1Byb3h5RXZlbnQnLCAnY2VsbE1vdXNlZW50ZXInLCBvYmosIHRoaXMsIHRoaXMuJHJlZnMueEdyaWQpOwogIH0sCiAgLy8g5b2T5Y2V5YWD5qC8IGhvdmVyIOi/m+WFpeaXtuS8muinpuWPkeivpeS6i+S7tiB7IHJvdywgcm93SW5kZXgsICRyb3dJbmRleCwgY29sdW1uLCBjb2x1bW5JbmRleCwgJGNvbHVtbkluZGV4LCAkZXZlbnQgfQogIGNlbGxNb3VzZWxlYXZlOiBmdW5jdGlvbiBjZWxsTW91c2VsZWF2ZShvYmopIHsKICAgIHRoaXMuJGVtaXQoJ2NlbGxNb3VzZWxlYXZlJywgb2JqLCB0aGlzLCB0aGlzLiRyZWZzLnhHcmlkKTsKICAgIHRoaXMuJGVtaXQoJ1Byb3h5RXZlbnQnLCAnY2VsbE1vdXNlbGVhdmUnLCBvYmosIHRoaXMsIHRoaXMuJHJlZnMueEdyaWQpOwogIH0sCiAgLy8g5b2T5Y2V5YWD5qC8IGhvdmVyIOmAgOWHuuaXtuS8muinpuWPkeivpeS6i+S7tiB7IHJvdywgcm93SW5kZXgsICRyb3dJbmRleCwgY29sdW1uLCBjb2x1bW5JbmRleCwgJGNvbHVtbkluZGV4LCAkZXZlbnQgfQogIGhlYWRlckNlbGxDbGljazogZnVuY3Rpb24gaGVhZGVyQ2VsbENsaWNrKG9iaikgewogICAgdGhpcy4kZW1pdCgnaGVhZGVyQ2VsbENsaWNrJywgb2JqLCB0aGlzLCB0aGlzLiRyZWZzLnhHcmlkKTsKICAgIHRoaXMuJGVtaXQoJ1Byb3h5RXZlbnQnLCAnaGVhZGVyQ2VsbENsaWNrJywgb2JqLCB0aGlzLCB0aGlzLiRyZWZzLnhHcmlkKTsKICB9LAogIC8vIOihqOWktOWNleWFg+agvOiiq+eCueWHu+aXtuS8muinpuWPkeivpeS6i+S7tiB7ICRyb3dJbmRleCwgY29sdW1uLCBjb2x1bW5JbmRleCwgJGNvbHVtbkluZGV4LCB0cmlnZ2VyUmVzaXphYmxlLCB0cmlnZ2VyU29ydCwgdHJpZ2dlckZpbHRlciwgJGV2ZW50IH0KICBoZWFkZXJDZWxsRGJsY2xpY2s6IGZ1bmN0aW9uIGhlYWRlckNlbGxEYmxjbGljayhvYmopIHsKICAgIHRoaXMuJGVtaXQoJ2hlYWRlckNlbGxEYmxjbGljaycsIG9iaiwgdGhpcywgdGhpcy4kcmVmcy54R3JpZCk7CiAgICB0aGlzLiRlbWl0KCdQcm94eUV2ZW50JywgJ2hlYWRlckNlbGxEYmxjbGljaycsIG9iaiwgdGhpcywgdGhpcy4kcmVmcy54R3JpZCk7CiAgfSwKICAvLyDooajlpLTljZXlhYPmoLzooqvlj4zlh7vml7bkvJrop6blj5Hor6Xkuovku7YgeyAkcm93SW5kZXgsIGNvbHVtbiwgY29sdW1uSW5kZXgsICRjb2x1bW5JbmRleCwgJGV2ZW50IH0KICAvLyBoZWFkZXJDZWxsQ29udGV4dE1lbnUob2JqKSB7CiAgLy8gICB0aGlzLiRlbWl0KCdoZWFkZXJDZWxsQ29udGV4dE1lbnUnLCBvYmosIHRoaXMsIHRoaXMuJHJlZnMueEdyaWQpCiAgLy8gfSwgLy8g5Y+q5a+5IGNvbnRleHQtbWVudSDphY3nva7ml7bmnInmlYjvvIzooajlpLTljZXlhYPmoLzooqvpvKDmoIflj7PplK7ml7bop6blj5Hor6Xkuovku7YgeyB0eXBlLCBjb2x1bW4sIGNvbHVtbkluZGV4LCAkZXZlbnQgfQogIGZvb3RlckNlbGxDbGljazogZnVuY3Rpb24gZm9vdGVyQ2VsbENsaWNrKG9iaikgewogICAgdGhpcy4kZW1pdCgnZm9vdGVyQ2VsbENsaWNrJywgb2JqLCB0aGlzLCB0aGlzLiRyZWZzLnhHcmlkKTsKICAgIHRoaXMuJGVtaXQoJ1Byb3h5RXZlbnQnLCAnZm9vdGVyQ2VsbENsaWNrJywgb2JqLCB0aGlzLCB0aGlzLiRyZWZzLnhHcmlkKTsKICB9LAogIC8vIOihqOWwvuWNleWFg+agvOiiq+eCueWHu+aXtuS8muinpuWPkeivpeS6i+S7tiAvLyB7IGl0ZW1zLCAkcm93SW5kZXgsIGNvbHVtbiwgY29sdW1uSW5kZXgsICRjb2x1bW5JbmRleCwgJGV2ZW50IH0KICBmb290ZXJDZWxsRGJsY2xpY2s6IGZ1bmN0aW9uIGZvb3RlckNlbGxEYmxjbGljayhvYmopIHsKICAgIHRoaXMuJGVtaXQoJ2Zvb3RlckNlbGxEYmxjbGljaycsIG9iaiwgdGhpcywgdGhpcy4kcmVmcy54R3JpZCk7CiAgICB0aGlzLiRlbWl0KCdQcm94eUV2ZW50JywgJ2Zvb3RlckNlbGxEYmxjbGljaycsIG9iaiwgdGhpcywgdGhpcy4kcmVmcy54R3JpZCk7CiAgfSwKICAvLyDooajlsL7ljZXlhYPmoLzooqvlj4zlh7vml7bkvJrop6blj5Hor6Xkuovku7YgeyBpdGVtcywgJHJvd0luZGV4LCBjb2x1bW4sIGNvbHVtbkluZGV4LCAkY29sdW1uSW5kZXgsICRldmVudCB9CiAgZm9vdGVyQ2VsbENvbnRleHRNZW51OiBmdW5jdGlvbiBmb290ZXJDZWxsQ29udGV4dE1lbnUob2JqKSB7CiAgICB0aGlzLiRlbWl0KCdmb290ZXJDZWxsQ29udGV4dE1lbnUnLCBvYmosIHRoaXMsIHRoaXMuJHJlZnMueEdyaWQpOwogICAgdGhpcy4kZW1pdCgnUHJveHlFdmVudCcsICdmb290ZXJDZWxsQ29udGV4dE1lbnUnLCBvYmosIHRoaXMsIHRoaXMuJHJlZnMueEdyaWQpOwogIH0sCiAgLy8g5Y+q5a+5IGNvbnRleHQgLSBtZW51IOmFjee9ruaXtuacieaViO+8jCDooajlsL7ljZXlhYPmoLzooqvpvKDmoIflj7PplK7ml7bop6blj5Hor6Xkuovku7YgeyB0eXBlLCBjb2x1bW4sIGNvbHVtbkluZGV4LCAkZXZlbnQgfQogIHNvcnRDaGFuZ2U6IGZ1bmN0aW9uIHNvcnRDaGFuZ2Uob2JqKSB7CiAgICB0aGlzLiRlbWl0KCdzb3J0Q2hhbmdlJywgb2JqLCB0aGlzLCB0aGlzLiRyZWZzLnhHcmlkKTsKICAgIHRoaXMuJGVtaXQoJ1Byb3h5RXZlbnQnLCAnc29ydENoYW5nZScsIG9iaiwgdGhpcywgdGhpcy4kcmVmcy54R3JpZCk7CiAgfSwKICAvLyDlvZPmjpLluo/mnaHku7blj5HnlJ/lj5jljJbml7bkvJrop6blj5Hor6Xkuovku7YgeyBjb2x1bW4sIGNvbHVtbi5wcm9wZXJ0eSwgb3JkZXIsICRldmVudCB9CiAgZmlsdGVyQ2hhbmdlOiBmdW5jdGlvbiBmaWx0ZXJDaGFuZ2Uob2JqKSB7CiAgICB0aGlzLiRlbWl0KCdmaWx0ZXJDaGFuZ2UnLCBvYmosIHRoaXMsIHRoaXMuJHJlZnMueEdyaWQpOwogICAgdGhpcy4kZW1pdCgnUHJveHlFdmVudCcsICdmaWx0ZXJDaGFuZ2UnLCBvYmosIHRoaXMsIHRoaXMuJHJlZnMueEdyaWQpOwogIH0sCiAgLy8g5b2T562b6YCJ5p2h5Lu25Y+R55Sf5Y+Y5YyW5pe25Lya6Kem5Y+R6K+l5LqL5Lu2IHsgY29sdW1uLCBwcm9wZXJ0eSwgdmFsdWVzLCBkYXRhcywgZmlsdGVycywgJGV2ZW50IH17IGNvbHVtbiwgcHJvcGVydHksIHZhbHVlcywgZGF0YXMsIGZpbHRlcnMsICRldmVudCB9CiAgcmVzaXphYmxlQ2hhbmdlOiBmdW5jdGlvbiByZXNpemFibGVDaGFuZ2Uob2JqKSB7CiAgICB0aGlzLiRlbWl0KCdyZXNpemFibGVDaGFuZ2UnLCBvYmosIHRoaXMsIHRoaXMuJHJlZnMueEdyaWQpOwogICAgdGhpcy4kZW1pdCgnUHJveHlFdmVudCcsICdyZXNpemFibGVDaGFuZ2UnLCBvYmosIHRoaXMsIHRoaXMuJHJlZnMueEdyaWQpOwogIH0sCiAgLy8g5b2T5YiX5a695ouW5Yqo5Y+R55Sf5Y+Y5YyW5pe25Lya6Kem5Y+R6K+l5LqL5Lu2IHsgJHJvd0luZGV4LCBjb2x1bW4sIGNvbHVtbkluZGV4LCAkY29sdW1uSW5kZXgsICRldmVudCB9CiAgdG9nZ2xlUm93RXhwYW5kOiBmdW5jdGlvbiB0b2dnbGVSb3dFeHBhbmQob2JqKSB7CiAgICAvLyDmh5LliqDovb3lrZDoioLngrnpnIDopoHnu5nlrZDoioLngrnorr7nva7llK/kuIDplK4KICAgIHNldFJvd1V1aWRLZXkob2JqLnJvdywgdGhpcyk7CiAgICB0aGlzLiRlbWl0KCd0b2dnbGVSb3dFeHBhbmQnLCBvYmosIHRoaXMsIHRoaXMuJHJlZnMueEdyaWQpOwogICAgdGhpcy4kZW1pdCgnUHJveHlFdmVudCcsICd0b2dnbGVSb3dFeHBhbmQnLCBvYmosIHRoaXMsIHRoaXMuJHJlZnMueEdyaWQpOwogIH0sCiAgLy8g5b2T6KGM5bGV5byA5oiW5pS26LW35pe25Lya6Kem5Y+R6K+l5LqL5Lu2IHsgZXhwYW5kZWQsIHJvdywgcm93SW5kZXgsICRyb3dJbmRleCwgY29sdW1uLCBjb2x1bW5JbmRleCwgJGNvbHVtbkluZGV4LCAkZXZlbnQgfQogIHRvZ2dsZVRyZWVFeHBhbmQ6IGZ1bmN0aW9uIHRvZ2dsZVRyZWVFeHBhbmQob2JqKSB7CiAgICB0aGlzLiRlbWl0KCd0b2dnbGVUcmVlRXhwYW5kJywgb2JqLCB0aGlzLCB0aGlzLiRyZWZzLnhHcmlkKTsKICAgIHRoaXMuJGVtaXQoJ1Byb3h5RXZlbnQnLCAndG9nZ2xlVHJlZUV4cGFuZCcsIG9iaiwgdGhpcywgdGhpcy4kcmVmcy54R3JpZCk7CiAgfSwKICAvLyDlvZPmoJHoioLngrnlsZXlvIDmiJbmlLbotbfml7bkvJrop6blj5Hor6Xkuovku7YgeyBleHBhbmRlZCwgcm93LCBjb2x1bW4sIGNvbHVtbkluZGV4LCAkY29sdW1uSW5kZXgsICRldmVudCB9CiAgY29udGV4dE1lbnVDbGljazogZnVuY3Rpb24gY29udGV4dE1lbnVDbGljayhvYmopIHsKICAgIHRoaXMuJGVtaXQoJ2NvbnRleHRNZW51Q2xpY2snLCBvYmosIHRoaXMsIHRoaXMuJHJlZnMueEdyaWQpOwogICAgdGhpcy4kZW1pdCgnUHJveHlFdmVudCcsICdjb250ZXh0TWVudUNsaWNrJywgb2JqLCB0aGlzLCB0aGlzLiRyZWZzLnhHcmlkKTsKICB9LAogIC8vIOWPquWvuSBjb250ZXh0LW1lbnUg6YWN572u5pe25pyJ5pWI77yM5b2T54K55Ye75b+r5o236I+c5Y2V5pe25Lya6Kem5Y+R6K+l5LqL5Lu2IHsgbWVudSwgdHlwZSwgcm93LCByb3dJbmRleCwgY29sdW1uLCBjb2x1bW5JbmRleCwgJGV2ZW50IH0KICBjdXJyZW50Q2hhbmdlOiBmdW5jdGlvbiBjdXJyZW50Q2hhbmdlKG9iaikgewogICAgdmFyIF90aGlzMjggPSB0aGlzOwogICAgLy8gdGhpcy5wZXJmb3JtVGFibGVEYXRhQ2FsY3VsYXRlKG9iaikKICAgIHRoaXMuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgX3RoaXMyOC4kZW1pdCgnY3VycmVudENoYW5nZScsIG9iaiwgX3RoaXMyOCwgX3RoaXMyOC4kcmVmcy54R3JpZCk7CiAgICAgIF90aGlzMjguJGVtaXQoJ1Byb3h5RXZlbnQnLCAnY3VycmVudENoYW5nZScsIG9iaiwgX3RoaXMyOCwgX3RoaXMyOC4kcmVmcy54R3JpZCk7CiAgICB9KTsKICB9LAogIC8vIOWPquWvuSBoaWdobGlnaHRDdXJyZW50Um93IOacieaViO+8jOW9k+aJi+WKqOmAieS4reihjOW5tuS4lOWAvOWPkeeUn+aUueWPmOaXtuinpuWPkeeahOS6i+S7tiB7IHJvdywgcm93SW5kZXgsICRyb3dJbmRleCwgY29sdW1uLCBjb2x1bW5JbmRleCwgJGNvbHVtbkluZGV4LCAkZXZlbnQgfQogIGVkaXRDbG9zZWQ6IGZ1bmN0aW9uIGVkaXRDbG9zZWQob2JqKSB7CiAgICB2YXIgX3RoaXMyOSA9IHRoaXM7CiAgICAvLyB0aGlzLnBlcmZvcm1BZnRlckVkaXRDbG9zZWRDYWxjdWxhdGUob2JqKS50aGVuKChyb3cpID0+IHsKICAgIG9iai5kYXRhID0gb2JqLmRhdGEgfHwgb2JqLiRncmlkLmdldFRhYmxlRGF0YSgpLmZ1bGxEYXRhIHx8IFtdOwogICAgdGhpcy5wZXJmb3JtVGFibGVEYXRhQ2FsY3VsYXRlKG9iaikudGhlbihmdW5jdGlvbiAoX3JlZjIxKSB7CiAgICAgIHZhciByb3cgPSBfcmVmMjEucm93OwogICAgICBfdGhpczI5LiRlbWl0KCdlZGl0Q2xvc2VkJywgb2JqLCBfdGhpczI5LCBfdGhpczI5LiRyZWZzLnhHcmlkKTsKICAgICAgX3RoaXMyOS4kZW1pdCgnUHJveHlFdmVudCcsICdlZGl0Q2xvc2VkJywgb2JqLCBfdGhpczI5LCBfdGhpczI5LiRyZWZzLnhHcmlkKTsKICAgIH0pOwogIH0sCiAgLy8KICBlZGl0QWN0aXZlZDogZnVuY3Rpb24gZWRpdEFjdGl2ZWQob2JqKSB7CiAgICB0aGlzLiRlbWl0KCdlZGl0QWN0aXZlZCcsIG9iaiwgdGhpcywgdGhpcy4kcmVmcy54R3JpZCk7CiAgICB0aGlzLiRlbWl0KCdQcm94eUV2ZW50JywgJ2VkaXRBY3RpdmVkJywgb2JqLCB0aGlzLCB0aGlzLiRyZWZzLnhHcmlkKTsKICB9LAogIC8vIOWPquWvuSBlZGl0LWNvbmZpZyDphY3nva7ml7bmnInmlYjvvIzljZXlhYPmoLzooqvmv4DmtLvnvJbovpHml7bkvJrop6blj5Hor6Xkuovku7YgeyByb3csIHJvd0luZGV4LCAkcm93SW5kZXgsIGNvbHVtbiwgY29sdW1uSW5kZXgsICRjb2x1bW5JbmRleCB9CiAgZWRpdERpc2FibGVkOiBmdW5jdGlvbiBlZGl0RGlzYWJsZWQob2JqKSB7CiAgICB0aGlzLiRlbWl0KCdlZGl0RGlzYWJsZWQnLCBvYmosIHRoaXMsIHRoaXMuJHJlZnMueEdyaWQpOwogICAgdGhpcy4kZW1pdCgnUHJveHlFdmVudCcsICdlZGl0RGlzYWJsZWQnLCBvYmosIHRoaXMsIHRoaXMuJHJlZnMueEdyaWQpOwogIH0sCiAgLy8g5Y+q5a+5IGVkaXQtY29uZmlnIOmFjee9ruaXtuacieaViO+8jOW9k+WNleWFg+agvOa/gOa0u+aXtuWmguaenOaYr+emgeeUqOeKtuaAgeaXtuS8muinpuWPkeivpeS6i+S7tiB7IHJvdywgcm93SW5kZXgsICRyb3dJbmRleCwgY29sdW1uLCBjb2x1bW5JbmRleCwgJGNvbHVtbkluZGV4IH0KICB2YWxpZEVycm9yOiBmdW5jdGlvbiB2YWxpZEVycm9yKG9iaikgewogICAgdGhpcy4kZW1pdCgndmFsaWRFcnJvcicsIG9iaiwgdGhpcywgdGhpcy4kcmVmcy54R3JpZCk7CiAgICB0aGlzLiRlbWl0KCdQcm94eUV2ZW50JywgJ3ZhbGlkRXJyb3InLCBvYmosIHRoaXMsIHRoaXMuJHJlZnMueEdyaWQpOwogIH0sCiAgLy8g5Y+q5a+5IGVkaXQtcnVsZXMg6YWN572u5pe25pyJ5pWI77yM5b2T5pWw5o2u5qCh6aqM5LiN6YCa6L+H5pe25Lya6Kem5Y+R6K+l5LqL5Lu2IHsgcnVsZSwgcm93LCByb3dJbmRleCwgJHJvd0luZGV4LCBjb2x1bW4sIGNvbHVtbkluZGV4LCAkY29sdW1uSW5kZXggfQogIHNjcm9sbDogZnVuY3Rpb24gc2Nyb2xsKG9iaikgewogICAgLy8g6aG16Z2i5rua5YqoCiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAvLyBjb25zdCB7IHR5cGUsIHNjcm9sbFRvcCwgc2Nyb2xsTGVmdCwgaXNYLCBpc1ksICRldmVudCB9ID0gb2JqCiAgICB2YXIgc2Nyb2xsVG9wID0gb2JqLnNjcm9sbFRvcCwKICAgICAgJGV2ZW50ID0gb2JqLiRldmVudDsKICAgIHRoaXMuJGVtaXQoJ3Njcm9sbCcsIG9iaiwgdGhpcywgdGhpcy4kcmVmcy54R3JpZCk7CiAgICB0aGlzLiRlbWl0KCdQcm94eUV2ZW50JywgJ3Njcm9sbCcsIG9iaiwgdGhpcywgdGhpcy4kcmVmcy54R3JpZCk7CiAgICBpZiAoc2VsZi5zY3JvbGxMb2FkQ29uZmlnQ3AgJiYgc2VsZi5zY3JvbGxMb2FkQ29uZmlnQ3AuZW5hYmxlZCkgewogICAgICBpZiAoK3Njcm9sbFRvcCArICRldmVudC50YXJnZXQub2Zmc2V0SGVpZ2h0ID4gJGV2ZW50LnRhcmdldC5zY3JvbGxIZWlnaHQgLSAyMCkgewogICAgICAgIHNlbGYuZGVib3VuY2VJdGVtQ2hhbmdlKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHNlbGYucGVyZm9ybVNjcm9sbExvYWQob2JqKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfQogIH0sCiAgLy8g6KGo5qC85rua5Yqo5pe25Lya6Kem5Y+R6K+l5LqL5Lu2IHsgdHlwZSwgc2Nyb2xsVG9wLCBzY3JvbGxMZWZ0LCBpc1gsIGlzWSwgJGV2ZW50IH0KICBwZXJmb3JtU2Nyb2xsTG9hZDogZnVuY3Rpb24gcGVyZm9ybVNjcm9sbExvYWQob2JqKSB7CiAgICAvLyDlhbzlrrnmiYvmnLrnq6/lkoxQQ+err+a7muWKqOWKoOi9vQogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgLy8g5rua5Yqo5p2h55qE5L2N572uIOWcqOmhtemdouS4iui/lOWbnuWGheWuueeahOWPr+inhumrmOW6piDov5Tlm57mlbTkuKrlhYPntKDnmoTpq5jluqbvvIjljIXmi6zluKbmu5rliqjmnaHnmoTpmpDolL3nmoTlnLDmlrnvvIkKICAgIHNlbGYuc2Nyb2xsTG9hZGluZyA9IHRydWU7CiAgICBzZWxmLnNjcm9sbExvYWRDb25maWdDcC5sb2FkRGF0YShzZWxmLnNjcm9sbExvYWRDb25maWdDcCwgdGhpcy5mb3JtU2VhcmNoRGF0YSkudGhlbihmdW5jdGlvbiAocmVzKSB7CiAgICAgIHNlbGYuc2Nyb2xsTG9hZGluZyA9IGZhbHNlOwogICAgICBpZiAocmVzICYmIHJlcy5kYXRhICYmIHJlcy5kYXRhLmxlbmd0aCkgewogICAgICAgIHNlbGYubG9hZFNjcm9sbFRhYmxlRGF0YShyZXMuZGF0YSk7CiAgICAgICAgT2JqZWN0LmFzc2lnbihzZWxmLnNjcm9sbExvYWRDb25maWdDcCwgewogICAgICAgICAgY3VyR3Q6IHNlbGYuc2Nyb2xsTG9hZENvbmZpZ0NwLmN1ckd0ICsgcmVzLmRhdGEubGVuZ3RoLAogICAgICAgICAgY3VycmVudFBhZ2U6IHNlbGYuc2Nyb2xsTG9hZENvbmZpZ0NwLmN1cnJlbnRQYWdlICsgMSwKICAgICAgICAgIHRhdGFsOiByZXMudG90YWwKICAgICAgICB9KTsKICAgICAgfQogICAgfSk7CiAgfSwKICBjdXN0b206IGZ1bmN0aW9uIGN1c3RvbShvYmopIHsKICAgIHRoaXMuJGVtaXQoJ2N1c3RvbScsIG9iaiwgdGhpcywgdGhpcy4kcmVmcy54R3JpZCk7CiAgICB0aGlzLiRlbWl0KCdQcm94eUV2ZW50JywgJ2N1c3RvbScsIG9iaiwgdGhpcywgdGhpcy4kcmVmcy54R3JpZCk7CiAgfSwKICBmb3JtU3VibWl0SW52YWxpZDogZnVuY3Rpb24gZm9ybVN1Ym1pdEludmFsaWQob2JqKSB7CiAgICB0aGlzLiRlbWl0KCdmb3JtU3VibWl0SW52YWxpZCcsIG9iaiwgdGhpcywgdGhpcy4kcmVmcy54R3JpZCk7CiAgICB0aGlzLiRlbWl0KCdQcm94eUV2ZW50JywgJ2Zvcm1TdWJtaXRJbnZhbGlkJywgb2JqLCB0aGlzLCB0aGlzLiRyZWZzLnhHcmlkKTsKICB9LAogIC8vIOWPquWvuSBmb3JtLWNvbmZpZyDphY3nva7ml7bmnInmlYjvvIzooajljZXmj5DkuqTml7blpoLmnpzmoKHpqozkuI3pgJrov4fkvJrop6blj5Hor6Xkuovku7YgeyBkYXRhLCBlcnJNYXAsICRldmVudCB9CiAgZm9ybVJlc2V0OiBmdW5jdGlvbiBmb3JtUmVzZXQob2JqKSB7CiAgICB0aGlzLiRlbWl0KCdmb3JtUmVzZXQnLCBvYmosIHRoaXMsIHRoaXMuJHJlZnMueEdyaWQpOwogICAgdGhpcy4kZW1pdCgnUHJveHlFdmVudCcsICdmb3JtUmVzZXQnLCBvYmosIHRoaXMsIHRoaXMuJHJlZnMueEdyaWQpOwogIH0sCiAgLy8g5Y+q5a+5IGZvcm0tY29uZmlnIOmFjee9ruaXtuacieaViO+8jOihqOWNlemHjee9ruaXtuS8muinpuWPkeivpeS6i+S7tiB7IGRhdGEsICRldmVudCB9CiAgZm9ybVRvZ2dsZUNvbGxhcHNlOiBmdW5jdGlvbiBmb3JtVG9nZ2xlQ29sbGFwc2Uob2JqKSB7CiAgICB0aGlzLiRlbWl0KCdmb3JtVG9nZ2xlQ29sbGFwc2UnLCBvYmosIHRoaXMsIHRoaXMuJHJlZnMueEdyaWQpOwogICAgdGhpcy4kZW1pdCgnUHJveHlFdmVudCcsICdmb3JtVG9nZ2xlQ29sbGFwc2UnLCBvYmosIHRoaXMsIHRoaXMuJHJlZnMueEdyaWQpOwogIH0sCiAgLy8g5Y+q5a+5IGZvcm0tY29uZmlnIOmFjee9ruaXtuacieaViO+8jOW9k+aKmOWPoOaMiemSruiiq+aJi+WKqOeCueWHu+aXtuS8muinpuWPkeivpeS6i+S7tiB7IGNvbGxhcHNlLCBkYXRhLCAkZXZlbnQgfQogIHpvb206IGZ1bmN0aW9uIHpvb20ob2JqKSB7CiAgICB0aGlzLiRlbWl0KCd6b29tJywgb2JqLCB0aGlzLCB0aGlzLiRyZWZzLnhHcmlkKTsKICAgIHRoaXMuJGVtaXQoJ1Byb3h5RXZlbnQnLCAnem9vbScsIG9iaiwgdGhpcywgdGhpcy4kcmVmcy54R3JpZCk7CiAgfSAvLyDlvZPmnIDlpKfljJbmiJbov5jljp/mk43kvZzooqvmiYvliqjngrnlh7vml7bkvJrlkI7op6blj5Hor6Xkuovku7YgeyB0eXBlLCAkZXZlbnQgfQogIC8vIGNoZWNrYm94Q2hhbmdlKG9iaikgewogIC8vICAgdGhpcy4kZW1pdCgnY2hlY2tib3hDaGFuZ2UnLCBvYmosICB0aGlzLCB0aGlzLiRyZWZzLnhHcmlkKQogIC8vIH0gLy8g5Y+q5a+5IHR5cGU9Y2hlY2tib3gg5pyJ5pWI77yM5b2T5omL5Yqo5Yu+6YCJ5bm25LiU5YC85Y+R55Sf5pS55Y+Y5pe26Kem5Y+R55qE5LqL5Lu2IHsgcmVjb3JkcywgcmVzZXJ2ZXMsIGluZGV0ZXJtaW5hdGVzLCBjaGVja2VkLCByb3csIHJvd0luZGV4LCAkcm93SW5kZXgsIGNvbHVtbiwgY29sdW1uSW5kZXgsICRjb2x1bW5JbmRleCwgJGV2ZW50IH0KICAvLyAgY2hlY2tib3hBbGwob2JqKSB7CiAgLy8gICAgdGhpcy4kZW1pdCgnY2hlY2tib3hBbGwnLCBvYmosICB0aGlzLCB0aGlzLiRyZWZzLnhHcmlkKQogIC8vICB9LCAvLyDlj6rlr7kgdHlwZT1jaGVja2JveCDmnInmlYjvvIzlvZPmiYvliqjli77pgInlhajpgInml7bop6blj5HnmoTkuovku7YgeyByZWNvcmRzLCByZXNlcnZlcywgaW5kZXRlcm1pbmF0ZXMsIGNoZWNrZWQsICRldmVudCB9CiAgLy8g5aaC5p6c5LiO5bel5YW35qCP5YWz6IGU77yMIOWcqOiHquWumuS5ieWIl+aMiemSruiiq+aJi+WKqOeCueWHu+WQjuS8muinpuWPkeivpeS6i+S7tiB7IHR5cGUsICRldmVudCB9CiAgLy8gcGFnZUNoYW5nZShvYmopIHsKICAvLyAgICAgIHRoaXMuJGVtaXQoJ3BhZ2VDaGFuZ2UnLCBvYmosICB0aGlzLCB0aGlzLiRyZWZzLnhHcmlkKQogIC8vIH0sIC8vIOWPquWvuSBwYWdlci1jb25maWcg6YWN572u5pe25pyJ5pWI77yM5YiG6aG15Y+R55Sf5pS55Y+Y5pe25Lya6Kem5Y+R6K+l5LqL5Lu2IHsgdHlwZSwgY3VycmVudFBhZ2UsIHBhZ2VTaXplLCAkZXZlbnQgfQogIC8vIGZvcm1TdWJtaXQgKG9iaikgewogIC8vICAgdGhpcy4kZW1pdCgnZm9ybVN1Ym1pdCcsIG9iaiwgIHRoaXMsIHRoaXMuJHJlZnMueEdyaWQpCiAgLy8gfSwgLy8g5Y+q5a+5IGZvcm0tY29uZmlnIOmFjee9ruaXtuacieaViO+8jOihqOWNleaPkOS6pOaXtuS8muinpuWPkeivpeS6i+S7tiB7IGRhdGEsICRldmVudCB9Cn07CnZhciBjYWxjdWxhdGVUb29sID0gewogIC8vIOaJp+ihjOmhuuW6j++8miDlj5bmlbAtLT7ooYzlhoXorqHnrpctLT7liIbnuqfmsYfmgLstLT7niLbnuqfooYzlhoXorqHnrpctLT7ljZXlhYPmoLzkuqTlj4norqHnrpco5raJ5Y+K55qE6KGM6K6h566XKS0tPuihjOe6puadny0tPuWNleWFg+agvOe6puadnwogIGFkZE1pc3NpbmdGaWVsZHNBbmRDYWxjQ29sRm9ybXVsYTogZnVuY3Rpb24gYWRkTWlzc2luZ0ZpZWxkc0FuZENhbGNDb2xGb3JtdWxhKHRhYmxlRGF0YSkgewogICAgdmFyIF90aGlzMzAgPSB0aGlzOwogICAgLy8g5re75Yqg57y65aSx5a2X5q615bm25omn6KGM5YWo6YeP5YiX6K6h566XCiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICB0YWJsZURhdGEgPSBBcnJheS5pc0FycmF5KHRhYmxlRGF0YSkgPyB0YWJsZURhdGEgOiBbXTsKICAgIHRhYmxlRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHsKICAgICAgc2VsZi50YWJsZUNvbHVtbnNGaWVsZEFyci5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgLy8gbGV0IHJlbmRlciA9IHNlbGYudGFibGVDb2x1bW5zRmllbGRNYXBbaXRlbV0uZWRpdFJlbmRlciB8fCBzZWxmLnRhYmxlQ29sdW1uc0ZpZWxkTWFwW2l0ZW1dLmNlbGxSZW5kZXIKICAgICAgICAvLyDpgY3ljobphY3nva7pobnnlJ/miJDnmoTliY3nvIDmlbDnu4TvvIzlubbkuJTlhbbliY3nvIDlnKjmlbDmja7ljIXkuK3kuI3lrZjlnKjml7bvvIzliqjmgIHnu5nlhbbnu5HlrprkuIDkuKrliY3nvIAKICAgICAgICAvLyBpZiAocmVuZGVyICYmIHJlbmRlci5wcm9wcyAmJiByZW5kZXIucHJvcHMubXVsdGlwbGUpIHsKICAgICAgICAvLyAgIGlmIChBcnJheS5pc0FycmF5KHJvd1tpdGVtXSkpIHsKICAgICAgICAvLyAgICAgcm93W2l0ZW0gKyAnX19tdWx0aXBsZSddID0gWy4uLnJvd1tpdGVtXV0KICAgICAgICAvLyAgIH0gZWxzZSBpZiAodHlwZW9mIHJvd1tpdGVtXSA9PT0gJ3N0cmluZycpIHsKICAgICAgICAvLyAgICAgcm93W2l0ZW0gKyAnX19tdWx0aXBsZSddID0gcm93W2l0ZW1dLnNwbGl0KCcsJykKICAgICAgICAvLyAgIH0gZWxzZSB7CiAgICAgICAgLy8gICAgIHJvd1tpdGVtICsgJ19fbXVsdGlwbGUnXSA9IFtdCiAgICAgICAgLy8gICB9CiAgICAgICAgLy8gfSBlbHNlIGlmIChyZW5kZXIgJiYgcmVuZGVyLm5hbWUgPT09ICckdnhlTW9uZXknKSB7CiAgICAgICAgLy8gICByb3dbaXRlbSArICdfX21vbmV5U3dpdGNoaW5wdXQnXSA9IHNlbGYuYWNjdXJhdGVDaHVGYSgocm93W2l0ZW1dICsgJycpLnJlcGxhY2UoL251bGx8dW5kZWZpbmVkfE5hTi9pZywgJycpLCBzZWxmLm1vbmV5VW5pdCkgKyAnJwogICAgICAgIC8vIH0gZWxzZSB7CiAgICAgICAgLy8gfQogICAgICAgIC8vIOmBjeWOhumFjee9rumhueeUn+aIkOeahOWJjee8gOaVsOe7hO+8jOW5tuS4lOWFtuWJjee8gOWcqOaVsOaNruWMheS4reS4jeWtmOWcqOaXtu+8jOWKqOaAgee7meWFtue7keWumuS4gOS4quWJjee8gAogICAgICAgIHJvd1tpdGVtXSA9IF90eXBlb2Yocm93W2l0ZW1dKSAhPT0gJ29iamVjdCcgPyByb3dbaXRlbV0gPT09IHVuZGVmaW5lZCA/ICcnIDogcm93W2l0ZW1dIDogcm93W2l0ZW1dID09PSBudWxsID8gJycgOiByb3dbaXRlbV07CiAgICAgIH0pOwogICAgICByb3cgPSBfdGhpczMwLnJlZHVjdGlvbkNvbEZvcm11bGEoX3RoaXMzMC5jYWxjdWxhdGVDb25zdHJhaW50Q29uZmlnSW4uY29sRm9ybXVsYUNvbmZpZywgcm93KTsKICAgICAgaWYgKEFycmF5LmlzQXJyYXkocm93LmNoaWxkcmVuKSAmJiByb3cuY2hpbGRyZW4ubGVuZ3RoICYmIF90aGlzMzAudHJlZUNvbmZpZ0luKSB7CiAgICAgICAgcm93LmNoaWxkcmVuID0gc2VsZi5hZGRNaXNzaW5nRmllbGRzQW5kQ2FsY0NvbEZvcm11bGEocm93LmNoaWxkcmVuKTsKICAgICAgfQogICAgfSk7CiAgICBzZWxmLnJlZHVjdGlvblJvd0NvZGVGb3JtdWxhKHRoaXMuY2FsY3VsYXRlQ29uc3RyYWludENvbmZpZ0luLnJvd0NvZGVGb3JtdWxhQ29uZmlnLCB0YWJsZURhdGEsIHNlbGYuaWQpOwogICAgcmV0dXJuIHRhYmxlRGF0YTsKICB9LAogIHJlZHVjdGlvbkNvbEZvcm11bGE6IGZ1bmN0aW9uIHJlZHVjdGlvbkNvbEZvcm11bGEoY29sRm9ybXVsYU1hcCwgcm93LCBwcm9wZXJ0eSkgewogICAgLy8g5Y2V5p2h5pWw5o2u6K6h566XCiAgICAvLyByb3dGb3JtdWxhTWFwPSB7ICJjb2xmaWVsZCI6Intjb2xmaWVsZH1b6L+Q566X56ymXSIgfQogICAgdmFyIHhHcmlkID0gdGhpcy4kcmVmcy54R3JpZDsKICAgIHZhciBfcmVmMjIgPSB4R3JpZCAmJiB4R3JpZC5nZXRUYWJsZUNvbHVtbiAmJiB4R3JpZC5nZXRUYWJsZUNvbHVtbigpIHx8IHt9LAogICAgICBfcmVmMjIkdmlzaWJsZUNvbHVtbiA9IF9yZWYyMi52aXNpYmxlQ29sdW1uLAogICAgICB2aXNpYmxlQ29sdW1uID0gX3JlZjIyJHZpc2libGVDb2x1bW4gPT09IHZvaWQgMCA/IFtdIDogX3JlZjIyJHZpc2libGVDb2x1bW47CiAgICB2YXIgdmlzaWJsZUNvbHVtbk9iaiA9IHt9OwogICAgdmlzaWJsZUNvbHVtbi5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgIGlmICghdmlzaWJsZUNvbHVtbk9ialtpdGVtLnByb3BlcnR5XSkgewogICAgICAgIHZpc2libGVDb2x1bW5PYmpbaXRlbS5wcm9wZXJ0eV0gPSBpdGVtOwogICAgICB9CiAgICB9KTsKICAgIC8vIHByb3BlcnR5IOagh+ivhuW9k+WJjee8lui+keWtl+autemFjee9rueahOacieWFrOW8j++8jOS9huaYr+ivpeWtl+auteWAvOaYr+WPr+e8lui+keeahO+8jOagh+iusOWAmeWQjueahOWAvOS/neWtmO+8jOS4jeeUqOmHjeaWsOaMieWFrOW8j+iuoeeul+aWsOWAvAogICAgdmFyIGNvbEZvcm11bGFNYXBDcCA9IHRoaXMuZGVlcENvcHkoY29sRm9ybXVsYU1hcCk7CiAgICB2YXIgaGFzQ2FsY0NvbEZvcm11bGFNYXAgPSB7fTsKICAgIHZhciBpID0gMDsKICAgIHZhciBpZkRvV2hpbGUgPSB0cnVlOwogICAgLy8g5aSE55CG5b2T5YmN57yW6L6R5a2X5q616YWN572u55qE5pyJ5YWs5byP77yM5L2G5piv6K+l5a2X5q615YC85piv5Y+v57yW6L6R55qE77yM57yW6L6R5ZCO55qE5YC85L+d5a2Y77yM5LiN55So6YeN5paw5oyJ5YWs5byP6K6h566X5paw5YC8CiAgICAvLyBkZWJ1Z2dlcgogICAgaWYgKHRoaXMuZWRpdENvbmZpZ0luLmZvcm11bGFFZGl0YWJsZSAmJiBwcm9wZXJ0eSAmJiBjb2xGb3JtdWxhTWFwQ3BbcHJvcGVydHldKSB7CiAgICAgIGRlbGV0ZSBjb2xGb3JtdWxhTWFwQ3BbcHJvcGVydHldOwogICAgfQogICAgLy8g5Yid5aeL5YyW5Zue5pi+5pe25aaC5p6c6K+l5a2X5q615pyJ5YC877yM5bCx5pi+56S66Ieq6Lqr6buY6K6k5YC877yM5LiN5YGa5YWs5byP6K6h566XCiAgICBpZiAodGhpcy5lZGl0Q29uZmlnSW4uZm9ybXVsYUVkaXRhYmxlICYmICFwcm9wZXJ0eSkgewogICAgICB2YXIgY29sRm9ybXVsYU1hcEFyciA9IE9iamVjdC5rZXlzKGNvbEZvcm11bGFNYXBDcCk7CiAgICAgIGNvbEZvcm11bGFNYXBBcnIuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgaWYgKHJvd1trZXldIHx8IHJvd1trZXldID09PSAwKSB7CiAgICAgICAgICBkZWxldGUgY29sRm9ybXVsYU1hcENwW2tleV07CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICAgIHRyeSB7CiAgICAgIHdoaWxlIChpZkRvV2hpbGUpIHsKICAgICAgICB2YXIgX2NvbEZvcm11bGFNYXBBcnIgPSBPYmplY3Qua2V5cyhjb2xGb3JtdWxhTWFwQ3ApOwogICAgICAgIGlmIChfY29sRm9ybXVsYU1hcEFyci5sZW5ndGgpIHsKICAgICAgICAgIGZvciAodmFyIGNtYWkgPSAwOyBjbWFpIDwgX2NvbEZvcm11bGFNYXBBcnIubGVuZ3RoOyBjbWFpKyspIHsKICAgICAgICAgICAgaSsrOwogICAgICAgICAgICB2YXIgaXRlbSA9IF9jb2xGb3JtdWxhTWFwQXJyW2NtYWldOwogICAgICAgICAgICB2YXIgZm9ybXVsYSA9IGNvbEZvcm11bGFNYXBDcFtpdGVtXTsKICAgICAgICAgICAgdmFyIHJlZ1IgPSBuZXcgUmVnRXhwKCcoe1thLXpBLVowLTlfXSp9KScsICdpZycpOwogICAgICAgICAgICB2YXIgcm93c0tleSA9IGZvcm11bGEubWF0Y2gocmVnUikgPT09IG51bGwgPyBbXSA6IGZvcm11bGEubWF0Y2gocmVnUik7CiAgICAgICAgICAgIGlmIChyb3dzS2V5Lmxlbmd0aCkgewogICAgICAgICAgICAgIGZvciAodmFyIGtleUNGIGluIHJvd3NLZXkpIHsKICAgICAgICAgICAgICAgIHZhciBrZXlDID0gcm93c0tleVtrZXlDRl0ucmVwbGFjZSgvXHt8XH0vZywgJycpOwogICAgICAgICAgICAgICAgdmFyIHJlZyA9IG5ldyBSZWdFeHAoJyh7JyArIGtleUMucmVwbGFjZSgvXCQvaWcsICdcXCQnKSArICd9KScsICdpZycpOwogICAgICAgICAgICAgICAgaWYgKHJvd1trZXlDXSAhPT0gdW5kZWZpbmVkICYmICEoaGFzQ2FsY0NvbEZvcm11bGFNYXBba2V5Q10gIT09IHVuZGVmaW5lZCB8fCBjb2xGb3JtdWxhTWFwQ3Bba2V5Q10pKSB7CiAgICAgICAgICAgICAgICAgIGNvbEZvcm11bGFNYXBDcFtpdGVtXSA9IGZvcm11bGEucmVwbGFjZShyZWcsIGlzTmFOKHBhcnNlRmxvYXQocm93W2tleUNdKSkgPyAwIDogcGFyc2VGbG9hdChyb3dba2V5Q10pKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaGFzQ2FsY0NvbEZvcm11bGFNYXBba2V5Q10gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICBjb2xGb3JtdWxhTWFwQ3BbaXRlbV0gPSBmb3JtdWxhLnJlcGxhY2UocmVnLCBoYXNDYWxjQ29sRm9ybXVsYU1hcFtrZXlDXSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCFjb2xGb3JtdWxhTWFwQ3Bba2V5Q10pIHsKICAgICAgICAgICAgICAgICAgY29sRm9ybXVsYU1hcENwW2l0ZW1dID0gZm9ybXVsYS5yZXBsYWNlKHJlZywgMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHZhciBfdmlzaWJsZUNvbHVtbk9iaiRpdGUsIF92aXNpYmxlQ29sdW1uT2JqJGl0ZTI7CiAgICAgICAgICAgICAgLy8gbGV0IGNhbGNSZXN1bHQgPSBldmFsKGZvcm11bGEpCiAgICAgICAgICAgICAgdmFyIGNhbGNSZXN1bHQgPSBldmFsQ2FsY1V0aWwuZXZhbChmb3JtdWxhKTsKICAgICAgICAgICAgICBoYXNDYWxjQ29sRm9ybXVsYU1hcFtpdGVtXSA9IGNhbGNSZXN1bHQgPT09IEluZmluaXR5IHx8IGNhbGNSZXN1bHQgPT09IC1JbmZpbml0eSB8fCBpc05hTihjYWxjUmVzdWx0KSB8fCBjYWxjUmVzdWx0ID09PSBudWxsID8gJycgOiB1dGlsLmFjY3VyYXRlRml4ZWQoY2FsY1Jlc3VsdCwgMik7CiAgICAgICAgICAgICAgLy8g5YiX5Y2V54us6YWN572u5YWD5ZKM5LiH5YWD5Y2V5L2NCiAgICAgICAgICAgICAgaWYgKHZpc2libGVDb2x1bW5PYmpbaXRlbV0gJiYgdmlzaWJsZUNvbHVtbk9ialtpdGVtXS5wYXJhbXMgJiYgdmlzaWJsZUNvbHVtbk9ialtpdGVtXS5wYXJhbXMubW9uZXlVbml0KSB7CiAgICAgICAgICAgICAgICBoYXNDYWxjQ29sRm9ybXVsYU1hcFtpdGVtXSA9IHRoaXMuYWNjdXJhdGVGaXhlZCh0aGlzLnRyYW5zVG9OdW1iZXIodGhpcy5hY2N1cmF0ZUNodUZhKGhhc0NhbGNDb2xGb3JtdWxhTWFwW2l0ZW1dLCB2aXNpYmxlQ29sdW1uT2JqW2l0ZW1dLnBhcmFtcy5tb25leVVuaXQpLCB2aXNpYmxlQ29sdW1uT2JqW2l0ZW1dLnBhcmFtcy5kaWdpdHMgfHwgMiksIDIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAvLyBmZWF077ya5a+55LqOJHZ4ZVJhdGlv5riy5p+T55qE55m+5YiG5q+UIOWPr+agueaNrumFjee9ruS/neeVmeWwj+aVsOS9jQogICAgICAgICAgICAgIGlmICgoKF92aXNpYmxlQ29sdW1uT2JqJGl0ZSA9IHZpc2libGVDb2x1bW5PYmpbaXRlbV0pID09PSBudWxsIHx8IF92aXNpYmxlQ29sdW1uT2JqJGl0ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF92aXNpYmxlQ29sdW1uT2JqJGl0ZTIgPSBfdmlzaWJsZUNvbHVtbk9iaiRpdGUuY2VsbFJlbmRlcikgPT09IG51bGwgfHwgX3Zpc2libGVDb2x1bW5PYmokaXRlMiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3Zpc2libGVDb2x1bW5PYmokaXRlMi5uYW1lKSA9PT0gJyR2eGVSYXRpbycpIHsKICAgICAgICAgICAgICAgIHZhciBfdmlzaWJsZUNvbHVtbk9iaiRpdGUzLCBfdmlzaWJsZUNvbHVtbk9iaiRpdGU0OwogICAgICAgICAgICAgICAgLy8g5L+d55WZ5bCP5pWw5L2N5pWw5pSv5oyB77ya5aSW6YOo5Y2V5YiX6YWN572uIHx8IOWFqOWxgOmFjee9riB8fCDpu5jorqTphY3nva4KICAgICAgICAgICAgICAgIHZhciBkaWdpdHMgPSAoKF92aXNpYmxlQ29sdW1uT2JqJGl0ZTMgPSB2aXNpYmxlQ29sdW1uT2JqW2l0ZW1dKSA9PT0gbnVsbCB8fCBfdmlzaWJsZUNvbHVtbk9iaiRpdGUzID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX3Zpc2libGVDb2x1bW5PYmokaXRlNCA9IF92aXNpYmxlQ29sdW1uT2JqJGl0ZTMucGFyYW1zKSA9PT0gbnVsbCB8fCBfdmlzaWJsZUNvbHVtbk9iaiRpdGU0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdmlzaWJsZUNvbHVtbk9iaiRpdGU0LmRpZ2l0cykgfHwgdGhpcy5mb3JtdWxhRGlnaXRzIHx8IDI7CiAgICAgICAgICAgICAgICAvLyBYRVV0aWxzLnJvdW5k5Zub6IiN5LqU5YWlCiAgICAgICAgICAgICAgICBoYXNDYWxjQ29sRm9ybXVsYU1hcFtpdGVtXSA9IGNhbGNSZXN1bHQgPT09IEluZmluaXR5IHx8IGNhbGNSZXN1bHQgPT09IC1JbmZpbml0eSB8fCBpc05hTihjYWxjUmVzdWx0KSB8fCBjYWxjUmVzdWx0ID09PSBudWxsID8gJycgOiBYRVV0aWxzLnJvdW5kKGNhbGNSZXN1bHQsIGRpZ2l0cyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGRlbGV0ZSBjb2xGb3JtdWxhTWFwQ3BbaXRlbV07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWZEb1doaWxlID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmIChpID09PSAxMDAwMDApIHsKICAgICAgICAgIGNvbnNvbGUubG9nKGNvbEZvcm11bGFNYXAsIGhhc0NhbGNDb2xGb3JtdWxhTWFwKTsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+ivt+aguOafpeWFrOW8jycpOwogICAgICAgIH0KICAgICAgfQogICAgfSBjYXRjaCAoZSkgewogICAgICAvLyBjb25zb2xlLmxvZyhpKQogICAgICAvLyBjb25zb2xlLmxvZyhjb2xGb3JtdWxhTWFwLCBoYXNDYWxjQ29sRm9ybXVsYU1hcCkKICAgICAgLy8gY29uc29sZS5lcnJvcign6K+35qC45p+l5YWs5byPJykKICAgIH0KICAgIC8vIGNvbnNvbGUubG9nKGhhc0NhbGNDb2xGb3JtdWxhTWFwKQogICAgLy8gZGVidWdnZXIKICAgIHJldHVybiBPYmplY3QuYXNzaWduKHJvdywgaGFzQ2FsY0NvbEZvcm11bGFNYXApOwogIH0sCiAgcmVkdWN0aW9uUm93Rm9ybXVsYTogZnVuY3Rpb24gcmVkdWN0aW9uUm93Rm9ybXVsYShyb3dGb3JtdWxhTWFwLCBkYXRhLCB0YWJsZUlkKSB7CiAgICAvLyDljZXlhYPmoLzkuqTlj4norqHnrpcKICAgIC8vIHJvd0Zvcm11bGFNYXA9IHsgImNvbEZpZWxkOnJvd0luZGV4Ijoie3RhYmxlSWQ6Y29sRmllbGQ6cm93SW5kZXh9W+i/kOeul+espl0iIH0KICAgIHZhciByb3dGb3JtdWxhTWFwQ3AgPSB0aGlzLmRlZXBDb3B5KHJvd0Zvcm11bGFNYXApOwogICAgdmFyIGhhc0NhbGNyb3dGb3JtdWxhTWFwID0ge307CiAgICB2YXIgaSA9IDA7CiAgICB2YXIgaWZEb1doaWxlID0gdHJ1ZTsKICAgIHRyeSB7CiAgICAgIHdoaWxlIChpZkRvV2hpbGUpIHsKICAgICAgICB2YXIgcm93Rm9ybXVsYU1hcEFyciA9IE9iamVjdC5rZXlzKHJvd0Zvcm11bGFNYXBDcCk7CiAgICAgICAgaWYgKHJvd0Zvcm11bGFNYXBBcnIubGVuZ3RoKSB7CiAgICAgICAgICBmb3IgKHZhciBjbWFpID0gMDsgY21haSA8IHJvd0Zvcm11bGFNYXBBcnIubGVuZ3RoOyBjbWFpKyspIHsKICAgICAgICAgICAgaSsrOwogICAgICAgICAgICB2YXIgaXRlbSA9IHJvd0Zvcm11bGFNYXBBcnJbY21haV07CiAgICAgICAgICAgIHZhciBmb3JtdWxhID0gcm93Rm9ybXVsYU1hcENwW2l0ZW1dOwogICAgICAgICAgICB2YXIgcmVnUiA9IG5ldyBSZWdFeHAoJyh7W2EtekEtWjAtOV86XCRdKn0pJywgJ2lnJyk7CiAgICAgICAgICAgIHZhciByb3dzS2V5ID0gZm9ybXVsYS5tYXRjaChyZWdSKSA9PT0gbnVsbCA/IFtdIDogZm9ybXVsYS5tYXRjaChyZWdSKTsKICAgICAgICAgICAgaWYgKHJvd3NLZXkubGVuZ3RoKSB7CiAgICAgICAgICAgICAgZm9yICh2YXIga2V5Q0YgaW4gcm93c0tleSkgewogICAgICAgICAgICAgICAgdmFyIGZvcm11bGFBcnIgPSByb3dzS2V5W2tleUNGXS5yZXBsYWNlKC9ce3xcfS9nLCAnJykuc3BsaXQoJzonKTsKICAgICAgICAgICAgICAgIHZhciByZWcgPSBuZXcgUmVnRXhwKCcoeycgKyBmb3JtdWxhQXJyLmpvaW4oJzonKS5yZXBsYWNlKC9cJC9pZywgJ1xcJCcpICsgJ30pJywgJ2lnJyk7CiAgICAgICAgICAgICAgICBpZiAoZm9ybXVsYUFyclswXSA9PT0gdGFibGVJZCkgewogICAgICAgICAgICAgICAgICBpZiAoZGF0YVtmb3JtdWxhQXJyWzJdXSAmJiBkYXRhW2Zvcm11bGFBcnJbMl1dW2Zvcm11bGFBcnJbMV1dICE9PSB1bmRlZmluZWQgJiYgIShoYXNDYWxjcm93Rm9ybXVsYU1hcFtmb3JtdWxhQXJyWzFdICsgJzonICsgZm9ybXVsYUFyclsyXV0gIT09IHVuZGVmaW5lZCB8fCByb3dGb3JtdWxhTWFwQ3BbZm9ybXVsYUFyclsxXSArICc6JyArIGZvcm11bGFBcnJbMl1dKSkgewogICAgICAgICAgICAgICAgICAgIHJvd0Zvcm11bGFNYXBDcFtpdGVtXSA9IGZvcm11bGEucmVwbGFjZShyZWcsIGlzTmFOKHBhcnNlRmxvYXQoZGF0YVtmb3JtdWxhQXJyWzJdXVtmb3JtdWxhQXJyWzFdXSkpID8gMCA6IHBhcnNlRmxvYXQoZGF0YVtmb3JtdWxhQXJyWzJdXVtmb3JtdWxhQXJyWzFdXSkpOwogICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGhhc0NhbGNyb3dGb3JtdWxhTWFwW2Zvcm11bGFBcnJbMV0gKyAnOicgKyBmb3JtdWxhQXJyWzJdXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgcm93Rm9ybXVsYU1hcENwW2l0ZW1dID0gZm9ybXVsYS5yZXBsYWNlKHJlZywgaGFzQ2FsY3Jvd0Zvcm11bGFNYXBbZm9ybXVsYUFyclsxXSArICc6JyArIGZvcm11bGFBcnJbMl1dKTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICghcm93Rm9ybXVsYU1hcENwW2Zvcm11bGFBcnJbMV0gKyAnOicgKyBmb3JtdWxhQXJyWzJdXSkgewogICAgICAgICAgICAgICAgICAgIHJvd0Zvcm11bGFNYXBDcFtpdGVtXSA9IGZvcm11bGEucmVwbGFjZShyZWcsIDApOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICByb3dGb3JtdWxhTWFwQ3BbaXRlbV0gPSBmb3JtdWxhLnJlcGxhY2UocmVnLCAwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdmFyIGNhbGNSZXN1bHQgPSBldmFsQ2FsY1V0aWwuZXZhbChmb3JtdWxhKTsKICAgICAgICAgICAgICBoYXNDYWxjcm93Rm9ybXVsYU1hcFtpdGVtXSA9IGNhbGNSZXN1bHQgPT09IEluZmluaXR5IHx8IGNhbGNSZXN1bHQgPT09IC1JbmZpbml0eSB8fCBpc05hTihjYWxjUmVzdWx0KSA/ICcnIDogdXRpbC5hY2N1cmF0ZUZpeGVkKGNhbGNSZXN1bHQsIDIpOwogICAgICAgICAgICAgIGRlbGV0ZSByb3dGb3JtdWxhTWFwQ3BbaXRlbV07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWZEb1doaWxlID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmIChpID09PSAxMDAwMDAwKSB7CiAgICAgICAgICBjb25zb2xlLmxvZyhyb3dGb3JtdWxhTWFwLCBoYXNDYWxjcm93Rm9ybXVsYU1hcCk7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCfor7fmoLjmn6XlhazlvI8nKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgY29uc29sZS5sb2cocm93Rm9ybXVsYU1hcCwgaGFzQ2FsY3Jvd0Zvcm11bGFNYXApOwogICAgICBjb25zb2xlLmVycm9yKCfor7fmoLjmn6XlhazlvI8nKTsKICAgIH0KICAgIE9iamVjdC5rZXlzKGhhc0NhbGNyb3dGb3JtdWxhTWFwKS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtLCBpbmRleCkgewogICAgICB2YXIgcm93Q2VsbEFyciA9IGl0ZW0uc3BsaXQoJzonKTsKICAgICAgaWYgKGRhdGFbcm93Q2VsbEFyclsxXV0pIHsKICAgICAgICBkYXRhW3Jvd0NlbGxBcnJbMV1dW3Jvd0NlbGxBcnJbMF1dID0gaGFzQ2FsY3Jvd0Zvcm11bGFNYXBbaXRlbV0gPT09ICcwLjAwJyA/ICcnIDogaGFzQ2FsY3Jvd0Zvcm11bGFNYXBbaXRlbV07CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIGRhdGE7CiAgfSwKICByZXZlckRhdGFDb2RlUm93TWFwOiBmdW5jdGlvbiByZXZlckRhdGFDb2RlUm93TWFwKGRhdGEsIGNvZGVLZXksIG9iaikgewogICAgLy8g6YCS5b2S55Sf5oiQ5pWw5o2uY29kZeaYoOWwhAogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgb2JqID0gb2JqIHx8IHsKICAgICAgZGF0YUNvZGVSb3dNYXA6IHt9CiAgICB9OwogICAgZGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtLCBpbmRleCkgewogICAgICBpZiAoQXJyYXkuaXNBcnJheShpdGVtLmNoaWxkcmVuKSAmJiBpdGVtLmNoaWxkcmVuLmxlbmd0aCkgewogICAgICAgIHNlbGYucmV2ZXJEYXRhQ29kZVJvd01hcChpdGVtLmNoaWxkcmVuLCBjb2RlS2V5LCBvYmopOwogICAgICB9IGVsc2UgewogICAgICAgIG9iai5kYXRhQ29kZVJvd01hcFtpdGVtW2NvZGVLZXldXSA9IGl0ZW07CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIG9iajsKICB9LAogIHJldmVyQ2FsY1Jvd0NvZGVGb3JtdWxhOiBmdW5jdGlvbiByZXZlckNhbGNSb3dDb2RlRm9ybXVsYShfcmV2ZXJDYWxjUm93Q29kZUZvcm11bGEsIGRhdGEsIHRhYmxlSWQpIHsKICAgIC8vIOmAkuW9kui/m+ihjOWNleWFg+agvOS6pOWPieS+nei1luiuoeeulwogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgT2JqZWN0LmtleXMoX3JldmVyQ2FsY1Jvd0NvZGVGb3JtdWxhKS5tYXAoZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgaXRlbWNvZGU6IGl0ZW0uc3BsaXQoJzonKVsxXSwKICAgICAgICBwcm9wZXJ0eTogaXRlbS5zcGxpdCgnOicpWzBdCiAgICAgIH07CiAgICB9KS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtLCBpZCkgewogICAgICB2YXIgZm9ybUNvbENhbExpc3QgPSBzZWxmLmdldEZvcm1Db2xDYWxCYWNrKHNlbGYuaWQgKyBpdGVtLnByb3BlcnR5ICsgaXRlbS5pdGVtY29kZSk7CiAgICAgIGlmIChPYmplY3Qua2V5cyhmb3JtQ29sQ2FsTGlzdCkubGVuZ3RoKSB7CiAgICAgICAgc2VsZi5yZWR1Y3Rpb25Sb3dDb2RlRm9ybXVsYShmb3JtQ29sQ2FsTGlzdCwgc2VsZi4kcmVmcy54R3JpZC5nZXRUYWJsZURhdGEoKS5mdWxsRGF0YSwgc2VsZi5pZCk7CiAgICAgIH0KICAgIH0pOwogIH0sCiAgZ2V0RGF0YUNvZGVSb3dNYXBDdW11bGF0aXZlUmVzdWx0OiBmdW5jdGlvbiBnZXREYXRhQ29kZVJvd01hcEN1bXVsYXRpdmVSZXN1bHQoZGF0YUNvZGVSb3dNYXAsIGZpZWxkKSB7CiAgICAvLyDojrflj5bph43lpI1pdGVtY29kZeeahOiuoeeul+e7k+aenAogICAgcmV0dXJuIGlzTmFOKHBhcnNlRmxvYXQoZGF0YUNvZGVSb3dNYXBbZmllbGRdKSkgPyAwIDogcGFyc2VGbG9hdChkYXRhQ29kZVJvd01hcFtmaWVsZF0pOwogIH0sCiAgcmVkdWN0aW9uUm93Q29kZUZvcm11bGE6IGZ1bmN0aW9uIHJlZHVjdGlvblJvd0NvZGVGb3JtdWxhKHJvd0NvZGVGb3JtdWxhTWFwLCBkYXRhLCB0YWJsZUlkKSB7CiAgICAvLyDljZXlhYPmoLzkuqTlj4norqHnrpfmoLnmja7ooYwgY29kZQogICAgLy8gcm93Q29kZUZvcm11bGFNYXA9IHsgImNvbEZpZWxkOnJvd0NvZGUiOiJ7dGFibGVJZDpjb2xGaWVsZDpyb3dDb2RlfVvov5DnrpfnrKZdIiB9CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICB2YXIgX3NlbGYkY2FsY3VsYXRlQ29uc3RyID0gc2VsZi5jYWxjdWxhdGVDb25zdHJhaW50Q29uZmlnSW4sCiAgICAgIGNhbGNBbmRDb25zdHJhaW50VGFibGVJZCA9IF9zZWxmJGNhbGN1bGF0ZUNvbnN0ci5jYWxjQW5kQ29uc3RyYWludFRhYmxlSWQsCiAgICAgIGRhdGFUeXBlID0gX3NlbGYkY2FsY3VsYXRlQ29uc3RyLmRhdGFUeXBlLAogICAgICBjYWxjQW5kQ29uc3RyYWludEl0ZW1Db2RlRmllbGQgPSBfc2VsZiRjYWxjdWxhdGVDb25zdHIuY2FsY0FuZENvbnN0cmFpbnRJdGVtQ29kZUZpZWxkLAogICAgICBncmFkZWRTdW1tYXJ5RmllbGRzID0gX3NlbGYkY2FsY3VsYXRlQ29uc3RyLmdyYWRlZFN1bW1hcnlGaWVsZHM7CiAgICB2YXIgaXNUcmVlRGF0YSA9IGRhdGFUeXBlID09PSB1bmRlZmluZWQgPyBzZWxmLnRyZWVDb25maWdJbiA6IGRhdGFUeXBlID09PSAndHJlZScgPyAxIDogMDsKICAgIHRhYmxlSWQgPSBjYWxjQW5kQ29uc3RyYWludFRhYmxlSWQgfHwgc2VsZi5pZDsKICAgIHZhciB0cmVlRGF0YSA9IHRoaXMuZ2V0RGF0YUNvZGVUcmVlRGF0YShkYXRhLCBjYWxjQW5kQ29uc3RyYWludEl0ZW1Db2RlRmllbGQsIGdyYWRlZFN1bW1hcnlGaWVsZHMsIGlzVHJlZURhdGEpOwogICAgdmFyIF9zZWxmJHJlY3Vyc2l2ZURhdGFDbyA9IHNlbGYucmVjdXJzaXZlRGF0YUNvZGVSb3dNYXAodHJlZURhdGEsIGNhbGNBbmRDb25zdHJhaW50SXRlbUNvZGVGaWVsZCwgdHJ1ZSksCiAgICAgIGRhdGFDb2RlUm93TWFwID0gX3NlbGYkcmVjdXJzaXZlRGF0YUNvLmRhdGFDb2RlUm93TWFwOwogICAgdmFyIHJvd0NvZGVGb3JtdWxhTWFwQ3AgPSB0aGlzLmRlZXBDb3B5KHJvd0NvZGVGb3JtdWxhTWFwKTsKICAgIHZhciBoYXNDYWxjcm93Q29kZUZvcm11bGFNYXAgPSB7fTsKICAgIHZhciBpID0gMDsKICAgIHZhciBpZkRvV2hpbGUgPSB0cnVlOwogICAgdHJ5IHsKICAgICAgd2hpbGUgKGlmRG9XaGlsZSkgewogICAgICAgIHZhciByb3dDb2RlRm9ybXVsYU1hcEFyciA9IE9iamVjdC5rZXlzKHJvd0NvZGVGb3JtdWxhTWFwQ3ApOwogICAgICAgIGlmIChyb3dDb2RlRm9ybXVsYU1hcEFyci5sZW5ndGgpIHsKICAgICAgICAgIGZvciAodmFyIGNtYWkgPSAwOyBjbWFpIDwgcm93Q29kZUZvcm11bGFNYXBBcnIubGVuZ3RoOyBjbWFpKyspIHsKICAgICAgICAgICAgaSsrOwogICAgICAgICAgICB2YXIgaXRlbSA9IHJvd0NvZGVGb3JtdWxhTWFwQXJyW2NtYWldOwogICAgICAgICAgICB2YXIgZm9ybXVsYSA9IHJvd0NvZGVGb3JtdWxhTWFwQ3BbaXRlbV07CiAgICAgICAgICAgIHZhciByZWdSID0gbmV3IFJlZ0V4cCgnKHtbYS16QS1aMC05XzpcJF0qfSknLCAnaWcnKTsKICAgICAgICAgICAgdmFyIHJvd3NLZXkgPSBmb3JtdWxhLm1hdGNoKHJlZ1IpID09PSBudWxsID8gW10gOiBmb3JtdWxhLm1hdGNoKHJlZ1IpOwogICAgICAgICAgICBpZiAocm93c0tleS5sZW5ndGgpIHsKICAgICAgICAgICAgICBmb3IgKHZhciBrZXlDRiBpbiByb3dzS2V5KSB7CiAgICAgICAgICAgICAgICB2YXIgZm9ybXVsYUFyciA9IHJvd3NLZXlba2V5Q0ZdLnJlcGxhY2UoL1x7fFx9L2csICcnKS5zcGxpdCgnOicpOwogICAgICAgICAgICAgICAgdmFyIHJlZyA9IG5ldyBSZWdFeHAoJyh7JyArIGZvcm11bGFBcnIuam9pbignOicpLnJlcGxhY2UoL1wkL2lnLCAnXFwkJykgKyAnfSknLCAnaWcnKTsKICAgICAgICAgICAgICAgIGlmIChmb3JtdWxhQXJyWzBdID09PSB0YWJsZUlkKSB7CiAgICAgICAgICAgICAgICAgIGlmIChkYXRhQ29kZVJvd01hcFtmb3JtdWxhQXJyWzJdXSAmJiAhKGhhc0NhbGNyb3dDb2RlRm9ybXVsYU1hcFtmb3JtdWxhQXJyWzFdICsgJzonICsgZm9ybXVsYUFyclsyXV0gfHwgcm93Q29kZUZvcm11bGFNYXBDcFtmb3JtdWxhQXJyWzFdICsgJzonICsgZm9ybXVsYUFyclsyXV0pKSB7CiAgICAgICAgICAgICAgICAgICAgcm93Q29kZUZvcm11bGFNYXBDcFtpdGVtXSA9IGZvcm11bGEucmVwbGFjZShyZWcsIHNlbGYuZ2V0RGF0YUNvZGVSb3dNYXBDdW11bGF0aXZlUmVzdWx0KGRhdGFDb2RlUm93TWFwW2Zvcm11bGFBcnJbMl1dLCBmb3JtdWxhQXJyWzFdKSk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaGFzQ2FsY3Jvd0NvZGVGb3JtdWxhTWFwW2Zvcm11bGFBcnJbMV0gKyAnOicgKyBmb3JtdWxhQXJyWzJdXSkgewogICAgICAgICAgICAgICAgICAgIHJvd0NvZGVGb3JtdWxhTWFwQ3BbaXRlbV0gPSBmb3JtdWxhLnJlcGxhY2UocmVnLCBoYXNDYWxjcm93Q29kZUZvcm11bGFNYXBbZm9ybXVsYUFyclsxXSArICc6JyArIGZvcm11bGFBcnJbMl1dKTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICghcm93Q29kZUZvcm11bGFNYXBDcFtmb3JtdWxhQXJyWzFdICsgJzonICsgZm9ybXVsYUFyclsyXV0pIHsKICAgICAgICAgICAgICAgICAgICByb3dDb2RlRm9ybXVsYU1hcENwW2l0ZW1dID0gZm9ybXVsYS5yZXBsYWNlKHJlZywgMCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHJvd0NvZGVGb3JtdWxhTWFwQ3BbaXRlbV0gPSBmb3JtdWxhLnJlcGxhY2UocmVnLCAwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdmFyIGNhbGNSZXN1bHQgPSBldmFsQ2FsY1V0aWwuZXZhbChmb3JtdWxhKTsKICAgICAgICAgICAgICBoYXNDYWxjcm93Q29kZUZvcm11bGFNYXBbaXRlbV0gPSBjYWxjUmVzdWx0ID09PSBJbmZpbml0eSB8fCBjYWxjUmVzdWx0ID09PSAtSW5maW5pdHkgfHwgaXNOYU4oY2FsY1Jlc3VsdCkgPyAnJyA6IHV0aWwuYWNjdXJhdGVGaXhlZChjYWxjUmVzdWx0LCAyKTsKICAgICAgICAgICAgICBkZWxldGUgcm93Q29kZUZvcm11bGFNYXBDcFtpdGVtXTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZkRvV2hpbGUgPSBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKGkgPT09IDEwMDAwMDApIHsKICAgICAgICAgIGNvbnNvbGUubG9nKHJvd0NvZGVGb3JtdWxhTWFwLCBoYXNDYWxjcm93Q29kZUZvcm11bGFNYXApOwogICAgICAgICAgY29uc29sZS5lcnJvcign6K+35qC45p+l5YWs5byPJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIGNvbnNvbGUubG9nKHJvd0NvZGVGb3JtdWxhTWFwLCBoYXNDYWxjcm93Q29kZUZvcm11bGFNYXApOwogICAgICB0aHJvdyBlOwogICAgfQogICAgdHJ5IHsKICAgICAgdmFyIHJvd0NvZGVGb3JtdW1hTWFwID0gc2VsZi5jaGVja1doZXRoZXJFeGN1dGVDb2xDYWxjdWxhdGUodGhpcy5kZWVwQ29weShoYXNDYWxjcm93Q29kZUZvcm11bGFNYXApKTsKICAgICAgZm9yICh2YXIgaXRlbUNvZGUgaW4gcm93Q29kZUZvcm11bWFNYXApIHsKICAgICAgICB2YXIgcm93ID0gZGF0YUNvZGVSb3dNYXBbaXRlbUNvZGVdOwogICAgICAgIGlmIChyb3cpIHsKICAgICAgICAgIHJvdyA9IE9iamVjdC5hc3NpZ24ocm93LCByb3dDb2RlRm9ybXVtYU1hcFtpdGVtQ29kZV0uY3VyUm93Q29kZUZvcm11bGFNYXApOwogICAgICAgICAgc2VsZi5yZWR1Y3Rpb25Db2xGb3JtdWxhKHJvd0NvZGVGb3JtdW1hTWFwW2l0ZW1Db2RlXS5yb3dDb2RlRm9ybXVsYUZpZWxkTWFwLCByb3cpOwogICAgICAgIH0KICAgICAgfQogICAgfSBjYXRjaCAoZSkgewogICAgICB0aHJvdyBlOwogICAgfQoKICAgIC8vIE9iamVjdC5rZXlzKGhhc0NhbGNyb3dDb2RlRm9ybXVsYU1hcCkuZm9yRWFjaCgoaXRlbSwgaW5kZXgpID0+IHsKICAgIC8vICAgbGV0IHJvd0NlbGxBcnIgPSBpdGVtLnNwbGl0KCc6JykKICAgIC8vICAgaWYgKGRhdGFDb2RlUm93TWFwW3Jvd0NlbGxBcnJbMV1dKSB7CiAgICAvLyAgICAgZGF0YUNvZGVSb3dNYXBbcm93Q2VsbEFyclsxXV0uZm9yRWFjaCgocm93LCByb3dJbmRleCkgPT4gewogICAgLy8gICAgICAgcm93W3Jvd0NlbGxBcnJbMF1dID0gaGFzQ2FsY3Jvd0NvZGVGb3JtdWxhTWFwW2l0ZW1dID09PSAnMC4wMCcgPyAnJyA6IGhhc0NhbGNyb3dDb2RlRm9ybXVsYU1hcFtpdGVtXQogICAgLy8gICAgICAgcm93ID0gc2VsZi5yZWR1Y3Rpb25Db2xGb3JtdWxhKCwgcm93KQogICAgLy8gICAgIH0pCiAgICAvLyAgIH0KICAgIC8vIH0pCiAgICAvLyB0aGlzLnJldmVyQ2FsY1Jvd0NvZGVGb3JtdWxhKHJvd0NvZGVGb3JtdWxhTWFwLCBkYXRhLCB0YWJsZUlkKQogICAgcmV0dXJuIGRhdGE7CiAgfSwKICBjaGVja1doZXRoZXJFeGN1dGVDb2xDYWxjdWxhdGU6IGZ1bmN0aW9uIGNoZWNrV2hldGhlckV4Y3V0ZUNvbENhbGN1bGF0ZShoYXNDYWxjcm93Q29kZUZvcm11bGFNYXApIHsKICAgIC8vIOiusOW9leW9k+WJjeaVsOaNruWNleWFg+agvOS6pOWPieWFrOW8j+iuoeeul+Wtl+autQogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgdmFyIHJvd0NvZGVGb3JtdW1hTWFwID0ge307CiAgICBPYmplY3Qua2V5cyhoYXNDYWxjcm93Q29kZUZvcm11bGFNYXApLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7CiAgICAgIHJvd0NvZGVGb3JtdW1hTWFwW2l0ZW0uc3BsaXQoJzonKVswXV0gPSB7fTsKICAgIH0pOwogICAgT2JqZWN0LmtleXMocm93Q29kZUZvcm11bWFNYXApLmZvckVhY2goZnVuY3Rpb24gKGl0ZW1Db2RlLCBpdGVtQ29kZUluZGV4KSB7CiAgICAgIHZhciByb3dDb2RlRm9ybXVsYUZpZWxkTWFwID0gT2JqZWN0LmFzc2lnbih7fSwgc2VsZi5jYWxjdWxhdGVDb25zdHJhaW50Q29uZmlnSW4uY29sRm9ybXVsYUNvbmZpZyk7IC8vIOWNleWFg+agvOS6pOWPieiuoeeulwogICAgICB2YXIgY3VyUm93Q29kZUZvcm11bGFNYXAgPSB7fTsKICAgICAgT2JqZWN0LmtleXMoaGFzQ2FsY3Jvd0NvZGVGb3JtdWxhTWFwKS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtLCBpbmRleCkgewogICAgICAgIHZhciByb3dDZWxsQXJyID0gaXRlbS5zcGxpdCgnOicpOwogICAgICAgIGlmIChyb3dDZWxsQXJyWzBdID09PSBpdGVtQ29kZSkgewogICAgICAgICAgY3VyUm93Q29kZUZvcm11bGFNYXBbcm93Q2VsbEFyclsxXV0gPSBoYXNDYWxjcm93Q29kZUZvcm11bGFNYXBbaXRlbV0gPT09ICcwLjAwJyA/ICcnIDogaGFzQ2FsY3Jvd0NvZGVGb3JtdWxhTWFwW2l0ZW1dOwogICAgICAgICAgZGVsZXRlIHJvd0NvZGVGb3JtdWxhRmllbGRNYXBbcm93Q2VsbEFyclswXV07CiAgICAgICAgfQogICAgICB9KTsKICAgICAgcm93Q29kZUZvcm11bWFNYXBbaXRlbUNvZGVdID0gewogICAgICAgIHJvd0NvZGVGb3JtdWxhRmllbGRNYXA6IE9iamVjdC5hc3NpZ24oe30sIHNlbGYuY2FsY3VsYXRlQ29uc3RyYWludENvbmZpZ0luLmNvbEZvcm11bGFDb25maWcsIHJvd0NvZGVGb3JtdWxhRmllbGRNYXApLAogICAgICAgIGN1clJvd0NvZGVGb3JtdWxhTWFwOiBjdXJSb3dDb2RlRm9ybXVsYU1hcAogICAgICB9OwogICAgfSk7CiAgICByZXR1cm4gcm93Q29kZUZvcm11bWFNYXA7CiAgfSwKICByaXZlckNvbHVtbnNHZW5lcmF0ZUNhbGNDb2xGb3JtdWxhTWFwOiBmdW5jdGlvbiByaXZlckNvbHVtbnNHZW5lcmF0ZUNhbGNDb2xGb3JtdWxhTWFwKGNvbHVtbnMsIG9iaikgewogICAgLy8g6YCS5b2S55Sf5oiQ5YiX6K6h566X5YWo6YeP5pig5bCECiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICBvYmogPSBvYmogfHwgewogICAgICB0YWJsZUNvbHVtbnNGaWVsZE1hcDoge30sCiAgICAgIHRhYmxlQ29sdW1uc0ZpZWxkQXJyOiBbXSwKICAgICAgdGFibGVDb2x1bW5zU2luZ0FycjogW10sCiAgICAgIHRhYmxlQ29sdW1uc1RpdGxlRmllbGRNYXA6IHt9LAogICAgICBjb2xGb3JtdWxhQ29uZmlnOiB7fSwKICAgICAgdGFibGVDb2x1bW5zU2luZ0VkaXRGaWVsZEFycjogW10sCiAgICAgIGdyYWRlZFN1bW1hcnlGaWVsZHM6IFtdCiAgICB9OwogICAgY29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb25sdW0sIGluZGV4KSB7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KGNvbmx1bS5jaGlsZHJlbikgJiYgY29ubHVtLmNoaWxkcmVuLmxlbmd0aCkgewogICAgICAgIHNlbGYucml2ZXJDb2x1bW5zR2VuZXJhdGVDYWxjQ29sRm9ybXVsYU1hcChjb25sdW0uY2hpbGRyZW4sIG9iaik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKGNvbmx1bS5maWVsZCkgewogICAgICAgICAgb2JqLnRhYmxlQ29sdW1uc0ZpZWxkTWFwW2Nvbmx1bS5maWVsZF0gPSBjb25sdW07CiAgICAgICAgICBvYmoudGFibGVDb2x1bW5zRmllbGRBcnIucHVzaChjb25sdW0uZmllbGQpOwogICAgICAgICAgb2JqLnRhYmxlQ29sdW1uc1NpbmdBcnIucHVzaChjb25sdW0pOwogICAgICAgICAgb2JqLnRhYmxlQ29sdW1uc1RpdGxlRmllbGRNYXBbY29ubHVtLnRpdGxlXSA9IGNvbmx1bS5maWVsZDsKICAgICAgICAgIGlmIChjb25sdW0uZm9ybXVsYSkgewogICAgICAgICAgICBvYmouY29sRm9ybXVsYUNvbmZpZ1tjb25sdW0uZmllbGRdID0gY29ubHVtLmZvcm11bGE7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoY29ubHVtLmVkaXRSZW5kZXIpIHsKICAgICAgICAgICAgb2JqLnRhYmxlQ29sdW1uc1NpbmdFZGl0RmllbGRBcnIucHVzaChjb25sdW0uZmllbGQpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGNvbmx1bS5jb21iaW5lZFR5cGUgJiYgY29ubHVtLmNvbWJpbmVkVHlwZS5pbmRleE9mKCduZWVkR3JhZGVkU3VtbWFyeScpID49IDAgfHwgY29ubHVtLm5lZWRSZXNwb25zaXZlIHx8IGNvbmx1bS5ncmFkZWRTdW1tYXJ5KSB7CiAgICAgICAgICAgIG9iai5ncmFkZWRTdW1tYXJ5RmllbGRzLnB1c2goY29ubHVtLmZpZWxkKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIG9iajsKICB9LAogIGdlbmVyYXRlQ2FsY0NvbEZvcm11bGFNYXA6IGZ1bmN0aW9uIGdlbmVyYXRlQ2FsY0NvbEZvcm11bGFNYXAoY29sdW1ucykgewogICAgLy8g55Sf5oiQ5YiX6K6h566X5YWs5byP5pig5bCECiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICB2YXIgb2JqID0gdGhpcy5yaXZlckNvbHVtbnNHZW5lcmF0ZUNhbGNDb2xGb3JtdWxhTWFwKGNvbHVtbnMpOwogICAgc2VsZi50YWJsZUNvbHVtbnNGaWVsZE1hcCA9IG9iai50YWJsZUNvbHVtbnNGaWVsZE1hcDsKICAgIHNlbGYudGFibGVDb2x1bW5zRmllbGRBcnIgPSBvYmoudGFibGVDb2x1bW5zRmllbGRBcnI7CiAgICBzZWxmLnRhYmxlQ29sdW1uc1NpbmdBcnIgPSBvYmoudGFibGVDb2x1bW5zU2luZ0FycjsKICAgIHNlbGYuZ3JhZGVkU3VtbWFyeUZpZWxkcyA9IEFycmF5LmlzQXJyYXkob2JqLmdyYWRlZFN1bW1hcnlGaWVsZHMpICYmIG9iai5ncmFkZWRTdW1tYXJ5RmllbGRzLmxlbmd0aCA/IG9iai5ncmFkZWRTdW1tYXJ5RmllbGRzIDogbnVsbDsKICAgIHNlbGYudGFibGVDb2x1bW5zVGl0bGVGaWVsZE1hcCA9IG9iai50YWJsZUNvbHVtbnNUaXRsZUZpZWxkTWFwOwogICAgc2VsZi50YWJsZUNvbHVtbnNTaW5nRWRpdEZpZWxkQXJyID0gb2JqLnRhYmxlQ29sdW1uc1NpbmdFZGl0RmllbGRBcnI7CiAgICB0aGlzLmNhbGN1bGF0ZUNvbnN0cmFpbnRDb25maWdJbiA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuY2FsY3VsYXRlQ29uc3RyYWludENvbmZpZ0luLCB7CiAgICAgIGNvbEZvcm11bGFDb25maWc6IG9iai5jb2xGb3JtdWxhQ29uZmlnCiAgICB9KTsKICB9LAogIGdldEZvcm1Db2xDYWxCYWNrOiBmdW5jdGlvbiBnZXRGb3JtQ29sQ2FsQmFjayhmb3JtdWxhQ29uZGl0aW9ucykgewogICAgLy8g5qC55o2u5Y2V5YWD5qC85L2N572u5p+l6K+i6K6h566X55qE5YWs5byPCiAgICAvLyBsZXQgc2VsZiA9IHRoaXMKICAgIHZhciBmb3JtQ29sQ2FsTGlzdCA9IHt9OwogICAgdmFyIHJvd0Zvcm11bGEgPSB0aGlzLmNhbGN1bGF0ZUNvbnN0cmFpbnRDb25maWdJbi5yb3dGb3JtdWxhOwogICAgaWYgKHJvd0Zvcm11bGEpIHsKICAgICAgT2JqZWN0LmtleXMocm93Rm9ybXVsYSkuZm9yRWFjaChmdW5jdGlvbiAodiwgaW5kZXgpIHsKICAgICAgICBpZiAodiA9PT0gZm9ybXVsYUNvbmRpdGlvbnMpIHsKICAgICAgICAgIHJvd0Zvcm11bGFbdl0uZm9yRWFjaChmdW5jdGlvbiAoaikgewogICAgICAgICAgICBmb3JtQ29sQ2FsTGlzdCA9IE9iamVjdC5hc3NpZ24oZm9ybUNvbENhbExpc3QsIGopOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgcmV0dXJuIGZvcm1Db2xDYWxMaXN0OwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuICcnOwogICAgfQogIH0sCiAgcGVyZm9ybVRhYmxlRGF0YUNhbGN1bGF0ZTogZnVuY3Rpb24gcGVyZm9ybVRhYmxlRGF0YUNhbGN1bGF0ZShvYmopIHsKICAgIC8vIOihjOaUueWPmOS6i+S7tuaJp+ihjOWNleWFg+agvOiuoeeul+W5tuWIt+aWsOinhuWbvgogICAgLy8g5omn6KGM6aG65bqP77yaIOWPluaVsC0tPuihjOWGheiuoeeuly0tPuWIhue6p+axh+aAuy0tPueItue6p+ihjOWGheiuoeeuly0tPuWNleWFg+agvOS6pOWPieiuoeeulyjmtonlj4rnmoTooYzorqHnrpcpLS0+6KGM57qm5p2fLS0+5Y2V5YWD5qC857qm5p2fCiAgICByZXR1cm4gdGhpcy5yZVBlcmZvcm1Sb3dDYWxjQW5kQ29uc3RyYWludFNpbmdsZUFuZFJlcmVuZGVyKG9iaik7CiAgfSwKICBnZW5lcmF0ZUNvbHVtbnNBbGxNYXA6IGZ1bmN0aW9uIGdlbmVyYXRlQ29sdW1uc0FsbE1hcChjb2x1bW5zLCBvYmopIHsKICAgIC8vIOeUn+aIkOWvvOWFpXZpZXfmmKDlsITmlbDmja4KICAgIHZhciBzZWxmID0gdGhpczsKICAgIG9iaiA9IG9iaiB8fCB7CiAgICAgIHRhYmxlQ29sdW1uc0ZpZWxkTWFwOiB7fSwKICAgICAgdGFibGVDb2x1bW5zVGl0bGVGaWVsZE1hcDoge30sCiAgICAgIHZpZXdUb1NvdXJjZU1hcDoge30sCiAgICAgIGNvbEZvcm11bGFDb25maWc6IHt9LAogICAgICByb3dzT2JqVGVtcDoge30sCiAgICAgIHRhYmxlQ29sdW1uc1RpdGxlTWFwOiB7fQogICAgfTsKICAgIGNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoY29ubHVtLCBpbmRleCkgewogICAgICBpZiAoQXJyYXkuaXNBcnJheShjb25sdW0uY2hpbGRyZW4pICYmIGNvbmx1bS5jaGlsZHJlbi5sZW5ndGgpIHsKICAgICAgICBzZWxmLnJpdmVyQ29sdW1uc0dlbmVyYXRlQ2FsY0NvbEZvcm11bGFNYXAoY29ubHVtLmNoaWxkcmVuLCBvYmopOwogICAgICB9IGVsc2UgewogICAgICAgIGlmIChjb25sdW0uZm9ybXVsYSkgewogICAgICAgICAgb2JqLmNvbEZvcm11bGFDb25maWdbY29ubHVtLmZpZWxkXSA9IGNvbmx1bS5mb3JtdWxhOwogICAgICAgICAgb2JqLnRhYmxlQ29sdW1uc1RpdGxlTWFwW2Nvbmx1bS50aXRsZV0gPSBjb25sdW07CiAgICAgICAgfQogICAgICAgIGlmIChjb25sdW0uZmllbGQpIHsKICAgICAgICAgIG9iai5yb3dzT2JqVGVtcFtjb25sdW0uZmllbGRdID0gJyc7CiAgICAgICAgICB2YXIgbWFwID0gewogICAgICAgICAgICBuZWVkTWFwOiB0cnVlLAogICAgICAgICAgICBvcHRpb25zOiBbXSwKICAgICAgICAgICAgbXVsdGlwbGU6IGZhbHNlLAogICAgICAgICAgICBmb3JtdWxhOiBjb25sdW0uZm9ybXVsYQogICAgICAgICAgfTsKICAgICAgICAgIG9iai50YWJsZUNvbHVtbnNGaWVsZE1hcFtjb25sdW0uZmllbGRdID0gY29ubHVtOwogICAgICAgICAgb2JqLnRhYmxlQ29sdW1uc1RpdGxlRmllbGRNYXBbY29ubHVtLnRpdGxlXSA9IGNvbmx1bS5maWVsZDsKICAgICAgICAgIHZhciBpdGVtUmVuZGVyID0gY29ubHVtLmNlbGxSZW5kZXIgfHwgY29ubHVtLmVkaXRSZW5kZXIgfHwgY29ubHVtLmNvbnRlbnRSZW5kZXI7CiAgICAgICAgICBpZiAoaXRlbVJlbmRlcikgewogICAgICAgICAgICBzd2l0Y2ggKGl0ZW1SZW5kZXIubmFtZSkgewogICAgICAgICAgICAgIGNhc2UgJyR2eGVTZWxlY3QnOgogICAgICAgICAgICAgICAgaWYgKGl0ZW1SZW5kZXIucHJvcHMgJiYgaXRlbVJlbmRlci5wcm9wcy5tdWx0aXBsZSkgewogICAgICAgICAgICAgICAgICBtYXAgPSBPYmplY3QuYXNzaWduKHt9LCBtYXAsIHsKICAgICAgICAgICAgICAgICAgICBuZWVkTWFwOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIG5hbWU6IGl0ZW1SZW5kZXIubmFtZSwKICAgICAgICAgICAgICAgICAgICBvcHRpb25zOiBBcnJheS5pc0FycmF5KGl0ZW1SZW5kZXIub3B0aW9ucykgPyBpdGVtUmVuZGVyLm9wdGlvbnMgOiBbXSwKICAgICAgICAgICAgICAgICAgICBtdWx0aXBsZTogdHJ1ZQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIG1hcCA9IE9iamVjdC5hc3NpZ24oe30sIG1hcCwgewogICAgICAgICAgICAgICAgICAgIG5lZWRNYXA6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgbmFtZTogaXRlbVJlbmRlci5uYW1lLAogICAgICAgICAgICAgICAgICAgIG9wdGlvbnM6IEFycmF5LmlzQXJyYXkoaXRlbVJlbmRlci5vcHRpb25zKSA/IGl0ZW1SZW5kZXIub3B0aW9ucyA6IFtdLAogICAgICAgICAgICAgICAgICAgIG11bHRpcGxlOiBmYWxzZQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgJyR2eGVSYWRpbyc6CiAgICAgICAgICAgICAgICBtYXAgPSBPYmplY3QuYXNzaWduKHt9LCBtYXAsIHsKICAgICAgICAgICAgICAgICAgbmVlZE1hcDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgbmFtZTogaXRlbVJlbmRlci5uYW1lLAogICAgICAgICAgICAgICAgICBvcHRpb25zOiBBcnJheS5pc0FycmF5KGl0ZW1SZW5kZXIub3B0aW9ucykgPyBpdGVtUmVuZGVyLm9wdGlvbnMgOiBbXSwKICAgICAgICAgICAgICAgICAgbXVsdGlwbGU6IGZhbHNlCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2UgJyR2eGVDaGVja2JveCc6CiAgICAgICAgICAgICAgICBtYXAgPSBPYmplY3QuYXNzaWduKHt9LCBtYXAsIHsKICAgICAgICAgICAgICAgICAgbmVlZE1hcDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgbmFtZTogaXRlbVJlbmRlci5uYW1lLAogICAgICAgICAgICAgICAgICBvcHRpb25zOiBBcnJheS5pc0FycmF5KGl0ZW1SZW5kZXIub3B0aW9ucykgPyBpdGVtUmVuZGVyLm9wdGlvbnMgOiBbXSwKICAgICAgICAgICAgICAgICAgbXVsdGlwbGU6IHRydWUKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAnJHZ4ZVN3aXRjaCc6CiAgICAgICAgICAgICAgICBtYXAgPSBPYmplY3QuYXNzaWduKHt9LCBtYXAsIHsKICAgICAgICAgICAgICAgICAgbmVlZE1hcDogdHJ1ZSwKICAgICAgICAgICAgICAgICAgbmFtZTogaXRlbVJlbmRlci5uYW1lLAogICAgICAgICAgICAgICAgICBvcHRpb25zOiBBcnJheS5pc0FycmF5KGl0ZW1SZW5kZXIub3B0aW9ucykgPyBpdGVtUmVuZGVyLm9wdGlvbnMgOiBbXSwKICAgICAgICAgICAgICAgICAgbXVsdGlwbGU6IGZhbHNlCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBtYXAgPSBPYmplY3QuYXNzaWduKHt9LCBtYXAsIHsKICAgICAgICAgICAgICAgICAgbmVlZE1hcDogZmFsc2UsCiAgICAgICAgICAgICAgICAgIC8vIHBhdHRlcm46ICgoaXRlbVJlbmRlck5hbWUsIGl0ZW1SZW5kZXJUeXBlKSA9PiB7CiAgICAgICAgICAgICAgICAgIC8vICAgc3dpdGNoIChpdGVtUmVuZGVyTmFtZSkgewogICAgICAgICAgICAgICAgICAvLyAgICAgY2FzZSAnJHZ4ZUlucHV0JzoKICAgICAgICAgICAgICAgICAgLy8gICAgICAgLy8gdGV4dCwgc2VhcmNoLCBudW1iZXIsIGludGVnZXIsIGZsb2F0LCBwYXNzd29yZCwgZGF0ZSwgdGltZSwgZGF0ZXRpbWUsIHdlZWssIG1vbnRoLCB5ZWFyCiAgICAgICAgICAgICAgICAgIC8vICAgICAgIHN3aXRjaCAoaXRlbVJlbmRlclR5cGUpIHsKICAgICAgICAgICAgICAgICAgLy8gICAgICAgICBjYXNlICdzdHJpbmcnOgogICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgcmV0dXJuIChzdHIpID0+IHsKICAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgLy8g56m6CiAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgIHN0ciA9IHN0ciAmJiBzdHIudG9TdHJpbmcoKQogICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICByZXR1cm4gIShzdHIgJiYgc3RyLnRyaW0oKSAhPT0gJycpCiAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgY2FzZSAnbnVtYmVyJzoKICAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgIC8vIOaVsOWtlwogICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgcmV0dXJuIChzdHIpID0+IHsKICAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgcmV0dXJuIC9eWzAtOV0qJC8udGVzdChzdHIpCiAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgY2FzZSAnaW50ZWdlcic6CiAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAvLyDmlbDlrZcKICAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgIHJldHVybiAoc3RyKSA9PiB7CiAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICAgIHJldHVybiAvXlsxLTldK1swLTldKiQvLnRlc3Qoc3RyKQogICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAvLyAgICAgICAgIGNhc2UgJ3RpbWUnOgogICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgLy8g5pe26Ze0CiAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICByZXR1cm4gKHN0cikgPT4gewogICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICByZXR1cm4gL15cZCooPzpcLlxkezAsMn0pPyQvLnRlc3Qoc3RyKQogICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAvLyAgICAgICAgIGNhc2UgJ3llYXInOgogICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgLy8g5bm0CiAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICByZXR1cm4gKHN0cikgPT4gewogICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICByZXR1cm4gL15bMSw5XXs0fS8udGVzdChzdHIpCiAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgY2FzZSAnZmxvYXQnOgogICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgLy8gMuS9jeWwj+WPlAogICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgcmV0dXJuIChzdHIpID0+IHsKICAgICAgICAgICAgICAgICAgLy8gICAgICAgICAgICAgcmV0dXJuIC9eLT9cZCtcLj9cZHswLDJ9JC8udGVzdChzdHIpCiAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIC8vICAgICAgIH0KICAgICAgICAgICAgICAgICAgLy8gICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgLy8gICAgIGNhc2UgJyR2eGVNb25leSc6CiAgICAgICAgICAgICAgICAgIC8vICAgICAgIHJldHVybiAoc3RyKSA9PiB7CiAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgcmV0dXJuIC9eLT9cZCtcLj9cZHswLDJ9JC8udGVzdChzdHIpCiAgICAgICAgICAgICAgICAgIC8vICAgICAgIH0KICAgICAgICAgICAgICAgICAgLy8gICAgIGNhc2UgJyR2eGVDYWxjdWxhdGUnOgogICAgICAgICAgICAgICAgICAvLyAgICAgICByZXR1cm4gKHN0cikgPT4gewogICAgICAgICAgICAgICAgICAvLyAgICAgICAgIHJldHVybiAvXi0/XGQrXC4/XGR7MCwyfSQvLnRlc3Qoc3RyKQogICAgICAgICAgICAgICAgICAvLyAgICAgICB9CiAgICAgICAgICAgICAgICAgIC8vICAgICBjYXNlICckdnhlRWRpdERvd25UZXh0YXJlYSc6CiAgICAgICAgICAgICAgICAgIC8vICAgICAgIHJldHVybiAoc3RyKSA9PiB7CiAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgc3RyID0gc3RyICYmIHN0ci50b1N0cmluZygpCiAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgcmV0dXJuICEoc3RyICYmIHN0ci50cmltKCkgIT09ICcnKQogICAgICAgICAgICAgICAgICAvLyAgICAgICB9CiAgICAgICAgICAgICAgICAgIC8vICAgICBjYXNlICckdnhlRGF5cyc6IHsKICAgICAgICAgICAgICAgICAgLy8gICAgICAgcmV0dXJuIChzdHIpID0+IHsKICAgICAgICAgICAgICAgICAgLy8gICAgICAgICByZXR1cm4gL14tP1xkK1wuP1xkezAsMn0kLy50ZXN0KHN0cikKICAgICAgICAgICAgICAgICAgLy8gICAgICAgfQogICAgICAgICAgICAgICAgICAvLyAgICAgfQogICAgICAgICAgICAgICAgICAvLyAgICAgY2FzZSAnJHZ4ZVRpbWUnOiB7CiAgICAgICAgICAgICAgICAgIC8vICAgICAgIHJldHVybiAoc3RyKSA9PiB7CiAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgcmV0dXJuIC9eLT9cZCtcLj9cZHswLDJ9JC8udGVzdChzdHIpCiAgICAgICAgICAgICAgICAgIC8vICAgICAgIH0KICAgICAgICAgICAgICAgICAgLy8gICAgIH0KICAgICAgICAgICAgICAgICAgLy8gICAgIGNhc2UgJyR2eGVUZXh0JzogewogICAgICAgICAgICAgICAgICAvLyAgICAgICByZXR1cm4gKHN0cikgPT4gewogICAgICAgICAgICAgICAgICAvLyAgICAgICAgIHJldHVybiAvXi0/XGQrXC4/XGR7MCwyfSQvLnRlc3Qoc3RyKQogICAgICAgICAgICAgICAgICAvLyAgICAgICB9CiAgICAgICAgICAgICAgICAgIC8vICAgICB9CgogICAgICAgICAgICAgICAgICAvLyAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgLy8gICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgLy8gICB9CiAgICAgICAgICAgICAgICAgIC8vIH0pKGl0ZW1SZW5kZXIubmFtZSwgaXRlbVJlbmRlci5wcm9wcyAmJiBpdGVtUmVuZGVyLnByb3BzLnR5cGUpLAogICAgICAgICAgICAgICAgICBuYW1lOiBpdGVtUmVuZGVyLm5hbWUsCiAgICAgICAgICAgICAgICAgIG9wdGlvbnM6IEFycmF5LmlzQXJyYXkoaXRlbVJlbmRlci5vcHRpb25zKSA/IGl0ZW1SZW5kZXIub3B0aW9ucyA6IFtdLAogICAgICAgICAgICAgICAgICBtdWx0aXBsZTogZmFsc2UKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG1hcCA9IE9iamVjdC5hc3NpZ24oe30sIG1hcCwgewogICAgICAgICAgICAgIG5lZWRNYXA6IGZhbHNlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgb2JqLnZpZXdUb1NvdXJjZU1hcFtjb25sdW0uZmllbGRdID0gbWFwOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gb2JqOwogIH0sCiAgaXNFZGl0Rm9yRm9ybXVsYTogZnVuY3Rpb24gaXNFZGl0Rm9yRm9ybXVsYShyb3csIHJvd0luZGV4LCBjb2x1bW4sIGNvbHVtbkluZGV4KSB7CiAgICB2YXIgaXNGb3JGb3JtdWxhRGF0YSA9IGNvbHVtbi5wcm9wZXJ0eSArICc6JyArIHJvdy5pdGVtY29kZTsKICAgIHZhciBpc0ZvckZvcm11bGEgPSB0cnVlOwogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgaWYgKHNlbGYuY2FsY3VsYXRlQ29uc3RyYWludENvbmZpZ0luLnJvd0NvZGVGb3JtdWxhQ29uZmlnW2lzRm9yRm9ybXVsYURhdGFdIHx8IHNlbGYuY2FsY3VsYXRlQ29uc3RyYWludENvbmZpZ0luLmNvbEZvcm11bGFDb25maWdbY29sdW1uLnByb3BlcnR5XSkgewogICAgICBpc0ZvckZvcm11bGEgPSBmYWxzZTsKICAgIH0gZWxzZSB7CiAgICAgIGlzRm9yRm9ybXVsYSA9IHRydWU7CiAgICB9CiAgICByZXR1cm4gaXNGb3JGb3JtdWxhOwogICAgLy8gaWYgKHRoaXMuY2FsY3VsYXRlQ29uc3RyYWludENvbmZpZ0luLmNvbnN0cmFpbnRDb25maWcgPT09ICcnKSB7CiAgICAvLyAgIHJldHVybiB0cnVlCiAgICAvLyB9IGVsc2UgewogICAgLy8gICByZXR1cm4gZmFsc2UKICAgIC8vIH0KICB9LAogIGlzQWN0aXZlQ2VsbEVkaXQ6IGZ1bmN0aW9uIGlzQWN0aXZlQ2VsbEVkaXQoX3JlZjIzKSB7CiAgICB2YXIgcm93ID0gX3JlZjIzLnJvdywKICAgICAgcm93SW5kZXggPSBfcmVmMjMucm93SW5kZXgsCiAgICAgIGNvbHVtbiA9IF9yZWYyMy5jb2x1bW4sCiAgICAgIGNvbHVtbkluZGV4ID0gX3JlZjIzLmNvbHVtbkluZGV4OwogICAgdmFyIGlzRWRpdEZvckZvcm11bGEgPSB0aGlzLmlzRWRpdEZvckZvcm11bGEocm93LCByb3dJbmRleCwgY29sdW1uLCBjb2x1bW5JbmRleCk7CiAgICByZXR1cm4gaXNFZGl0Rm9yRm9ybXVsYTsKICB9Cn07CnZhciBjYWxjQW5kQ29uc3RyYWludCA9IHsKICAvLyDorqHnrpfnuqbmnZ/pg6jliIYKICAvLyDmiafooYzpobrluo/vvJog5Y+W5pWwLS0+IOihjOWGheiuoeeuly0tPiDliIbnuqfmsYfmgLstLT4g54i257qn6KGM5YaF6K6h566XLS0+IOWNleWFg+agvOS6pOWPieiuoeeulyjmtonlj4rnmoTooYzorqHnrpcpLS0+IOihjOe6puadny0tPiDljZXlhYPmoLznuqbmnZ8KICBhZGRNaXNzaW5nRmllbGRzOiBmdW5jdGlvbiBhZGRNaXNzaW5nRmllbGRzKHRhYmxlRGF0YSkgewogICAgdmFyIF90aGlzMzEgPSB0aGlzOwogICAgLy8g5re75Yqg57y65aSx5a2X5q615bm25omn6KGM5YWo6YeP5YiX6K6h566XCiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICB0YWJsZURhdGEgPSBBcnJheS5pc0FycmF5KHRhYmxlRGF0YSkgPyB0YWJsZURhdGEgOiBbXTsKICAgIHRhYmxlRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHsKICAgICAgc2VsZi50YWJsZUNvbHVtbnNGaWVsZEFyci5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgICAgcm93W2l0ZW1dID0gX3R5cGVvZihyb3dbaXRlbV0pICE9PSAnb2JqZWN0JyA/IHJvd1tpdGVtXSA9PT0gdW5kZWZpbmVkID8gJycgOiByb3dbaXRlbV0gOiByb3dbaXRlbV0gPT09IG51bGwgPyAnJyA6IHJvd1tpdGVtXTsKICAgICAgfSk7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KHJvdy5jaGlsZHJlbikgJiYgcm93LmNoaWxkcmVuLmxlbmd0aCAmJiBfdGhpczMxLnRyZWVDb25maWdJbikgewogICAgICAgIHJvdy5jaGlsZHJlbiA9IHNlbGYuYWRkTWlzc2luZ0ZpZWxkcyhyb3cuY2hpbGRyZW4pOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiB0YWJsZURhdGE7CiAgfSwKICAvLyDlj5bmlbAKICBnZW5lcmF0R2V0RGF0YUNvbmZpZ01hcDogZnVuY3Rpb24gZ2VuZXJhdEdldERhdGFDb25maWdNYXAoY2VsbERhdGFDb25maWcpIHsKICAgIC8vIOeUn+aIkOWPluaVsOWSjOWNleWFg+agvOiuoeeulwogICAgLy8gIFt7IGl0ZW1jb2RlOiAiMDAyIiwgaXRlbW5hbWU6ICLkuIDoiKzlhazlhbHpooTnrpciLCBjZWxsczogW3sgaXRlbWNvZGU6ICIwMDIiLCBjb2xGaWVsZDogImYwMDEiLCBpbnB1dFR5cGU6IDEsIGZvcm11bGFTaG93OiAi5o+Q5Y+WIixmb3JtdWxhOid0YWJsZUlkOmNvbEZpZWxkOml0ZW1jb2RlJyB9XSB9XQogICAgdmFyIHJvd0NvZGVGb3JtdWxhQ29uZmlnID0ge307CiAgICB2YXIgZ2V0RGF0YUNvbmZpZyA9IHt9OwogICAgY2VsbERhdGFDb25maWcuZm9yRWFjaChmdW5jdGlvbiAoY2VsbCkgewogICAgICBpZiAoY2VsbC5mb3JtdWxhU2hvdyA9PT0gJ+aPkOWPlicpIHsKICAgICAgICBnZXREYXRhQ29uZmlnW2NlbGwuaXRlbUNvZGUgKyAnOicgKyBjZWxsLmNvbEZpZWxkXSA9IGNlbGwuZm9ybXVsYTsKICAgICAgfSBlbHNlIGlmIChjZWxsLmZvcm11bGFTaG93ID09PSAn6K6h566XJykgewogICAgICAgIHJvd0NvZGVGb3JtdWxhQ29uZmlnW2NlbGwuaXRlbUNvZGUgKyAnOicgKyBjZWxsLmNvbEZpZWxkXSA9IGNlbGwuZm9ybXVsYTsKICAgICAgfSBlbHNlIHt9CiAgICB9KTsKICAgIHRoaXMuY2FsY3VsYXRlQ29uc3RyYWludENvbmZpZ0luLnJvd0NvZGVGb3JtdWxhQ29uZmlnID0gcm93Q29kZUZvcm11bGFDb25maWc7CiAgICB0aGlzLmNhbGN1bGF0ZUNvbnN0cmFpbnRDb25maWdJbi5nZXREYXRhQ29uZmlnID0gZ2V0RGF0YUNvbmZpZzsKICB9LAogIHBlcmZvcm1HZXREYXRhOiBmdW5jdGlvbiBwZXJmb3JtR2V0RGF0YSgpIHsKICAgIHZhciBfdGhpczMyID0gdGhpczsKICAgIC8vIOiOt+WPluaVsOaNrgogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgdmFyIF90aGlzMzIkY2FsY3VsYXRlQ29ucyA9IF90aGlzMzIuY2FsY3VsYXRlQ29uc3RyYWludENvbmZpZ0luLAogICAgICAgIGdldERhdGFBeGlvc0NvbmZpZyA9IF90aGlzMzIkY2FsY3VsYXRlQ29ucy5nZXREYXRhQXhpb3NDb25maWcsCiAgICAgICAgZ2V0RGF0YVBhcmFtcyA9IF90aGlzMzIkY2FsY3VsYXRlQ29ucy5nZXREYXRhUGFyYW1zLAogICAgICAgIGdldERhdGFDb25maWcgPSBfdGhpczMyJGNhbGN1bGF0ZUNvbnMuZ2V0RGF0YUNvbmZpZzsKICAgICAgdmFyIGRhdGFGaWVsZEFyciA9IGdldERhdGFBeGlvc0NvbmZpZy5kYXRhRmllbGQgPyBnZXREYXRhQXhpb3NDb25maWcuZGF0YUZpZWxkLnNwbGl0KCcuJylbMF0gPyBnZXREYXRhQXhpb3NDb25maWcuZGF0YUZpZWxkLnNwbGl0KCcuJykgOiBbJ2RhdGEnXSA6IFsnZGF0YSddOwogICAgICBpZiAoIWdldERhdGFBeGlvc0NvbmZpZy51cmwgfHwgZ2V0RGF0YUF4aW9zQ29uZmlnLmRhdGEpIHsKICAgICAgICByZXNvbHZlKGdldERhdGFDb25maWcpOwogICAgICB9IGVsc2UgewogICAgICAgIHNlbGYuJGh0dHBbZ2V0RGF0YUF4aW9zQ29uZmlnLm1ldGhvZF0oZ2V0RGF0YUF4aW9zQ29uZmlnLnVybCwgT2JqZWN0LmFzc2lnbih7CiAgICAgICAgICB0YWJsZUlkOiBfdGhpczMyLmlkCiAgICAgICAgfSwgZ2V0RGF0YVBhcmFtcyB8fCB7fSkpLnRoZW4oZnVuY3Rpb24gKHJlcykgewogICAgICAgICAgdmFyIHJlc0RhdGEgPSB7fTsKICAgICAgICAgIGlmIChzZWxmLmdldGJhc2ljRGF0YVR5cGUocmVzKSA9PT0gJ0FycmF5JykgewogICAgICAgICAgICByZXNEYXRhID0gcmVzOwogICAgICAgICAgICBzZWxmLiRYTW9kYWwubWVzc2FnZSh7CiAgICAgICAgICAgICAgc3RhdHVzOiAnc3VjY2VzcycsCiAgICAgICAgICAgICAgbWVzc2FnZTogJ+aTjeS9nOaIkOWKnycKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHNlbGYuZ2V0YmFzaWNEYXRhVHlwZShyZXMpID09PSAnT2JqZWN0JykgewogICAgICAgICAgICBpZiAocmVzW2dldERhdGFBeGlvc0NvbmZpZy5zdGF0dXNGaWVsZCB8fCAncnNjb2RlJ10gPT09IChnZXREYXRhQXhpb3NDb25maWcuc3VjY2Vzc0NvZGUgfHwgJzIwMCcpKSB7CiAgICAgICAgICAgICAgZGF0YUZpZWxkQXJyLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7CiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPT09IDApIHsKICAgICAgICAgICAgICAgICAgcmVzRGF0YSA9IHJlc1tpdGVtXTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHJlc0RhdGEgPSByZXNEYXRhW2l0ZW1dOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHJlc29sdmUoc2VsZi5nZW5lcmF0R2V0RGF0YU1hcChyZXNEYXRhKSk7CiAgICAgICAgICAgICAgc2VsZi4kWE1vZGFsLm1lc3NhZ2UoewogICAgICAgICAgICAgICAgc3RhdHVzOiAnc3VjY2VzcycsCiAgICAgICAgICAgICAgICBtZXNzYWdlOiAn5pON5L2c5oiQ5YqfJwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfojrflj5blj5bmoJHmlbDmja7lvILluLjvvIzlvZPliY3ov5Tlm57mlbDmja7kuLrvvJpcbicsIHJlcyk7CiAgICAgICAgICAgICAgc2VsZi4kWE1vZGFsLm1lc3NhZ2UoewogICAgICAgICAgICAgICAgc3RhdHVzOiAnZXJyb3InLAogICAgICAgICAgICAgICAgbWVzc2FnZTogJ+iOt+WPluWPluagkeaVsOaNruW8guW4uCcKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICByZWplY3QocmVzKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc29sZS5sb2coJ+iOt+WPluWPluaVsOaVsOaNruW8guW4uO+8jOW9k+WJjei/lOWbnuaVsOaNruS4uu+8mlxuJywgcmVzKTsKICAgICAgICAgICAgc2VsZi4kWE1vZGFsLm1lc3NhZ2UoewogICAgICAgICAgICAgIHN0YXR1czogJ2Vycm9yJywKICAgICAgICAgICAgICBtZXNzYWdlOiAn6I635Y+W5Y+W5qCR5pWw5o2u5byC5bi4JwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmVqZWN0KHJlcyk7CiAgICAgICAgICB9CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHNlbGYuJFhNb2RhbC5tZXNzYWdlKHsKICAgICAgICAgICAgc3RhdHVzOiAnZXJyb3InLAogICAgICAgICAgICBtZXNzYWdlOiAn6I635Y+W5Y+W5qCR5pWw5o2u5byC5bi4JwogICAgICAgICAgfSk7CiAgICAgICAgICByZWplY3QoZSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0pOwogIH0sCiAgZ2VuZXJhdEdldERhdGFNYXA6IGZ1bmN0aW9uIGdlbmVyYXRHZXREYXRhTWFwKHJlcykgewogICAgLy8g55Sf5oiQ5Y+W5pWwbWFwCiAgICAvLyAgW3sgaXRlbUNvZGU6ICIwMDIiLCBjb2xGaWVsZDogImYwMDUiLCB2YWx1ZTogIjE1MDAuMCIgfSwgeyBpdGVtQ29kZTogIjAwMjAwMSIsIGNvbEZpZWxkOiAiZjAwNSIsIHZhbHVlOiAiNTAwLjAiIH1dCiAgICB2YXIgZ2V0RGF0YVJlbmRlck1hcCA9IHt9OwogICAgcmVzLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7CiAgICAgIGdldERhdGFSZW5kZXJNYXBbaXRlbS5pdGVtQ29kZSArICc6JyArIGl0ZW0uY29sRmllbGRdID0gaXRlbS52YWx1ZTsKICAgIH0pOwogICAgdGhpcy5jYWxjdWxhdGVDb25zdHJhaW50Q29uZmlnSW4uZ2V0RGF0YVJlbmRlck1hcCA9IGdldERhdGFSZW5kZXJNYXA7CiAgICByZXR1cm4gZ2V0RGF0YVJlbmRlck1hcDsKICB9LAogIC8vIOWFqOmHj+iuoeeul+WSjOeUn+aIkOe6puadn+aVsOaNrgogIHBlcmZvcm1HZXREYXRhT3B0aW9uOiBmdW5jdGlvbiBwZXJmb3JtR2V0RGF0YU9wdGlvbihkYXRhKSB7CiAgICAvLyDmiafooYzlj5bmlbAg5bm2IOmHjeaWsOiuoeeul+WSjOaJp+ihjOe6puadn+W5tua4suafk+ihqOagvAogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgc2VsZi5wZXJmb3JtR2V0RGF0YSgpLnRoZW4oZnVuY3Rpb24gKGdldERhdGFSZW5kZXJNYXApIHsKICAgICAgICBzZWxmLmNhbGN1bGF0ZUNvbnN0cmFpbnRDb25maWdJbi5nZXREYXRhUmVuZGVyTWFwID0gZ2V0RGF0YVJlbmRlck1hcDsKICAgICAgICBzZWxmLnJlUGVyZm9ybUFsbENhbGNBbmRDb25zdHJhaW50QnlEYXRhKGRhdGEgfHwgc2VsZi5nZXRUYWJsZURhdGEoKS5mdWxsRGF0YSkudGhlbihmdW5jdGlvbiAoX3JlZjI0KSB7CiAgICAgICAgICB2YXIgZGF0YUNvZGVSb3dNYXAgPSBfcmVmMjQuZGF0YUNvZGVSb3dNYXAsCiAgICAgICAgICAgIGRhdGFDb2RlUm93QXJyID0gX3JlZjI0LmRhdGFDb2RlUm93QXJyLAogICAgICAgICAgICBhZnRlckNhbGNEYXRhID0gX3JlZjI0LmFmdGVyQ2FsY0RhdGE7CiAgICAgICAgICByZXNvbHZlKGRhdGEpOwogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICByZWplY3QoZSk7CiAgICAgICAgfSk7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgcmVqZWN0KGUpOwogICAgICB9KTsKICAgIH0pOwogIH0sCiAgcmVQZXJmb3JtUm93Q2FsY0FuZENvbnN0cmFpbnRBbGxBbmRSZXJlbmRlcjogZnVuY3Rpb24gcmVQZXJmb3JtUm93Q2FsY0FuZENvbnN0cmFpbnRBbGxBbmRSZXJlbmRlcihkYXRhKSB7CiAgICAvLyDmiafooYzooYzmiYDorr7orqHnmoTmiYDmnInorqHnrpfnuqbmnZ/lubbph43mlrDmuLLmn5MKICAgIHZhciBzZWxmID0gdGhpczsKICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgIHNlbGYucmVQZXJmb3JtQWxsQ2FsY0FuZENvbnN0cmFpbnRCeURhdGEoZGF0YSkudGhlbihmdW5jdGlvbiAoX3JlZjI1KSB7CiAgICAgICAgdmFyIGRhdGFDb2RlUm93TWFwID0gX3JlZjI1LmRhdGFDb2RlUm93TWFwLAogICAgICAgICAgZGF0YUNvZGVSb3dBcnIgPSBfcmVmMjUuZGF0YUNvZGVSb3dBcnIsCiAgICAgICAgICBhZnRlckNhbGNEYXRhID0gX3JlZjI1LmFmdGVyQ2FsY0RhdGE7CiAgICAgICAgc2VsZi51cGRhdGVGb290ZXIoKS50aGVuKGZ1bmN0aW9uICgpIHt9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgdGhyb3cgZTsKICAgICAgICB9KTsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICB0aHJvdyBlOwogICAgICB9KTsKICAgIH0pOwogIH0sCiAgcmVQZXJmb3JtQWxsQ2FsY0FuZENvbnN0cmFpbnRCeURhdGE6IGZ1bmN0aW9uIHJlUGVyZm9ybUFsbENhbGNBbmRDb25zdHJhaW50QnlEYXRhKGRhdGEpIHsKICAgIHZhciBfdGhpczMzID0gdGhpczsKICAgIC8vIOmHjeaWsOiuoeeul+WSjOeUn+aIkOe6puadn+aVsOaNrgogICAgLy8g5omn6KGM6aG65bqP77yaIOWPluaVsC0tPiDooYzlhoXorqHnrpctLT4g5YiG57qn5rGH5oC7LS0+IOeItue6p+ihjOWGheiuoeeuly0tPiDljZXlhYPmoLzkuqTlj4norqHnrpco5raJ5Y+K55qE6KGM6K6h566XKS0tPiDooYznuqbmnZ8tLT4g5Y2V5YWD5qC857qm5p2fCiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICB0cnkgewogICAgICAgIGlmIChBcnJheS5pc0FycmF5ICYmIGRhdGEubGVuZ3RoKSB7CiAgICAgICAgICB2YXIgX3NlbGYkY2FsY3VsYXRlQ29uc3RyMiA9IHNlbGYuY2FsY3VsYXRlQ29uc3RyYWludENvbmZpZ0luLAogICAgICAgICAgICBlbmFibGVkVHlwZSA9IF9zZWxmJGNhbGN1bGF0ZUNvbnN0cjIuZW5hYmxlZFR5cGUsCiAgICAgICAgICAgIGNvbEZvcm11bGFDb25maWcgPSBfc2VsZiRjYWxjdWxhdGVDb25zdHIyLmNvbEZvcm11bGFDb25maWcsCiAgICAgICAgICAgIGNhbGNBbmRDb25zdHJhaW50VGFibGVJZCA9IF9zZWxmJGNhbGN1bGF0ZUNvbnN0cjIuY2FsY0FuZENvbnN0cmFpbnRUYWJsZUlkLAogICAgICAgICAgICBkYXRhVHlwZSA9IF9zZWxmJGNhbGN1bGF0ZUNvbnN0cjIuZGF0YVR5cGUsCiAgICAgICAgICAgIGNhbGNBbmRDb25zdHJhaW50SXRlbUNvZGVGaWVsZCA9IF9zZWxmJGNhbGN1bGF0ZUNvbnN0cjIuY2FsY0FuZENvbnN0cmFpbnRJdGVtQ29kZUZpZWxkLAogICAgICAgICAgICByb3dDb2RlRm9ybXVsYUNvbmZpZyA9IF9zZWxmJGNhbGN1bGF0ZUNvbnN0cjIucm93Q29kZUZvcm11bGFDb25maWcsCiAgICAgICAgICAgIGNvbENvbnN0cmFpbnRDb25maWcgPSBfc2VsZiRjYWxjdWxhdGVDb25zdHIyLmNvbENvbnN0cmFpbnRDb25maWcsCiAgICAgICAgICAgIHJvd0NvZGVDb25zdHJhaW50Q29uZmlnID0gX3NlbGYkY2FsY3VsYXRlQ29uc3RyMi5yb3dDb2RlQ29uc3RyYWludENvbmZpZywKICAgICAgICAgICAgZ2V0RGF0YVJlbmRlck1hcCA9IF9zZWxmJGNhbGN1bGF0ZUNvbnN0cjIuZ2V0RGF0YVJlbmRlck1hcCwKICAgICAgICAgICAgZ3JhZGVkU3VtbWFyeUZpZWxkcyA9IF9zZWxmJGNhbGN1bGF0ZUNvbnN0cjIuZ3JhZGVkU3VtbWFyeUZpZWxkcywKICAgICAgICAgICAgZW5hYmxlZCA9IF9zZWxmJGNhbGN1bGF0ZUNvbnN0cjIuZW5hYmxlZDsKICAgICAgICAgIGlmIChlbmFibGVkKSB7CiAgICAgICAgICAgIHZhciBpc1RyZWVEYXRhID0gZGF0YVR5cGUgPT09IHVuZGVmaW5lZCA/IHNlbGYudHJlZUNvbmZpZ0luIDogZGF0YVR5cGUgPT09ICd0cmVlJyA/IDEgOiAwOwogICAgICAgICAgICB2YXIgdGFibGVJZCA9IGNhbGNBbmRDb25zdHJhaW50VGFibGVJZCB8fCBzZWxmLmlkOwogICAgICAgICAgICB2YXIgdHJlZURhdGEgPSBfdGhpczMzLmdldERhdGFDb2RlVHJlZURhdGEoZGF0YSwgY2FsY0FuZENvbnN0cmFpbnRJdGVtQ29kZUZpZWxkLCBzZWxmLmdyYWRlZFN1bW1hcnlGaWVsZHMgfHwgZ3JhZGVkU3VtbWFyeUZpZWxkcywgaXNUcmVlRGF0YSk7CiAgICAgICAgICAgIHZhciBfc2VsZiRyZWN1cnNpdmVEYXRhQ28yID0gc2VsZi5yZWN1cnNpdmVEYXRhQ29kZVJvd01hcCh0cmVlRGF0YSwgY2FsY0FuZENvbnN0cmFpbnRJdGVtQ29kZUZpZWxkLCB0cnVlKSwKICAgICAgICAgICAgICBkYXRhQ29kZVJvd01hcCA9IF9zZWxmJHJlY3Vyc2l2ZURhdGFDbzIuZGF0YUNvZGVSb3dNYXAsCiAgICAgICAgICAgICAgZGF0YUNvZGVSb3dBcnIgPSBfc2VsZiRyZWN1cnNpdmVEYXRhQ28yLmRhdGFDb2RlUm93QXJyOwogICAgICAgICAgICBpZiAoZW5hYmxlZFR5cGUucGVyZm9ybUdldERhdGEpIHsKICAgICAgICAgICAgICBzZWxmLnBlcmZvcm1HZXREYXRhQWxsKHsKICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEsCiAgICAgICAgICAgICAgICBkYXRhQ29kZVJvd01hcDogZGF0YUNvZGVSb3dNYXAsCiAgICAgICAgICAgICAgICBkYXRhQ29kZVJvd0FycjogZGF0YUNvZGVSb3dBcnIsCiAgICAgICAgICAgICAgICBnZXREYXRhUmVuZGVyTWFwOiBnZXREYXRhUmVuZGVyTWFwLAogICAgICAgICAgICAgICAgdGFibGVJZDogdGFibGVJZAogICAgICAgICAgICAgIH0pOyAvLyDmuLLmn5Plj5bmlbAKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGVuYWJsZWRUeXBlLnBlcmZvcm1Db2xGb3JtdWxhKSB7CiAgICAgICAgICAgICAgc2VsZi5wZXJmb3JtQ29sRm9ybXVsYUFsbCh7CiAgICAgICAgICAgICAgICBkYXRhOiBkYXRhLAogICAgICAgICAgICAgICAgZGF0YUNvZGVSb3dNYXA6IGRhdGFDb2RlUm93TWFwLAogICAgICAgICAgICAgICAgZGF0YUNvZGVSb3dBcnI6IGRhdGFDb2RlUm93QXJyLAogICAgICAgICAgICAgICAgZ3JhZGVkU3VtbWFyeUZpZWxkczogc2VsZi5ncmFkZWRTdW1tYXJ5RmllbGRzIHx8IGdyYWRlZFN1bW1hcnlGaWVsZHMsCiAgICAgICAgICAgICAgICBjb2xGb3JtdWxhQ29uZmlnOiBjb2xGb3JtdWxhQ29uZmlnLAogICAgICAgICAgICAgICAgdGFibGVJZDogdGFibGVJZCwKICAgICAgICAgICAgICAgIGNhbGNDb2xUeXBlOiAnbGFzdExldmVsJwogICAgICAgICAgICAgIH0pOyAvLyDooYzlhoXorqHnrpcKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGVuYWJsZWRUeXBlLmdyYWRlZFN1bW1hcnkpIHsKICAgICAgICAgICAgICBzZWxmLnBlcmZvcm1HcmFkZWRTdW1tYXJ5QWxsKHsKICAgICAgICAgICAgICAgIGRhdGE6IHRyZWVEYXRhLAogICAgICAgICAgICAgICAgZGF0YUNvZGVSb3dNYXA6IGRhdGFDb2RlUm93TWFwLAogICAgICAgICAgICAgICAgZGF0YUNvZGVSb3dBcnI6IGRhdGFDb2RlUm93QXJyLAogICAgICAgICAgICAgICAgZ3JhZGVkU3VtbWFyeUZpZWxkczogc2VsZi5ncmFkZWRTdW1tYXJ5RmllbGRzIHx8IGdyYWRlZFN1bW1hcnlGaWVsZHMsCiAgICAgICAgICAgICAgICB0YWJsZUlkOiB0YWJsZUlkCiAgICAgICAgICAgICAgfSk7IC8vIOWIhue6p+axh+aAuwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZW5hYmxlZFR5cGUucGVyZm9ybUNvbEZvcm11bGEpIHsKICAgICAgICAgICAgICBzZWxmLnBlcmZvcm1Db2xGb3JtdWxhQWxsKHsKICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEsCiAgICAgICAgICAgICAgICBkYXRhQ29kZVJvd01hcDogZGF0YUNvZGVSb3dNYXAsCiAgICAgICAgICAgICAgICBkYXRhQ29kZVJvd0FycjogZGF0YUNvZGVSb3dBcnIsCiAgICAgICAgICAgICAgICBncmFkZWRTdW1tYXJ5RmllbGRzOiBzZWxmLmdyYWRlZFN1bW1hcnlGaWVsZHMgfHwgZ3JhZGVkU3VtbWFyeUZpZWxkcywKICAgICAgICAgICAgICAgIGNvbEZvcm11bGFDb25maWc6IGNvbEZvcm11bGFDb25maWcsCiAgICAgICAgICAgICAgICB0YWJsZUlkOiB0YWJsZUlkLAogICAgICAgICAgICAgICAgY2FsY0NvbFR5cGU6ICdwYXJlbnQnCiAgICAgICAgICAgICAgfSk7IC8vIOeItue6p+ihjOWGheiuoeeulwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZW5hYmxlZFR5cGUucGVyZm9ybVJvd0NvZGVGb3JtdWxhKSB7CiAgICAgICAgICAgICAgc2VsZi5wZXJmb3JtUm93Q29kZUZvcm11bGEoewogICAgICAgICAgICAgICAgZGF0YTogZGF0YSwKICAgICAgICAgICAgICAgIGRhdGFDb2RlUm93TWFwOiBkYXRhQ29kZVJvd01hcCwKICAgICAgICAgICAgICAgIGRhdGFDb2RlUm93QXJyOiBkYXRhQ29kZVJvd0FyciwKICAgICAgICAgICAgICAgIHJvd0NvZGVGb3JtdWxhQ29uZmlnOiByb3dDb2RlRm9ybXVsYUNvbmZpZywKICAgICAgICAgICAgICAgIHRhYmxlSWQ6IHRhYmxlSWQKICAgICAgICAgICAgICB9KTsgLy8g5Y2V5YWD5qC85Lqk5Y+J6K6h566XCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChlbmFibGVkVHlwZS5wZXJmb3JtQ29sQ29uc3RyYWludCkgewogICAgICAgICAgICAgIHNlbGYucGVyZm9ybVJvd0NvbnN0cmFpbnRBbGwoewogICAgICAgICAgICAgICAgZGF0YTogZGF0YSwKICAgICAgICAgICAgICAgIGRhdGFDb2RlUm93TWFwOiBkYXRhQ29kZVJvd01hcCwKICAgICAgICAgICAgICAgIGRhdGFDb2RlUm93QXJyOiBkYXRhQ29kZVJvd0FyciwKICAgICAgICAgICAgICAgIGNvbENvbnN0cmFpbnRDb25maWc6IGNvbENvbnN0cmFpbnRDb25maWcsCiAgICAgICAgICAgICAgICB0YWJsZUlkOiB0YWJsZUlkCiAgICAgICAgICAgICAgfSk7IC8vIOihjOWGhee6puadnwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZW5hYmxlZFR5cGUucGVyZm9ybUNlbGxDb25zdHJhaW50KSB7CiAgICAgICAgICAgICAgc2VsZi5wZXJmb3JtQ2VsbENvbnN0cmFpbnRBbGwoewogICAgICAgICAgICAgICAgZGF0YTogZGF0YSwKICAgICAgICAgICAgICAgIGRhdGFDb2RlUm93TWFwOiBkYXRhQ29kZVJvd01hcCwKICAgICAgICAgICAgICAgIGRhdGFDb2RlUm93QXJyOiBkYXRhQ29kZVJvd0FyciwKICAgICAgICAgICAgICAgIHJvd0NvZGVDb25zdHJhaW50Q29uZmlnOiByb3dDb2RlQ29uc3RyYWludENvbmZpZywKICAgICAgICAgICAgICAgIHRhYmxlSWQ6IHRhYmxlSWQKICAgICAgICAgICAgICB9KTsgLy8g5Y2V5YWD5qC857qm5p2fCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChlbmFibGVkVHlwZS5wZXJmb3JtQ29sQ29uc3RyYWludCB8fCBlbmFibGVkVHlwZS5wZXJmb3JtQ2VsbENvbnN0cmFpbnQpIHsKICAgICAgICAgICAgICBzZWxmLnVwZGF0ZWREYXRhQWZ0ZXJDb25zdHJhaW50KHsKICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEsCiAgICAgICAgICAgICAgICBjb25zdHJhaW5Sb3dEYXRhTWFwOiBzZWxmLmNvbnN0cmFpblJvd0RhdGFNYXAsCiAgICAgICAgICAgICAgICBkYXRhQ29kZVJvd01hcDogZGF0YUNvZGVSb3dNYXAsCiAgICAgICAgICAgICAgICBkYXRhQ29kZVJvd0FycjogZGF0YUNvZGVSb3dBcnIKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXNvbHZlKHsKICAgICAgICAgICAgICBkYXRhQ29kZVJvd01hcDogZGF0YUNvZGVSb3dNYXAsCiAgICAgICAgICAgICAgZGF0YUNvZGVSb3dBcnI6IGRhdGFDb2RlUm93QXJyLAogICAgICAgICAgICAgIGFmdGVyQ2FsY0RhdGE6IGRhdGEKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXNvbHZlKHsKICAgICAgICAgICAgICBkYXRhQ29kZVJvd01hcDoge30sCiAgICAgICAgICAgICAgZGF0YUNvZGVSb3dBcnI6IGRhdGEsCiAgICAgICAgICAgICAgYWZ0ZXJDYWxjRGF0YTogZGF0YQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmVzb2x2ZSh7CiAgICAgICAgICAgIGRhdGFDb2RlUm93TWFwOiB7fSwKICAgICAgICAgICAgZGF0YUNvZGVSb3dBcnI6IFtdLAogICAgICAgICAgICBhZnRlckNhbGNEYXRhOiBbXQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgcmVqZWN0KGUpOwogICAgICB9CiAgICB9KTsKICB9LAogIHJlUGVyZm9ybVJvd0NhbGNBbmRDb25zdHJhaW50U2luZ2xlQW5kUmVyZW5kZXI6IGZ1bmN0aW9uIHJlUGVyZm9ybVJvd0NhbGNBbmRDb25zdHJhaW50U2luZ2xlQW5kUmVyZW5kZXIob2JqKSB7CiAgICAvLyDmiafooYzooYzmiYDmtonlj4rnmoTmiYDmnInorqHnrpfnuqbmnZ/lubbph43mlrDmuLLmn5MKICAgIHZhciBzZWxmID0gdGhpczsKICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgIHNlbGYucmVQZXJmb3JtUm93Q2FsY0FuZENvbnN0cmFpbnRTaW5nbGUob2JqKS50aGVuKGZ1bmN0aW9uIChfcmVmMjYpIHsKICAgICAgICB2YXIgcm93ID0gX3JlZjI2LnJvdywKICAgICAgICAgIGRhdGEgPSBfcmVmMjYuZGF0YSwKICAgICAgICAgIGRhdGFDb2RlUm93TWFwID0gX3JlZjI2LmRhdGFDb2RlUm93TWFwLAogICAgICAgICAgZGF0YUNvZGVSb3dBcnIgPSBfcmVmMjYuZGF0YUNvZGVSb3dBcnI7CiAgICAgICAgc2VsZi51cGRhdGVGb290ZXIoKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHJlc29sdmUodHJ1ZSk7CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICAgIHJlc29sdmUoZmFsc2UpOwogICAgICAgIH0pOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgIHJlc29sdmUoZmFsc2UpOwogICAgICB9KTsKICAgIH0pOwogIH0sCiAgcmVQZXJmb3JtUm93Q2FsY0FuZENvbnN0cmFpbnRTaW5nbGU6IGZ1bmN0aW9uIHJlUGVyZm9ybVJvd0NhbGNBbmRDb25zdHJhaW50U2luZ2xlKF9yZWYyNykgewogICAgdmFyIF90aGlzMzQgPSB0aGlzOwogICAgdmFyIHJvdyA9IF9yZWYyNy5yb3csCiAgICAgIGRhdGEgPSBfcmVmMjcuZGF0YSwKICAgICAgY29sdW1uID0gX3JlZjI3LmNvbHVtbjsKICAgIC8vIOmHjeaWsOiuoeeul+WSjOeUn+aIkOWNleadoee6puadn+aVsOaNrgogICAgLy8g5omn6KGM6aG65bqP77yaIOWPluaVsC0tPuihjOWGheiuoeeuly0tPuWIhue6p+axh+aAuy0tPueItue6p+ihjOWGheiuoeeuly0tPuWNleWFg+agvOS6pOWPieiuoeeulyjmtonlj4rnmoTooYzorqHnrpcpLS0+6KGM57qm5p2fLS0+5Y2V5YWD5qC857qm5p2fCiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICB0cnkgewogICAgICAgIHZhciBfc2VsZiRjYWxjdWxhdGVDb25zdHIzID0gc2VsZi5jYWxjdWxhdGVDb25zdHJhaW50Q29uZmlnSW4sCiAgICAgICAgICBlbmFibGVkVHlwZSA9IF9zZWxmJGNhbGN1bGF0ZUNvbnN0cjMuZW5hYmxlZFR5cGUsCiAgICAgICAgICBjb2xGb3JtdWxhQ29uZmlnID0gX3NlbGYkY2FsY3VsYXRlQ29uc3RyMy5jb2xGb3JtdWxhQ29uZmlnLAogICAgICAgICAgY2FsY0FuZENvbnN0cmFpbnRUYWJsZUlkID0gX3NlbGYkY2FsY3VsYXRlQ29uc3RyMy5jYWxjQW5kQ29uc3RyYWludFRhYmxlSWQsCiAgICAgICAgICBkYXRhVHlwZSA9IF9zZWxmJGNhbGN1bGF0ZUNvbnN0cjMuZGF0YVR5cGUsCiAgICAgICAgICBjYWxjQW5kQ29uc3RyYWludEl0ZW1Db2RlRmllbGQgPSBfc2VsZiRjYWxjdWxhdGVDb25zdHIzLmNhbGNBbmRDb25zdHJhaW50SXRlbUNvZGVGaWVsZCwKICAgICAgICAgIGNvbENvbnN0cmFpbnRDb25maWcgPSBfc2VsZiRjYWxjdWxhdGVDb25zdHIzLmNvbENvbnN0cmFpbnRDb25maWcsCiAgICAgICAgICByb3dDb2RlQ29uc3RyYWludENvbmZpZyA9IF9zZWxmJGNhbGN1bGF0ZUNvbnN0cjMucm93Q29kZUNvbnN0cmFpbnRDb25maWcsCiAgICAgICAgICByb3dDb2RlRm9ybXVsYUNvbmZpZyA9IF9zZWxmJGNhbGN1bGF0ZUNvbnN0cjMucm93Q29kZUZvcm11bGFDb25maWcsCiAgICAgICAgICBncmFkZWRTdW1tYXJ5RmllbGRzID0gX3NlbGYkY2FsY3VsYXRlQ29uc3RyMy5ncmFkZWRTdW1tYXJ5RmllbGRzLAogICAgICAgICAgZW5hYmxlZCA9IF9zZWxmJGNhbGN1bGF0ZUNvbnN0cjMuZW5hYmxlZDsKICAgICAgICBpZiAoZW5hYmxlZCkgewogICAgICAgICAgdmFyIGlzVHJlZURhdGEgPSBkYXRhVHlwZSA9PT0gdW5kZWZpbmVkID8gc2VsZi50cmVlQ29uZmlnSW4gOiBkYXRhVHlwZSA9PT0gJ3RyZWUnID8gMSA6IDA7CiAgICAgICAgICB2YXIgdGFibGVJZCA9IGNhbGNBbmRDb25zdHJhaW50VGFibGVJZCB8fCBzZWxmLmlkOwogICAgICAgICAgdmFyIHRyZWVEYXRhID0gX3RoaXMzNC5nZXREYXRhQ29kZVRyZWVEYXRhKGRhdGEsIGNhbGNBbmRDb25zdHJhaW50SXRlbUNvZGVGaWVsZCwgc2VsZi5ncmFkZWRTdW1tYXJ5RmllbGRzIHx8IGdyYWRlZFN1bW1hcnlGaWVsZHMsIGlzVHJlZURhdGEpOwogICAgICAgICAgdmFyIF9zZWxmJHJlY3Vyc2l2ZURhdGFDbzMgPSBzZWxmLnJlY3Vyc2l2ZURhdGFDb2RlUm93TWFwKHRyZWVEYXRhLCBjYWxjQW5kQ29uc3RyYWludEl0ZW1Db2RlRmllbGQsIHRydWUpLAogICAgICAgICAgICBkYXRhQ29kZVJvd01hcCA9IF9zZWxmJHJlY3Vyc2l2ZURhdGFDbzMuZGF0YUNvZGVSb3dNYXAsCiAgICAgICAgICAgIGRhdGFDb2RlUm93QXJyID0gX3NlbGYkcmVjdXJzaXZlRGF0YUNvMy5kYXRhQ29kZVJvd0FycjsKICAgICAgICAgIC8vIHNlbGYucGVyZm9ybUdldERhdGFBbGwoeyBkYXRhLCBkYXRhQ29kZVJvd01hcCwgZGF0YUNvZGVSb3dBcnIsIGdldERhdGFSZW5kZXJNYXAsIHRhYmxlSWQ6IHRhYmxlSWQsIHJvdyB9KSAvLyDmuLLmn5Plj5bmlbAKICAgICAgICAgIGlmIChlbmFibGVkVHlwZS5wZXJmb3JtQ29sRm9ybXVsYSkgewogICAgICAgICAgICBzZWxmLnBlcmZvcm1Db2xGb3JtdWxhU2luZ2xlKHsKICAgICAgICAgICAgICBjb2x1bW46IGNvbHVtbiwKICAgICAgICAgICAgICBkYXRhOiBkYXRhLAogICAgICAgICAgICAgIGRhdGFDb2RlUm93TWFwOiBkYXRhQ29kZVJvd01hcCwKICAgICAgICAgICAgICBncmFkZWRTdW1tYXJ5RmllbGRzOiBzZWxmLmdyYWRlZFN1bW1hcnlGaWVsZHMgfHwgZ3JhZGVkU3VtbWFyeUZpZWxkcywKICAgICAgICAgICAgICBjYWxjQW5kQ29uc3RyYWludEl0ZW1Db2RlRmllbGQ6IGNhbGNBbmRDb25zdHJhaW50SXRlbUNvZGVGaWVsZCwKICAgICAgICAgICAgICBkYXRhQ29kZVJvd0FycjogZGF0YUNvZGVSb3dBcnIsCiAgICAgICAgICAgICAgY29sRm9ybXVsYUNvbmZpZzogY29sRm9ybXVsYUNvbmZpZywKICAgICAgICAgICAgICB0YWJsZUlkOiB0YWJsZUlkLAogICAgICAgICAgICAgIHJvdzogcm93LAogICAgICAgICAgICAgIGNhbGNDb2xUeXBlOiAnbGFzdExldmVsJwogICAgICAgICAgICB9KTsgLy8g6KGM5YaF6K6h566XCiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGVuYWJsZWRUeXBlLmdyYWRlZFN1bW1hcnkpIHsKICAgICAgICAgICAgdmFyIGdyYWRlZFN1bW1hcnlSb3cgPSBkYXRhQ29kZVJvd01hcFtyb3dbJ2l0ZW1fX3BOZXN0Q29kZSddLnNwbGl0KCdfJylbMF1dOwogICAgICAgICAgICBpZiAoZ3JhZGVkU3VtbWFyeVJvdykgewogICAgICAgICAgICAgIHNlbGYucGVyZm9ybUdyYWRlZFN1bW1hcnlTaW5nbGUoewogICAgICAgICAgICAgICAgY29sdW1uOiBjb2x1bW4sCiAgICAgICAgICAgICAgICBkYXRhOiB0cmVlRGF0YSwKICAgICAgICAgICAgICAgIGRhdGFDb2RlUm93TWFwOiBkYXRhQ29kZVJvd01hcCwKICAgICAgICAgICAgICAgIGRhdGFDb2RlUm93QXJyOiBkYXRhQ29kZVJvd0FyciwKICAgICAgICAgICAgICAgIGdyYWRlZFN1bW1hcnlGaWVsZHM6IHNlbGYuZ3JhZGVkU3VtbWFyeUZpZWxkcyB8fCBncmFkZWRTdW1tYXJ5RmllbGRzLAogICAgICAgICAgICAgICAgcm93OiBncmFkZWRTdW1tYXJ5Um93LAogICAgICAgICAgICAgICAgdGFibGVJZDogdGFibGVJZAogICAgICAgICAgICAgIH0pOyAvLyDliIbnuqfmsYfmgLsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGlmIChlbmFibGVkVHlwZS5wZXJmb3JtQ29sRm9ybXVsYSkgewogICAgICAgICAgICBzZWxmLnBlcmZvcm1Db2xGb3JtdWxhU2luZ2xlKHsKICAgICAgICAgICAgICBkYXRhOiBkYXRhLAogICAgICAgICAgICAgIGRhdGFDb2RlUm93TWFwOiBkYXRhQ29kZVJvd01hcCwKICAgICAgICAgICAgICBjb2x1bW46IGNvbHVtbiwKICAgICAgICAgICAgICBkYXRhQ29kZVJvd0FycjogZGF0YUNvZGVSb3dBcnIsCiAgICAgICAgICAgICAgY2FsY0FuZENvbnN0cmFpbnRJdGVtQ29kZUZpZWxkOiBjYWxjQW5kQ29uc3RyYWludEl0ZW1Db2RlRmllbGQsCiAgICAgICAgICAgICAgZ3JhZGVkU3VtbWFyeUZpZWxkczogc2VsZi5ncmFkZWRTdW1tYXJ5RmllbGRzIHx8IGdyYWRlZFN1bW1hcnlGaWVsZHMsCiAgICAgICAgICAgICAgY29sRm9ybXVsYUNvbmZpZzogY29sRm9ybXVsYUNvbmZpZywKICAgICAgICAgICAgICByb3c6IHJvdywKICAgICAgICAgICAgICB0YWJsZUlkOiB0YWJsZUlkLAogICAgICAgICAgICAgIGNhbGNDb2xUeXBlOiAncGFyZW50JwogICAgICAgICAgICB9KTsgLy8g54i257qn6KGM5YaF6K6h566XCiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGVuYWJsZWRUeXBlLnBlcmZvcm1Sb3dDb2RlRm9ybXVsYSkgewogICAgICAgICAgICBzZWxmLnBlcmZvcm1Sb3dDb2RlRm9ybXVsYSh7CiAgICAgICAgICAgICAgZGF0YTogZGF0YSwKICAgICAgICAgICAgICBkYXRhQ29kZVJvd01hcDogZGF0YUNvZGVSb3dNYXAsCiAgICAgICAgICAgICAgY29sdW1uOiBjb2x1bW4sCiAgICAgICAgICAgICAgZGF0YUNvZGVSb3dBcnI6IGRhdGFDb2RlUm93QXJyLAogICAgICAgICAgICAgIHJvd0NvZGVGb3JtdWxhQ29uZmlnOiByb3dDb2RlRm9ybXVsYUNvbmZpZywKICAgICAgICAgICAgICB0YWJsZUlkOiB0YWJsZUlkCiAgICAgICAgICAgIH0pOyAvLyDljZXlhYPmoLzkuqTlj4norqHnrpcKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZW5hYmxlZFR5cGUucGVyZm9ybUNvbENvbnN0cmFpbnQpIHsKICAgICAgICAgICAgc2VsZi5wZXJmb3JtUm93Q29uc3RyYWludFNpbmdsZSh7CiAgICAgICAgICAgICAgZGF0YTogZGF0YSwKICAgICAgICAgICAgICByb3c6IHJvdywKICAgICAgICAgICAgICBjb2x1bW46IGNvbHVtbiwKICAgICAgICAgICAgICBkYXRhQ29kZVJvd01hcDogZGF0YUNvZGVSb3dNYXAsCiAgICAgICAgICAgICAgZGF0YUNvZGVSb3dBcnI6IGRhdGFDb2RlUm93QXJyLAogICAgICAgICAgICAgIGNvbENvbnN0cmFpbnRDb25maWc6IGNvbENvbnN0cmFpbnRDb25maWcsCiAgICAgICAgICAgICAgdGFibGVJZDogdGFibGVJZAogICAgICAgICAgICB9KTsgLy8g6KGM5YaF57qm5p2fCiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGVuYWJsZWRUeXBlLnBlcmZvcm1DZWxsQ29uc3RyYWludCkgewogICAgICAgICAgICBzZWxmLnBlcmZvcm1DZWxsQ29uc3RyYWludFNpbmdsZSh7CiAgICAgICAgICAgICAgZGF0YTogZGF0YSwKICAgICAgICAgICAgICByb3c6IHJvdywKICAgICAgICAgICAgICBjb2x1bW46IGNvbHVtbiwKICAgICAgICAgICAgICBkYXRhQ29kZVJvd01hcDogZGF0YUNvZGVSb3dNYXAsCiAgICAgICAgICAgICAgZGF0YUNvZGVSb3dBcnI6IGRhdGFDb2RlUm93QXJyLAogICAgICAgICAgICAgIHJvd0NvZGVDb25zdHJhaW50Q29uZmlnOiByb3dDb2RlQ29uc3RyYWludENvbmZpZywKICAgICAgICAgICAgICB0YWJsZUlkOiB0YWJsZUlkCiAgICAgICAgICAgIH0pOyAvLyDljZXlhYPmoLznuqbmnZ8KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZW5hYmxlZFR5cGUucGVyZm9ybUNvbENvbnN0cmFpbnQgfHwgZW5hYmxlZFR5cGUucGVyZm9ybUNlbGxDb25zdHJhaW50KSB7CiAgICAgICAgICAgIHNlbGYudXBkYXRlZERhdGFBZnRlckNvbnN0cmFpbnQoewogICAgICAgICAgICAgIGRhdGE6IGRhdGEsCiAgICAgICAgICAgICAgY29uc3RyYWluUm93RGF0YU1hcDogc2VsZi5jb25zdHJhaW5Sb3dEYXRhTWFwLAogICAgICAgICAgICAgIGRhdGFDb2RlUm93TWFwOiBkYXRhQ29kZVJvd01hcCwKICAgICAgICAgICAgICBkYXRhQ29kZVJvd0FycjogZGF0YUNvZGVSb3dBcnIKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXNvbHZlKHsKICAgICAgICAgICAgcm93OiByb3csCiAgICAgICAgICAgIGRhdGE6IGRhdGEsCiAgICAgICAgICAgIGRhdGFDb2RlUm93TWFwOiBkYXRhQ29kZVJvd01hcCwKICAgICAgICAgICAgZGF0YUNvZGVSb3dBcnI6IGRhdGFDb2RlUm93QXJyCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmVzb2x2ZSh7CiAgICAgICAgICAgIHJvdzogcm93LAogICAgICAgICAgICBkYXRhOiBkYXRhLAogICAgICAgICAgICBkYXRhQ29kZVJvd01hcDoge30sCiAgICAgICAgICAgIGRhdGFDb2RlUm93QXJyOiBkYXRhCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICBjb25zb2xlLmVycm9yKGUpOwogICAgICAgIHJlamVjdChlKTsKICAgICAgfQogICAgfSk7CiAgfSwKICBnZXREYXRhQ29kZVRyZWVEYXRhOiBmdW5jdGlvbiBnZXREYXRhQ29kZVRyZWVEYXRhKGRhdGEsIGNhbGNBbmRDb25zdHJhaW50SXRlbUNvZGVGaWVsZCwgZ3JhZGVkU3VtbWFyeUZpZWxkcywgaXNUcmVlRGF0YSkgewogICAgLy8g5bmz6KGM5pWw5o2u55Sf5oiQ5qCR5b2i5pWw5o2u77yM5Lul5L6/5LiL5LiA5q2l6L2s5o2i5re75Yqg5pig5bCECiAgICBpZiAoaXNUcmVlRGF0YSkgewogICAgICByZXR1cm4gZGF0YTsKICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShncmFkZWRTdW1tYXJ5RmllbGRzKSAmJiBncmFkZWRTdW1tYXJ5RmllbGRzLmxlbmd0aCAmJiBjYWxjQW5kQ29uc3RyYWludEl0ZW1Db2RlRmllbGQpIHsKICAgICAgcmV0dXJuIHRoaXMubGlzdFRvVHJlZUJ5TmVzdENvZGVMZW5ndGgoZGF0YSwgY2FsY0FuZENvbnN0cmFpbnRJdGVtQ29kZUZpZWxkKTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBkYXRhOwogICAgfQogIH0sCiAgcmVjdXJzaXZlRGF0YUNvZGVSb3dNYXA6IGZ1bmN0aW9uIHJlY3Vyc2l2ZURhdGFDb2RlUm93TWFwKGRhdGEsIGNvZGVLZXksIHRyYXZlcnNlVHJlZSkgewogICAgdmFyIGxldmVsTm8gPSBhcmd1bWVudHMubGVuZ3RoID4gMyAmJiBhcmd1bWVudHNbM10gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1szXSA6IDE7CiAgICB2YXIgcENvZGUgPSBhcmd1bWVudHMubGVuZ3RoID4gNCAmJiBhcmd1bWVudHNbNF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1s0XSA6ICcnOwogICAgdmFyIHBOQ29kZSA9IGFyZ3VtZW50cy5sZW5ndGggPiA1ID8gYXJndW1lbnRzWzVdIDogdW5kZWZpbmVkOwogICAgdmFyIG9iaiA9IGFyZ3VtZW50cy5sZW5ndGggPiA2ICYmIGFyZ3VtZW50c1s2XSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzZdIDogewogICAgICBkYXRhQ29kZVJvd01hcDoge30sCiAgICAgIGRhdGFDb2RlUm93QXJyOiBbXQogICAgfTsKICAgIC8vIOmAkuW9kueUn+aIkOaVsOaNrmNvZGXmmKDlsIQKICAgIHZhciBleHRlbmRNYXBJbmZvRmllbGQgPSB0aGlzLmNhbGN1bGF0ZUNvbnN0cmFpbnRDb25maWdJbi5leHRlbmRNYXBJbmZvRmllbGQ7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICBkYXRhLmZvckVhY2goZnVuY3Rpb24gKHJvdywgaW5kZXgpIHsKICAgICAgaWYgKGV4dGVuZE1hcEluZm9GaWVsZCkgewogICAgICAgIHJvd1snaXRlbV9fbGV2ZWwnXSA9IGxldmVsTm87CiAgICAgICAgcm93WydpdGVtX19wY29kZSddID0gcENvZGU7CiAgICAgICAgcm93WydpdGVtX19wTmVzdENvZGUnXSA9IHBOQ29kZSA/IHBOQ29kZSArICdfJyArIHJvd1tjb2RlS2V5XSA6IHJvd1tjb2RlS2V5XTsKICAgICAgfQogICAgICBvYmouZGF0YUNvZGVSb3dNYXBbcm93W2NvZGVLZXldXSA9IHJvdzsKICAgICAgb2JqLmRhdGFDb2RlUm93QXJyLnB1c2gocm93KTsKICAgICAgaWYgKHRyYXZlcnNlVHJlZSkgewogICAgICAgIGlmIChBcnJheS5pc0FycmF5KHJvdy5jaGlsZHJlbikgJiYgcm93LmNoaWxkcmVuLmxlbmd0aCkgewogICAgICAgICAgcm93WydsYXN0X19sZXZlbCddID0gMDsKICAgICAgICAgIHNlbGYucmVjdXJzaXZlRGF0YUNvZGVSb3dNYXAocm93LmNoaWxkcmVuLCBjb2RlS2V5LCB0cmF2ZXJzZVRyZWUsIGxldmVsTm8gKyAxLCByb3dbY29kZUtleV0sIHJvd1snaXRlbV9fcE5lc3RDb2RlJ10sIG9iaik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJvd1snbGFzdF9fbGV2ZWwnXSA9IDE7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHJvd1snbGFzdF9fbGV2ZWwnXSA9IDE7CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIG9iajsKICB9LAogIHBlcmZvcm1HZXREYXRhQWxsOiBmdW5jdGlvbiBwZXJmb3JtR2V0RGF0YUFsbChfcmVmMjgpIHsKICAgIHZhciBkYXRhID0gX3JlZjI4LmRhdGEsCiAgICAgIGRhdGFDb2RlUm93TWFwID0gX3JlZjI4LmRhdGFDb2RlUm93TWFwLAogICAgICBnZXREYXRhUmVuZGVyTWFwID0gX3JlZjI4LmdldERhdGFSZW5kZXJNYXAsCiAgICAgIHRhYmxlSWQgPSBfcmVmMjgudGFibGVJZDsKICAgIC8vIOaJp+ihjCDlj5bmlbAKICAgIGlmICh0aGlzLmlzRW1wdHlPYmooZ2V0RGF0YVJlbmRlck1hcCkpIHsKICAgICAgcmV0dXJuIGRhdGE7CiAgICB9CiAgICBPYmplY3Qua2V5cyhnZXREYXRhUmVuZGVyTWFwKS5mb3JFYWNoKGZ1bmN0aW9uIChyZW5kZXJJdGVtS2V5KSB7CiAgICAgIHZhciByZW5kZXJJdGVtS2V5QXJyID0gcmVuZGVySXRlbUtleS5zcGxpdCgnOicpOwogICAgICBpZiAoZGF0YUNvZGVSb3dNYXBbcmVuZGVySXRlbUtleUFyclswXV0pIHsKICAgICAgICBkYXRhQ29kZVJvd01hcFtyZW5kZXJJdGVtS2V5QXJyWzBdXVtyZW5kZXJJdGVtS2V5QXJyWzFdXSA9IGdldERhdGFSZW5kZXJNYXBbcmVuZGVySXRlbUtleV0gfHwgJyc7CiAgICAgIH0KICAgIH0pOwogIH0sCiAgcGVyZm9ybUdldERhdGFTaW5nbGU6IGZ1bmN0aW9uIHBlcmZvcm1HZXREYXRhU2luZ2xlKF9yZWYyOSkgewogICAgdmFyIGRhdGEgPSBfcmVmMjkuZGF0YSwKICAgICAgZGF0YUNvZGVSb3dNYXAgPSBfcmVmMjkuZGF0YUNvZGVSb3dNYXAsCiAgICAgIGNhbGNBbmRDb25zdHJhaW50SXRlbUNvZGVGaWVsZCA9IF9yZWYyOS5jYWxjQW5kQ29uc3RyYWludEl0ZW1Db2RlRmllbGQsCiAgICAgIGdldERhdGFSZW5kZXJNYXAgPSBfcmVmMjkuZ2V0RGF0YVJlbmRlck1hcCwKICAgICAgdGFibGVJZCA9IF9yZWYyOS50YWJsZUlkLAogICAgICByb3cgPSBfcmVmMjkucm93OwogICAgLy8g5omn6KGMIOWNleadoeaVsOaNriDlj5bmlbAKICAgIGlmICh0aGlzLmlzRW1wdHlPYmooZ2V0RGF0YVJlbmRlck1hcCkpIHsKICAgICAgcmV0dXJuIGRhdGE7CiAgICB9CiAgICBPYmplY3Qua2V5cyhnZXREYXRhUmVuZGVyTWFwKS5mb3JFYWNoKGZ1bmN0aW9uIChyZW5kZXJJdGVtS2V5KSB7CiAgICAgIHZhciByZW5kZXJJdGVtS2V5QXJyID0gcmVuZGVySXRlbUtleS5zcGxpdCgnOicpOwogICAgICBpZiAocmVuZGVySXRlbUtleUFyclswXSA9PT0gcm93W2NhbGNBbmRDb25zdHJhaW50SXRlbUNvZGVGaWVsZF0pIHsKICAgICAgICByb3dbcmVuZGVySXRlbUtleUFyclswXV1bcmVuZGVySXRlbUtleUFyclsxXV0gPSBnZXREYXRhUmVuZGVyTWFwW3JlbmRlckl0ZW1LZXldOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiBkYXRhOwogIH0sCiAgcGVyZm9ybUNvbEZvcm11bGFBbGw6IGZ1bmN0aW9uIHBlcmZvcm1Db2xGb3JtdWxhQWxsKF9yZWYzMCkgewogICAgdmFyIGRhdGEgPSBfcmVmMzAuZGF0YSwKICAgICAgZGF0YUNvZGVSb3dNYXAgPSBfcmVmMzAuZGF0YUNvZGVSb3dNYXAsCiAgICAgIGRhdGFDb2RlUm93QXJyID0gX3JlZjMwLmRhdGFDb2RlUm93QXJyLAogICAgICBncmFkZWRTdW1tYXJ5RmllbGRzID0gX3JlZjMwLmdyYWRlZFN1bW1hcnlGaWVsZHMsCiAgICAgIGNvbEZvcm11bGFDb25maWcgPSBfcmVmMzAuY29sRm9ybXVsYUNvbmZpZywKICAgICAgdGFibGVJZCA9IF9yZWYzMC50YWJsZUlkLAogICAgICBjYWxjQ29sVHlwZSA9IF9yZWYzMC5jYWxjQ29sVHlwZTsKICAgIC8vIOaJp+ihjCDooYzorqHnrpcKICAgIC8vIGNhbGNDb2xUeXBlICDmiafooYwgIGxhc3RMZXZlbDrmnIDlupXnuqfvvIxwYXJlbnQ654i257qnIGFsbDrlhajpg6gKICAgIGlmICh0aGlzLmlzRW1wdHlPYmooY29sRm9ybXVsYUNvbmZpZykpIHsKICAgICAgcmV0dXJuIGRhdGE7CiAgICB9CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICBkYXRhQ29kZVJvd0Fyci5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHsKICAgICAgc2VsZi5wZXJmb3JtQ29sRm9ybXVsYVNpbmdsZSh7CiAgICAgICAgZGF0YTogZGF0YSwKICAgICAgICBkYXRhQ29kZVJvd01hcDogZGF0YUNvZGVSb3dNYXAsCiAgICAgICAgZGF0YUNvZGVSb3dBcnI6IGRhdGFDb2RlUm93QXJyLAogICAgICAgIGdyYWRlZFN1bW1hcnlGaWVsZHM6IGdyYWRlZFN1bW1hcnlGaWVsZHMsCiAgICAgICAgY29sRm9ybXVsYUNvbmZpZzogY29sRm9ybXVsYUNvbmZpZywKICAgICAgICB0YWJsZUlkOiB0YWJsZUlkLAogICAgICAgIGNhbGNDb2xUeXBlOiBjYWxjQ29sVHlwZSwKICAgICAgICByb3c6IHJvdwogICAgICB9KTsKICAgIH0pOwogICAgcmV0dXJuIGRhdGE7CiAgfSwKICBwZXJmb3JtQ29sRm9ybXVsYVNpbmdsZTogZnVuY3Rpb24gcGVyZm9ybUNvbEZvcm11bGFTaW5nbGUoX3JlZjMxKSB7CiAgICB2YXIgZGF0YSA9IF9yZWYzMS5kYXRhLAogICAgICBkYXRhQ29kZVJvd01hcCA9IF9yZWYzMS5kYXRhQ29kZVJvd01hcCwKICAgICAgZGF0YUNvZGVSb3dBcnIgPSBfcmVmMzEuZGF0YUNvZGVSb3dBcnIsCiAgICAgIGdyYWRlZFN1bW1hcnlGaWVsZHMgPSBfcmVmMzEuZ3JhZGVkU3VtbWFyeUZpZWxkcywKICAgICAgY29sRm9ybXVsYUNvbmZpZyA9IF9yZWYzMS5jb2xGb3JtdWxhQ29uZmlnLAogICAgICB0YWJsZUlkID0gX3JlZjMxLnRhYmxlSWQsCiAgICAgIGNhbGNDb2xUeXBlID0gX3JlZjMxLmNhbGNDb2xUeXBlLAogICAgICByb3cgPSBfcmVmMzEucm93OwogICAgLy8g5omn6KGMIOWNleadoSDooYzorqHnrpcKICAgIC8vIGNhbGNDb2xUeXBlICDmiafooYwgIGxhc3RMZXZlbDrmnIDlupXnuqfvvIxwYXJlbnQ654i257qnIGFsbDrlhajpg6gKICAgIGlmICh0aGlzLmlzRW1wdHlPYmooY29sRm9ybXVsYUNvbmZpZykpIHsKICAgICAgcmV0dXJuIHJvdzsKICAgIH0KICAgIHZhciBzZWxmID0gdGhpczsKICAgIHN3aXRjaCAoY2FsY0NvbFR5cGUpIHsKICAgICAgY2FzZSAnYWxsJzoKICAgICAgICAvLyDlhajpg6jorqHnrpcKICAgICAgICBzZWxmLnJlZHVjdGlvbkNvbEZvcm11bGEoY29sRm9ybXVsYUNvbmZpZywgcm93KTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAncGFyZW50JzoKICAgICAgICAvLyDku4XorqHnrpfniLbnuqcKICAgICAgICBpZiAocm93WydsYXN0X19sZXZlbCddID09PSAxKSB7CiAgICAgICAgICBzZWxmLnJlZHVjdGlvbkNvbEZvcm11bGEoY29sRm9ybXVsYUNvbmZpZywgcm93KTsKICAgICAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkocm93LmNoaWxkcmVuKSAmJiByb3cuY2hpbGRyZW4ubGVuZ3RoIHx8IHJvd1snbGFzdF9fbGV2ZWwnXSAhPT0gMCkgewogICAgICAgICAgc2VsZi5yZWR1Y3Rpb25Db2xGb3JtdWxhKHNlbGYuZ2V0UGFyZW50Q29sRm9ybXVsYUNvbmZpZyhzZWxmLmRlZXBDb3B5KGNvbEZvcm11bGFDb25maWcpLCBncmFkZWRTdW1tYXJ5RmllbGRzKSwgcm93KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc2VsZi5yZWR1Y3Rpb25Db2xGb3JtdWxhKGNvbEZvcm11bGFDb25maWcsIHJvdyk7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdsYXN0TGV2ZWwnOgogICAgICAgIC8vIOS7heiuoeeul+acgOS9jue6pwogICAgICAgIGlmICghKEFycmF5LmlzQXJyYXkocm93LmNoaWxkcmVuKSAmJiByb3cuY2hpbGRyZW4ubGVuZ3RoKSB8fCByb3dbJ2xhc3RfX2xldmVsJ10gIT09IDApIHsKICAgICAgICAgIHNlbGYucmVkdWN0aW9uQ29sRm9ybXVsYShjb2xGb3JtdWxhQ29uZmlnLCByb3cpOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgIH0KICAgIHJldHVybiByb3c7CiAgfSwKICBnZXRQYXJlbnRDb2xGb3JtdWxhQ29uZmlnOiBmdW5jdGlvbiBnZXRQYXJlbnRDb2xGb3JtdWxhQ29uZmlnKGNvbEZvcm11bGFDb25maWcsIGdyYWRlZFN1bW1hcnlGaWVsZHMpIHsKICAgIC8vIOWIhue6p+axh+aAu+WQjuWmguaenOeItue6p+aXouacieWIhue6p+axh+aAuyDkuZ/mnIkg6K6h566XIOS7peWIhue6p+axh+aAu+S4uuS4uwogICAgZ3JhZGVkU3VtbWFyeUZpZWxkcy5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7CiAgICAgIGRlbGV0ZSBjb2xGb3JtdWxhQ29uZmlnW2l0ZW1dOwogICAgfSk7CiAgICByZXR1cm4gY29sRm9ybXVsYUNvbmZpZzsKICB9LAogIHBlcmZvcm1HcmFkZWRTdW1tYXJ5QWxsOiBmdW5jdGlvbiBwZXJmb3JtR3JhZGVkU3VtbWFyeUFsbChfcmVmMzIpIHsKICAgIHZhciBkYXRhID0gX3JlZjMyLmRhdGEsCiAgICAgIGRhdGFDb2RlUm93TWFwID0gX3JlZjMyLmRhdGFDb2RlUm93TWFwLAogICAgICBncmFkZWRTdW1tYXJ5RmllbGRzID0gX3JlZjMyLmdyYWRlZFN1bW1hcnlGaWVsZHMsCiAgICAgIHRhYmxlSWQgPSBfcmVmMzIudGFibGVJZDsKICAgIC8vIOaJp+ihjCDmlbDnu4TliIbnuqfmsYfmgLvorqHnrpcKICAgIGlmICghKEFycmF5LmlzQXJyYXkoZ3JhZGVkU3VtbWFyeUZpZWxkcykgJiYgZ3JhZGVkU3VtbWFyeUZpZWxkcy5sZW5ndGgpKSB7CiAgICAgIHJldHVybiBkYXRhOwogICAgfQogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgZGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChyb3cpIHsKICAgICAgc2VsZi5wZXJmb3JtR3JhZGVkU3VtbWFyeVNpbmdsZSh7CiAgICAgICAgcm93OiByb3csCiAgICAgICAgZ3JhZGVkU3VtbWFyeUZpZWxkczogZ3JhZGVkU3VtbWFyeUZpZWxkcwogICAgICB9KTsKICAgIH0pOwogICAgcmV0dXJuIGRhdGE7CiAgfSwKICBwZXJmb3JtR3JhZGVkU3VtbWFyeVNpbmdsZTogZnVuY3Rpb24gcGVyZm9ybUdyYWRlZFN1bW1hcnlTaW5nbGUoX3JlZjMzKSB7CiAgICB2YXIgcm93ID0gX3JlZjMzLnJvdywKICAgICAgZGF0YSA9IF9yZWYzMy5kYXRhLAogICAgICBncmFkZWRTdW1tYXJ5RmllbGRzID0gX3JlZjMzLmdyYWRlZFN1bW1hcnlGaWVsZHM7CiAgICAvLyDmiafooYwg5Y2V5p2h5pWw5o2u5YiG57qn5rGH5oC76K6h566XCiAgICBpZiAoIShBcnJheS5pc0FycmF5KGdyYWRlZFN1bW1hcnlGaWVsZHMpICYmIGdyYWRlZFN1bW1hcnlGaWVsZHMubGVuZ3RoKSkgewogICAgICByZXR1cm4gcm93OwogICAgfQogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgaWYgKEFycmF5LmlzQXJyYXkocm93LmNoaWxkcmVuKSAmJiByb3cuY2hpbGRyZW4ubGVuZ3RoKSB7CiAgICAgIGdyYWRlZFN1bW1hcnlGaWVsZHMuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgcm93W2tleV0gPSByb3cuY2hpbGRyZW4ucmVkdWNlKGZ1bmN0aW9uIChwcmVSZXN1bHQsIG5leHQpIHsKICAgICAgICAgIHZhciBjdXJJdGVtR3JhZGVkU3VtbWFyeVZhbHVlID0gMDsKICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KG5leHQuY2hpbGRyZW4pICYmIG5leHQuY2hpbGRyZW4ubGVuZ3RoKSB7CiAgICAgICAgICAgIGN1ckl0ZW1HcmFkZWRTdW1tYXJ5VmFsdWUgPSBwYXJzZUZsb2F0KHNlbGYucGVyZm9ybUdyYWRlZFN1bW1hcnlTaW5nbGUoewogICAgICAgICAgICAgIHJvdzogbmV4dCwKICAgICAgICAgICAgICBncmFkZWRTdW1tYXJ5RmllbGRzOiBncmFkZWRTdW1tYXJ5RmllbGRzCiAgICAgICAgICAgIH0pW2tleV0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY3VySXRlbUdyYWRlZFN1bW1hcnlWYWx1ZSA9IHBhcnNlRmxvYXQobmV4dFtrZXldKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBwcmVSZXN1bHQgKyAoaXNOYU4oY3VySXRlbUdyYWRlZFN1bW1hcnlWYWx1ZSkgPyAwIDogY3VySXRlbUdyYWRlZFN1bW1hcnlWYWx1ZSk7CiAgICAgICAgfSwgMCk7CiAgICAgIH0pOwogICAgfQogICAgcmV0dXJuIHJvdzsKICB9LAogIHBlcmZvcm1Sb3dDb2RlRm9ybXVsYTogZnVuY3Rpb24gcGVyZm9ybVJvd0NvZGVGb3JtdWxhKF9yZWYzNCkgewogICAgdmFyIGRhdGEgPSBfcmVmMzQuZGF0YSwKICAgICAgZGF0YUNvZGVSb3dNYXAgPSBfcmVmMzQuZGF0YUNvZGVSb3dNYXAsCiAgICAgIHJvd0NvZGVGb3JtdWxhQ29uZmlnID0gX3JlZjM0LnJvd0NvZGVGb3JtdWxhQ29uZmlnLAogICAgICB0YWJsZUlkID0gX3JlZjM0LnRhYmxlSWQ7CiAgICAvLyDmiafooYwg5Y2V5YWD5qC85Lqk5Y+J6K6h566XCiAgICB0aGlzLnJlZHVjdGlvblJvd0NvZGVGb3JtdWxhKHJvd0NvZGVGb3JtdWxhQ29uZmlnLCBkYXRhLCB0YWJsZUlkKTsKICB9LAogIHBlcmZvcm1Sb3dDb25zdHJhaW50QWxsOiBmdW5jdGlvbiBwZXJmb3JtUm93Q29uc3RyYWludEFsbChfcmVmMzUpIHsKICAgIHZhciBkYXRhID0gX3JlZjM1LmRhdGEsCiAgICAgIGRhdGFDb2RlUm93TWFwID0gX3JlZjM1LmRhdGFDb2RlUm93TWFwLAogICAgICBkYXRhQ29kZVJvd0FyciA9IF9yZWYzNS5kYXRhQ29kZVJvd0FyciwKICAgICAgY29sQ29uc3RyYWludENvbmZpZyA9IF9yZWYzNS5jb2xDb25zdHJhaW50Q29uZmlnLAogICAgICB0YWJsZUlkID0gX3JlZjM1LnRhYmxlSWQ7CiAgICAvLyDmiafooYwg6KGM5YaF57qm5p2fCiAgICB0aGlzLmdlbmFyYXRlUm93Q29uc3RyYWludE1hcEFsbCh7CiAgICAgIGRhdGE6IGRhdGEsCiAgICAgIGRhdGFDb2RlUm93TWFwOiBkYXRhQ29kZVJvd01hcCwKICAgICAgZGF0YUNvZGVSb3dBcnI6IGRhdGFDb2RlUm93QXJyLAogICAgICBjb2xDb25zdHJhaW50Q29uZmlnOiBjb2xDb25zdHJhaW50Q29uZmlnLAogICAgICB0YWJsZUlkOiB0YWJsZUlkCiAgICB9KTsKICB9LAogIHBlcmZvcm1DZWxsQ29uc3RyYWludEFsbDogZnVuY3Rpb24gcGVyZm9ybUNlbGxDb25zdHJhaW50QWxsKF9yZWYzNikgewogICAgdmFyIGRhdGEgPSBfcmVmMzYuZGF0YSwKICAgICAgZGF0YUNvZGVSb3dNYXAgPSBfcmVmMzYuZGF0YUNvZGVSb3dNYXAsCiAgICAgIHJvd0NvZGVDb25zdHJhaW50Q29uZmlnID0gX3JlZjM2LnJvd0NvZGVDb25zdHJhaW50Q29uZmlnLAogICAgICBkYXRhQ29kZVJvd0FyciA9IF9yZWYzNi5kYXRhQ29kZVJvd0FyciwKICAgICAgdGFibGVJZCA9IF9yZWYzNi50YWJsZUlkOwogICAgLy8g5omn6KGMIOWNleWFg+agvOe6puadnwogICAgdGhpcy5nZW5hcmF0ZUNlbGxDb25zdHJhaW50TWFwQWxsKHsKICAgICAgZGF0YTogZGF0YSwKICAgICAgZGF0YUNvZGVSb3dNYXA6IGRhdGFDb2RlUm93TWFwLAogICAgICByb3dDb2RlQ29uc3RyYWludENvbmZpZzogcm93Q29kZUNvbnN0cmFpbnRDb25maWcsCiAgICAgIGRhdGFDb2RlUm93QXJyOiBkYXRhQ29kZVJvd0FyciwKICAgICAgdGFibGVJZDogdGFibGVJZAogICAgfSk7CiAgfSwKICBwZXJmb3JtUm93Q29uc3RyYWludFNpbmdsZTogZnVuY3Rpb24gcGVyZm9ybVJvd0NvbnN0cmFpbnRTaW5nbGUoX3JlZjM3KSB7CiAgICB2YXIgZGF0YSA9IF9yZWYzNy5kYXRhLAogICAgICBkYXRhQ29kZVJvd01hcCA9IF9yZWYzNy5kYXRhQ29kZVJvd01hcCwKICAgICAgY29sQ29uc3RyYWludENvbmZpZyA9IF9yZWYzNy5jb2xDb25zdHJhaW50Q29uZmlnLAogICAgICBkYXRhQ29kZVJvd0FyciA9IF9yZWYzNy5kYXRhQ29kZVJvd0FyciwKICAgICAgdGFibGVJZCA9IF9yZWYzNy50YWJsZUlkLAogICAgICByb3cgPSBfcmVmMzcucm93OwogICAgLy8g5omn6KGMIOWNleadoeaVsOaNrueahOihjOWGhee6puadnwogICAgdGhpcy5nZW5hcmF0ZVJvd0NvbnN0cmFpbnRNYXBTaW5nbGUoewogICAgICBkYXRhOiBkYXRhLAogICAgICBkYXRhQ29kZVJvd01hcDogZGF0YUNvZGVSb3dNYXAsCiAgICAgIGNvbENvbnN0cmFpbnRDb25maWc6IGNvbENvbnN0cmFpbnRDb25maWcsCiAgICAgIHRhYmxlSWQ6IHRhYmxlSWQsCiAgICAgIHJvdzogcm93CiAgICB9KTsKICB9LAogIHBlcmZvcm1DZWxsQ29uc3RyYWludFNpbmdsZTogZnVuY3Rpb24gcGVyZm9ybUNlbGxDb25zdHJhaW50U2luZ2xlKF9yZWYzOCkgewogICAgdmFyIHJvd0NvZGVDb25zdHJhaW50Q29uZmlnID0gX3JlZjM4LnJvd0NvZGVDb25zdHJhaW50Q29uZmlnLAogICAgICBkYXRhID0gX3JlZjM4LmRhdGEsCiAgICAgIGRhdGFDb2RlUm93TWFwID0gX3JlZjM4LmRhdGFDb2RlUm93TWFwLAogICAgICB0YWJsZUlkID0gX3JlZjM4LnRhYmxlSWQsCiAgICAgIHJvdyA9IF9yZWYzOC5yb3csCiAgICAgIGNvbHVtbiA9IF9yZWYzOC5jb2x1bW47CiAgICAvLyDmiafooYwg5Y2V5p2h5pWw5o2u55qE6KGM5YaF57qm5p2fCiAgICB2YXIgY2FsY0FuZENvbnN0cmFpbnRJdGVtQ29kZUZpZWxkID0gdGhpcy5jYWxjdWxhdGVDb25zdHJhaW50Q29uZmlnSW4uY2FsY0FuZENvbnN0cmFpbnRJdGVtQ29kZUZpZWxkOwogICAgdmFyIGN1ckNlbGxDb25zdHJhaW50ID0gcm93Q29kZUNvbnN0cmFpbnRDb25maWdbcm93W2NhbGNBbmRDb25zdHJhaW50SXRlbUNvZGVGaWVsZF0gKyAnOicgKyAoY29sdW1uLnByb3BlcnR5IHx8IGNvbHVtbi5maWVsZCldOwogICAgaWYgKGN1ckNlbGxDb25zdHJhaW50KSB7CiAgICAgIHRoaXMuZ2VuYXJhdGVDZWxsQ29uc3RyYWludE1hcFNpbmdsZShkYXRhQ29kZVJvd01hcCwgY3VyQ2VsbENvbnN0cmFpbnQsIHRhYmxlSWQpOwogICAgfQogIH0KfTsKdmFyIGNvbnN0cmFpbnRUb29sID0gewogIC8vIOe6puadn+mDqOWIhiDooYzlhoXnuqbmnZ8KICAvLyDlupXnuqflj5bmlbAtLT7ooYzorqHnrpctLT7liIbnuqfmsYfmgLstLT7niLbnuqfooYzorqHnrpctLT7ljZXlhYPmoLzkuqTlj4norqHnrpctLT7nuqbmnZ8KICBnZW5hcmF0ZVJvd0NvbnN0cmFpbnRNYXBBbGw6IGZ1bmN0aW9uIGdlbmFyYXRlUm93Q29uc3RyYWludE1hcEFsbChfcmVmMzkpIHsKICAgIHZhciBjb2xDb25zdHJhaW50Q29uZmlnID0gX3JlZjM5LmNvbENvbnN0cmFpbnRDb25maWcsCiAgICAgIHRhYmxlRGF0YSA9IF9yZWYzOS50YWJsZURhdGEsCiAgICAgIGRhdGFDb2RlUm93TWFwID0gX3JlZjM5LmRhdGFDb2RlUm93TWFwLAogICAgICBkYXRhQ29kZVJvd0FyciA9IF9yZWYzOS5kYXRhQ29kZVJvd0FyciwKICAgICAgdGFibGVJZCA9IF9yZWYzOS50YWJsZUlkOwogICAgLy8g55Sf5oiQ57qm5p2fbWFwCiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICB0aGlzLmVhY2goZGF0YUNvZGVSb3dBcnIsIGZ1bmN0aW9uIChyb3dJbmRleCwgcm93KSB7CiAgICAgIHNlbGYuZ2VuYXJhdGVSb3dDb25zdHJhaW50TWFwU2luZ2xlKHsKICAgICAgICBjb2xDb25zdHJhaW50Q29uZmlnOiBjb2xDb25zdHJhaW50Q29uZmlnLAogICAgICAgIHJvdzogcm93LAogICAgICAgIHRhYmxlSWQ6IHRhYmxlSWQKICAgICAgfSk7CiAgICB9KTsKICB9LAogIGdlbmFyYXRlUm93Q29uc3RyYWludE1hcFNpbmdsZTogZnVuY3Rpb24gZ2VuYXJhdGVSb3dDb25zdHJhaW50TWFwU2luZ2xlKF9yZWY0MCkgewogICAgdmFyIGNvbENvbnN0cmFpbnRDb25maWcgPSBfcmVmNDAuY29sQ29uc3RyYWludENvbmZpZywKICAgICAgcm93ID0gX3JlZjQwLnJvdywKICAgICAgdGFibGVJZCA9IF9yZWY0MC50YWJsZUlkOwogICAgLy8g55Sf5oiQ5Y2V5p2h5pWw5o2u57qm5p2fbWFwCiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICB2YXIgY2FsY0FuZENvbnN0cmFpbnRJdGVtQ29kZUZpZWxkID0gdGhpcy5jYWxjdWxhdGVDb25zdHJhaW50Q29uZmlnSW4uY2FsY0FuZENvbnN0cmFpbnRJdGVtQ29kZUZpZWxkOwogICAgc2VsZi5jb25zdHJhaW5Sb3dEYXRhTWFwW3Jvd1tjYWxjQW5kQ29uc3RyYWludEl0ZW1Db2RlRmllbGRdXSA9IHNlbGYuY29uc3RyYWluUm93RGF0YU1hcFtyb3dbY2FsY0FuZENvbnN0cmFpbnRJdGVtQ29kZUZpZWxkXV0gfHwge307CiAgICB2YXIgZGF0YU1hcCA9IHNlbGYuY29uc3RyYWluUm93RGF0YU1hcFtyb3dbY2FsY0FuZENvbnN0cmFpbnRJdGVtQ29kZUZpZWxkXV07CiAgICB0aGlzLmVhY2goY29sQ29uc3RyYWludENvbmZpZywgZnVuY3Rpb24gKGtleSwgaXRlbSkgewogICAgICBzZWxmLnBhcnNpbmdSb3dDb25zdHJhaW50Q29uZmlnVG9NYXBEYXRhKGNvbENvbnN0cmFpbnRDb25maWdba2V5XSwgcm93LCBkYXRhTWFwLCB0YWJsZUlkLCBjb2xDb25zdHJhaW50Q29uZmlnKTsKICAgIH0pOwogIH0sCiAgcGFyc2luZ1Jvd0NvbnN0cmFpbnRDb25maWdUb01hcERhdGE6IGZ1bmN0aW9uIHBhcnNpbmdSb3dDb25zdHJhaW50Q29uZmlnVG9NYXBEYXRhKGV4cHJlc3Npb24sIHJvdywgZGF0YU1hcCwgdGFibGVJZCwgY29sQ29uc3RyYWludENvbmZpZykgewogICAgLy8g55Sf5oiQ5Y2V5p2h5pWw5o2u57qm5p2fbWFwCiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICBleHByZXNzaW9uLnNwbGl0KCctLSYmLS0nKS5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtLCBpbmRleCkgewogICAgICB2YXIgcm93Q29uc3RyYWludEFyciA9IGl0ZW0uc3BsaXQoJzo6Jyk7CiAgICAgIGRhdGFNYXBbcm93Q29uc3RyYWludEFyclswXV0gPSBkYXRhTWFwW3Jvd0NvbnN0cmFpbnRBcnJbMF1dIHx8IHt9OwogICAgICBkYXRhTWFwW3Jvd0NvbnN0cmFpbnRBcnJbMF1dW3Jvd0NvbnN0cmFpbnRBcnJbMV1dID0gc2VsZi5wYXJzaW5nUm93Q29uc3RyYWludENvbmZpZ1RvVmFsdWVEYXRhKHJvd0NvbnN0cmFpbnRBcnJbMl0sIHJvd0NvbnN0cmFpbnRBcnJbMV0sIHJvdyk7CiAgICAgIGlmIChyb3dDb25zdHJhaW50QXJyWzFdID09PSAndmFsdWUnIHx8IHJvd0NvbnN0cmFpbnRBcnJbMV0gPT09ICdjbGVhcicpIHsKICAgICAgICAvLyDlpoLmnpxh55qE5YC85pS55Y+Y5a+86Ie0Y+eahOWAvOaUueWPmO+8jGPnmoTlgLzmlLnlj5jlj4jkvJrmlLnlj5jlhbbku5bvvIzliJnpgJLlvZLosIPnlKgKICAgICAgICBpZiAoY29sQ29uc3RyYWludENvbmZpZ1tyb3dDb25zdHJhaW50QXJyWzBdXSkgewogICAgICAgICAgc2VsZi5wYXJzaW5nUm93Q29uc3RyYWludENvbmZpZ1RvVmFsdWVEYXRhKGNvbENvbnN0cmFpbnRDb25maWdbcm93Q29uc3RyYWludEFyclswXV0sIHJvdywgZGF0YU1hcCwgdGFibGVJZCwgY29sQ29uc3RyYWludENvbmZpZyk7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICB9LAogIHBhcnNpbmdSb3dDb25zdHJhaW50Q29uZmlnVG9WYWx1ZURhdGE6IGZ1bmN0aW9uIHBhcnNpbmdSb3dDb25zdHJhaW50Q29uZmlnVG9WYWx1ZURhdGEoZXhwcmVzc2lvbiwgdHlwZSwgcm93LCB0YWJsZUlkKSB7CiAgICAvLyDnlJ/miJDlvZPmnaFhZ2U6MTAwMToxMDAxCiAgICAvLyB0eXBlOiB2aXNpYmxlIGVkaXRibGUgY2xlYXIgc3R5bGUgdmFsdWUgZ2V0RGF0YQogICAgdmFyIHZhbHVlID0gbnVsbDsKICAgIHN3aXRjaCAodHlwZSkgewogICAgICBjYXNlICd2aXNpYmxlJzoKICAgICAgICB2YWx1ZSA9ICEhdGhpcy5ldmFsRXByZXNzaW9uKHRoaXMucmVwbGFjZVJvd0VwcmVzc2lvblZhbHVlKGV4cHJlc3Npb24sIHJvdywgdGFibGVJZCkpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdlZGl0YWJsZSc6CiAgICAgICAgdmFsdWUgPSAhIXRoaXMuZXZhbEVwcmVzc2lvbih0aGlzLnJlcGxhY2VSb3dFcHJlc3Npb25WYWx1ZShleHByZXNzaW9uLCByb3csIHRhYmxlSWQpKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnY2xlYXInOgogICAgICAgIHZhbHVlID0gISF0aGlzLmV2YWxFcHJlc3Npb24odGhpcy5yZXBsYWNlUm93RXByZXNzaW9uVmFsdWUoZXhwcmVzc2lvbiwgcm93LCB0YWJsZUlkKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3ZhbHVlJzoKICAgICAgICB2YWx1ZSA9IHRoaXMuZXZhbEVwcmVzc2lvbih0aGlzLnJlcGxhY2VSb3dFcHJlc3Npb25WYWx1ZShleHByZXNzaW9uLCByb3csIHRhYmxlSWQpKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc3R5bGUnOgogICAgICAgIHZhbHVlID0gdGhpcy50cmFuc0V4cHJlc3Npb25Ub09iamVjdCh0aGlzLnBhc2luZ0V4cHJlc3Npb24odGhpcy5yZXBsYWNlUm93RXByZXNzaW9uVmFsdWUoZXhwcmVzc2lvbiwgcm93LCB0YWJsZUlkKSksIHJvdyk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2dldERhdGEnOgogICAgICAgIHZhbHVlID0ge307CiAgICAgICAgYnJlYWs7CiAgICB9CiAgICByZXR1cm4gdmFsdWU7CiAgfSwKICByZXBsYWNlUm93RXByZXNzaW9uVmFsdWU6IGZ1bmN0aW9uIHJlcGxhY2VSb3dFcHJlc3Npb25WYWx1ZShleHByZXNzaW9uLCByb3csIHRhYmxlSWQpIHsKICAgIHZhciByZWdSID0gbmV3IFJlZ0V4cCgnKHtbYS16QS1aMC05X10qfSknLCAnaWcnKTsKICAgIHZhciByb3dzS2V5ID0gZXhwcmVzc2lvbi5tYXRjaChyZWdSKSB8fCBbXTsKICAgIHJvd3NLZXkgPSBBcnJheS5mcm9tKG5ldyBTZXQocm93c0tleSkpOwogICAgaWYgKHJvd3NLZXkubGVuZ3RoKSB7CiAgICAgIGZvciAodmFyIGtleUMgaW4gcm93c0tleSkgewogICAgICAgIHZhciByZWcgPSBuZXcgUmVnRXhwKCcoJyArIHJvd3NLZXlba2V5Q10ucmVwbGFjZSgvXCQvaWcsICdcXCQnKSArICcpJywgJ2lnJyk7CiAgICAgICAgdmFyIGtleUYgPSByb3dzS2V5W2tleUNdLnJlcGxhY2UoL1x7fFx9L2csICcnKTsKICAgICAgICBleHByZXNzaW9uID0gZXhwcmVzc2lvbi5yZXBsYWNlKHJlZywgcm93W2tleUZdIHx8IDApOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZXhwcmVzc2lvbjsKICB9LAogIGV2YWxFcHJlc3Npb246IGZ1bmN0aW9uIGV2YWxFcHJlc3Npb24oZXhwcmVzc2lvbikgewogICAgLy8g5omn6KGM6KGo6L6+5byPCiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tbmV3LWZ1bmMKICAgIHJldHVybiBuZXcgRnVuY3Rpb24oJ3JldHVybiAnICsgZXhwcmVzc2lvbikoKTsKICB9LAogIHBhc2luZ0V4cHJlc3Npb246IGZ1bmN0aW9uIHBhc2luZ0V4cHJlc3Npb24oZXhwcmVzc2lvbikgewogICAgdmFyIHN0ciA9ICcnOwogICAgdHJ5IHsKICAgICAgdGhpcy5lYWNoKGV4cHJlc3Npb24uc3BsaXQoJy0tKy0tJyksIGZ1bmN0aW9uIChpbmRleCwgaXRlbSkgewogICAgICAgIGlmIChpbmRleCA9PT0gMCkgewogICAgICAgICAgc3RyICs9ICdpZignICsgaXRlbS5zcGxpdCgnLS0/Py0tJylbMF0gKyAnKXtyZXR1cm4gIicgKyBpdGVtLnNwbGl0KCctLT8/LS0nKVsxXSArICcifSc7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN0ciArPSAnZWxzZSBpZignICsgaXRlbS5zcGxpdCgnLS0/Py0tJylbMF0gKyAnKXtyZXR1cm4gIicgKyBpdGVtLnNwbGl0KCctLT8/LS0nKVsxXSArICcifSc7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgc3RyICs9ICdlbHNle3JldHVybiAiIn0nOwogICAgICByZXR1cm4gbmV3IEZ1bmN0aW9uKHN0cikoKTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgY29uc29sZS5lcnJvcihlKTsKICAgICAgcmV0dXJuICcnOwogICAgfQogIH0sCiAgcGVyZm9ybVJvd0NvbnN0cmFpbnRBbmRSZXJlbmRlcjogZnVuY3Rpb24gcGVyZm9ybVJvd0NvbnN0cmFpbnRBbmRSZXJlbmRlcihyb3cpIHsKICAgIC8vIOaJp+ihjOW9k+WJjeihjOe6puadn+W5tumHjeaWsOa4suafkwogICAgdmFyIGNhbGNBbmRDb25zdHJhaW50SXRlbUNvZGVGaWVsZCA9IHRoaXMuY2FsY3VsYXRlQ29uc3RyYWludENvbmZpZ0luLmNhbGNBbmRDb25zdHJhaW50SXRlbUNvZGVGaWVsZDsKICAgIGlmICh0aGlzLmNhbGN1bGF0ZUNvbnN0cmFpbnRDb25maWdJbi5jb25zdHJhaW50Q29uZmlnLnJvdykgewogICAgICB0aGlzLmNvbnN0cmFpblJvd0RhdGFNYXBbcm93W2NhbGNBbmRDb25zdHJhaW50SXRlbUNvZGVGaWVsZF1dID0gc2VsZi5jb25zdHJhaW5Sb3dEYXRhTWFwW3Jvd1tjYWxjQW5kQ29uc3RyYWludEl0ZW1Db2RlRmllbGRdXSB8fCB7fTsKICAgICAgdGhpcy5jb25zdHJhaW5Sb3dEYXRhTWFwW3Jvd1tjYWxjQW5kQ29uc3RyYWludEl0ZW1Db2RlRmllbGRdXSA9IHNlbGYuZ2VuYXJhdGVSb3dDb25zdHJhaW50TWFwKHNlbGYuZGVlcENvcHkodGhpcy5jYWxjdWxhdGVDb25zdHJhaW50Q29uZmlnSW4uY29uc3RyYWludENvbmZpZy5yb3cpLCByb3csIHNlbGYuY29uc3RyYWluUm93RGF0YU1hcFtyb3dbY2FsY0FuZENvbnN0cmFpbnRJdGVtQ29kZUZpZWxkXV0pOwogICAgICB0aGlzLiRyZWZzLnhHcmlkLnJlZnJlc2hDb2x1bW4oKTsKICAgIH0KICB9LAogIHRyYW5zRXhwcmVzc2lvblRvT2JqZWN0OiBmdW5jdGlvbiB0cmFuc0V4cHJlc3Npb25Ub09iamVjdCh2YWx1ZSkgewogICAgLy8g6I635Y+W5YWo6YOo5Y+C5pWwLOW5tui9rOaNouaIkGpzb27lr7nosaEKICAgIHRyeSB7CiAgICAgIHZhciB2YWx1ZUFyciA9IHZhbHVlLnNwbGl0KCcmJyk7CiAgICAgIHZhciBsZW4gPSB2YWx1ZUFyci5sZW5ndGg7CiAgICAgIHZhciByZXN1bHQgPSB7fTsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykgewogICAgICAgIHZhciBwb3MgPSB2YWx1ZUFycltpXS5pbmRleE9mKCc9Jyk7CiAgICAgICAgaWYgKHBvcyA9PT0gLTEpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICB2YXIgbmFtZSA9IHZhbHVlQXJyW2ldLnN1YnN0cmluZygwLCBwb3MpOwogICAgICAgIHJlc3VsdFtuYW1lXSA9IHZhbHVlQXJyW2ldLnN1YnN0cmluZyhwb3MgKyAxKS5tYXRjaChuZXcgUmVnRXhwKCcoe1thLXpBLVowLTlfOlwkXSp9KScsICdpZycpKSA/IHRoaXMuZXZhbEVwcmVzc2lvbih2YWx1ZUFycltpXS5zdWJzdHJpbmcocG9zICsgMSkpIDogdmFsdWVBcnJbaV0uc3Vic3RyaW5nKHBvcyArIDEpOwogICAgICB9CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIGNvbnNvbGUuZXJyb3IoZSk7CiAgICAgIHJldHVybiB7fTsKICAgIH0KICB9LAogIHBlcmZvcm1Db25zdHJhaW50QW5kUmVyZW5kZXI6IGZ1bmN0aW9uIHBlcmZvcm1Db25zdHJhaW50QW5kUmVyZW5kZXIoKSB7CiAgICAvLyDmiafooYznuqbmnZ/lubbph43mlrDmuLLmn5MKICAgIHRoaXMuY29uc3RyYWluUm93RGF0YU1hcCA9IHt9OwogICAgdGhpcy5nZW5hcmF0ZUNvbnN0cmFpbnRNYXAodGhpcy5jYWxjdWxhdGVDb25zdHJhaW50Q29uZmlnSW4uY29uc3RyYWludENvbmZpZywgdGhpcy5nZXRUYWJsZURhdGEoKS5mdWxsRGF0YSk7CiAgICB0aGlzLiRyZWZzLnhHcmlkLnJlZnJlc2hDb2x1bW4oKTsKICB9LAogIC8vIOe6puadn+mDqOWIhiDljZXlhYPmoLzpl7TnuqbmnZ8KICBnZW5hcmF0ZUNlbGxDb25zdHJhaW50TWFwQWxsOiBmdW5jdGlvbiBnZW5hcmF0ZUNlbGxDb25zdHJhaW50TWFwQWxsKF9yZWY0MSkgewogICAgdmFyIHJvd0NvZGVDb25zdHJhaW50Q29uZmlnID0gX3JlZjQxLnJvd0NvZGVDb25zdHJhaW50Q29uZmlnLAogICAgICBkYXRhID0gX3JlZjQxLmRhdGEsCiAgICAgIGRhdGFDb2RlUm93TWFwID0gX3JlZjQxLmRhdGFDb2RlUm93TWFwLAogICAgICB0YWJsZUlkID0gX3JlZjQxLnRhYmxlSWQ7CiAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICBzZWxmLmVhY2gocm93Q29kZUNvbnN0cmFpbnRDb25maWcsIGZ1bmN0aW9uIChpdGVta2V5LCBpdGVtKSB7CiAgICAgIHNlbGYuZ2VuYXJhdGVDZWxsQ29uc3RyYWludE1hcFNpbmdsZShkYXRhQ29kZVJvd01hcCwgaXRlbSwgdGFibGVJZCwgcm93Q29kZUNvbnN0cmFpbnRDb25maWcpOwogICAgfSk7CiAgfSwKICBnZW5hcmF0ZUNlbGxDb25zdHJhaW50TWFwU2luZ2xlOiBmdW5jdGlvbiBnZW5hcmF0ZUNlbGxDb25zdHJhaW50TWFwU2luZ2xlKGRhdGFDb2RlUm93TWFwLCBpdGVtLCB0YWJsZUlkLCByb3dDb2RlQ29uc3RyYWludENvbmZpZykgewogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgdHJ5IHsKICAgICAgdmFyIGNvbnN0cmFpblJvd0RhdGFNYXAgPSB0aGlzLmNvbnN0cmFpblJvd0RhdGFNYXA7CiAgICAgIGl0ZW0uc3BsaXQoJy0tJiYtLScpLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7CiAgICAgICAgdmFyIHJvd0NvbnN0cmFpbnRBcnIgPSBpdGVtLnNwbGl0KCc6OicpOwogICAgICAgIHZhciBpdGVtQ29kZUZpZWxkQXJyID0gcm93Q29uc3RyYWludEFyclswXS5zcGxpdCgnOicpOwogICAgICAgIGNvbnN0cmFpblJvd0RhdGFNYXBbaXRlbUNvZGVGaWVsZEFyclswXV0gPSBjb25zdHJhaW5Sb3dEYXRhTWFwW2l0ZW1Db2RlRmllbGRBcnJbMF1dIHx8IHt9OwogICAgICAgIGNvbnN0cmFpblJvd0RhdGFNYXBbaXRlbUNvZGVGaWVsZEFyclswXV1baXRlbUNvZGVGaWVsZEFyclsxXV0gPSBjb25zdHJhaW5Sb3dEYXRhTWFwW2l0ZW1Db2RlRmllbGRBcnJbMF1dW2l0ZW1Db2RlRmllbGRBcnJbMV1dIHx8IHt9OwogICAgICAgIGNvbnN0cmFpblJvd0RhdGFNYXBbaXRlbUNvZGVGaWVsZEFyclswXV1baXRlbUNvZGVGaWVsZEFyclsxXV1bcm93Q29uc3RyYWludEFyclsxXV0gPSBzZWxmLnBhcnNpbmdDZWxsQ29uc3RyYWludENvbmZpZ1RvVmFsdWVEYXRhKHJvd0NvbnN0cmFpbnRBcnJbMl0sIHJvd0NvbnN0cmFpbnRBcnJbMV0sIGRhdGFDb2RlUm93TWFwLCB0YWJsZUlkKTsKICAgICAgICBpZiAocm93Q29uc3RyYWludEFyclsxXSA9PT0gJ3ZhbHVlJyB8fCByb3dDb25zdHJhaW50QXJyWzFdID09PSAnY2xlYXInKSB7CiAgICAgICAgICAvLyDlpoLmnpxh55qE5YC85pS55Y+Y5a+86Ie0Y+eahOWAvOaUueWPmO+8jGPnmoTlgLzmlLnlj5jlj4jkvJrmlLnlj5jlhbbku5bvvIzliJnpgJLlvZLosIPnlKgKICAgICAgICAgIGlmIChyb3dDb2RlQ29uc3RyYWludENvbmZpZ1tpdGVtQ29kZUZpZWxkQXJyWzBdICsgJzonICsgaXRlbUNvZGVGaWVsZEFyclsxXV0pIHsKICAgICAgICAgICAgc2VsZi5nZW5hcmF0ZUNlbGxDb25zdHJhaW50TWFwU2luZ2xlKGRhdGFDb2RlUm93TWFwLCByb3dDb2RlQ29uc3RyYWludENvbmZpZ1tpdGVtQ29kZUZpZWxkQXJyWzBdICsgJzonICsgaXRlbUNvZGVGaWVsZEFyclsxXV0sIHRhYmxlSWQsIHJvd0NvZGVDb25zdHJhaW50Q29uZmlnKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgfSBjYXRjaCAoZSkgewogICAgICBjb25zb2xlLmVycm9yKGUpOwogICAgfQogIH0sCiAgcGFyc2luZ0NlbGxDb25zdHJhaW50Q29uZmlnVG9WYWx1ZURhdGE6IGZ1bmN0aW9uIHBhcnNpbmdDZWxsQ29uc3RyYWludENvbmZpZ1RvVmFsdWVEYXRhKGV4cHJlc3Npb24sIHR5cGUsIGRhdGFDb2RlUm93TWFwLCB0YWJsZUlkKSB7CiAgICAvLyDnlJ/miJDlvZPmnaFhZ2U6MTAwMToxMDAxCiAgICAvLyB0eXBlOiB2aXNpYmxlIGVkaXRibGUgY2xlYXIgc3R5bGUgdmFsdWUgZ2V0RGF0YQogICAgdmFyIHZhbHVlID0gbnVsbDsKICAgIHN3aXRjaCAodHlwZSkgewogICAgICBjYXNlICd2aXNpYmxlJzoKICAgICAgICB2YWx1ZSA9ICEhdGhpcy5ldmFsRXByZXNzaW9uKHRoaXMucmVwbGFjZUNlbGxFcHJlc3Npb25WYWx1ZShleHByZXNzaW9uLCBkYXRhQ29kZVJvd01hcCwgdGFibGVJZCkpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdlZGl0YWJsZSc6CiAgICAgICAgdmFsdWUgPSAhIXRoaXMuZXZhbEVwcmVzc2lvbih0aGlzLnJlcGxhY2VDZWxsRXByZXNzaW9uVmFsdWUoZXhwcmVzc2lvbiwgZGF0YUNvZGVSb3dNYXAsIHRhYmxlSWQpKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnY2xlYXInOgogICAgICAgIHZhbHVlID0gISF0aGlzLmV2YWxFcHJlc3Npb24odGhpcy5yZXBsYWNlQ2VsbEVwcmVzc2lvblZhbHVlKGV4cHJlc3Npb24sIGRhdGFDb2RlUm93TWFwLCB0YWJsZUlkKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3ZhbHVlJzoKICAgICAgICB2YWx1ZSA9IHRoaXMuZXZhbEVwcmVzc2lvbih0aGlzLnJlcGxhY2VDZWxsRXByZXNzaW9uVmFsdWUoZXhwcmVzc2lvbiwgZGF0YUNvZGVSb3dNYXAsIHRhYmxlSWQpKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc3R5bGUnOgogICAgICAgIHZhbHVlID0gdGhpcy50cmFuc0V4cHJlc3Npb25Ub09iamVjdCh0aGlzLnBhc2luZ0V4cHJlc3Npb24odGhpcy5yZXBsYWNlQ2VsbEVwcmVzc2lvblZhbHVlKGV4cHJlc3Npb24sIGRhdGFDb2RlUm93TWFwLCB0YWJsZUlkKSksIGRhdGFDb2RlUm93TWFwKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnZ2V0RGF0YSc6CiAgICAgICAgdmFsdWUgPSB7fTsKICAgICAgICBicmVhazsKICAgIH0KICAgIHJldHVybiB2YWx1ZTsKICB9LAogIHJlcGxhY2VDZWxsRXByZXNzaW9uVmFsdWU6IGZ1bmN0aW9uIHJlcGxhY2VDZWxsRXByZXNzaW9uVmFsdWUoZXhwcmVzc2lvbiwgZGF0YUNvZGVSb3dNYXAsIHRhYmxlSWQpIHsKICAgIHRyeSB7CiAgICAgIHZhciBfc2VsZiA9IHRoaXM7CiAgICAgIHZhciByZWdSID0gbmV3IFJlZ0V4cCgnKHtbYS16QS1aMC05XzpcJF0qfSknLCAnaWcnKTsKICAgICAgdmFyIHJvd3NLZXkgPSBleHByZXNzaW9uLm1hdGNoKHJlZ1IpIHx8IFtdOwogICAgICByb3dzS2V5ID0gQXJyYXkuZnJvbShuZXcgU2V0KHJvd3NLZXkpKTsKICAgICAgaWYgKHJvd3NLZXkubGVuZ3RoKSB7CiAgICAgICAgZm9yICh2YXIga2V5Q0YgaW4gcm93c0tleSkgewogICAgICAgICAgdmFyIGZvcm11bGFBcnIgPSByb3dzS2V5W2tleUNGXS5yZXBsYWNlKC9ce3xcfS9nLCAnJykuc3BsaXQoJzonKTsKICAgICAgICAgIHZhciByZWcgPSBuZXcgUmVnRXhwKCcoeycgKyBmb3JtdWxhQXJyLmpvaW4oJzonKS5yZXBsYWNlKC9cJC9pZywgJ1xcJCcpICsgJ30pJywgJ2lnJyk7CiAgICAgICAgICBpZiAoZm9ybXVsYUFyclswXSA9PT0gdGFibGVJZCkgewogICAgICAgICAgICBpZiAoZGF0YUNvZGVSb3dNYXBbZm9ybXVsYUFyclsyXV0pIHsKICAgICAgICAgICAgICBleHByZXNzaW9uID0gZXhwcmVzc2lvbi5yZXBsYWNlKHJlZywgX3NlbGYuZ2V0RGF0YUNvZGVSb3dNYXBDdW11bGF0aXZlUmVzdWx0KGRhdGFDb2RlUm93TWFwW2Zvcm11bGFBcnJbMl1dLCBmb3JtdWxhQXJyWzFdKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgZXhwcmVzc2lvbiA9IGV4cHJlc3Npb24ucmVwbGFjZShyZWcsIDApOwogICAgICAgICAgICB9CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBleHByZXNzaW9uID0gZXhwcmVzc2lvbi5yZXBsYWNlKHJlZywgMCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBleHByZXNzaW9uOwogICAgfSBjYXRjaCAoZSkgewogICAgICBjb25zb2xlLmVycm9yKGUpOwogICAgICByZXR1cm4gJyc7CiAgICB9CiAgfSwKICB1cGRhdGVkRGF0YUFmdGVyQ29uc3RyYWludDogZnVuY3Rpb24gdXBkYXRlZERhdGFBZnRlckNvbnN0cmFpbnQoX3JlZjQyKSB7CiAgICB2YXIgZGF0YSA9IF9yZWY0Mi5kYXRhLAogICAgICBjb25zdHJhaW5Sb3dEYXRhTWFwID0gX3JlZjQyLmNvbnN0cmFpblJvd0RhdGFNYXAsCiAgICAgIGRhdGFDb2RlUm93TWFwID0gX3JlZjQyLmRhdGFDb2RlUm93TWFwLAogICAgICBkYXRhQ29kZVJvd0FyciA9IF9yZWY0Mi5kYXRhQ29kZVJvd0FycjsKICAgIC8vIOabtOaWsOihqOagvOaVsOaNrgogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgdmFyIGNhbGNBbmRDb25zdHJhaW50SXRlbUNvZGVGaWVsZCA9IHRoaXMuY2FsY3VsYXRlQ29uc3RyYWludENvbmZpZ0luLmNhbGNBbmRDb25zdHJhaW50SXRlbUNvZGVGaWVsZDsKICAgIHNlbGYuZWFjaChkYXRhQ29kZVJvd0FyciwgZnVuY3Rpb24gKHJvd0luZGV4LCByb3cpIHsKICAgICAgdmFyIGN1clJvd0NvbnN0cmFpblJvd0RhdGFNYXAgPSBjb25zdHJhaW5Sb3dEYXRhTWFwW3Jvd1tjYWxjQW5kQ29uc3RyYWludEl0ZW1Db2RlRmllbGRdXTsKICAgICAgc2VsZi5lYWNoKGN1clJvd0NvbnN0cmFpblJvd0RhdGFNYXAsIGZ1bmN0aW9uIChpdGVta2V5LCBpdGVtKSB7CiAgICAgICAgaWYgKGl0ZW0udmFsdWUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgcm93W2l0ZW1rZXldID0gaXRlbS52YWx1ZTsKICAgICAgICB9IGVsc2UgaWYgKGl0ZW0uY2xlYXIpIHsKICAgICAgICAgIHJvd1tpdGVta2V5XSA9ICcnOwogICAgICAgIH0gZWxzZSB7fQogICAgICB9KTsKICAgIH0pOwogICAgcmV0dXJuIGRhdGE7CiAgfQp9Owp2YXIgb3RoZXJGbiA9IHsKICBnZXRMaXN0RGF0YTogZnVuY3Rpb24gZ2V0TGlzdERhdGEoKSB7CiAgICAvLyDojrflj5booajljZXmlbDmja4KICAgIHZhciBfdGhpcyQkcmVmcyR4R3JpZCRnZXQzID0gdGhpcy4kcmVmcy54R3JpZC5nZXRUYWJsZURhdGEoKSwKICAgICAgZnVsbERhdGEgPSBfdGhpcyQkcmVmcyR4R3JpZCRnZXQzLmZ1bGxEYXRhOwogICAgdmFyIGRhdGEgPSBmdWxsRGF0YSB8fCBbXTsKICAgIHJldHVybiB0aGlzLmRlYWxEYXRhKGRhdGEpOwogIH0sCiAgZGVhbERhdGE6IGZ1bmN0aW9uIGRlYWxEYXRhKGRhdGEpIHsKICAgIHZhciBuZXdEYXRhID0gW107CiAgICBkYXRhLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgdmFyIGl0ZW1WYWwgPSBPYmplY3QuYXNzaWduKHt9LCBpdGVtKTsKICAgICAgT2JqZWN0LmtleXMoaXRlbVZhbCkubWFwKGZ1bmN0aW9uICh2YWwpIHsKICAgICAgICB2YXIgdmFsdWUgPSBTdHJpbmcoaXRlbVZhbFt2YWxdKSB8fCAnJzsKICAgICAgICBpZiAodmFsdWUuaW5jbHVkZXMoJ2luaXRJZCcpKSB7CiAgICAgICAgICB2YXIgcHJlZml4ID0gdmFsLnN1YnN0cigwLCB2YWwuaW5kZXhPZignaWQnKSk7CiAgICAgICAgICBpdGVtVmFsW3ZhbF0gPSAnJzsKICAgICAgICAgIGl0ZW1WYWxbcHJlZml4ICsgJ2NvZGUnXSA9ICcnOwogICAgICAgICAgaXRlbVZhbFtwcmVmaXggKyAnbmFtZSddID0gJyc7CiAgICAgICAgfQogICAgICB9KTsKICAgICAgbmV3RGF0YS5wdXNoKGl0ZW1WYWwpOwogICAgfSk7CiAgICByZXR1cm4gbmV3RGF0YTsKICB9LAogIHJlZ1RyZWVQcmVmaXg6IGZ1bmN0aW9uIHJlZ1RyZWVQcmVmaXgoaXRlbSkgewogICAgdmFyIHJlZyA9IC9cdypfJC9nOwogICAgcmV0dXJuIHJlZy50ZXN0KGl0ZW0pOwogIH0sCiAgLy8g6YGN5Y6G5q2j5YiZ5a+56LGh77yM57uZ5qCR57uf5LiA6Ieq5Yqo5re75Yqg5q2j5YiZCiAgYWRkVHJlZVJlZzogZnVuY3Rpb24gYWRkVHJlZVJlZyhmb3JtVmFsaWRhdGlvbkNvbmZpZykgewogICAgdmFyIF90aGlzMzUgPSB0aGlzOwogICAgdmFyIHJlZyA9IC9eKD8haW5pdElkKS9nOwogICAgT2JqZWN0LmtleXMoZm9ybVZhbGlkYXRpb25Db25maWcpLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgaWYgKF90aGlzMzUucmVnVHJlZVByZWZpeChpdGVtKSkgewogICAgICAgIGZvcm1WYWxpZGF0aW9uQ29uZmlnW2l0ZW1dWzBdLnBhdHRlcm4gPSByZWc7CiAgICAgIH0KICAgIH0pOwogICAgcmV0dXJuIGZvcm1WYWxpZGF0aW9uQ29uZmlnOwogIH0sCiAgLy8g6YGN5Y6G77yM5Yqo5oCB57uZ5qCR57uE5Lu25re75Yqg5Y+M5ZCR57uR5a6a55qE5YmN57yACiAgYWRkVHJlZVByZWZpeEtleTI6IGZ1bmN0aW9uIGFkZFRyZWVQcmVmaXhLZXkyKHRyZWVEYXRhKSB7CiAgICB2YXIgX3RoaXMzNiA9IHRoaXM7CiAgICB2YXIgcmVnID0gL19pZCQvOwogICAgdmFyIHRyZWVBcnIgPSB0cmVlRGF0YSB8fCBbXTsKICAgIHRyZWVBcnIuZm9yRWFjaChmdW5jdGlvbiAocm93KSB7CiAgICAgIE9iamVjdC5rZXlzKHJvdykuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgIC8vIOS7pV9pZOe7k+Wwvu+8jOW5tuS4lOWFtuWJjee8gOWcqOaVsOaNruWMheS4reS4jeWtmOWcqOaXtu+8jOWKqOaAgee7meWFtue7keWumuS4gOS4quWJjee8gAogICAgICAgIGlmIChyZWcudGVzdChpdGVtKSkgewogICAgICAgICAgdmFyIHByZWZpeCA9IGl0ZW0uc3Vic3RyKDAsIGl0ZW0uaW5kZXhPZignaWQnKSk7CiAgICAgICAgICBpZiAoIXJvdy5oYXNPd25Qcm9wZXJ0eShwcmVmaXgpKSB7CiAgICAgICAgICAgIF90aGlzMzYuJHNldChyb3csIHByZWZpeCwgJycpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSk7CiAgICB9KTsKICAgIHJldHVybiB0cmVlRGF0YTsKICB9LAogIC8vIOmAkuW9kuaAu+iuoeW4pmNoaWxkcmVu55qE5ZCI6K6h5oC75ZKMCiAgbG9vcEFkZFN1YlRvdGFsOiBmdW5jdGlvbiBsb29wQWRkU3ViVG90YWwoKSB7CiAgICB2YXIgdG90YWwgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IDA7CiAgICB2YXIgaXRlbURhdGEgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9OwogICAgdmFyIHByb3BlcnR5ID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgPyBhcmd1bWVudHNbMl0gOiB1bmRlZmluZWQ7CiAgICBpZiAoaXRlbURhdGEuY2hpbGRyZW4gJiYgaXRlbURhdGEuY2hpbGRyZW4ubGVuZ3RoKSB7CiAgICAgIGl0ZW1EYXRhLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGl0KSB7CiAgICAgICAgdG90YWwgPSBvdGhlckZuLmxvb3BBZGRTdWJUb3RhbCh0b3RhbCwgaXQsIHByb3BlcnR5KTsKICAgICAgfSk7CiAgICB9CiAgICB2YXIgaXRWYWwgPSAodHlwZW9mIGl0ZW1EYXRhW3Byb3BlcnR5XSA9PT0gJ251bWJlcicgfHwgdHlwZW9mIGl0ZW1EYXRhW3Byb3BlcnR5XSA9PT0gJ3N0cmluZycpICYmIGl0ZW1EYXRhW3Byb3BlcnR5XSAhPT0gJycgPyBwYXJzZUZsb2F0KGl0ZW1EYXRhW3Byb3BlcnR5XS50b1N0cmluZygpLnNwbGl0KCcsJykuam9pbignJykpIDogMDsKICAgIHRvdGFsICs9IE51bWJlcihpdFZhbCk7CiAgICByZXR1cm4gdG90YWw7CiAgfQp9Owp2YXIgYmF0Y2hNb2RpZnkgPSB7CiAgLy8g5om56YeP5L+u5pS5CiAgb25CYXRjaE1vZGlmeUl0ZW1DaGFuZ2U6IGZ1bmN0aW9uIG9uQmF0Y2hNb2RpZnlJdGVtQ2hhbmdlKG9iaiwgbW9kaWZ5Rm9ybSkgewogICAgdGhpcy4kZW1pdCgnb25CYXRjaE1vZGlmeUl0ZW1DaGFuZ2UnLCBvYmosIG1vZGlmeUZvcm0pOwogIH0sCiAgb21CYXRjaE1vZGlmeVN1cmVDbGljazogZnVuY3Rpb24gb21CYXRjaE1vZGlmeVN1cmVDbGljayhfcmVmNDMpIHsKICAgIHZhciBtb2RpZnlJdGVtID0gX3JlZjQzLm1vZGlmeUl0ZW0sCiAgICAgIGZvcm1EYXRhID0gX3JlZjQzLmZvcm1EYXRhOwogICAgLy8g5om56YeP5L+u5pS556Gu6K6kCiAgICB2YXIgc2VsZWN0aW9uID0gdGhpcy5zZWxlY3Rpb247CiAgICBzZWxlY3Rpb24uZm9yRWFjaChmdW5jdGlvbiAocm93LCBpbmRleCkgewogICAgICByb3cgPSBPYmplY3QuYXNzaWduKHJvdywgZm9ybURhdGEpOwogICAgfSk7CiAgICBzZWxmLnJlQ2FsY0FuZFJlTG9hZFRhYmxlRGF0YSh7CiAgICAgIGRhdGE6IHRoaXMuZ2V0VGFibGVEYXRhKCkuZnVsbERhdGEsCiAgICAgIG1vZGlmeUl0ZW06IG1vZGlmeUl0ZW0sCiAgICAgIG1vZGlmeURhdGE6IGZvcm1EYXRhCiAgICB9KS50aGVuKGZ1bmN0aW9uIChvYmopIHsKICAgICAgc2VsZi4kZW1pdCgnb25CYXRjaE1vZGlmeVN1Y2Nlc3MnLCBvYmosIHNlbGYsIHNlbGYuJHJlZnMueEdyaWQpOwogICAgfSk7CiAgfQp9Owp2YXIgZXhwb3J0QW5kSW1wb3J0Rm4gPSB7CiAgLyoqDQogICAqIOWvvOWHuuaVsOaNruihjOebuOWFs+aVsOaNruWtl+auteiuoeeulw0KICAgKiBAZGVzY3JpcHRpb24g6YeR6aKd5YiX5qC55o2u5Y2V5L2N6K6h566X77yb6L+b5bqm55m+5YiG5q+U5YiX5re75YqgJyUnDQogICAqIEBwYXJhbXMgcm93IHtPYmplY3R9IOW9k+WJjeihjOaVsOaNrg0KICAgKiBAcGFyYW1zIG1vbmV5S2V5cyB7QXJyYXl9IOmHkemineWIl2ZpZWxk5pWw57uEDQogICAqIEBwYXJhbXMgcmF0aW9LZXlzIHtBcnJheX0g6L+b5bqm5YiXZmllbGTmlbDnu4QNCiAgICogKi8KICBjb21wdXRlZEV4cG9ydFJvdzogZnVuY3Rpb24gY29tcHV0ZWRFeHBvcnRSb3cocm93LCBtb25leUtleXMsIHJhdGlvS2V5cykgewogICAgdmFyIF90aGlzMzcgPSB0aGlzOwogICAgLy8g6YeR6aKd5YiX5qC55o2u5Y2V5L2N6L+b6KGM6K6h566XCiAgICBtb25leUtleXMuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgIHJvd1trZXldID0gcm93W2tleV0gJiYgX3RoaXMzNy5tb25leVVuaXQgPyByb3dba2V5XSAvIF90aGlzMzcubW9uZXlVbml0IDogJyc7CiAgICB9KTsKICAgIC8vIOi/m+W6puWIl+WinuWKoCUKICAgIC8vIHJhdGlvS2V5cy5mb3JFYWNoKGtleSA9PiB7CiAgICAvLyAgIHJvd1trZXldID0gcm93W2tleV0gPyBOdW1iZXIucHJvdG90eXBlLnRvRml4ZWQuY2FsbChyb3dba2V5XSwgMSkgOiAnJwogICAgLy8gfSkKICB9LAogIGdldFByaW50T3B0aW9uOiBmdW5jdGlvbiBnZXRQcmludE9wdGlvbihleHBvcnRNb2RhbEZvcm1EYXRhKSB7CiAgICB2YXIgY2hlY2tDb2x1bW5zID0gW107CiAgICB0aGlzLiRYRVV0aWxzLmVhY2hUcmVlKGV4cG9ydE1vZGFsRm9ybURhdGEuY29sdW1ucywgZnVuY3Rpb24gKGNvbHVtbikgewogICAgICB2YXIgaXNDb2xHcm91cCA9IGNvbHVtbi5jaGlsZHJlbiAmJiBjb2x1bW4uY2hpbGRyZW4ubGVuZ3RoOwogICAgICBpZiAoIWlzQ29sR3JvdXApIHsKICAgICAgICBjaGVja0NvbHVtbnMucHVzaChjb2x1bW4pOwogICAgICB9CiAgICB9KTsKICAgIHJldHVybiB7CiAgICAgIGRhdGE6IGV4cG9ydE1vZGFsRm9ybURhdGFbZXhwb3J0TW9kYWxGb3JtRGF0YS5kYXRhVHlwZV0sCiAgICAgIGlzSGVhZGVyOiB0cnVlLAogICAgICBjb2x1bW5zOiBjaGVja0NvbHVtbnMKICAgIH07CiAgfSwKICBvblByaW50Q2xpY2s6IGZ1bmN0aW9uIG9uUHJpbnRDbGljayhvYmopIHsKICAgIHRoaXMuJHJlZnMueEdyaWQuJHJlZnMueFRhYmxlLnByaW50KE9iamVjdC5hc3NpZ24oe30sIHRoaXMuZ2V0UHJpbnRPcHRpb24ob2JqKSkpOwogICAgLy8gdGhpcy4kVlhFVGFibGUucHJpbnQoKQogIH0sCiAgdHJpZ2dlckV4cG9ydE9wdGlvbjogZnVuY3Rpb24gdHJpZ2dlckV4cG9ydE9wdGlvbihvYmopIHsKICAgIHZhciBfdGhpczM4ID0gdGhpczsKICAgIC8vIOinpuWPkeWvvOWHuuWKqOS9nAogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgdmFyIGNvbHVtbnMgPSB0aGlzLmRlZXBDb3B5KHRoaXMudGFibGVDb2x1bW5zQ29uZmlnKTsKICAgIHZhciBfdGhpcyRnZXRUYWJsZURhdGEgPSB0aGlzLmdldFRhYmxlRGF0YSgpLAogICAgICB0YWJsZURhdGEgPSBfdGhpcyRnZXRUYWJsZURhdGEudGFibGVEYXRhLAogICAgICBmdWxsRGF0YSA9IF90aGlzJGdldFRhYmxlRGF0YS5mdWxsRGF0YSwKICAgICAgdHJlZUV4cGFuZERhdGEgPSBfdGhpcyRnZXRUYWJsZURhdGEudHJlZUV4cGFuZERhdGEsCiAgICAgIHNlbGVjdGlvbiA9IF90aGlzJGdldFRhYmxlRGF0YS5zZWxlY3Rpb247CgogICAgLy8g6I635Y+W6YeR6aKd44CB6L+b5bqm54m55q6K5a2X5q615YiX6KGoCiAgICB2YXIgbW9uZXlLZXlzID0gW10sCiAgICAgIHJhdGlvS2V5cyA9IFtdOwogICAgdGhpcy4kWEVVdGlscy5lYWNoVHJlZShjb2x1bW5zLCBmdW5jdGlvbiAoaXRlbSkgewogICAgICB2YXIgX2l0ZW0kY2VsbFJlbmRlciwgX2l0ZW0kY2VsbFJlbmRlcjI7CiAgICAgIGlmICgoaXRlbSA9PT0gbnVsbCB8fCBpdGVtID09PSB2b2lkIDAgPyB2b2lkIDAgOiBpdGVtLnR5cGUpID09PSAnbW9uZXknIHx8ICgoX2l0ZW0kY2VsbFJlbmRlciA9IGl0ZW0uY2VsbFJlbmRlcikgPT09IG51bGwgfHwgX2l0ZW0kY2VsbFJlbmRlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2l0ZW0kY2VsbFJlbmRlci5uYW1lKSA9PT0gJyR2eGVNb25leScpIHsKICAgICAgICBtb25leUtleXMucHVzaChpdGVtLmZpZWxkKTsKICAgICAgfSBlbHNlIGlmICgoKF9pdGVtJGNlbGxSZW5kZXIyID0gaXRlbS5jZWxsUmVuZGVyKSA9PT0gbnVsbCB8fCBfaXRlbSRjZWxsUmVuZGVyMiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2l0ZW0kY2VsbFJlbmRlcjIubmFtZSkgPT09ICckdnhlUmF0aW8nKSB7CiAgICAgICAgcmF0aW9LZXlzLnB1c2goaXRlbS5maWVsZCk7CiAgICAgIH0KICAgIH0pOwogICAgLy8g5rex5ou36LSd77yM5Li65ZCO57ut6K6h566X55yf5a6e5YC85YGa5YeG5aSHCiAgICB2YXIgX3JlZjQ0ID0gW3RoaXMuJFhFVXRpbHMuY2xvbmUoZnVsbERhdGEsIHRydWUpLCB0aGlzLiRYRVV0aWxzLmNsb25lKHRyZWVFeHBhbmREYXRhLCB0cnVlKV0sCiAgICAgIGNvbXB1dGVkRnVsbERhdGEgPSBfcmVmNDRbMF0sCiAgICAgIGNvbXB1dGVkRXhwYW5kRGF0YSA9IF9yZWY0NFsxXTsKICAgIHZhciBmdWxsRGF0YVRyZWVBcnIgPSBYRVV0aWxzLnRvVHJlZUFycmF5KGNvbXB1dGVkRnVsbERhdGEpOwogICAgdmFyIHRyZWVFeHBhbmREYXRhVHJlZUFyciA9IFhFVXRpbHMudG9UcmVlQXJyYXkoY29tcHV0ZWRFeHBhbmREYXRhKTsKICAgIHRoaXMuJFhFVXRpbHMuZWFjaFRyZWUoY29tcHV0ZWRGdWxsRGF0YSwgZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgaWYgKHNlbGYuaXNUcmVlU2VxVG9GbGF0KSB7CiAgICAgICAgdmFyIF9mdWxsRGF0YVRyZWVBcnIkOwogICAgICAgIHZhciBmaW5kSW5kZXggPSBmdWxsRGF0YVRyZWVBcnIuZmluZEluZGV4KGZ1bmN0aW9uIChpdCkgewogICAgICAgICAgcmV0dXJuIGl0W3Jvd1V1aWRLZXlOYW1lXSA9PT0gaXRlbVtyb3dVdWlkS2V5TmFtZV07CiAgICAgICAgfSk7CiAgICAgICAgaXRlbS5zZXFJbmRleCA9ICgoX2Z1bGxEYXRhVHJlZUFyciQgPSBmdWxsRGF0YVRyZWVBcnJbMF0pID09PSBudWxsIHx8IF9mdWxsRGF0YVRyZWVBcnIkID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZnVsbERhdGFUcmVlQXJyJC5pZCkgPT09ICcjJyA/IGl0ZW0uaWQgPT09ICcjJyA/ICcjJyA6IGZpbmRJbmRleCA6IGZpbmRJbmRleCArIDE7CiAgICAgIH0KICAgICAgY29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2xJdGVtKSB7CiAgICAgICAgLy8g5re75Yqg5a+85Ye6Zm9ybWF0dGVy5a2X5q6155qE6YWN572uCiAgICAgICAgaWYgKGNvbEl0ZW0uZXhwb3J0Rm9ybWF0dGVyKSB7CiAgICAgICAgICB2YXIgZmllbGQgPSBjb2xJdGVtLmZpZWxkOwogICAgICAgICAgaWYgKE9iamVjdC5oYXNPd24oaXRlbSwgZmllbGQpICYmIGl0ZW1bY29sSXRlbS5maWVsZF0pIHsKICAgICAgICAgICAgdmFyIG5ld0Zvcm1hdHRlclZhbHVlID0gY29sSXRlbS5mb3JtYXR0ZXIoewogICAgICAgICAgICAgIHJvdzogaXRlbQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgUmVmbGVjdC5zZXQoaXRlbSwgZmllbGQsIG5ld0Zvcm1hdHRlclZhbHVlKTsKICAgICAgICAgICAgcmV0dXJuIGl0ZW07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgICAgX3RoaXMzOC5jb21wdXRlZEV4cG9ydFJvdyhpdGVtLCBtb25leUtleXMsIHJhdGlvS2V5cyk7CiAgICB9KTsKICAgIHRoaXMuJFhFVXRpbHMuZWFjaFRyZWUoY29tcHV0ZWRFeHBhbmREYXRhLCBmdW5jdGlvbiAoaXRlbSkgewogICAgICBpZiAoc2VsZi5pc1RyZWVTZXFUb0ZsYXQpIHsKICAgICAgICB2YXIgX3RyZWVFeHBhbmREYXRhVHJlZUFyOwogICAgICAgIHZhciBmaW5kSW5kZXggPSB0cmVlRXhwYW5kRGF0YVRyZWVBcnIuZmluZEluZGV4KGZ1bmN0aW9uIChpdCkgewogICAgICAgICAgcmV0dXJuIGl0W3Jvd1V1aWRLZXlOYW1lXSA9PT0gaXRlbVtyb3dVdWlkS2V5TmFtZV07CiAgICAgICAgfSk7CiAgICAgICAgaXRlbS5zZXFJbmRleCA9ICgoX3RyZWVFeHBhbmREYXRhVHJlZUFyID0gdHJlZUV4cGFuZERhdGFUcmVlQXJyWzBdKSA9PT0gbnVsbCB8fCBfdHJlZUV4cGFuZERhdGFUcmVlQXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF90cmVlRXhwYW5kRGF0YVRyZWVBci5pZCkgPT09ICcjJyA/IGl0ZW0uaWQgPT09ICcjJyA/ICcjJyA6IGZpbmRJbmRleCA6IGZpbmRJbmRleCArIDE7CiAgICAgIH0KICAgICAgY29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChjb2xJdGVtKSB7CiAgICAgICAgLy8g5re75Yqg5a+85Ye6Zm9ybWF0dGVy5a2X5q6155qE6YWN572uCiAgICAgICAgaWYgKGNvbEl0ZW0uZXhwb3J0Rm9ybWF0dGVyKSB7CiAgICAgICAgICB2YXIgZmllbGQgPSBjb2xJdGVtLmZpZWxkOwogICAgICAgICAgaWYgKE9iamVjdC5oYXNPd24oaXRlbSwgZmllbGQpICYmIGl0ZW1bY29sSXRlbS5maWVsZF0pIHsKICAgICAgICAgICAgdmFyIG5ld0Zvcm1hdHRlclZhbHVlID0gY29sSXRlbS5mb3JtYXR0ZXIoewogICAgICAgICAgICAgIHJvdzogaXRlbQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgUmVmbGVjdC5zZXQoaXRlbSwgZmllbGQsIG5ld0Zvcm1hdHRlclZhbHVlKTsKICAgICAgICAgICAgcmV0dXJuIGl0ZW07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KTsKICAgICAgX3RoaXMzOC5jb21wdXRlZEV4cG9ydFJvdyhpdGVtLCBtb25leUtleXMsIHJhdGlvS2V5cyk7CiAgICB9KTsKICAgIHZhciBsYXRlc3RUYWJsZURhdGEgPSB7CiAgICAgIGNvbHVtbnM6IGNvbHVtbnMsCiAgICAgIC8vIOihqOWktOmFjee9rgogICAgICBmdWxsRGF0YTogY29tcHV0ZWRGdWxsRGF0YSwKICAgICAgLy8g5L2/55So6K6h566X5ZCO55qEZnVsbERhdGEKICAgICAgdGFibGVEYXRhOiB0YWJsZURhdGEsCiAgICAgIHRyZWVFeHBhbmREYXRhOiBjb21wdXRlZEV4cGFuZERhdGEsCiAgICAgIC8vIOS9v+eUqOiuoeeul+WQjueahGV4cGVuZERhdGEKICAgICAgc2VsZWN0aW9uOiBzZWxlY3Rpb24KICAgIH07CiAgICB0aGlzLmV4cG9ydE1vZGFsRGF0YSA9IE9iamVjdC5hc3NpZ24oewogICAgICBpc0V4cG9ydFRyZWU6ICEhc2VsZi50cmVlQ29uZmlnSW4sCiAgICAgIHNhdmVUeXBlOiAnLnhsc3gnLAogICAgICBmaWxlTmFtZTogJ2V4cG9ydCcsCiAgICAgIC8vIOaWh+S7tuWQjQogICAgICBkYXRhVHlwZTogIXNlbGYudHJlZUNvbmZpZ0luID8gJ2Z1bGxEYXRhJyA6ICdmdWxsRGF0YScsCiAgICAgIGlzRXhwb3J0SGVhZDogdHJ1ZSwKICAgICAgLy8g5piv5ZCm5a+85Ye66KGo5aS0CiAgICAgIGlzRXhwb3J0Rm9vdGVyOiBmYWxzZSwKICAgICAgLy8g5piv5ZCm5a+85Ye66KGo5bC+6YOoCiAgICAgIGlzRXhwb3J0T25seVNvdXJjZUZpZWxkOiBmYWxzZSwKICAgICAgLy8g5piv5ZCm5Y+q5a+85Ye65pWw5o2u5rqQ6KGo5aS05a2X5q6177yMCiAgICAgIGlzRXhwb3J0T25seVZpZXdUaXRsZTogZmFsc2UsCiAgICAgIC8vIOaYr+WQpuWPquWvvOWHuuaVsOaNruihqOWktOWQjeensO+8jAogICAgICBpc0V4cG9ydE9yaWdpbmFsRGF0YTogZmFsc2UsCiAgICAgIC8vIOaYr+WQpuWvvOWHuua6kOaVsOaNrgogICAgICBpc0V4cG9ydERhdGE6IHRydWUsCiAgICAgIC8vIOaYr+WQpuWvvOWHuuaVsOaNrgogICAgICBjb2x1bW5zOiBjb2x1bW5zLAogICAgICAvLyDooajlpLTphY3nva4KICAgICAgZnVsbERhdGE6IGZ1bGxEYXRhLAogICAgICB0YWJsZURhdGE6IHRhYmxlRGF0YSwKICAgICAgdHJlZUV4cGFuZERhdGE6IHRyZWVFeHBhbmREYXRhLAogICAgICBkYXRhczogW10sCiAgICAgIC8vIOa6kOaVsOaNriwg5aaC5p6c6IOD56m65pWw57uE5YiZ5Y+WZGF0YVR5cGUg5a+55bqU55qE5pWw5o2u77yM5ZCm5YiZ55u05o6l5LulZGF0YXPlr7zlh7oKICAgICAgc2VsZWN0aW9uOiBzZWxlY3Rpb24sCiAgICAgIC8vIOmAieS4reaVsOaNrgogICAgICBpbmRleDogdHJ1ZSwKICAgICAgLy8g5piv5ZCm5re75Yqg5bqP5Y+3LAogICAgICBpZ25vcmVDb2xzVHlwZXM6IFsnZHJhZ1NvcnQnLCAnc2VxJywgJ2NoZWNrYm94JywgJ3JhZGlvJywgJ29wdGlvblJvdycsICdleHBhbmQnLCAnYXR0YWNoJywgJ2FjaCcsICdsaXN0JywgJ2F0dGFjaGxpc3QnXSwKICAgICAgLy8g5b+955Wl5a+85Ye655qE5YiX57G75Z6LCiAgICAgIHZpZXdWYWx1ZUZvcm1hdDogZnVuY3Rpb24gdmlld1ZhbHVlRm9ybWF0KHZhbHVlLCByb3csIGNvbHVtbikgewogICAgICAgIC8vIOinhuWbvuaVsOaNruagvOW8j+WMluaWueazlQogICAgICAgIC8vIHJldHVybiB2YWx1ZQogICAgICB9CiAgICB9LCB0aGlzLnRhYmxlR2xvYmFsQ29uZmlnLmN1c3RvbUV4cG9ydENvbmZpZywgdGhpcy5leHBvcnRNb2RhbERhdGEgfHwge30sIG9iaiB8fCB7fSwgbGF0ZXN0VGFibGVEYXRhKTsKICAgIHRoaXMuZXhwb3J0TW9kYWxWaXNpYmxlID0gdHJ1ZTsKICB9LAogIG9uRXhwb3J0Q2xpY2s6IGZ1bmN0aW9uIG9uRXhwb3J0Q2xpY2sob2JqLCBlYykgewogICAgdmFyIF90aGlzMzkgPSB0aGlzOwogICAgLy8g56Gu5a6a5a+85Ye654K55Ye75LqL5Lu2CiAgICBvYmouc3VjY2Vzc0NiID0gZnVuY3Rpb24gKCkgewogICAgICBfdGhpczM5LmV4cG9ydE1vZGFsVmlzaWJsZSA9IGZhbHNlOwogICAgfTsKICAgIGlmIChvYmoub25seUNvbmZpZ0V4cG9ydCkgewogICAgICB0aGlzLiRlbWl0KCdvbkV4cG9ydENsaWNrJywgb2JqLCBlYyk7CiAgICB9IGVsc2UgewogICAgICBjb25zb2xlLmxvZyhvYmopOwogICAgICB0aGlzLiRFeHBvcnQuZXhwb3J0RXhjZWwob2JqLCB0aGlzKTsKICAgIH0KICB9LAogIGRlYWxFeHBvcnRWaWV3RGF0YTogZnVuY3Rpb24gZGVhbEV4cG9ydFZpZXdEYXRhKCkgewogICAgdmFyIF90aGlzNDAgPSB0aGlzOwogICAgdmFyIG9iaiA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogewogICAgICBjb25sdW1zOiBbXSwKICAgICAgdmlld0RhdGE6IFtdCiAgICB9OwogICAgLy8g5aSE55CGIOWvvOWFpeaVsOaNrgogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgdmFyIF90aGlzJGdlbmVyYXRlQ29sdW1ucyA9IHRoaXMuZ2VuZXJhdGVDb2x1bW5zQWxsTWFwKG9iai5jb25sdW1zKSwKICAgICAgdmlld1RvU291cmNlTWFwID0gX3RoaXMkZ2VuZXJhdGVDb2x1bW5zLnZpZXdUb1NvdXJjZU1hcCwKICAgICAgdGFibGVDb2x1bW5zVGl0bGVGaWVsZE1hcCA9IF90aGlzJGdlbmVyYXRlQ29sdW1ucy50YWJsZUNvbHVtbnNUaXRsZUZpZWxkTWFwLAogICAgICByb3dzT2JqVGVtcCA9IF90aGlzJGdlbmVyYXRlQ29sdW1ucy5yb3dzT2JqVGVtcCwKICAgICAgY29sRm9ybXVsYUNvbmZpZ20gPSBfdGhpcyRnZW5lcmF0ZUNvbHVtbnMuY29sRm9ybXVsYUNvbmZpZ20sCiAgICAgIGNvbEZvcm11bGFDb25maWcgPSBfdGhpcyRnZW5lcmF0ZUNvbHVtbnMuY29sRm9ybXVsYUNvbmZpZzsKICAgIHJldHVybiBvYmoudmlld0RhdGEubWFwKGZ1bmN0aW9uIChyb3csIHJvd0luZGV4KSB7CiAgICAgIE9iamVjdC5rZXlzKHJvdykubWFwKGZ1bmN0aW9uIChrZXksIGtleUluZGV4KSB7CiAgICAgICAgcm93W3RhYmxlQ29sdW1uc1RpdGxlRmllbGRNYXBba2V5XV0gPSBzZWxmLnJldmVyc2VQYXJzZVZpZXdEYXRhVG9zb3VyY2Uodmlld1RvU291cmNlTWFwW3RhYmxlQ29sdW1uc1RpdGxlRmllbGRNYXBba2V5XV0sIHJvd1trZXldKTsKICAgICAgfSk7CiAgICAgIHJvdyA9IE9iamVjdC5hc3NpZ24oe30sIHJvd3NPYmpUZW1wLCByb3cpOwogICAgICByZXR1cm4gX3RoaXM0MC5yZWR1Y3Rpb25Db2xGb3JtdWxhKGNvbEZvcm11bGFDb25maWdtLCBzZWxmLnJlZHVjdGlvbkNvbEZvcm11bGEoY29sRm9ybXVsYUNvbmZpZywgcm93KSk7CiAgICB9KTsKICB9LAogIGRlYUltcG9ydFZpZXdEYXRhOiBmdW5jdGlvbiBkZWFJbXBvcnRWaWV3RGF0YSgpIHsKICAgIHZhciBfdGhpczQxID0gdGhpczsKICAgIHZhciBvYmogPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHsKICAgICAgY29ubHVtczogW10sCiAgICAgIHZpZXdEYXRhOiBbXSwKICAgICAgdmFsaVJ1bGVzOiB7fQogICAgfTsKICAgIC8vIOWkhOeQhiDlr7zlhaXmlbDmja4KICAgIHZhciBzZWxmID0gdGhpczsKICAgIHZhciBfdGhpcyRnZW5lcmF0ZUNvbHVtbnMyID0gdGhpcy5nZW5lcmF0ZUNvbHVtbnNBbGxNYXAob2JqLmNvbmx1bXMpLAogICAgICB2aWV3VG9Tb3VyY2VNYXAgPSBfdGhpcyRnZW5lcmF0ZUNvbHVtbnMyLnZpZXdUb1NvdXJjZU1hcCwKICAgICAgdGFibGVDb2x1bW5zVGl0bGVGaWVsZE1hcCA9IF90aGlzJGdlbmVyYXRlQ29sdW1uczIudGFibGVDb2x1bW5zVGl0bGVGaWVsZE1hcCwKICAgICAgdGFibGVDb2x1bW5zRmllbGRNYXAgPSBfdGhpcyRnZW5lcmF0ZUNvbHVtbnMyLnRhYmxlQ29sdW1uc0ZpZWxkTWFwLAogICAgICByb3dzT2JqVGVtcCA9IF90aGlzJGdlbmVyYXRlQ29sdW1uczIucm93c09ialRlbXAsCiAgICAgIGNvbEZvcm11bGFDb25maWcgPSBfdGhpcyRnZW5lcmF0ZUNvbHVtbnMyLmNvbEZvcm11bGFDb25maWc7CiAgICB2YXIgdmFsaWRSZXN1bHQgPSB0cnVlOwogICAgdmFyIHZhbGlkUmVzdWx0RmllbGRUaXRsZSA9IFtdOwogICAgdmFyIGZvcm1hdERhdGEgPSBmYWxzZTsKICAgIC8vIGxldCB2YWxpUnVsZSA9IFtdCiAgICBpZiAocHJvY2Vzcy5lbnYuVlVFX0FQUF9DT05GX0lTSEIpIHsKICAgICAgdmFyIHZhbGlSdWxlID0ge307CiAgICAgIG9iai52aWV3RGF0YS5tYXAoZnVuY3Rpb24gKHJvdywgcm93SW5kZXgpIHsKICAgICAgICB2YXIgX2xvb3AgPSBmdW5jdGlvbiBfbG9vcCgpIHsKICAgICAgICAgIHZhciBjb2x1bW4gPSB0YWJsZUNvbHVtbnNGaWVsZE1hcFtrZXldOwogICAgICAgICAgdmFyIGZsYWcgPSBmYWxzZTsKICAgICAgICAgIC8vIOavj+S4gOWIl+S4jemHjeWkjeagoemqjAogICAgICAgICAgdmFyIGZpZWxkVmFsdWUgPSByb3dbY29sdW1uLnRpdGxlXTsKICAgICAgICAgIHZhciBmaWVsZCA9IGNvbHVtbi5maWVsZDsKICAgICAgICAgIGlmIChjb2x1bW4ucmVxdWlyZWQpIHsKICAgICAgICAgICAgLy8g5b+F5aGrCiAgICAgICAgICAgIGlmIChmaWVsZCA9PT0gJ3BheV9hbXQnIHx8IGZpZWxkID09PSAncGF5X2FwcF9hbXQnIHx8IGZpZWxkID09PSAneHBheV9hbXQnKSB7CiAgICAgICAgICAgICAgLy8g6YeR6aKd6ZyA5aSn5LqOMAogICAgICAgICAgICAgIGlmICghZmllbGRWYWx1ZSB8fCBpc05hTihmaWVsZFZhbHVlKSB8fCByb3dbZmllbGRdICogMSA8IDApIHsKICAgICAgICAgICAgICAgIGZsYWcgPSB0cnVlOwogICAgICAgICAgICAgICAgdmFyIG1zZyA9ICJcdTdCMkMiLmNvbmNhdChyb3dJbmRleCArIDEsICJcdTg4NEMiKS5jb25jYXQoY29sdW1uLnRpdGxlLCAiXHU5NzAwXHU0RTNBXHU1OTI3XHU0RThFMFx1NzY4NFx1NjU3MFx1NUI1NyIpOwogICAgICAgICAgICAgICAgX3RoaXM0MS5jb2xsZWN0VmFsaWRFcnJvcih2YWxpUnVsZSwgcm93SW5kZXgsIGZpZWxkLCBjb2x1bW4sIG1zZyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGlmICghZmllbGRWYWx1ZSkgewogICAgICAgICAgICAgICAgZmxhZyA9IHRydWU7CiAgICAgICAgICAgICAgICBfdGhpczQxLmNvbGxlY3RWYWxpZEVycm9yKHZhbGlSdWxlLCByb3dJbmRleCwgZmllbGQsIGNvbHVtbiwgIlx1N0IyQyIuY29uY2F0KHJvd0luZGV4ICsgMSwgIlx1ODg0QyIpLmNvbmNhdChjb2x1bW4udGl0bGUsICJcdTRFM0FcdTVGQzVcdTU4NkJcdTk4NzkiKSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoY29sdW1uLnJlZyAmJiAhZmxhZykgewogICAgICAgICAgICB2YXIgdmFsdWUgPSBmaWVsZFZhbHVlOwogICAgICAgICAgICBpZiAoIWNvbHVtbi5yZWcudGVzdCh2YWx1ZSkpIHsKICAgICAgICAgICAgICBmbGFnID0gdHJ1ZTsKICAgICAgICAgICAgICBfdGhpczQxLmNvbGxlY3RWYWxpZEVycm9yKHZhbGlSdWxlLCByb3dJbmRleCwgZmllbGQsIGNvbHVtbiwgIlx1N0IyQyIuY29uY2F0KHJvd0luZGV4ICsgMSwgIlx1ODg0QyIpLmNvbmNhdChjb2x1bW4ubXNnKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmIChjb2x1bW4udmFsaWRhdG9yICYmIHR5cGVvZiBjb2x1bW4udmFsaWRhdG9yID09PSAnZnVuY3Rpb24nICYmICFmbGFnKSB7CiAgICAgICAgICAgIHZhciBkYXRhID0gcm93OwogICAgICAgICAgICB2YXIgcmVzID0gY29sdW1uLnZhbGlkYXRvci5jYWxsKF90aGlzNDEsIGRhdGEpOwogICAgICAgICAgICBpZiAoIXJlcy5yZXN1bHQpIHsKICAgICAgICAgICAgICBfdGhpczQxLmNvbGxlY3RWYWxpZEVycm9yKHZhbGlSdWxlLCByb3dJbmRleCwgZmllbGQsIGNvbHVtbiwgIlx1N0IyQyIuY29uY2F0KHJvd0luZGV4ICsgMSwgIlx1ODg0QyIpLmNvbmNhdChyZXMubXNnKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIC8vIOagoemqjOinhOWImQogICAgICAgICAgaWYgKG9iai52YWxpUnVsZXMpIHsKICAgICAgICAgICAgdmFyIHZhbGlSdWxlcyA9IE9iamVjdC5rZXlzKG9iai52YWxpUnVsZXMpOwogICAgICAgICAgICBpZiAodmFsaVJ1bGVzICYmIHZhbGlSdWxlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgaWYgKGZpZWxkVmFsdWUpIHsKICAgICAgICAgICAgICAgIHZhbGlSdWxlcy5mb3JFYWNoKGZ1bmN0aW9uIChydWxlRmllbGQpIHsKICAgICAgICAgICAgICAgICAgaWYgKHJ1bGVGaWVsZCA9PT0gZmllbGQpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgcmVnID0gb2JqLnZhbGlSdWxlc1tydWxlRmllbGRdOwogICAgICAgICAgICAgICAgICAgIGlmIChyZWcgaW5zdGFuY2VvZiBSZWdFeHApIHsKICAgICAgICAgICAgICAgICAgICAgIHZhciByID0gbmV3IFJlZ0V4cChyZWcpOwogICAgICAgICAgICAgICAgICAgICAgaWYgKCFyLnRlc3QoZmllbGRWYWx1ZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXM0MS5jb2xsZWN0VmFsaWRFcnJvcih2YWxpUnVsZSwgcm93SW5kZXgsIGZpZWxkLCBjb2x1bW4sICJcdTdCMkMiLmNvbmNhdChyb3dJbmRleCArIDEsICJcdTg4NEMiKS5jb25jYXQob2JqLnZhbGlSdWxlc1tydWxlRmllbGQgKyAnX21zZyddKSk7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZWcgaW5zdGFuY2VvZiBGdW5jdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgdmFyIF9yZXMgPSByZWcuY2FsbChfdGhpczQxLCBmaWVsZFZhbHVlLCByb3csIGNvbHVtbi50aXRsZSk7CiAgICAgICAgICAgICAgICAgICAgICBpZiAoX3JlcyAmJiAhX3Jlcy5yZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXM0MS5jb2xsZWN0VmFsaWRFcnJvcih2YWxpUnVsZSwgcm93SW5kZXgsIGZpZWxkLCBjb2x1bW4sICJcdTdCMkMiLmNvbmNhdChyb3dJbmRleCArIDEsICJcdTg4NEMiKS5jb25jYXQoX3Jlcy5tc2cpKTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgZm9yICh2YXIga2V5IGluIHRhYmxlQ29sdW1uc0ZpZWxkTWFwKSB7CiAgICAgICAgICBfbG9vcCgpOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIGlmIChPYmplY3Qua2V5cyh2YWxpUnVsZSkubGVuZ3RoID4gMCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICByZXN1bHQ6IGZhbHNlLAogICAgICAgICAgdmFsaVJ1bGU6IHZhbGlSdWxlCiAgICAgICAgfTsKICAgICAgfQogICAgICB0aGlzLmltcG9ydE1vZGFsVmlzaWJsZSA9IGZhbHNlOwogICAgfQogICAgdmFyIHZpZXdEYXRhID0gb2JqLnZpZXdEYXRhLm1hcChmdW5jdGlvbiAocm93LCByb3dJbmRleCkgewogICAgICBPYmplY3Qua2V5cyhyb3cpLmZvckVhY2goZnVuY3Rpb24gKGtleSwga2V5SW5kZXgpIHsKICAgICAgICB2YXIgcGFyc2VWaWV3VmFsdWUgPSBzZWxmLnJldmVyc2VQYXJzZVZpZXdEYXRhVG9zb3VyY2Uodmlld1RvU291cmNlTWFwW3RhYmxlQ29sdW1uc1RpdGxlRmllbGRNYXBba2V5XV0sIHJvd1trZXldKTsKICAgICAgICAvLyBjb25zdCBjdXN0b21WYWwgPSBTdHJpbmcocGFyc2VWaWV3VmFsdWUpLnJlcGxhY2UoL251bGx8dW5kZWZpbmVkfFxzKy9pZywgJycpICE9PSAnJwogICAgICAgIGlmICh0YWJsZUNvbHVtbnNGaWVsZE1hcFt0YWJsZUNvbHVtbnNUaXRsZUZpZWxkTWFwW2tleV1dKSB7CiAgICAgICAgICAvLyBzZWxmLnZhbGlkQ2VsbFJ1bGVzKHsgdHlwZTogJ2FsbCcsIHJvdywgY29sdW1uOiB0YWJsZUNvbHVtbnNGaWVsZE1hcFt0YWJsZUNvbHVtbnNUaXRsZUZpZWxkTWFwW2tleV1dLCB2YWw6IHBhcnNlVmlld1ZhbHVlLCB2YWxpUnVsZXM6IG9iai52YWxpUnVsZXMgfSkKICAgICAgICAgIC8vICAgLnRoZW4oKCkgPT4gewogICAgICAgICAgLy8gICAgIGlmIChjdXN0b21WYWwpIHsKICAgICAgICAgIHJvd1t0YWJsZUNvbHVtbnNUaXRsZUZpZWxkTWFwW2tleV1dID0gcGFyc2VWaWV3VmFsdWU7CiAgICAgICAgICBpZiAodGFibGVDb2x1bW5zVGl0bGVGaWVsZE1hcFtrZXldID09PSAnaW5hbWUnKSB7CiAgICAgICAgICAgIHJvd1snaXRlbWNvZGUnXSA9IHBhcnNlVmlld1ZhbHVlLnNwbGl0KCctJylbMF0ucmVwbGFjZSgvXHMrL2lnLCAnJyk7CiAgICAgICAgICB9CiAgICAgICAgICAvLyAgIH0KICAgICAgICAgIC8vIH0pCiAgICAgICAgICAvLyAuY2F0Y2goKHsgcnVsZSB9KSA9PiB7CiAgICAgICAgICAvLyAgIHZhbGlkUmVzdWx0ID0gZmFsc2UKICAgICAgICAgIC8vICAgdmFsaVJ1bGUucHVzaChydWxlKQogICAgICAgICAgLy8gICBpZiAoY3VzdG9tVmFsKSB7CiAgICAgICAgICAvLyAgICAgcm93W3RhYmxlQ29sdW1uc1RpdGxlRmllbGRNYXBba2V5XV0gPSBwYXJzZVZpZXdWYWx1ZQogICAgICAgICAgLy8gICB9CiAgICAgICAgICAvLyB9KQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoa2V5ICE9PSAn5bqP5Y+3JyB8fCBrZXkgIT09ICdzZXFJbmRleCcpIHsKICAgICAgICAgICAgdmFsaWRSZXN1bHRGaWVsZFRpdGxlLnB1c2goa2V5KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwogICAgICByb3cgPSBPYmplY3QuYXNzaWduKHt9LCByb3dzT2JqVGVtcCwgcm93KTsKICAgICAgZm9ybWF0RGF0YSA9IHRydWU7CiAgICAgIHJldHVybiBfdGhpczQxLnJlZHVjdGlvbkNvbEZvcm11bGEoY29sRm9ybXVsYUNvbmZpZywgc2VsZi5yZWR1Y3Rpb25Db2xGb3JtdWxhKGNvbEZvcm11bGFDb25maWcsIHJvdykpOwogICAgfSk7CiAgICBpZiAoZm9ybWF0RGF0YSkgcmV0dXJuIHZpZXdEYXRhOwogICAgc2VsZi5yZWR1Y3Rpb25Sb3dDb2RlRm9ybXVsYSh0aGlzLmNhbGN1bGF0ZUNvbnN0cmFpbnRDb25maWdJbi5yb3dDb2RlRm9ybXVsYUNvbmZpZywgdmlld0RhdGEsIHNlbGYuaWQpOwogICAgcmV0dXJuIHZhbGlkUmVzdWx0ICYmICF2YWxpZFJlc3VsdEZpZWxkVGl0bGUubGVuZ3RoICYmIHZpZXdEYXRhOwogIH0sCiAgcmV2ZXJzZVBhcnNlVmlld0RhdGFUb3NvdXJjZTogZnVuY3Rpb24gcmV2ZXJzZVBhcnNlVmlld0RhdGFUb3NvdXJjZSh2aWV3VG9Tb3VyY2VNYXAsIHZhbHVlKSB7CiAgICAvLyDlpITnkIbljZXkuKog5a+85YWl5pWw5o2uCiAgICAvLyAgbmVlZE1hcDogdHJ1ZSwKICAgIC8vICBuYW1lOiBpdGVtUmVuZGVyLm5hbWUsCiAgICAvLyAgb3B0aW9uczogQXJyYXkuaXNBcnJheShpdGVtUmVuZGVyLm9wdGlvbnMpID8gaXRlbVJlbmRlci5vcHRpb25zIDogW10sCiAgICAvLyAgbXVsdGlwbGU6IHRydWUsCiAgICAvLyAgZm9ybXVsYTogY29ubHVtLmZvcm11bGEKICAgIGlmICh2aWV3VG9Tb3VyY2VNYXAgJiYgdmlld1RvU291cmNlTWFwLm5lZWRNYXApIHsKICAgICAgdmFyIHRyYW5zVmFsdWUgPSAnJzsKICAgICAgdmFyIHZpZXdWYWx1ZSA9IHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgPyB2YWx1ZSA6ICcnOwogICAgICBpZiAodmlld1RvU291cmNlTWFwLm11bHRpcGxlKSB7CiAgICAgICAgaWYgKHZpZXdWYWx1ZS5sZW5ndGgpIHsKICAgICAgICAgIHZhciB2aWV3VG9Tb3VyY2VWYWx1ZUFyciA9IFtdOwogICAgICAgICAgdmlld1RvU291cmNlTWFwLm9wdGlvbnMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHsKICAgICAgICAgICAgaWYgKHZpZXdWYWx1ZS5pbmRleE9mKGl0ZW0ubGFiZWwpID49IDApIHsKICAgICAgICAgICAgICB2aWV3VG9Tb3VyY2VWYWx1ZUFyci5wdXNoKGl0ZW0udmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICAgIHRyYW5zVmFsdWUgPSB2aWV3VG9Tb3VyY2VWYWx1ZUFyci5qb2luKCcsJyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRyYW5zVmFsdWUgPSAnJzsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmlld1RvU291cmNlTWFwLm9wdGlvbnMuZm9yRWFjaChmdW5jdGlvbiAoaXRlbSwgaW5kZXgpIHsKICAgICAgICAgIGlmICh2aWV3VmFsdWUuaW5kZXhPZihpdGVtLmxhYmVsKSA+PSAwKSB7CiAgICAgICAgICAgIHRyYW5zVmFsdWUgPSBpdGVtLnZhbHVlOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICAgIHJldHVybiB0cmFuc1ZhbHVlOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIHZhbHVlICsgJycucmVwbGFjZSgvbnVsbHxOYU58dW5kZWZpbmVkfCwvaWcsICcnKTsKICAgIH0KICB9LAogIG5ld1J1bGU6IGZ1bmN0aW9uIG5ld1J1bGUocnVsZSkgewogICAgLy8g6ZSZ6K+v6KeE5YiZ5L+h5oGvCiAgICByZXR1cm4gT2JqZWN0LmFzc2lnbih7fSwgewogICAgICAkb3B0aW9uczogcnVsZSwKICAgICAgcmVxdWlyZWQ6IHJ1bGUucmVxdWlyZWQsCiAgICAgIG1pbjogcnVsZS5taW4sCiAgICAgIG1heDogcnVsZS5taW4sCiAgICAgIHR5cGU6IHJ1bGUudHlwZSwKICAgICAgcGF0dGVybjogcnVsZS5wYXR0ZXJuLAogICAgICB2YWxpZGF0b3I6IHJ1bGUudmFsaWRhdG9yLAogICAgICBtYXhXaWR0aDogcnVsZS5tYXhXaWR0aCwKICAgICAgbWVzc2FnZTogcnVsZS5tZXNzYWdlCiAgICB9KTsKICB9LAogIHZhbGlkQ2VsbFJ1bGVzOiBmdW5jdGlvbiB2YWxpZENlbGxSdWxlcyhhcmdPYmopIHsKICAgIHZhciBfdGhpczQyID0gdGhpczsKICAgIC8vIOagoemqjOWNleWFg+agvAogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgdmFyIHR5cGUgPSBhcmdPYmoudHlwZSwKICAgICAgcm93ID0gYXJnT2JqLnJvdywKICAgICAgY29sdW1uID0gYXJnT2JqLmNvbHVtbiwKICAgICAgdmFsID0gYXJnT2JqLnZhbCwKICAgICAgdmFsaVJ1bGVzID0gYXJnT2JqLnZhbGlSdWxlczsKICAgIHZhciBwcm9wZXJ0eSA9IGNvbHVtbi5maWVsZDsKICAgIHZhciBlcnJvclJ1bGVzID0gW107CiAgICB2YXIgc3luY1ZhaWxkcyA9IFtdOwogICAgaWYgKHByb3BlcnR5ICYmIHZhbGlSdWxlcykgewogICAgICB2YXIgcnVsZXMgPSBzZWxmLiRYRVV0aWxzLmdldCh2YWxpUnVsZXMsIHByb3BlcnR5KTsKICAgICAgaWYgKHJ1bGVzKSB7CiAgICAgICAgdmFyIGNlbGxWYWx1ZSA9IHZhbDsKICAgICAgICAvLyBjb25zdCBjZWxsVmFsdWUgPSBzZWxmLiRYRVV0aWxzLmlzVW5kZWZpbmVkKHZhbCkgPyBzZWxmLiRYRVV0aWxzLmdldChyb3csIHByb3BlcnR5KSA6IHZhbAogICAgICAgIHJ1bGVzLmZvckVhY2goZnVuY3Rpb24gKHJ1bGUpIHsKICAgICAgICAgIGlmICh0eXBlID09PSAnYWxsJykgewogICAgICAgICAgICBpZiAoc2VsZi4kWEVVdGlscy5pc0Z1bmN0aW9uKHJ1bGUudmFsaWRhdG9yKSkgewogICAgICAgICAgICAgIHZhciBjdXN0b21WYWxpZDsKICAgICAgICAgICAgICBjdXN0b21WYWxpZCA9IHJ1bGUudmFsaWRhdG9yKHsKICAgICAgICAgICAgICAgIGNlbGxWYWx1ZTogY2VsbFZhbHVlLAogICAgICAgICAgICAgICAgcnVsZTogcnVsZSwKICAgICAgICAgICAgICAgIHJ1bGVzOiBydWxlcywKICAgICAgICAgICAgICAgIHJvdzogcm93LAogICAgICAgICAgICAgICAgcm93SW5kZXg6IHJvdy5pbmRleCwKICAgICAgICAgICAgICAgIGNvbHVtbjogY29sdW1uLAogICAgICAgICAgICAgICAgJHRhYmxlOiBfdGhpczQyCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgaWYgKGN1c3RvbVZhbGlkKSB7CiAgICAgICAgICAgICAgICBpZiAoc2VsZi4kWEVVdGlscy5pc0Vycm9yKGN1c3RvbVZhbGlkKSkgewogICAgICAgICAgICAgICAgICBfdGhpczQyLnZhbGlkUnVsZUVyciA9IHRydWU7CiAgICAgICAgICAgICAgICAgIGVycm9yUnVsZXMucHVzaChzZWxmLm5ld1J1bGUoewogICAgICAgICAgICAgICAgICAgIHR5cGU6ICdjdXN0b20nLAogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGN1c3RvbVZhbGlkLm1lc3NhZ2UsCiAgICAgICAgICAgICAgICAgICAgcnVsZTogc2VsZi5uZXdSdWxlKHJ1bGUpCiAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY3VzdG9tVmFsaWQuY2F0Y2gpIHsKICAgICAgICAgICAgICAgICAgLy8g5aaC5p6c5Li65byC5q2l5qCh6aqM77yI5rOo77ya5byC5q2l5qCh6aqM5piv5bm25Y+R5peg5bqP55qE77yJCiAgICAgICAgICAgICAgICAgIHN5bmNWYWlsZHMucHVzaChjdXN0b21WYWxpZC5jYXRjaChmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAgICAgICAgIF90aGlzNDIudmFsaWRSdWxlRXJyID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBlcnJvclJ1bGVzLnB1c2goc2VsZi5uZXdSdWxlKHsKICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdjdXN0b20nLAogICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogZSA/IGUubWVzc2FnZSA6IHJ1bGUubWVzc2FnZSwKICAgICAgICAgICAgICAgICAgICAgIHJ1bGU6IHNlbGYubmV3UnVsZShydWxlKQogICAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB2YXIgaXNOdW1iZXIgPSBydWxlLnR5cGUgPT09ICdudW1iZXInOwogICAgICAgICAgICAgIHZhciBudW1WYWwgPSBpc051bWJlciA/IHNlbGYuJFhFVXRpbHMudG9OdW1iZXIoY2VsbFZhbHVlKSA6IHNlbGYuJFhFVXRpbHMuZ2V0U2l6ZShjZWxsVmFsdWUpOwogICAgICAgICAgICAgIGlmIChydWxlLnJlcXVpcmVkICYmIChjZWxsVmFsdWUgPT09IG51bGwgfHwgY2VsbFZhbHVlID09PSB1bmRlZmluZWQgfHwgY2VsbFZhbHVlID09PSAnJykpIHsKICAgICAgICAgICAgICAgIF90aGlzNDIudmFsaWRSdWxlRXJyID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGVycm9yUnVsZXMucHVzaChzZWxmLm5ld1J1bGUocnVsZSkpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNOdW1iZXIgJiYgaXNOYU4oY2VsbFZhbHVlKSB8fCAhaXNOYU4ocnVsZS5taW4pICYmIG51bVZhbCA8IHBhcnNlRmxvYXQocnVsZS5taW4pIHx8ICFpc05hTihydWxlLm1heCkgJiYgbnVtVmFsID4gcGFyc2VGbG9hdChydWxlLm1heCkgfHwgcnVsZS5wYXR0ZXJuICYmICEocnVsZS5wYXR0ZXJuLnRlc3QgPyBydWxlLnBhdHRlcm4gOiBuZXcgUmVnRXhwKHJ1bGUucGF0dGVybikpLnRlc3QoY2VsbFZhbHVlKSkgewogICAgICAgICAgICAgICAgX3RoaXM0Mi52YWxpZFJ1bGVFcnIgPSB0cnVlOwogICAgICAgICAgICAgICAgZXJyb3JSdWxlcy5wdXNoKHNlbGYubmV3UnVsZShydWxlKSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBQcm9taXNlLmFsbChzeW5jVmFpbGRzKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgaWYgKGVycm9yUnVsZXMubGVuZ3RoKSB7CiAgICAgICAgdmFyIHJlc3QgPSB7CiAgICAgICAgICBydWxlczogZXJyb3JSdWxlcywKICAgICAgICAgIHJ1bGU6IGVycm9yUnVsZXNbMF0KICAgICAgICB9OwogICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChyZXN0KTsKICAgICAgfQogICAgfSk7CiAgfSwKICBleHBvcnRCeVRlbXBhbHRlOiBmdW5jdGlvbiBleHBvcnRCeVRlbXBhbHRlKCkgewogICAgdmFyIG9iaiA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDogewogICAgICBkYXRhOiBbXSwKICAgICAgLy8g5qih54mI5pWw5o2u77yM5Y+q5ou/56ys5LiA6KGM5a+85Ye65YiX6YWN572uCiAgICAgIGNvbmx1bXM6IFtdIC8vIOaJgOacieihqOWktAogICAgfTsKCiAgICAvLyDmjInmqKHniYjlr7zlh7oKICAgIHZhciBleHBvcnRDb25sdW1zID0gW107CiAgICB2YXIgZXhwb3J0Q29ubHVtc1RpdGxlID0gb2JqLmRhdGFbMF07CiAgICB2YXIgX3RoaXMkZ2VuZXJhdGVDb2x1bW5zMyA9IHRoaXMuZ2VuZXJhdGVDb2x1bW5zQWxsTWFwKG9iai5jb25sdW1zKSwKICAgICAgdGFibGVDb2x1bW5zVGl0bGVNYXAgPSBfdGhpcyRnZW5lcmF0ZUNvbHVtbnMzLnRhYmxlQ29sdW1uc1RpdGxlTWFwOwogICAgZXhwb3J0Q29ubHVtc1RpdGxlLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7CiAgICAgIHRhYmxlQ29sdW1uc1RpdGxlTWFwW2l0ZW1dICYmIGV4cG9ydENvbmx1bXMucHVzaCh0YWJsZUNvbHVtbnNUaXRsZU1hcFtpdGVtXSk7CiAgICB9KTsKICAgIHZhciBmdWxsRGF0YSA9IHRoaXMuZ2V0VGFibGVEYXRhKCkuZnVsbERhdGE7CiAgICB2YXIgc2VsZWN0aW9uID0gdGhpcy5zZWxlY3Rpb247CiAgICB0aGlzLiRFeHBvcnQuZXhwb3J0RXhjZWwoewogICAgICBpc0V4cG9ydFRyZWU6IHRydWUsCiAgICAgIHNhdmVUeXBlOiAnLnhsc3gnLAogICAgICBmaWxlTmFtZTogJ2V4cG9ydCcsCiAgICAgIC8vIOaWh+S7tuWQjQogICAgICBkYXRhVHlwZTogJ2Z1bGxEYXRhJywKICAgICAgaXNFeHBvcnRIZWFkOiB0cnVlLAogICAgICAvLyDmmK/lkKblr7zlh7rooajlpLQKICAgICAgaXNFeHBvcnRGb290ZXI6IGZhbHNlLAogICAgICAvLyDmmK/lkKblr7zlh7rooajlsL7pg6gKICAgICAgaXNFeHBvcnRPbmx5U291cmNlRmllbGQ6IGZhbHNlLAogICAgICAvLyDmmK/lkKblj6rlr7zlh7rmlbDmja7mupDooajlpLTlrZfmrrXvvIwKICAgICAgaXNFeHBvcnRPbmx5Vmlld1RpdGxlOiBmYWxzZSwKICAgICAgLy8g5piv5ZCm5Y+q5a+85Ye65pWw5o2u6KGo5aS05ZCN56ew77yMCiAgICAgIGlzRXhwb3J0T3JpZ2luYWxEYXRhOiBmYWxzZSwKICAgICAgLy8g5piv5ZCm5a+85Ye65rqQ5pWw5o2uCiAgICAgIGlzRXhwb3J0RGF0YTogdHJ1ZSwKICAgICAgLy8g5piv5ZCm5a+85Ye65pWw5o2uCiAgICAgIGNvbHVtbnM6IGV4cG9ydENvbmx1bXMsCiAgICAgIC8vIOihqOWktOmFjee9rgogICAgICBmdWxsRGF0YTogZnVsbERhdGEsCiAgICAgIGRhdGFzOiBbXSwKICAgICAgLy8g5rqQ5pWw5o2uLAogICAgICBzZWxlY3Rpb246IHNlbGVjdGlvbiwKICAgICAgLy8g6YCJ5Lit5pWw5o2uCiAgICAgIGluZGV4OiB0cnVlIC8vIOaYr+WQpua3u+WKoOW6j+WPtywKICAgIH0sIHRoaXMpOwogIH0sCiAgZG93bkxvYWRJbXBvcnRUZW1wbGF0ZTogZnVuY3Rpb24gZG93bkxvYWRJbXBvcnRUZW1wbGF0ZShvYmosIHRhYlBhbmFsKSB7CiAgICAvLyDkuIvovb3lr7zlhaXmqKHniYgKICAgIHZhciB0YWJsZUNvbHVtbnNDb25maWcgPSB0aGlzLnRhYmxlQ29sdW1uc0NvbmZpZzsKICAgIHRoaXMuJEV4cG9ydC5leHBvcnRFeGNlbCh7CiAgICAgIHNhdmVUeXBlOiAnLnhsc3gnLAogICAgICBmaWxlTmFtZTogJ+WvvOWFpeaooeeJiCcsCiAgICAgIC8vIOaWh+S7tuWQjQogICAgICBkYXRhVHlwZTogJ2Z1bGxEYXRhJywKICAgICAgaXNFeHBvcnRPbmx5Vmlld1RpdGxlOiB0cnVlLAogICAgICAvLyDmmK/lkKblj6rlr7zlh7rmlbDmja7mupDooajlpLTlrZfmrrXvvIwKICAgICAgY29sdW1uczogdGFibGVDb2x1bW5zQ29uZmlnLAogICAgICAvLyDooajlpLTphY3nva4KICAgICAgaW5kZXg6IGZhbHNlIC8vIOaYr+WQpua3u+WKoOW6j+WPtywKICAgIH0sIHRoaXMpOwogIH0sCiAgdHJpZ2dlckltcG9ydE9wdGlvbjogZnVuY3Rpb24gdHJpZ2dlckltcG9ydE9wdGlvbigpIHsKICAgIHZhciBjb25maWcgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IHt9OwogICAgLy8g6Kem5Y+R5a+85YWlCiAgICB0aGlzLmltcG9ydENvbmZpZyA9IGNvbmZpZzsKICAgIHRoaXMuaW1wb3J0TW9kYWxWaXNpYmxlID0gdHJ1ZTsKICB9LAogIHRyaWdnZXJEb3dubG9hZFRlbXBsYXRlOiBmdW5jdGlvbiB0cmlnZ2VyRG93bmxvYWRUZW1wbGF0ZShvYmopIHsKICAgIHRoaXMub25Eb3dubG9hZFRlbXBsYXRlQ2xpY2sob2JqKTsKICB9LAogIG9uRG93bmxvYWRUZW1wbGF0ZUNsaWNrOiBmdW5jdGlvbiBvbkRvd25sb2FkVGVtcGxhdGVDbGljayhvYmopIHsKICAgIC8vIOS4i+i9veaooeeJiAogICAgaWYgKHR5cGVvZiB0aGlzLmltcG9ydENvbmZpZy5kb3dubG9hZFRlbXBsYXRlQ2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHsKICAgICAgdGhpcy5pbXBvcnRDb25maWcuZG93bmxvYWRUZW1wbGF0ZUNhbGxiYWNrKHRoaXMuaW1wb3J0RGF0YSk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmltcG9ydERhdGEgPSBbXTsKICAgICAgdmFyIGNvbHVtbnMgPSB0aGlzLnRhYmxlQ29sdW1uc0NvbmZpZzsKICAgICAgdmFyIHNlbGVjdGlvbiA9IHRoaXMuc2VsZWN0aW9uOwogICAgICB2YXIgZGVmYXVsdENvbmZpZyA9IHsKICAgICAgICBpc0V4cG9ydFRyZWU6ICEhc2VsZi50cmVlQ29uZmlnSW4sCiAgICAgICAgc2F2ZVR5cGU6ICcueGxzeCcsCiAgICAgICAgZmlsZU5hbWU6ICdpbXBvcnRUZW1wcGxhdGUnLAogICAgICAgIC8vIOaWh+S7tuWQjQogICAgICAgIGRhdGFUeXBlOiAnZnVsbERhdGEnLAogICAgICAgIGlzRXhwb3J0T25seVNvdXJjZUZpZWxkOiB0cnVlLAogICAgICAgIC8vIOaYr+WQpuWPquWvvOWHuuaVsOaNrua6kOihqOWktOWtl+aute+8jAogICAgICAgIGlzRXhwb3J0T25seVZpZXdUaXRsZTogZmFsc2UsCiAgICAgICAgLy8g5piv5ZCm5Y+q5a+85Ye65pWw5o2u6KGo5aS05ZCN56ew77yMCiAgICAgICAgaXNFeHBvcnRIZWFkOiB0cnVlLAogICAgICAgIC8vIOaYr+WQpuWvvOWHuuihqOWktAogICAgICAgIGV4cG9ydFZpZXdUaXRsZVR5cGU6ICduZXN0VGl0bGUnLAogICAgICAgIGlzRXhwb3J0Rm9vdGVyOiBmYWxzZSwKICAgICAgICAvLyDmmK/lkKblr7zlh7rooajlsL7pg6gKICAgICAgICBpc0V4cG9ydE9yaWdpbmFsRGF0YTogdHJ1ZSwKICAgICAgICAvLyDmmK/lkKblr7zlh7rmupDmlbDmja4KICAgICAgICBpc0V4cG9ydERhdGE6IHRydWUsCiAgICAgICAgLy8g5piv5ZCm5a+85Ye65pWw5o2uCiAgICAgICAgY29sdW1uczogY29sdW1ucywKICAgICAgICAvLyDooajlpLTphY3nva4KICAgICAgICBkYXRhczogW10sCiAgICAgICAgLy8g5rqQ5pWw5o2uLAogICAgICAgIHNlbGVjdGlvbjogc2VsZWN0aW9uLAogICAgICAgIC8vIOmAieS4reaVsOaNrgogICAgICAgIGluZGV4OiB0cnVlLAogICAgICAgIC8vIOaYr+WQpua3u+WKoOW6j+WPtywKICAgICAgICBpZ25vcmVDb2xzVHlwZXM6IFsnZHJhZ1NvcnQnLCAnc2VxJywgJ2NoZWNrYm94JywgJ3JhZGlvJywgJ29wdGlvblJvdycsICdleHBhbmQnLCAnYXR0YWNoJywgJ2FjaCcsICdsaXN0JywgJ2F0dGFjaGxpc3QnXSAvLyDlv73nlaXlr7zlh7rnmoTliJfnsbvlnosKICAgICAgfTsKCiAgICAgIHRoaXMuJEV4cG9ydC5leHBvcnRFeGNlbChvYmogPyBPYmplY3QuYXNzaWduKGRlZmF1bHRDb25maWcsIG9iaikgOiBvYmosIHRoaXMpOwogICAgfQogIH0sCiAgb25JbXBvcnRGaWxlQ2xpY2s6IGZ1bmN0aW9uIG9uSW1wb3J0RmlsZUNsaWNrKCkgewogICAgdmFyIF90aGlzNDMgPSB0aGlzOwogICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZSgpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTkoKSB7CiAgICAgIHZhciBzZWxmOwogICAgICByZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZSgpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTkkKF9jb250ZXh0OSkgewogICAgICAgIHdoaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0OS5wcmV2ID0gX2NvbnRleHQ5Lm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgLy8g5a+85YWl5paH5Lu2CiAgICAgICAgICAgIHNlbGYgPSBfdGhpczQzOwogICAgICAgICAgICBfY29udGV4dDkubmV4dCA9IDM7CiAgICAgICAgICAgIHJldHVybiBfdGhpczQzLiRJbXBvcnQuaW1wb3J0RXhjZWwoe30sIGZ1bmN0aW9uIChyZXN1bHQsIGZpbGVuYW1lKSB7CiAgICAgICAgICAgICAgLy8gdGhpcy50YWJsZURhdGFJbiA9IHJlc3VsdAogICAgICAgICAgICAgIHNlbGYuaW1wb3J0RGF0YSA9IHJlc3VsdDsKICAgICAgICAgICAgICBzZWxmLmZpbGVDb25maWcuZmlsZU5hbWUgPSBmaWxlbmFtZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ5LnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0sIF9jYWxsZWU5KTsKICAgIH0pKSgpOwogIH0sCiAgb25JbXBvcnRDbGljazogZnVuY3Rpb24gb25JbXBvcnRDbGljaygpIHsKICAgIC8vIOWvvOWFpeaPkOS6pAogICAgaWYgKCF0aGlzLmltcG9ydERhdGEubGVuZ3RoKSB7CiAgICAgIHRoaXMuJFhNb2RhbC5tZXNzYWdlKHsKICAgICAgICBzdGF0dXM6ICdlcnJvcicsCiAgICAgICAgbWVzc2FnZTogJ+aXoOaVsOaNruWvvOWFpeivt+mHjeaWsOWvvOWFpeaVsOaNru+8gScKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmltcG9ydE1vZGFsVmlzaWJsZSA9IGZhbHNlOwogICAgICBpZiAodHlwZW9mIHRoaXMuaW1wb3J0Q29uZmlnLmltcG9ydFN1Y2Nlc3NDYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgIHRoaXMuaW1wb3J0Q29uZmlnLmltcG9ydFN1Y2Nlc3NDYWxsYmFjayh0aGlzLmltcG9ydERhdGEpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuJGVtaXQoJ2ltcG9ydFN1Y2Nlc3NDYWxsYmFjaycsIHRoaXMuaW1wb3J0RGF0YSk7CiAgICAgIH0KICAgIH0KICB9Cn07CgovLyDorr7nva5jb2x1bW7ph5Hpop3ov4fmu6QKdmFyIHVzZU1vbmV5RmlsdGVyID0gewogIHNldENvbHVtbk1vbmV5RmlsdGVyOiBmdW5jdGlvbiBzZXRDb2x1bW5Nb25leUZpbHRlcihjb2x1bW5zKSB7CiAgICB2YXIgX3RoaXM0NCA9IHRoaXM7CiAgICBjb2x1bW5zID09PSBudWxsIHx8IGNvbHVtbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbiAoY29sdW1uKSB7CiAgICAgIHZhciBfY29sdW1uJGNlbGxSZW5kZXIsIF90aGlzNDQkdGFibGVDb25maWckZzsKICAgICAgdmFyIGZsYWcgPSAoKF9jb2x1bW4kY2VsbFJlbmRlciA9IGNvbHVtbi5jZWxsUmVuZGVyKSA9PT0gbnVsbCB8fCBfY29sdW1uJGNlbGxSZW5kZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jb2x1bW4kY2VsbFJlbmRlci5uYW1lKSA9PT0gJyR2eGVNb25leScgfHwgY29sdW1uLnR5cGUgPT09ICdtb25leScgPyAoKF90aGlzNDQkdGFibGVDb25maWckZyA9IF90aGlzNDQudGFibGVDb25maWcuZ2xvYmFsQ29uZmlnKSA9PT0gbnVsbCB8fCBfdGhpczQ0JHRhYmxlQ29uZmlnJGcgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF90aGlzNDQkdGFibGVDb25maWckZy51c2VNb25leUZpbHRlcikgJiYgY29sdW1uLnVzZU1vbmV5RmlsdGVyICE9PSBmYWxzZSB8fCBjb2x1bW4udXNlTW9uZXlGaWx0ZXIgOiBmYWxzZTsKICAgICAgaWYgKGZsYWcpIHsKICAgICAgICBPYmplY3QuYXNzaWduKGNvbHVtbiwgZ2V0Q29sdW1uTW9uZXlGaWx0ZXJDb25maWcoY29sdW1uKSk7CiAgICAgIH0KICAgICAgY29sdW1uLmNoaWxkcmVuICYmIF90aGlzNDQuc2V0Q29sdW1uTW9uZXlGaWx0ZXIoY29sdW1uLmNoaWxkcmVuKTsKICAgIH0pOwogIH0KfTsKZXhwb3J0IGRlZmF1bHQgX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZChfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgdXRpbCksIHNvcnRNZXRob2RzKSwgYXhpb3NFdmVudCksIGluaXRNZXRob2RzKSwgcmVnaXN0Rm4pLCB0YWJsZUV2ZW50Rm4pLCB0b29sQmFyRXZlbnQpLCBwYWdlRXZlbnQpLCBmb3JtYXR0ZXJzKSwgdGFibGVPcHRpb25GbiksIHByb3h5Rm4pLCB0YWJsZUV2ZW50KSwgb3RoZXJGbiksIGJhdGNoTW9kaWZ5KSwgY2FsY3VsYXRlVG9vbCksIGNhbGNBbmRDb25zdHJhaW50KSwgY29uc3RyYWludFRvb2wpLCBleHBvcnRBbmRJbXBvcnRGbiksIHVzZU1vbmV5RmlsdGVyKTs="},{"version":3,"names":["_regeneratorRuntime","e","t","r","Object","prototype","n","hasOwnProperty","o","defineProperty","value","i","Symbol","a","iterator","c","asyncIterator","u","toStringTag","define","enumerable","configurable","writable","wrap","Generator","create","Context","makeInvokeMethod","tryCatch","type","arg","call","h","l","f","s","y","GeneratorFunction","GeneratorFunctionPrototype","p","d","getPrototypeOf","v","values","g","defineIteratorMethods","forEach","_invoke","AsyncIterator","invoke","_typeof","resolve","__await","then","callInvokeWithMethodAndArg","Error","done","method","delegate","maybeInvokeDelegate","sent","_sent","dispatchException","abrupt","return","TypeError","resultName","next","nextLoc","pushTryEntry","tryLoc","catchLoc","finallyLoc","afterLoc","tryEntries","push","resetTryEntry","completion","reset","isNaN","length","displayName","isGeneratorFunction","constructor","name","mark","setPrototypeOf","__proto__","awrap","async","Promise","keys","reverse","pop","prev","charAt","slice","stop","rval","handle","complete","finish","catch","_catch","delegateYield","asyncGeneratorStep","gen","reject","_next","_throw","key","info","error","_asyncToGenerator","fn","self","args","arguments","apply","err","undefined","_toConsumableArray","arr","_arrayWithoutHoles","_iterableToArray","_unsupportedIterableToArray","_nonIterableSpread","iter","Array","from","isArray","_arrayLikeToArray","ownKeys","getOwnPropertySymbols","filter","getOwnPropertyDescriptor","_objectSpread","_defineProperty","getOwnPropertyDescriptors","defineProperties","obj","_toPropertyKey","_toPrimitive","String","input","hint","prim","toPrimitive","res","Number","_createForOfIteratorHelper","allowArrayLike","it","F","_e","normalCompletion","didErr","step","_e2","minLen","toString","test","len","arr2","tableColumns","filterTypeMap","formatters","util","evalCalcUtil","getColumnMoneyFilterConfig","XEUtils","rowUuidKeyName","rowUniqueLevelKey","setRowUuidKey","rows","instance","level","_iterator","_step","_row$children","row","Reflect","set","uniqueId","concat","children","sortMethods","arrSortGloabal","data","property","order","sort","b","localeCompare","arrSortString","_ref","$table","column","arrSortNumber","_ref2","arrSortStringSuffix","_ref3","rTypeSuffix","arrSortNumberSuffix","_ref4","sortInner","parseFloat","treeConfig","item","_item$children","arrSort","_ref5","sortTypeMap","$vxeMoney","$vxeDays","$vxeCalculate","$vxeTree","$vxeInput","$vxeSelect","$vxeEditDownTextarea","$vxeTime","$vxeRadio","$vxeCheckbox","$$vxeEditDownJson","$vxeEditDownConditions","$vxeInterlet","render","own","editRender","cellRender","contentRender","registFn","registGlobleFormatters","index","$VXETable","formats","add","bind","registGloableConlumsConfig","reverRegistGloableConlumsConfig","arrc","registSingelRowConfig","registSingelRowFilter","registSingRowCalcRenderer","formula","registSingelRowFilter_old","filters","filterRender","itemRender","field","tableConfigCp","filterMethod","_ref6","option","options","filterMultiple","isCase","dataType","vals","sVal","getbasicDataType","props","indexOf","assign","registSingelRowFormater","formatter","registSingelRowRenderer","cellRenderConfig","registSingelRowSorts","registRenderers","reverRegistRenderers","registFilters","registFormatters","registTableRender","renderers","renderer","initMethods","initCreated","initColumnMoneyFilter","initMounted","initFirst","tableGlobalConfigIn","dragColumnsConfig","openDrag","columnDrop","setColumnDrop","rowDrop","setRowDrop","initTableGlobalConfig","initContextMenuConfig","initSeqConfig","initExpandConfig","initToolbar","initEditConfig","initTableFormConfig","initCalculateConstraintConfig","initTableConfig","initEditRules","initTable","initTableData","initTableConlums","setPagerConfig","setColumnMoneyFilter","tableColumnsConfig","completeMoneyFilter","tableGlobalConfig","globalConfig","checkType","seq","sortable","tableConfig","initCacheColumn","JSON","parse","localStorage","getItem","tableId","map","k","stringify","_iterator2","_step2","item2","columnsConfig","calculateConstraintConfigIn","cacheStatus","generateCalcColFormulaMap","tableColumnsConfigIn","unidirectionalData","deepCopy","generateTableConlums","initScrollLoadConfig","scrollLoadConfig","scrollLoadConfigCp","conlums","optionSort","generateOptionRow","hasOptionRow","optionRow","generateBottomGroupTotal","calculateConstraintConfig","cellDataConfig","generatGetDataConfigMap","constrainRowDataMap","toolbarConfig","curtoolbarConfig","toolbarConfigIn","toolbarConfigInCopy","toolbarConfigInCp","visible","yearlist","formSearchData","year","setMoneyUnit","moneyUnit","loadScrollTableData","selection","$refs","xGrid","xTable","tableSourceData","removeCheckboxRow","tableDataIn","getTableData","fullData","addMissingFieldsAndCalcColFormula","$nextTick","reloadData","clearFilter","handleDefaults","initCalcPublicData","_this","tableData","rePerformAllCalcAndConstraintByData","_ref7","dataCodeRowMap","dataCodeRowArr","afterCalcData","tableDataMap","addMissingFields","$emit","tableFormConfig","tableFormConfigIn","startIndex","seqConfig","seqMethod","$seq","pagerConfigIn","pageSize","currentPage","finalSeq","isTreeSeqToFlat","_arr$","toTreeArray","treeExpandData","findIndex","id","editConfig","editConfigIn","trigger","mode","activeMethod","_ref8","rowIndex","columnIndex","showStatus","editable","editConfigInCp","_ref9","refreshTableIsEdit","expandConfig","expandConfigIn","expandAll","contextMenuConfig","contextMenuConfigIn","initTreeConfig","treeConfigIn","dblExpandAll","onlyDblTreeNodeExpand","dblExpand","accordion","initFooterConfig","footerConfigIn","footerConfig","editRulesIn","editRules","tableOptionFn","replaceColumnSlotKey","_key$replace","_key$replace2","_key$replace3","_key$replace4","console","log","replace","transTableCloumnToSource","cloumn","_this2","newColumn","_newColumn$v$children","updateFooter","updateData","_this3","exportData","openExport","original","importDataEvent","importData","setAllCheckboxRow","_this4","clearCheckboxRow","_this5","revertEvent","_this6","$XModal","confirm","reLoadTable","deleteSelectedRow","removeCurrentRow","deleteRowData","copySelectionRowData","_arguments","_this7","_callee","_callee$","_context","rowIndexTo","rowTo","newRowSelectionsData","getCheckboxRecords","insertMark","date","Date","format","isNew","_XID","insert","_ref10","setActiveCell","message","copyRowData","_arguments2","_this8","_callee2","rowSource","rowSourceData","newRowDataObj","_yield$self$$refs$xGr","_callee2$","_context2","getData","insertAt","setCurrentRow","validate","errMap","insertRowData","_arguments3","_this9","_callee3","_callee3$","_context3","dataObj","_ref11","reloadColumn","reLoadTableData","refreshTable","_this10","ifRenderTable","reloadTableConlums","reloadTableRenderData","reCalcAndReLoadTableData","_ref12","modifyItem","modifyData","_ref13","clearDataRenderField","itemN","ki","fliterTableDataUnexpand","_this11","cloneFullData","$XEUtils","clone","_this11$$refs$xGrid","isTreeExpandByRow","deleteProperty","insertRecords","getInsertRecords","updateRecords","getUpdateRecords","removeRecords","getRemoveRecords","_this$$refs$xGrid$$re","keepSource","_this$$refs$xGrid$get","visibleData","footerData","combinedData","getCombinedData","_this12","combinedType","accurateJiafa","transToNumber","getPureTableData","listData","getListData","_this$$refs$xGrid$$re2","_this$$refs$xGrid$get2","getOptionData","getRecordset","getInsertRowData","getSelectionData","validateChangeData","validEvent","_arguments4","_this13","_callee4","_callee4$","_context4","status","fullValidEvent","_arguments5","_this14","_callee5","msgList","_callee5$","_context5","$createElement","fullValidate","errList","params","rules","rule","title","msg","selectValidEvent","_this15","_callee6","selectRecords","_callee6$","_context6","insertEvent","_ref14","transTableColumnsToSource","columns","newColumns","transTableColumnToSource","tableEventFn","_this16","Sortable","$Sortable","$el","querySelector","onEnd","_ref15","oldIndex","targetTrElem","wrapperElem","parentNode","prevTrElem","previousElementSibling","tableTreeData","selfRow","getRowNode","selfNode","findTree","prevRow","prevNode","oldTrElem","insertBefore","currRow","items","splice","unshift","_this17","_ref16","newIndex","_xTable$getTableColum","getTableColumn","fullColumn","tableColumn","targetThElem","fixed","oldColumnIndex","getColumnIndex","newColumnIndex","storageColumn","$store","commit","loadColumn","onContextMenuClick","_ref17","event","menu","window","code","hideColumn","resetColumn","resizable","toggleAllCheckboxRow","remove","clearData","maximize","zoom","$Export","triggerExportOption","print","filename","isHeader","isFooter","clearSort","triggerReverseCheck","_xGrid$getTableData","setCheckboxRow","handleCheckboxChange","_this18","records","handleCheckboxAllChange","_this19","onOptionRowClick","methods","onOptionSortRowClick","_ref18","$rowIndex","optionType","temp","toolBarEvent","toolbarButtonClickEvent","button","callback","onToolbarOperrateClick","_this20","context","exportCustom","triggerImportOption","downloadTemplateCallback","Cb","downLoadImportTemplate","importSuccessCallback","expendAllLoading","setTimeout","expandAllState","_this20$$refs$xGrid","_this20$$refs$xGrid$c","clearTreeExpand","_this20$$refs$xGrid2","_this20$$refs$xGrid2$","setAllTreeExpand","finally","Unitlevel","oldUnitlevel","_this21","moneyUnitOptions","curSelectMoneyUnitOption","$forceUpdate","caliberDeclareHandle","caliberDeclareVisible","pageEvent","pagerConfig","pagerConfigInCp","handlePageChange","_ref19","loadData","handleRefresh","formSearchSubmit","getColumnsList","newColumnsList","delSearchfromMain","filterValue","_ref20","_this22","$event","newTbleDatas","search","dataNews","tableColumnsFieldArr","includes","onFuzzySearchEnter","keyCode","filtertext","filtertextCp","getHighlightedFilterText","val","regf","RegExp","match","searchParams","onAdvancedSearchBtnClick","proxyFn","handleSearch","_this23","filterName","trim","toLowerCase","filterRE","searchProps","rest","searchTree","some","eachTree","apiList","setTreeExpand","defaultExpandRows","searchEvent","debounce","leading","trailing","axiosEvent","$asyncGet","url","cb","_this24","_callee7","_callee7$","_context7","$http","get","origin","$asyncPost","_this25","_callee8","_callee8$","_context8","post","$post","response","$get","tableEvent","cellOptionCallBack","keydown","radioChange","cellClick","_this26","cellClickCheck","shiftKey","isCheckedByCheckboxRow","cellDblclick","treeNode","dblRowExpandAll","toggleTreeExpand","_this27","cellContextMenu","cellMouseenter","cellMouseleave","headerCellClick","headerCellDblclick","footerCellClick","footerCellDblclick","footerCellContextMenu","sortChange","filterChange","resizableChange","toggleRowExpand","contextMenuClick","currentChange","_this28","editClosed","_this29","$grid","performTableDataCalculate","_ref21","editActived","editDisabled","validError","scroll","scrollTop","enabled","target","offsetHeight","scrollHeight","debounceItemChange","performScrollLoad","scrollLoading","curGt","tatal","total","custom","formSubmitInvalid","formReset","formToggleCollapse","calculateTool","_this30","reductionColFormula","colFormulaConfig","reductionRowCodeFormula","rowCodeFormulaConfig","colFormulaMap","_ref22","_ref22$visibleColumn","visibleColumn","visibleColumnObj","colFormulaMapCp","hasCalcColFormulaMap","ifDoWhile","formulaEditable","colFormulaMapArr","cmai","regR","rowsKey","keyCF","keyC","reg","_visibleColumnObj$ite","_visibleColumnObj$ite2","calcResult","eval","Infinity","accurateFixed","accurateChuFa","digits","_visibleColumnObj$ite3","_visibleColumnObj$ite4","formulaDigits","round","reductionRowFormula","rowFormulaMap","rowFormulaMapCp","hasCalcrowFormulaMap","rowFormulaMapArr","formulaArr","split","join","rowCellArr","reverDataCodeRowMap","codeKey","reverCalcRowCodeFormula","itemcode","formColCalList","getFormColCalBack","getDataCodeRowMapCumulativeResult","rowCodeFormulaMap","_self$calculateConstr","calcAndConstraintTableId","calcAndConstraintItemCodeField","gradedSummaryFields","isTreeData","treeData","getDataCodeTreeData","_self$recursiveDataCo","recursiveDataCodeRowMap","rowCodeFormulaMapCp","hasCalcrowCodeFormulaMap","rowCodeFormulaMapArr","rowCodeFormumaMap","checkWhetherExcuteColCalculate","itemCode","curRowCodeFormulaMap","rowCodeFormulaFieldMap","itemCodeIndex","riverColumnsGenerateCalcColFormulaMap","tableColumnsFieldMap","tableColumnsSingArr","tableColumnsTitleFieldMap","tableColumnsSingEditFieldArr","conlum","needResponsive","gradedSummary","formulaConditions","rowFormula","j","rePerformRowCalcAndConstraintSingleAndRerender","generateColumnsAllMap","viewToSourceMap","rowsObjTemp","tableColumnsTitleMap","needMap","multiple","isEditForFormula","isForFormulaData","isForFormula","isActiveCellEdit","_ref23","calcAndConstraint","_this31","getDataConfig","cell","formulaShow","colField","performGetData","_this32","_this32$calculateCons","getDataAxiosConfig","getDataParams","dataFieldArr","dataField","resData","statusField","successCode","generatGetDataMap","getDataRenderMap","performGetDataOption","_ref24","rePerformRowCalcAndConstraintAllAndRerender","_ref25","_this33","_self$calculateConstr2","enabledType","colConstraintConfig","rowCodeConstraintConfig","_self$recursiveDataCo2","performGetDataAll","performColFormula","performColFormulaAll","calcColType","performGradedSummaryAll","performRowCodeFormula","performColConstraint","performRowConstraintAll","performCellConstraint","performCellConstraintAll","updatedDataAfterConstraint","rePerformRowCalcAndConstraintSingle","_ref26","_ref27","_this34","_self$calculateConstr3","_self$recursiveDataCo3","performColFormulaSingle","gradedSummaryRow","performGradedSummarySingle","performRowConstraintSingle","performCellConstraintSingle","listToTreeByNestCodeLength","traverseTree","levelNo","pCode","pNCode","extendMapInfoField","_ref28","isEmptyObj","renderItemKey","renderItemKeyArr","performGetDataSingle","_ref29","_ref30","_ref31","getParentColFormulaConfig","_ref32","_ref33","reduce","preResult","curItemGradedSummaryValue","_ref34","_ref35","genarateRowConstraintMapAll","_ref36","genarateCellConstraintMapAll","_ref37","genarateRowConstraintMapSingle","_ref38","curCellConstraint","genarateCellConstraintMapSingle","constraintTool","_ref39","each","_ref40","dataMap","parsingRowConstraintConfigToMapData","expression","rowConstraintArr","parsingRowConstraintConfigToValueData","evalEpression","replaceRowEpressionValue","transExpressionToObject","pasingExpression","Set","keyF","Function","str","performRowConstraintAndRerender","constraintConfig","genarateRowConstraintMap","refreshColumn","valueArr","result","pos","substring","performConstraintAndRerender","genarateConstraintMap","_ref41","itemkey","itemCodeFieldArr","parsingCellConstraintConfigToValueData","replaceCellEpressionValue","_ref42","curRowConstrainRowDataMap","clear","otherFn","_this$$refs$xGrid$get3","dealData","newData","itemVal","prefix","substr","regTreePrefix","addTreeReg","formValidationConfig","_this35","pattern","addTreePrefixKey2","_this36","treeArr","$set","loopAddSubTotal","itemData","itVal","batchModify","onBatchModifyItemChange","modifyForm","omBatchModifySureClick","_ref43","formData","exportAndImportFn","computedExportRow","moneyKeys","ratioKeys","_this37","getPrintOption","exportModalFormData","checkColumns","isColGroup","onPrintClick","_this38","_this$getTableData","_item$cellRender","_item$cellRender2","_ref44","computedFullData","computedExpandData","fullDataTreeArr","treeExpandDataTreeArr","_fullDataTreeArr$","seqIndex","colItem","exportFormatter","hasOwn","newFormatterValue","_treeExpandDataTreeAr","latestTableData","exportModalData","isExportTree","saveType","fileName","isExportHead","isExportFooter","isExportOnlySourceField","isExportOnlyViewTitle","isExportOriginalData","isExportData","datas","ignoreColsTypes","viewValueFormat","customExportConfig","exportModalVisible","onExportClick","ec","_this39","successCb","onlyConfigExport","exportExcel","dealExportViewData","_this40","viewData","_this$generateColumns","colFormulaConfigm","keyIndex","reverseParseViewDataTosource","deaImportViewData","_this41","valiRules","_this$generateColumns2","validResult","validResultFieldTitle","formatData","process","env","VUE_APP_CONF_ISHB","valiRule","_loop","flag","fieldValue","required","collectValidError","validator","ruleField","importModalVisible","parseViewValue","transValue","viewValue","viewToSourceValueArr","label","newRule","$options","min","max","maxWidth","validCellRules","argObj","_this42","errorRules","syncVailds","cellValue","isFunction","customValid","isError","validRuleErr","isNumber","numVal","toNumber","getSize","all","exportByTempalte","exportConlums","exportConlumsTitle","_this$generateColumns3","tabPanal","config","importConfig","triggerDownloadTemplate","onDownloadTemplateClick","defaultConfig","exportViewTitleType","onImportFileClick","_this43","_callee9","_callee9$","_context9","$Import","importExcel","fileConfig","onImportClick","useMoneyFilter","_this44","_column$cellRender","_this44$tableConfig$g"],"sources":["C:/Users/何小龙/Desktop/platformweb-fb/src/components/Table/util/methods.js"],"sourcesContent":["/* eslint-disable no-useless-escape */\r\n/* eslint-disable no-eval */\r\n/* eslint-disable no-new-func */\r\n// methods   Author:Titans@2396757591@qq.com\r\nimport { tableColumns, filterTypeMap } from '../config/tableDefaultConfig'\r\nimport formatters from './formatter'\r\nimport util from '../tool/util.js'\r\nimport evalCalcUtil from '../../tool/eval/index.js'\r\nimport { getColumnMoneyFilterConfig } from '../tool/tableColumnMoneyFilter'\r\nimport XEUtils from 'xe-utils'\r\n\r\n// 唯一行id属性名称\r\nexport const rowUuidKeyName = '__BOSS_UUID'\r\n// 树形节点深度\r\nexport const rowUniqueLevelKey = '__BOSS_TREE_NODE_LEVEL'\r\n\r\n// 设置树形表格唯一键\r\nconst setRowUuidKey = (rows, instance, level = 0) => {\r\n  if (typeof rows !== 'object') return\r\n  for (let row of Array.isArray(rows) ? rows : [rows]) {\r\n    // 设置唯一标识\r\n    !row[rowUuidKeyName] && Reflect.set(row, rowUuidKeyName, XEUtils.uniqueId(`${rowUuidKeyName}_`))\r\n    // 设置节点层级\r\n    !row[rowUniqueLevelKey] && Reflect.set(row, rowUniqueLevelKey, level)\r\n    if (row?.children && row?.children?.length) {\r\n      setRowUuidKey(row.children, instance, level + 1)\r\n    }\r\n  }\r\n}\r\n\r\nconst sortMethods = {\r\n  arrSortGloabal(data, property, type, order = 'asc') {\r\n    // 通用 排序\r\n    data.sort(function (a, b) {\r\n      if (order === 'asc') {\r\n        if (type === 'number') {\r\n          return a[property] - b[property]\r\n        }\r\n        return (String(a[property])).localeCompare(String(b[property]))\r\n      } else {\r\n        if (type === 'number') {\r\n          return b[property] - a[property]\r\n        }\r\n        return (String(b[property])).localeCompare(String(a[property]))\r\n      }\r\n    })\r\n    return data\r\n  },\r\n  arrSortString({ $table, data, column, property, order }) {\r\n    // 字符 排序\r\n    data.sort(function (a, b) {\r\n      if (order === 'asc') {\r\n        return (String(a[property])).localeCompare(String(b[property]))\r\n      } else {\r\n        return (String(b[property])).localeCompare(String(a[property]))\r\n      }\r\n    })\r\n    return data\r\n  },\r\n  arrSortNumber({ $table, data, column, property, order }) {\r\n    // 数字 排序\r\n    data.sort(function (a, b) {\r\n      if (order === 'asc') {\r\n        return a[property] - b[property]\r\n      } else {\r\n        return b[property] - a[property]\r\n      }\r\n    })\r\n    return data\r\n  },\r\n  arrSortStringSuffix({ $table, data, column, property, order, rTypeSuffix }) {\r\n    // 通用 排序 new\r\n    data.sort(function (a, b) {\r\n      if (order === 'asc') {\r\n        return (String(a[property])).localeCompare(String(b[property]))\r\n      } else {\r\n        return (String(b[property])).localeCompare(String(a[property]))\r\n      }\r\n    })\r\n    return data\r\n  },\r\n  arrSortNumberSuffix({ $table, data, column, property, order, rTypeSuffix }) {\r\n    // 兼容树形表格 => 递归排序后代节点\r\n    function sortInner(data) {\r\n      // 通用 排序 new\r\n      data.sort(function (a, b) {\r\n        if (order === 'asc') {\r\n          return parseFloat(a[property]) - parseFloat(b[property])\r\n        } else {\r\n          return parseFloat(b[property]) - parseFloat(a[property])\r\n        }\r\n      })\r\n      $table.treeConfig && data.forEach(item => {\r\n        if (item?.children?.length) {\r\n          sortInner(item.children)\r\n        }\r\n      })\r\n    }\r\n    sortInner(data)\r\n    return data\r\n  },\r\n  arrSort({ $table, data, column, property, order }) {\r\n    // 排序\r\n    let self = this\r\n    const sortTypeMap = {\r\n      // number类型排序\r\n      $vxeMoney: 'arrSortNumberSuffix',\r\n      $vxeDays: 'arrSortNumberSuffix',\r\n      $vxeCalculate: 'arrSortNumberSuffix',\r\n      // 字符类型排序\r\n      $vxeTree: 'arrSortStringSuffix',\r\n      $vxeInput: 'arrSortStringSuffix',\r\n      $vxeSelect: 'arrSortStringSuffix',\r\n      $vxeEditDownTextarea: 'arrSortStringSuffix',\r\n      $vxeTime: 'arrSortStringSuffix',\r\n      $vxeRadio: 'arrSortStringSuffix',\r\n      $vxeCheckbox: 'arrSortStringSuffix',\r\n      $$vxeEditDownJson: 'arrSortStringSuffix',\r\n      $vxeEditDownConditions: 'arrSortStringSuffix',\r\n      $vxeInterlet: 'arrSortStringSuffix'\r\n    }\r\n    let render = (column.own && (column.own.editRender || column.own.cellRender || column.own.contentRender))\r\n    if (render && render.name && sortTypeMap[render.name]) {\r\n      return self[sortTypeMap[render.name]]({ $table, data, column, property, order, rTypeSuffix: '__viewSort' })\r\n    } else {\r\n      data.sort(function (a, b) {\r\n        if (order === 'asc') {\r\n          if (isNaN(Number(a[property]))) {\r\n            return (a[property].toString()).localeCompare(b[property].toString())\r\n          }\r\n          return a[property] - b[property]\r\n        } else {\r\n          if (isNaN(Number(a[property]))) {\r\n            return (b[property].toString()).localeCompare(a[property].toString())\r\n          }\r\n          return b[property] - a[property]\r\n        }\r\n      })\r\n    }\r\n    return data\r\n  }\r\n}\r\nconst registFn = {\r\n  registGlobleFormatters(obj) {\r\n    let self = this\r\n    Object.keys(obj).forEach((item, index) => {\r\n      self.$VXETable.formats.add(item, obj[item].bind(self))\r\n    })\r\n  },\r\n  registGloableConlumsConfig(arr = []) {\r\n    // 注册列格式化，渲染器，过滤项目等全局函数\r\n    let self = this\r\n    function reverRegistGloableConlumsConfig(arrc) {\r\n      arrc.forEach((item, index) => {\r\n        self.registSingelRowConfig(arrc, item, index)\r\n        if (Array.isArray(item.children) && item.children.length) {\r\n          self.registGloableConlumsConfig(item.children)\r\n        }\r\n      })\r\n    }\r\n    reverRegistGloableConlumsConfig(arr)\r\n  },\r\n  registSingelRowConfig(arr, item, index) {\r\n    // 注册 单条数据配置项\r\n    let self = this\r\n    arr[index] = self.registSingelRowFilter(item)\r\n    // self.registSingelRowFormater(item)\r\n    // self.registSingelRowSorts(item)\r\n    // self.registSingelRowRenderer(item)\r\n    // self.registSingRowCalcRenderer(item)\r\n  },\r\n  registSingRowCalcRenderer(item) {\r\n    // 注册单条数据计算渲染器\r\n    if (item.formula && !item.editRender) {\r\n      item.editRender = {\r\n        name: '$vxeCalculate'\r\n      }\r\n    }\r\n  },\r\n  registSingelRowFilter_old(item) {\r\n    // 绑定单条列过滤器配置\r\n    if (Array.isArray(item.children)) {\r\n      return\r\n    }\r\n    if (item.filters !== undefined || item.filters || item.filterRender !== undefined || item.filterRender) {\r\n      // if (item.filters === false) {\r\n      //   delete item.filters\r\n      //   delete item.filterRender\r\n      //   delete item.filterMethod\r\n      // }\r\n\r\n      // type+editable\r\n      // { value: '$vxeInput', label: '输入框' },\r\n      // { value: '$vxeSelect', label: '下拉选择' },\r\n      // { value: '$vxeCalculate', label: '计算' },\r\n      // { value: '$vxeMoney', label: '金额' },\r\n      // { value: '$vxeEditDownTextarea', label: '文本输入框' },\r\n      // { value: '$vxeDays', label: '天数' },\r\n      // { value: '$vxeTime', label: '时间' },\r\n      // { value: '$vxeRadio', label: '单选' },\r\n      // { value: '$vxeCheckbox', label: '复选' },\r\n      // { value: '$treeinput', label: '下拉树' },\r\n      // { value: '$EditDownJson', label: 'JSON' },\r\n      // { value: '$href', label: '链接' }\r\n      return\r\n    }\r\n    let self = this\r\n    let itemRender = item.cellRender || item.editRender || item.contentRender\r\n    if (item.filters === undefined || item.filters === true) {\r\n      if (item.field && self.tableConfigCp.filters[item.field]) {\r\n        item.filters = self.tableConfigCp.filters[item.field].filters ? self.tableConfigCp.filters[item.field].filters : [{ data: '' }]\r\n        if (typeof (self.tableConfigCp.filters[item.field].filterMethod) === 'function') {\r\n          item.filterMethod = self.tableConfigCp.filters[item.field].filterMethod ? self.tableConfigCp.filters[item.field].filterMethod : ({ option, row, column }) => {\r\n            return row[column.property] === Number(option.data)\r\n          }\r\n        }\r\n      } else if (item.field && itemRender) {\r\n        switch (itemRender.name) {\r\n          case '$select':\r\n            item.filters = Array.isArray(itemRender.options) ? itemRender.options : []\r\n            item.filterMultiple = true\r\n            break\r\n          case '$vxeSelect':\r\n            item.filters = Array.isArray(itemRender.options) ? itemRender.options : []\r\n            item.filterMultiple = true\r\n            break\r\n          case '$calculateRender':\r\n            item.filters = [{ data: { type: 'has', isCase: false, value: '', dataType: 'float' } }]\r\n            item.filterRender = { name: 'FilterComplex' }\r\n            break\r\n          case '$vxeCalculate':\r\n            item.filters = [{ data: { type: 'has', isCase: false, value: '', dataType: 'float' } }]\r\n            item.filterRender = { name: 'FilterComplex' }\r\n            break\r\n          case '$moneyRender':\r\n            item.filters = [{ data: { type: 'has', isCase: false, value: '', dataType: 'float' } }]\r\n            item.filterRender = { name: 'FilterComplex' }\r\n            break\r\n          case '$vxeMoney':\r\n            item.filters = [{ data: { type: 'has', isCase: false, value: '', dataType: 'float' } }]\r\n            item.filterRender = { name: 'FilterComplex' }\r\n            break\r\n          case '$href':\r\n            item.filters = [{ data: '' }]\r\n            item.filterRender = { name: 'FilterInput' }\r\n            break\r\n          case '$vxeRadio':\r\n            item.filters = Array.isArray(itemRender.options) ? itemRender.options : []\r\n            item.filterMultiple = true\r\n            break\r\n          case '$vxeCheckbox':\r\n            item.filters = [{ data: { vals: [], sVal: '' } }]\r\n            item.filterRender = { name: 'FilterChoose' }\r\n            break\r\n          case '$vxeInput':\r\n            // text, search, number, integer, float, password, date, datetime, week, month, year\r\n            if (this.getbasicDataType(itemRender.props) === 'Object' && itemRender.props.type) {\r\n              switch (itemRender.props.type) {\r\n                case 'text':\r\n                  item.filters = [{ data: { vals: [], sVal: '' } }]\r\n                  item.filterRender = { name: 'FilterContent' }\r\n                  break\r\n                case 'float':\r\n                  item.filters = [{ data: { type: 'has', isCase: false, value: '', dataType: 'float' } }]\r\n                  item.filterRender = { name: 'FilterComplex' }\r\n                  break\r\n                case 'number':\r\n                  item.filters = [{ data: { type: 'has', isCase: false, value: '', dataType: 'number' } }]\r\n                  item.filterRender = { name: 'FilterComplex' }\r\n                  break\r\n                case 'year':\r\n                  item.filters = [{ data: { type: 'has', isCase: false, value: '', dataType: 'year' } }]\r\n                  item.filterRender = { name: 'FilterComplex' }\r\n                  break\r\n                case 'date':\r\n                  item.filters = [{ data: { type: 'has', isCase: false, value: '', dataType: 'date' } }]\r\n                  item.filterRender = { name: 'FilterComplex' }\r\n                  break\r\n                default:\r\n                  if (itemRender.name === '$optionSort' || itemRender.name === 'optionRow') {\r\n                    delete item.filters\r\n                    delete item.filterRender\r\n                    delete item.filterMethod\r\n                  } else {\r\n                    item.filters = [{ data: '' }]\r\n                    item.filterRender = { name: 'FilterInput' }\r\n                  }\r\n                  break\r\n              }\r\n            } else {\r\n              item.filters = [{ data: '' }]\r\n              item.filterRender = { name: 'FilterInput' }\r\n            }\r\n            break\r\n          case '$EditDownTextarea':\r\n            item.filters = [{ data: { vals: [], sVal: '' } }]\r\n            item.filterRender = { name: 'FilterContent' }\r\n            break\r\n          case '$vxeEditDownTextarea':\r\n            item.filters = [{ data: { vals: [], sVal: '' } }]\r\n            item.filterRender = { name: 'FilterContent' }\r\n            break\r\n          case '$treeinput':\r\n            item.filters = [{ data: { vals: [], sVal: '' } }]\r\n            item.filterRender = { name: 'FilterContent' }\r\n            break\r\n          default:\r\n            if (['seq', 'checkbox', 'dragSort', 'radio', 'optionRow'].indexOf(item.type)) {\r\n              delete item.filters\r\n              delete item.filterRender\r\n              delete item.filterMethod\r\n            } else {\r\n              item.filters = [{ data: '' }]\r\n              item.filterRender = { name: 'FilterInput' }\r\n            }\r\n            break\r\n        }\r\n      } else {\r\n        item.filters = [{ data: '' }]\r\n        item.filterRender = { name: 'FilterInput' }\r\n      }\r\n    }\r\n  },\r\n  registSingelRowFilter(item) {\r\n    // 绑定单条列过滤器配置\r\n    if (Array.isArray(item.children)) {\r\n      return item\r\n    }\r\n    try {\r\n      let itemRender = item.cellRender || item.editRender\r\n      if (itemRender && ((item.filters + '' === 'true') || item.filters + '' === 'undefined')) {\r\n        if (itemRender.name && filterTypeMap[itemRender.name]) {\r\n          if (itemRender.name === '$vxeInput') {\r\n            if (this.getbasicDataType(itemRender.props) === 'Object' && filterTypeMap['$vxeInput'][itemRender.name + itemRender.props.type]) {\r\n              item = Object.assign({}, item, filterTypeMap['$vxeInput'][itemRender.name + itemRender.props.type])\r\n            } else {\r\n              item = Object.assign({}, item, filterTypeMap['$vxeInput'][itemRender.name + 'global'])\r\n            }\r\n          } else {\r\n            item = Object.assign({}, item, filterTypeMap[itemRender.name])\r\n          }\r\n        } else {\r\n          switch (itemRender.name) {\r\n            default:\r\n              if (['seq', 'checkbox', 'dragSort', 'radio', 'optionRow'].indexOf(item.type) >= 0) {\r\n                delete item.filters\r\n                delete item.filterRender\r\n                delete item.filterMethod\r\n              } else {\r\n                item.filters = [{ data: '' }]\r\n                item.filterRender = { name: 'FilterInput' }\r\n              }\r\n              break\r\n          }\r\n        }\r\n      } else if (!(typeof item.filters === 'object')) {\r\n        item.filters = false\r\n      } else {\r\n      }\r\n    } catch (e) {\r\n      throw (e)\r\n    }\r\n    return item\r\n  },\r\n  registSingelRowFormater(item) {\r\n    // 绑定单条列格式化配置 废弃\r\n    let self = this\r\n    if (item.field && self.tableConfigCp.formatters[item.field]) {\r\n      item.formatter = self.tableConfigCp.formatters[item.field]\r\n    }\r\n  },\r\n  registSingelRowRenderer(item) {\r\n    // 绑定单条列渲染器配置 废弃\r\n    let self = this\r\n    let itemRender = item.cellRender || item.editRender || item.contentRender\r\n    if (item.field && self.tableConfigCp.cellRenderConfig[item.field] && !itemRender) {\r\n      item[self.tableConfigCp.cellRenderConfig[item.field].type] = self.tableConfigCp.cellRenderConfig[item.field]\r\n    }\r\n  },\r\n  registSingelRowSorts(item) {\r\n    // 绑定单条列排序配置\r\n    if (!item.children && item['sortable'] === undefined) {\r\n      item['sortable'] = item['sortable'] || true\r\n    }\r\n  },\r\n  registRenderers(arr = []) {\r\n    // 初始化绑定列渲染器\r\n    let self = this\r\n    function reverRegistRenderers(arrc) {\r\n      arrc.forEach((item, index) => {\r\n        reverRegistRenderers(item)\r\n        if (Array.isArray(item.children) && item.children.length) {\r\n          self.registRenderers(item.children)\r\n        }\r\n      })\r\n    }\r\n    reverRegistRenderers(arr)\r\n  },\r\n  registFilters(arr = []) {\r\n    // 初始化绑定列过滤器函数 废弃\r\n    let self = this\r\n    arr.forEach((item, index) => {\r\n      self.registSingelRowFilter(item)\r\n      if (Array.isArray(item.children) && item.children.length) {\r\n        self.registFormatters(item.children)\r\n      }\r\n    })\r\n  },\r\n  registFormatters(arr = []) {\r\n    // 初始化绑定列格式化函数 废弃\r\n    let self = this\r\n    arr.forEach((item, index) => {\r\n      self.registSingelRowFormater(item)\r\n      if (Array.isArray(item.children) && item.children.length) {\r\n        self.registFormatters(item.children)\r\n      }\r\n    })\r\n  },\r\n  registTableRender(renderers) {\r\n    // 注册渲染器\r\n    for (let i in renderers) {\r\n      this.$VXETable.renderer.add(i, renderers[i])\r\n    }\r\n  }\r\n}\r\nconst initMethods = {\r\n  initCreated() {\r\n    this.initColumnMoneyFilter()\r\n\r\n    // 初始化Created\r\n    // 即将废弃\r\n    // this.registTableRender(defaultRenderers)\r\n    // this.registGlobleFormatters(defaultFormatters)\r\n    // this.tableGlobalConfig.dragColumnsConfig && this.tableGlobalConfig.dragColumnsConfig.openDrag && this.setColumnDrop()\r\n  },\r\n  initMounted() {\r\n    // 初始化Mounted\r\n    this.initFirst()\r\n    if ((this.tableGlobalConfigIn.dragColumnsConfig && this.tableGlobalConfigIn.dragColumnsConfig.openDrag) || this.tableGlobalConfigIn.columnDrop) {\r\n      this.setColumnDrop()\r\n    }\r\n    if (this.tableGlobalConfigIn.rowDrop) {\r\n      this.setRowDrop()\r\n    }\r\n  },\r\n  initFirst() {\r\n    // 组件初始化\r\n    this.initTableGlobalConfig()\r\n    this.initContextMenuConfig()\r\n    this.initSeqConfig()\r\n    this.initExpandConfig()\r\n    this.initToolbar()\r\n    this.initEditConfig()\r\n    this.initTableFormConfig()\r\n    this.initCalculateConstraintConfig()\r\n    this.initTableConfig()\r\n    this.initEditRules()\r\n    this.initTable()\r\n    this.initTableData()\r\n  },\r\n  initTable() {\r\n    this.initTableConlums()\r\n    this.setPagerConfig()\r\n  },\r\n  initColumnMoneyFilter() {\r\n    // 金额过滤\r\n    this.setColumnMoneyFilter(this.tableColumnsConfig)\r\n    this.completeMoneyFilter = true\r\n  },\r\n  initTableGlobalConfig() {\r\n    // 初始化全局配置\r\n    this.tableGlobalConfigIn = Object.assign({}, this.tableGlobalConfigIn, this.tableGlobalConfig)\r\n  },\r\n  initTableConfig() {\r\n    // 初始化表格列和渲染器配置\r\n    this.tableConfigCp = Object.assign({\r\n      globalConfig: {\r\n        checkType: 'checkbox',\r\n        seq: true,\r\n        filters: true,\r\n        sortable: false\r\n      }\r\n    }, this.tableConfig || this.tableGlobalConfigIn.tableConfig)\r\n    this.initTableConlums()\r\n\r\n    this.registTableRender(this.tableConfigCp.renderers)\r\n  },\r\n  initCacheColumn() {\r\n    let data = JSON.parse(localStorage.getItem(this.tableId || '') || '[]').map((k, v) => ({ field: k, index: v }))\r\n    let tableColumnsConfig = JSON.parse(JSON.stringify(this.tableColumnsConfig))\r\n    let arr = data.length\r\n      ? tableColumnsConfig.map(item => {\r\n        let obj = {}\r\n        for (let item2 of data) {\r\n          if (item.field === item2.field) {\r\n            obj = { ...item, ...item2 }\r\n          }\r\n        }\r\n        return obj\r\n      }) : []\r\n    arr.sort((a, b) => {\r\n      return a.index - b.index\r\n    })\r\n    return arr.length ? arr : tableColumnsConfig\r\n  },\r\n  initTableConlums(columnsConfig) {\r\n    // 初始化列配置\r\n    this.calculateConstraintConfigIn = Object.assign({}, this.calculateConstraintConfigIn)\r\n    const tableColumnsConfig = (this.tableGlobalConfig.dragColumnsConfig && this.tableGlobalConfig.dragColumnsConfig.cacheStatus) ? this.initCacheColumn() : (columnsConfig || this.tableColumnsConfig)\r\n    if (tableColumnsConfig.length) {\r\n      this.generateCalcColFormulaMap(tableColumnsConfig)\r\n      this.tableColumnsConfigIn = this.unidirectionalData ? this.deepCopy(this.generateTableConlums(tableColumnsConfig, this.tableConfigCp.globalConfig)) : this.generateTableConlums(tableColumnsConfig, this.tableConfigCp.globalConfig)\r\n    } else {\r\n      this.tableColumnsConfigIn = []\r\n    }\r\n    return this.tableColumnsConfigIn\r\n  },\r\n  initScrollLoadConfig(scrollLoadConfig) {\r\n    this.scrollLoadConfigCp = Object.assign({}, this.scrollLoadConfigCp, scrollLoadConfig || this.scrollLoadConfig)\r\n  },\r\n  generateTableConlums(conlums, globalConfig) {\r\n    // 生成表头\r\n    let tableColumnsConfigIn = []\r\n    if (globalConfig.rowDrop) {\r\n      tableColumnsConfigIn.push(tableColumns['rowDrop'])\r\n    }\r\n    if (globalConfig.checkType) {\r\n      tableColumnsConfigIn.push(tableColumns[globalConfig.checkType])\r\n    }\r\n    if (globalConfig.seq) {\r\n      tableColumnsConfigIn.push(tableColumns['seq'])\r\n    }\r\n    tableColumnsConfigIn = [...tableColumnsConfigIn, ...conlums]\r\n    if (globalConfig.optionSort) {\r\n      tableColumnsConfigIn.push(tableColumns['optionSort'])\r\n    }\r\n    this.registGloableConlumsConfig(tableColumnsConfigIn)\r\n    return tableColumnsConfigIn\r\n  },\r\n  generateOptionRow(tableColumnsConfigIn, globalConfig) {\r\n    // 初始化操作列 废弃\r\n    if (globalConfig.hasOptionRow) {\r\n      let optionRow = tableColumns['optionRow']\r\n      if (this.getbasicDataType(this.tableConfigCp.cellRenderConfig.optionRow) === 'Object') {\r\n        let cellRender = optionRow.cellRender\r\n        cellRender = Object.assign({}, this.tableConfigCp.cellRenderConfig.optionRow)\r\n        optionRow[this.tableConfigCp.cellRenderConfig.optionRow.type] = cellRender\r\n      }\r\n      tableColumnsConfigIn.push(optionRow)\r\n    }\r\n    return tableColumnsConfigIn\r\n  },\r\n  generateBottomGroupTotal() {\r\n    // 根据表格上面已算好的分组合计，求最下面的分组合计\r\n\r\n  },\r\n  initCalculateConstraintConfig() {\r\n    // 初始化计算和约束配置\r\n    this.calculateConstraintConfigIn = Object.assign({}, this.calculateConstraintConfigIn, this.calculateConstraintConfig)\r\n    if (this.calculateConstraintConfigIn.cellDataConfig && this.calculateConstraintConfigIn.cellDataConfig.length) {\r\n      this.generatGetDataConfigMap(this.calculateConstraintConfigIn.cellDataConfig)\r\n    }\r\n    this.constrainRowDataMap = {}\r\n  },\r\n  initToolbar(toolbarConfig) {\r\n    // 初始化工具栏\r\n    let curtoolbarConfig = toolbarConfig || this.toolbarConfig\r\n    if (this.getbasicDataType(curtoolbarConfig) === 'Boolean') {\r\n      this.toolbarConfigIn = undefined\r\n      this.toolbarConfigInCopy = this.toolbarConfigInCp || {}\r\n    } else {\r\n      if (curtoolbarConfig.visible === false) {\r\n        this.toolbarConfigIn = undefined\r\n        this.toolbarConfigInCopy = this.toolbarConfigInCp\r\n      } else {\r\n        this.toolbarConfigIn = Object.assign({}, this.toolbarConfigInCp, curtoolbarConfig)\r\n        this.toolbarConfigInCopy = this.toolbarConfigIn\r\n      }\r\n      if (this.toolbarConfigInCopy.yearlist.length) {\r\n        this.formSearchData.year = this.toolbarConfigInCopy.yearlist[0]\r\n      }\r\n      this.setMoneyUnit(this.moneyUnit)\r\n    }\r\n  },\r\n  loadScrollTableData(data) {\r\n    // 加载滚动加载数据\r\n    let self = this\r\n    this.initCalculateConstraintConfig()\r\n    // 初始化表格数据\r\n    this.selection = []\r\n    if (this.$refs.xGrid) {\r\n      this.$refs.xGrid.$refs.xTable.tableSourceData = []\r\n      this.$refs.xGrid.removeCheckboxRow()\r\n    }\r\n    this.tableDataIn = this.getTableData().fullData.concat(this.addMissingFieldsAndCalcColFormula(data))\r\n    this.$nextTick().then(() => {\r\n      if (self.$refs.xGrid) {\r\n        self.$refs.xGrid.reloadData(self.tableDataIn).then(() => {\r\n          self.$refs.xGrid.clearFilter().then(() => {\r\n            self.$refs.xGrid.$refs.xTable.tableSourceData = self.deepCopy(self.getTableData().fullData)\r\n            self.$refs.xGrid.$refs.xTable.handleDefaults()\r\n          })\r\n        })\r\n      }\r\n    })\r\n    return this.tableDataIn\r\n  },\r\n  initCalcPublicData() {\r\n    // calcPublicData: {\r\n    // }\r\n    // rowCalcData: { },\r\n    // cellCaclData: { },\r\n    // cellCodeCalcData: { }\r\n    // }\r\n  },\r\n  initTableData(data) { // 初始化表格数据\r\n    // 执行顺序： 取数-->行内计算-->分级汇总-->父级行内计算-->单元格交叉计算(涉及的行计算)-->行约束-->单元格约束\r\n    let self = this\r\n    this.initCalculateConstraintConfig()\r\n    this.selection = []\r\n    data = Array.isArray(data || this.tableData) ? (data || this.tableData) : []\r\n\r\n    // 为树形数据设置唯一属性\r\n    setRowUuidKey(data, this)\r\n\r\n    return new Promise((resolve, reject) => {\r\n      this.rePerformAllCalcAndConstraintByData(self.unidirectionalData ? self.deepCopy(data) : data, true).then(({ dataCodeRowMap, dataCodeRowArr, afterCalcData }) => {\r\n        self.tableDataMap = dataCodeRowMap\r\n        self.tableDataIn = self.addMissingFields(self.deepCopy(afterCalcData))\r\n        self.$nextTick().then(() => {\r\n          let xGrid = self.$refs.xGrid\r\n          if (xGrid) {\r\n            xGrid.reloadData(self.tableDataIn).then(() => {\r\n              xGrid.clearFilter().then(() => {\r\n                xGrid.$refs.xTable.tableSourceData = self.deepCopy(self.getTableData().fullData)\r\n                xGrid.$refs.xTable.handleDefaults()\r\n                self.$emit('onTableDataLoaded', self.tableDataIn, self, xGrid)\r\n                resolve(self.tableDataIn)\r\n              })\r\n            })\r\n          } else {\r\n            resolve(self.tableDataIn)\r\n          }\r\n        })\r\n      })\r\n    })\r\n  },\r\n  initTableFormConfig() {\r\n    if (this.getbasicDataType(this.tableFormConfig) === 'Boolean') {\r\n      this.tableFormConfigIn = undefined\r\n    } else {\r\n      this.tableFormConfigIn = Object.assign({}, this.tableFormConfig)\r\n    }\r\n  },\r\n  initSeqConfig(startIndex = 0) {\r\n    // 初始化序号配置项\r\n    let self = this\r\n\r\n    this.seqConfig = {\r\n      startIndex: 1, // 设置序号的起始值 number0\r\n      seqMethod(data) {\r\n        const { seq, $seq, row } = data\r\n\r\n        if (self.pagerConfigIn && !self.treeConfig) {\r\n          return (self.pagerConfigIn.pageSize > 0 ? self.pagerConfigIn.pageSize : 20) * ((self.pagerConfigIn.currentPage > 0 ? self.pagerConfigIn.currentPage : 1) - 1) + seq\r\n        } else {\r\n          let finalSeq = $seq === '' || $seq === undefined ? seq : $seq + '.' + seq\r\n          if (self.isTreeSeqToFlat) {\r\n            const arr = XEUtils.toTreeArray(self.getTableData().treeExpandData)\r\n            const index = arr.findIndex(item => item[rowUuidKeyName] === row[rowUuidKeyName])\r\n            // 根据第一行是否是合计行判断\r\n            if (arr[0]?.id === '#') {\r\n              finalSeq = row.id === '#' ? '#' : index\r\n            } else {\r\n              finalSeq = index + 1\r\n            }\r\n          }\r\n\r\n          // return $seq === '' || $seq === undefined ? seq : $seq + '.' + seq\r\n          return finalSeq\r\n        }\r\n      }\r\n    }\r\n  },\r\n  initEditConfig() { // 编辑配置\r\n    // 暂时性方案，后期调整\r\n    if (this.getbasicDataType(this.editConfig) === 'Boolean') {\r\n      // this.editConfigIn = false\r\n      this.editConfigIn = {\r\n        trigger: 'dblclick',\r\n        mode: 'cell',\r\n        activeMethod: ({ row, rowIndex, column, columnIndex }) => {\r\n          return false\r\n        },\r\n        showStatus: false\r\n      }\r\n    } else if (this.getbasicDataType(this.editConfig) === 'Object') {\r\n      if (this.editConfig.editable !== false) {\r\n        this.editConfigIn = Object.assign(this.editConfigInCp, this.editConfig)\r\n      } else {\r\n        this.editConfigIn = {\r\n          trigger: 'dblclick',\r\n          mode: 'cell',\r\n          activeMethod: ({ row, rowIndex, column, columnIndex }) => {\r\n            return false\r\n          },\r\n          showStatus: false\r\n        }\r\n      }\r\n    }\r\n  },\r\n  refreshTableIsEdit() {\r\n    // 重新渲染刷新表格\r\n\r\n  },\r\n  initExpandConfig() {\r\n    // 编辑展开配置\r\n    if (this.getbasicDataType(this.expandConfig) === 'Undefined' || this.getbasicDataType(this.expandConfig) === 'Boolean') {\r\n      this.expandConfigIn = {\r\n        expandAll: false\r\n      }\r\n    } else {\r\n      this.expandConfigIn = Object.assign({}, this.expandConfig)\r\n    }\r\n  },\r\n  initContextMenuConfig() {\r\n    // 更新右键配置\r\n    if (this.getbasicDataType(this.contextMenuConfig) === 'Undefined' || this.getbasicDataType(this.contextMenuConfig) === 'Boolean') {\r\n      this.contextMenuConfigIn = {}\r\n    } else {\r\n      this.contextMenuConfigIn = Object.assign({}, this.contextMenuConfigIn, this.contextMenuConfig)\r\n    }\r\n  },\r\n  initTreeConfig() {\r\n    // 表格树配置\r\n    if (this.getbasicDataType(this.treeConfig) === 'Boolean') {\r\n      this.treeConfigIn = this.treeConfig\r\n    } else {\r\n      this.treeConfigIn = Object.assign({\r\n        dblExpandAll: false, // 双击展开当前节点树形数据\r\n        onlyDblTreeNodeExpand: false, // 在不允许编辑模式下是否仅仅双击树列才允许执行展开\r\n        dblExpand: false, // 是否执行双击展开树形数据\r\n        children: 'children',\r\n        // 是否为手风琴效果\r\n        accordion: false\r\n      }, this.treeConfig)\r\n    }\r\n  },\r\n  initFooterConfig() {\r\n    // 更新footer配置\r\n    this.footerConfigIn = Object.assign({}, this.footerConfigIn, this.footerConfig)\r\n  },\r\n  initEditRules() {\r\n    // 编辑校验规则\r\n    this.editRulesIn = Object.assign({}, this.editRules)\r\n    // this.editRulesIn = Object.assign({}, this.editRulesIn, this.addTreeReg({ ...this.editRules }))\r\n  }\r\n}\r\nconst tableOptionFn = {\r\n  replaceColumnSlotKey(key) {\r\n    if (!key) return ''\r\n    console.log(key?.replace?.(/column-/, '') ?? '')\r\n    return key?.replace?.(/column-/, '') ?? ''\r\n  },\r\n  // 获取传入表头数据\r\n  transTableCloumnToSource(cloumn) {\r\n    if (!cloumn) return []\r\n    const newColumn = []\r\n    cloumn.forEach((k, v) => {\r\n      k.own && newColumn.push(k.own)\r\n      if (k && k.children) {\r\n        newColumn[v].children = []\r\n        newColumn[v].children.push(...this.transTableCloumnToSource(k.children))\r\n      }\r\n    })\r\n    return newColumn\r\n  },\r\n  tableOptionFn() {\r\n    // 全局表格组件xgrid调用实例\r\n    return this.$refs.xGrid\r\n  },\r\n  updateFooter() {\r\n    // 更新表尾\r\n    return this.$refs.xGrid.updateFooter()\r\n  },\r\n  updateData() {\r\n    // 刷新数据\r\n    this.$refs.xGrid.updateData().then(() => {\r\n      this.$refs.xGrid.updateFooter()\r\n    })\r\n  },\r\n  exportData(obj) {\r\n    // 导出数据\r\n    this.$refs.xGrid.openExport({\r\n      // 默认勾选源\r\n      original: true\r\n    })\r\n  },\r\n  importDataEvent() {\r\n    // 导入数据\r\n    this.$refs.xGrid.importData()\r\n  },\r\n  setAllCheckboxRow() {\r\n    // 设置所有选中\r\n    this.$refs.xGrid.setAllCheckboxRow(true).then(() => {\r\n      this.updateFooter().then(() => { }).catch(() => { })\r\n    })\r\n  },\r\n  clearCheckboxRow() {\r\n    // 清除所有选中\r\n    this.$refs.xGrid.clearCheckboxRow().then(() => {\r\n      this.updateFooter().then(() => { }).catch(() => { })\r\n    })\r\n  },\r\n  removeCheckboxRow() {\r\n    // 删除选中行操作\r\n    let self = this\r\n    self.$refs.xGrid.removeCheckboxRow()\r\n  },\r\n  revertEvent() {\r\n    // 撤销操作\r\n    this.$XModal.confirm('您确定要还原数据吗?').then(type => {\r\n      if (type === 'confirm') {\r\n        // this.$refs.xGrid.revertData()\r\n        this.reLoadTable()\r\n      }\r\n    })\r\n  },\r\n  deleteSelectedRow() {\r\n    // 删除选中记录行的数据（不是复选框的）\r\n    let self = this\r\n    this.$XModal.confirm('您确定要删除所选中数据吗?').then(type => {\r\n      if (type === 'confirm') {\r\n        self.$refs.xGrid.removeCurrentRow()\r\n      }\r\n    })\r\n  },\r\n  deleteRowData(rows) {\r\n    // 删除选中行操作\r\n    let self = this\r\n    return new Promise((resolve, reject) => {\r\n      self.$XModal.confirm('您确定要删除所选中数据吗?').then(type => {\r\n        if (type === 'confirm') {\r\n          self.$refs.xGrid.removeCheckboxRow(rows).then((res) => {\r\n            resolve(res)\r\n          }).catch(e => {\r\n            reject(e)\r\n          })\r\n        } else {\r\n          resolve(false)\r\n        }\r\n      })\r\n    })\r\n  },\r\n  async copySelectionRowData(obj = {}) {\r\n    // 复制选中行数据\r\n    let self = this\r\n    return new Promise((resolve, reject) => {\r\n      const { rowIndexTo, data } = obj\r\n      let rowTo = rowIndexTo === undefined ? -1 : rowIndexTo\r\n      let newRowSelectionsData = data || self.$refs.xGrid.getCheckboxRecords()\r\n      if (newRowSelectionsData.length) {\r\n        newRowSelectionsData.forEach((item, index) => {\r\n          Object.keys(item).forEach((key) => {\r\n            if (key.indexOf('__') >= 0) {\r\n              delete item[key]\r\n            }\r\n          })\r\n          item = Object.assign({}, item, {\r\n            insertMark: '新数据',\r\n            date: new Date().format('YYYY-MM-DD hh:mm:ss:c'),\r\n            isNew: true,\r\n            _XID: ''\r\n          })\r\n        })\r\n        self.$refs.xGrid.insert(newRowSelectionsData).then(({ row, rows }) => {\r\n          self.$refs.xGrid.setActiveCell(rowTo).then(() => {\r\n            resolve({ tableData: self.getTableData, row: row }, self)\r\n          }).catch(e => {\r\n            reject(e)\r\n          })\r\n        }).catch(e => {\r\n          reject(e)\r\n        })\r\n      } else {\r\n        reject(new Error('请先选择新增数据的模版!'))\r\n        self.$XModal.message({ message: '请先选择新增数据的模版!' })\r\n      }\r\n    })\r\n  },\r\n  async copyRowData(obj = {}) {\r\n    // 复制行\r\n    let self = this\r\n    const { rowSource, rowIndexTo } = obj\r\n    let rowSourceData = rowSource === undefined ? 0 : rowSource\r\n    let rowTo = rowIndexTo === undefined ? -1 : rowIndexTo\r\n    // 复制行\r\n    let newRowDataObj = { ...self.$refs.xGrid.getData(rowSourceData) }\r\n    Object.keys(newRowDataObj).forEach((key) => {\r\n      if (key.indexOf('__') >= 0) {\r\n        delete newRowDataObj[key]\r\n      }\r\n    })\r\n    newRowDataObj = Object.assign({}, newRowDataObj, {\r\n      insertMark: '新数据',\r\n      date: new Date().format('YYYY-MM-DD hh:mm:ss:c'),\r\n      isNew: true,\r\n      _XID: ''\r\n    })\r\n    let { row } = await self.$refs.xGrid.insertAt(newRowDataObj, rowTo)\r\n    await self.$refs.xGrid.setCurrentRow(row)\r\n    await self.$refs.xGrid.setActiveCell(row)\r\n    await self.$refs.xGrid.validate(row).catch(errMap => errMap)\r\n    // this.$XModal.message({ message: `复制单条数据完成，行号为 ${rowTo + 1}` })\r\n  },\r\n  async insertRowData(obj = {}) {\r\n    // 新增行\r\n    let self = this\r\n    return new Promise((resolve, reject) => {\r\n      const { data, rowIndexTo } = obj\r\n      let rowTo = rowIndexTo === undefined ? -1 : rowIndexTo\r\n      let dataObj = Object.assign({}, data === undefined ? {} : data, {\r\n        insertMark: '新数据',\r\n        date: new Date().format('YYYY-MM-DD hh:mm:ss:c'),\r\n        isNew: true,\r\n        _XID: ''\r\n      })\r\n      Object.keys(dataObj).forEach((key) => {\r\n        if (key.indexOf('__') >= 0) {\r\n          delete dataObj[key]\r\n        }\r\n      })\r\n      self.$refs.xGrid.insertAt(dataObj, rowTo).then(({ row }) => {\r\n        self.$refs.xGrid.setCurrentRow(row).then(() => {\r\n          self.$refs.xGrid.setActiveCell(row).then(() => {\r\n            self.$refs.xGrid.validate(row).then(() => {\r\n              resolve({ tableData: self.getTableData, row: row }, self)\r\n            }).catch(errMap => {\r\n              console.log('validate', errMap)\r\n              resolve({ tableData: self.getTableData, row: row, errMap: errMap }, self)\r\n            })\r\n          }).catch(e => {\r\n            reject(e)\r\n          })\r\n        }).catch(e => {\r\n          reject(e)\r\n        })\r\n      }).catch(e => {\r\n        reject(e)\r\n      })\r\n    })\r\n    // await this.$refs.xGrid.fullValidate(row).catch(errMap => {\r\n    //   console.log('fullValidate', errMap)\r\n    //   return errMap\r\n    // })\r\n    // this.$XModal.message({ message: `复制单条数据完成，行号为 ${rowTo + 1}` })\r\n  },\r\n  reLoadTable() {\r\n    let self = this\r\n    let xGrid = this.$refs.xGrid\r\n    this.initTable()\r\n    // xGrid.reloadData(xGrid.getTableData().fullData)\r\n    xGrid.reloadColumn(self.initTableConlums())\r\n    xGrid.reloadData(self.initTableData()).then().catch()\r\n  },\r\n  reLoadTableData() {\r\n    let xGrid = this.$refs.xGrid\r\n    // xGrid.reloadData(xGrid.getTableData().fullData)\r\n    xGrid.reloadData(this.initTableData()).then().catch()\r\n  },\r\n  refreshTable(data) {\r\n    // 重新加载所有\r\n    if (data) {\r\n      // 重新加载数据刷新视图 调整 即将废弃\r\n      let xGrid = this.$refs.xGrid\r\n      // xGrid.reloadData(xGrid.getTableData().fullData)\r\n      xGrid.reloadData(data || this.tableDataIn).then().catch()\r\n    } else {\r\n      this.initMounted()\r\n      this.ifRenderTable = false\r\n      this.$nextTick(() => {\r\n        this.ifRenderTable = true\r\n      })\r\n    }\r\n  },\r\n  reloadTableConlums(conlums) {\r\n    // 重加载表头\r\n    this.$refs.xGrid.reloadColumn(conlums ? this.generateTableConlums(conlums, this.tableConfigCp.globalConfig) : self.initTableConlums()).then().catch()\r\n  },\r\n  reloadTableRenderData(data = []) {\r\n    // 重加载渲染数据\r\n    let xGrid = this.$refs.xGrid\r\n    xGrid.reloadData(data)\r\n    this.selection = []\r\n    if (xGrid) {\r\n      xGrid.removeCheckboxRow()\r\n    }\r\n  },\r\n  reCalcAndReLoadTableData({ data, modifyItem, modifyData }) {\r\n    // 重新计算tableData并刷新视图\r\n    let self = this\r\n    return new Promise((resolve, reject) => {\r\n      self.rePerformAllCalcAndConstraintByData(data, true).then(({ dataCodeRowMap, dataCodeRowArr, afterCalcData }) => {\r\n        self.updateFooter().then(() => {\r\n          resolve({ data: afterCalcData, modifyItem, modifyData })\r\n        }).catch((e) => {\r\n          reject(e)\r\n        })\r\n      })\r\n    })\r\n  },\r\n  clearDataRenderField(data) {\r\n    // 删除__字段\r\n    let self = this\r\n    return data.map((item, index) => {\r\n      let itemN = Object.assign({}, item)\r\n      Object.keys(itemN).forEach((key, ki) => {\r\n        if (key.indexOf('__') >= 0) {\r\n          delete itemN[key]\r\n        }\r\n        if (Array.isArray(itemN.children) && itemN.children.length) {\r\n          itemN.children = self.clearDataRenderField(itemN.children)\r\n        }\r\n      })\r\n      return itemN\r\n    })\r\n  },\r\n  /**\r\n   * 根据列表展开情况过滤导出数据\r\n   * @param fullData\r\n   * @param cloneFullData\r\n   * @returns {*}\r\n   */\r\n  fliterTableDataUnexpand(fullData, cloneFullData = this.$XEUtils.clone(fullData, true)) {\r\n    fullData.forEach((row, rowIndex) => {\r\n      if (!this.$refs.xGrid?.isTreeExpandByRow(row)) {\r\n        Reflect.deleteProperty(cloneFullData[rowIndex], 'children')\r\n      } else {\r\n        this.fliterTableDataUnexpand(row.children, cloneFullData[rowIndex].children)\r\n      }\r\n    })\r\n    return cloneFullData\r\n  },\r\n  getTableData() {\r\n    // 获取表格数据\r\n    // const listData = this.getListData()\r\n    const insertRecords = this.$refs.xGrid.getInsertRecords()\r\n    const updateRecords = this.$refs.xGrid.getUpdateRecords()\r\n    const removeRecords = this.$refs.xGrid.getRemoveRecords()\r\n    const { keepSource, tableSourceData } = this.$refs.xGrid.$refs.xTable\r\n    const { fullData, visibleData, tableData, footerData } = this.$refs.xGrid.getTableData()\r\n    const treeExpandData = this.fliterTableDataUnexpand(fullData)\r\n\r\n    const selection = this.$refs.xGrid.getCheckboxRecords(true)\r\n    const { tableColumnsConfig, editRules } = this\r\n    // const combinedData = this.getCombinedData(fullData, tableColumnsConfig)\r\n    const combinedData = []\r\n    return { combinedData, keepSource, tableSourceData, fullData, visibleData, tableData, footerData, tableColumnsConfig, selection, editRules, insertRecords, removeRecords, updateRecords, treeExpandData }\r\n  },\r\n  getCombinedData(data, tableColumnsConfig, combinedData = {}) {\r\n    let self = this\r\n    data.forEach((row, index) => {\r\n      tableColumnsConfig.forEach((column, columnIndex) => {\r\n        if (Array.isArray(column.children) && column.children.length) {\r\n          self.getCombinedData(data, column.children, combinedData)\r\n        } else if (column.combinedType && column.combinedType.indexOf('total') >= 0) {\r\n          combinedData[column.field] = this.accurateJiafa((combinedData[column.field] || 0), (+this.transToNumber(row[column.field], 3) || 0))\r\n        }\r\n      })\r\n    })\r\n    return combinedData\r\n  },\r\n  getPureTableData() {\r\n    // 获取表格纯净数据\r\n    const listData = this.getListData()\r\n    const insertRecords = this.$refs.xGrid.getInsertRecords()\r\n    const updateRecords = this.$refs.xGrid.getUpdateRecords()\r\n    const removeRecords = this.$refs.xGrid.getRemoveRecords()\r\n    const { keepSource, tableSourceData } = this.$refs.xGrid.$refs.xTable\r\n    const { fullData, visibleData, tableData, footerData } = this.$refs.xGrid.getTableData()\r\n    const selection = this.$refs.xGrid.getCheckboxRecords()\r\n    const { tableColumnsConfig, editRules } = this\r\n    // const combinedData = this.getCombinedData(fullData, tableColumnsConfig)\r\n    const combinedData = []\r\n    return { combinedData, keepSource, tableSourceData: this.clearDataRenderField(tableSourceData), fullData: this.clearDataRenderField(fullData), visibleData: this.clearDataRenderField(visibleData), tableData: this.clearDataRenderField(tableData), footerData, tableColumnsConfig, selection: this.clearDataRenderField(selection), editRules, listData: this.clearDataRenderField(listData), insertRecords: this.clearDataRenderField(insertRecords), updateRecords: this.clearDataRenderField(updateRecords), removeRecords: this.clearDataRenderField(removeRecords) }\r\n  },\r\n  getOptionData() {\r\n    // 获取当前操作数据\r\n    return this.$refs.xGrid.getRecordset()\r\n  },\r\n  getInsertRowData() {\r\n    // 获取新增行\r\n    return this.$refs.xGrid.getInsertRecords()\r\n    // this.$XModal.alert(insertRecords.length)\r\n  },\r\n  getSelectionData() {\r\n    // 获取选中\r\n    return this.$refs.xGrid.getCheckboxRecords()\r\n    // this.$XModal.alert(selectRecords.length)\r\n  },\r\n  getData(rowIndex = []) {\r\n    return this.$refs.xGrid.getData(rowIndex)\r\n  },\r\n  validate(row = true) {\r\n    return this.$refs.xGrid.validate(row)\r\n  },\r\n  validateChangeData() {\r\n    // 只校验临时变动的数据，例如新增或修改\r\n    return this.$refs.xGrid.validate()\r\n  },\r\n  async validEvent(row = true) {\r\n    // 校验\r\n    const errMap = await this.$refs.xGrid.validate(row).catch(errMap => errMap)\r\n    if (errMap) {\r\n      this.$XModal.message({ status: 'error', message: '校验不通过！' })\r\n    } else {\r\n      this.$XModal.message({ status: 'success', message: '校验成功！' })\r\n    }\r\n  },\r\n  async fullValidEvent(row = true) {\r\n    // 所有校验\r\n    const errMap = await this.$refs.xGrid.fullValidate(row).catch(errMap => errMap)\r\n    if (errMap) {\r\n      let msgList = []\r\n      Object.values(errMap).forEach(errList => {\r\n        errList.forEach(params => {\r\n          let { rowIndex, column, rules } = params\r\n          rules.forEach(rule => {\r\n            msgList.push(`第 ${rowIndex} 行 ${column.title} 校验错误：${rule.message}`)\r\n          })\r\n        })\r\n      })\r\n      this.$XModal.message({\r\n        status: 'error',\r\n        message: () => {\r\n          return [\r\n            <div class=\"red\" style=\"max-height: 400px;overflow: auto;\">\r\n              {\r\n                msgList.map(msg => <div>{msg}</div>)\r\n              }\r\n            </div>\r\n          ]\r\n        }\r\n      })\r\n    } else {\r\n      this.$XModal.message({ status: 'success', message: '校验成功！' })\r\n    }\r\n  },\r\n  async selectValidEvent() {\r\n    // 选中校验\r\n    let selectRecords = this.$refs.xGrid.getCheckboxRecords()\r\n    if (selectRecords.length > 0) {\r\n      const errMap = await this.$refs.xGrid.validate(selectRecords).catch(errMap => errMap)\r\n      if (errMap) {\r\n        this.$XModal.message({ status: 'error', message: '校验不通过！' })\r\n        return false\r\n      } else {\r\n        this.$XModal.message({ status: 'success', message: '校验成功！' })\r\n        return true\r\n      }\r\n    } else {\r\n      this.$XModal.message({ status: 'warning', message: '未选中数据！' })\r\n    }\r\n  },\r\n  insertEvent(row, column) {\r\n    // 插入数据\r\n    let xTable = this.$refs.xTable\r\n    xTable.insertAt(null, row)\r\n      .then(({ row }) => xTable.setActiveCell(row, column.property))\r\n  },\r\n  transTableColumnsToSource(columns) {\r\n    // 表格渲染数据转换为传入数据格式\r\n    if (!columns) return []\r\n    const newColumns = []\r\n    let self = this\r\n    columns.forEach((column, columnIndex) => {\r\n      newColumns.push(column.own || {})\r\n      if (Array.isArray(column.children) && column.children.length) {\r\n        newColumns[columnIndex].children = self.transTableColumnToSource(column.children)\r\n      }\r\n    })\r\n    return newColumns\r\n  }\r\n}\r\nconst tableEventFn = {\r\n  setRowDrop() {\r\n    // 行拖拽排序\r\n    this.$nextTick(() => {\r\n      const xTable = this.$refs.xGrid\r\n      if (!xTable) return\r\n      let Sortable = this.$Sortable\r\n      let XEUtils = this.$XEUtils\r\n      this.sortable = Sortable.create(xTable.$el.querySelector('.body--wrapper>.vxe-table--body tbody'), {\r\n        handle: '.drag-btn',\r\n        onEnd: ({ item, oldIndex }) => {\r\n          const options = { children: 'children' }\r\n          const targetTrElem = item\r\n          const wrapperElem = targetTrElem.parentNode\r\n          const prevTrElem = targetTrElem.previousElementSibling\r\n          const tableTreeData = this.tableDataIn\r\n          const selfRow = xTable.getRowNode(targetTrElem).item\r\n          const selfNode = XEUtils.findTree(tableTreeData, row => row === selfRow, options)\r\n          if (prevTrElem) {\r\n            // 移动到节点\r\n            const prevRow = xTable.getRowNode(prevTrElem).item\r\n            const prevNode = XEUtils.findTree(tableTreeData, row => row === prevRow, options)\r\n            if (XEUtils.findTree(selfRow[options.children], row => prevRow === row, options)) {\r\n              // 错误的移动\r\n              const oldTrElem = wrapperElem.children[oldIndex]\r\n              wrapperElem.insertBefore(targetTrElem, oldTrElem)\r\n              return this.$XModal.message({ message: '不允许自己给自己拖动！', status: 'error' })\r\n            }\r\n            const currRow = selfNode.items.splice(selfNode.index, 1)[0]\r\n            if (xTable.isTreeExpandByRow(prevRow)) {\r\n              // 移动到当前的子节点\r\n              prevRow[options.children].splice(0, 0, currRow)\r\n            } else {\r\n              // 移动到相邻节点\r\n              prevNode.items.splice(prevNode.index + (selfNode.index < prevNode.index ? 0 : 1), 0, currRow)\r\n            }\r\n          } else {\r\n            // 移动到第一行\r\n            const currRow = selfNode.items.splice(selfNode.index, 1)[0]\r\n            tableTreeData.unshift(currRow)\r\n          }\r\n          // 如果变动了树层级，需要刷新数据\r\n          this.tableDataIn = [...tableTreeData]\r\n        }\r\n      })\r\n    })\r\n  },\r\n  setColumnDrop() { // 设置列拖拽\r\n    let self = this\r\n    let Sortable = this.$Sortable\r\n    this.$nextTick(() => {\r\n      const xTable = this.$refs.xGrid\r\n      this.sortable = Sortable.create(xTable.$el.querySelector('.body--wrapper>.vxe-table--header .vxe-header--row'), {\r\n        handle: '.vxe-header--column:not(.col--fixed)',\r\n        onEnd: ({ item, newIndex, oldIndex }) => {\r\n          const { fullColumn, tableColumn } = xTable.getTableColumn()\r\n          const targetThElem = item\r\n          const wrapperElem = targetThElem.parentNode\r\n          const newColumn = fullColumn[newIndex]\r\n          if (newColumn.fixed) {\r\n            // 错误的移动\r\n            if (newIndex > oldIndex) {\r\n              wrapperElem.insertBefore(targetThElem, wrapperElem.children[oldIndex])\r\n            } else {\r\n              wrapperElem.insertBefore(wrapperElem.children[oldIndex], targetThElem)\r\n            }\r\n            return this.$XModal.message({ message: '固定列不允许拖动！', status: 'error' })\r\n          }\r\n          // 转换真实索引\r\n          const oldColumnIndex = xTable.getColumnIndex(tableColumn[oldIndex])\r\n          const newColumnIndex = xTable.getColumnIndex(tableColumn[newIndex])\r\n          // 移动到目标列\r\n          const currRow = fullColumn.splice(oldColumnIndex, 1)[0]\r\n          fullColumn.splice(newColumnIndex, 0, currRow)\r\n          // 是否开启列顺序缓存\r\n          if (this.tableGlobalConfig.dragColumnsConfig.cacheStatus) {\r\n            // resize之后的宽度拿不到，故暂时只缓存字段名\r\n            const storageColumn = this.transTableCloumnToSource(fullColumn).filter(k => !!k.field).map(k => k && k.field)\r\n            this.$store.commit('setCacheColumn', { key: this.tableId, value: storageColumn })\r\n          }\r\n          xTable.loadColumn(fullColumn)\r\n          self.$emit('ProxyEvent', 'columnDrag', tableColumn)\r\n          self.$emit('columnDrag', tableColumn)\r\n        }\r\n      })\r\n    })\r\n  },\r\n  onContextMenuClick({ menu, row, column, columnIndex, rowIndex }, event) { // 右键菜单\r\n    event = event || window.event\r\n    let self = this\r\n    let xGrid = this.$refs.xGrid\r\n    switch (menu.code) {\r\n      case 'hideColumn':// 隐藏当前列\r\n        xGrid.hideColumn(column)\r\n        break\r\n      case 'showAllColumn': // 显示所有列\r\n        xGrid.resetColumn()\r\n        break\r\n      case 'recover_all': // 显示所有列\r\n        self.reloadTableConlums(self.tableColumnsConfig)\r\n        break\r\n      case 'resetColumn': // 重新加载\r\n        xGrid.resetColumn({ visible: true, resizable: true })\r\n        break\r\n      case 'toggleAllCheckboxRow': // 重新加载\r\n        xGrid.toggleAllCheckboxRow()\r\n        break\r\n      case 'reload': // 重新加载\r\n        break\r\n      case 'insertAt': // 插入数据\r\n        // self.copySelectionRowData()\r\n        self.insertRowData({})\r\n        break\r\n      case 'remove': // 移除数据\r\n        xGrid.remove(row)\r\n        break\r\n      case 'clear': // 清除单元格数据\r\n        xGrid.clearData(row, column.property)\r\n        break\r\n      case 'verify': // 校验并定位到第一个错误\r\n        // this.validate().catch(errMap => console.log(errMap))\r\n        this.validEvent()\r\n        break\r\n      case 'maximize': // 表格最大化\r\n        xGrid.maximize()\r\n        break\r\n      case 'revert': // 表格还原\r\n        self.revertEvent()\r\n        break\r\n      case 'zoom': // 切换表格最大化\r\n        xGrid.zoom()\r\n        break\r\n      // case 'copy': // 复制文本\r\n      //   if (self.$XEClipboard.copy(row[column.property])) {\r\n      //     self.$XModal.message({ message: '已复制到剪贴板！', status: 'success' })\r\n      //   }\r\n      //   break\r\n      // case 'paste': // 复制文本\r\n      //   debugger\r\n      //   let clipboardData = (event.clipboardData || event.originalEvent.clipboardData)\r\n      //   debugger\r\n      //   row[column.property] = clipboardData\r\n      //   break\r\n      //  case 'save':\r\n      //  self.$XModal.message({ message: '保存成功', status: 'success' })\r\n      //  break\r\n      case 'exportDataXlsx':\r\n        console.log('this.$Export', this, this.$Export)\r\n        this.triggerExportOption()\r\n        // this.$Export.exportExcel({\r\n        //   columns: this.tableColumnsConfig,\r\n        //   datas: this.getTableData().fullData\r\n        // })\r\n        // xGrid.openExport({\r\n        //   filename: 'export',\r\n        //   sheetName: 'Sheet1',\r\n        //   type: 'xlsx',\r\n        //   isPrint: true\r\n        // })\r\n        break\r\n      case 'print':\r\n        xGrid.print({\r\n          filename: 'printData',\r\n          mode: 'current',\r\n          isHeader: true,\r\n          isFooter: true\r\n        })\r\n        break\r\n      case 'logCurrentData':\r\n        console.log('当前行数据:', row, '\\n', '当前单元格数据:', row && row[column.property], '\\n', '当前列配置数据:', column, '\\n', '当前行索引:', rowIndex, '\\n', '当前列索引:', columnIndex, '\\n')\r\n        // console.log(row && row[column.property], row, column, columnIndex, rowIndex)\r\n        console.log('当前表格数据:', this.getTableData())\r\n        break\r\n      case 'exportDataPdf':\r\n        xGrid.exportData({\r\n          filename: '导出',\r\n          type: 'pdf'\r\n        })\r\n        break\r\n      case 'clearSort':\r\n        xGrid.clearSort()\r\n        break\r\n      case 'sortAsc':\r\n        xGrid.sort(column.property, 'asc')\r\n        break\r\n      case 'sortDesc':\r\n        xGrid.sort(column.property, 'desc')\r\n        break\r\n    }\r\n    return false\r\n  },\r\n  triggerReverseCheck() {\r\n    // 反选\r\n    let self = this\r\n    let xGrid = self.$refs.xGrid\r\n    return new Promise((resolve, reject) => {\r\n      // let selectionNew = []\r\n      let selection = xGrid.getCheckboxRecords()\r\n      let { tableData } = xGrid.getTableData()\r\n      // tableData.forEach((row, rowIndex) => {\r\n      //   if (!selection.some((item, index) => {\r\n      //     return row._XID === item._XID\r\n      //   })) {\r\n      //     selectionNew.push(row)\r\n      //   }\r\n      // })\r\n      // xGrid.clearCheckboxRow().then(() => {\r\n      xGrid.setCheckboxRow(tableData, true).then(() => {\r\n        xGrid.setCheckboxRow(selection, false).then(() => {\r\n          self.selection = xGrid.getCheckboxRecords()\r\n          resolve(self.selection)\r\n        }).catch(e => {\r\n          reject(e)\r\n        })\r\n      }).catch(e => {\r\n        reject(e)\r\n      })\r\n      // }).catch(e => {\r\n      //   reject(e)\r\n      // })\r\n    })\r\n  },\r\n  handleCheckboxChange(obj, e) {\r\n    // 多选选中或去选某一条事件\r\n    this.selection = obj ? obj.records : this.getSelectionData()\r\n    this.updateFooter().then(() => {\r\n      this.$emit('checkboxChange', obj, e)\r\n      this.$emit('ProxyEvent', 'checkboxChange', obj, this, this.$refs.xGrid)\r\n    }).catch(() => { })\r\n  },\r\n  handleCheckboxAllChange(obj, e) {\r\n    // 全选选中或去选某一条事件\r\n    this.selection = obj.records\r\n    this.updateFooter().then(() => {\r\n      this.$emit('checkboxAll', obj, e)\r\n      this.$emit('ProxyEvent', 'checkboxAll', obj, this, this.$refs.xGrid)\r\n    }).catch(() => { })\r\n  },\r\n  onOptionRowClick(obj) {\r\n    // 操作列点击事件\r\n    this.$emit('onOptionRowClick', obj, this)\r\n    this.$emit('ProxyEvent', 'onOptionRowClick', obj, this, this.$refs.xGrid)\r\n    let methods = this.tableConfigCp.methods\r\n    typeof (methods.onOptionRowClick) === 'function' && methods.onOptionRowClick(obj, this)\r\n  },\r\n  onOptionSortRowClick({ row, column, $rowIndex, data, items, optionType }) {\r\n    switch (optionType) {\r\n      case 'upSort':\r\n        if ($rowIndex > 0) {\r\n          let temp = data[$rowIndex - 1]\r\n          data[$rowIndex - 1] = data[$rowIndex]\r\n          data[$rowIndex] = temp\r\n          // [data[$rowIndex - 1]], data[$rowIndex]] = [data[$rowIndex], data[$rowIndex-1]] ts\r\n        }\r\n        break\r\n      case 'downSort':\r\n        if ($rowIndex < data.length - 1) {\r\n          let temp = data[$rowIndex + 1]\r\n          data[$rowIndex + 1] = data[$rowIndex]\r\n          data[$rowIndex] = temp\r\n          // [data[$rowIndex + 1]], data[$rowIndex]] = [data[$rowIndex], data[$rowIndex + 1]] ts\r\n        }\r\n        break\r\n      case 'topSort':\r\n        if ($rowIndex > 0) {\r\n          data.unshift(data.splice($rowIndex, 1)[0])\r\n        }\r\n        break\r\n      case 'bottomSort':\r\n        if ($rowIndex < data.length - 1) {\r\n          data.push(data.splice($rowIndex, 1)[0])\r\n        }\r\n        break\r\n      default:\r\n        break\r\n    }\r\n    this.$refs.xGrid.reloadData(data).then().catch()\r\n  }\r\n}\r\nconst toolBarEvent = {\r\n  toolbarButtonClickEvent(obj, e) { // toolbar事件代理\r\n    // 工具栏左侧按钮点击事件\r\n    let self = this\r\n    self.$emit('onToolbarBtnClick', obj, this)\r\n    let methods = this.tableConfigCp.methods\r\n    if (typeof (obj.button.callback) === 'function') {\r\n      obj.button.callback(obj, self, e)\r\n    } else {\r\n      typeof (methods.toolbarButtonClickEvent) === 'function' && methods.toolbarButtonClickEvent(obj, self, e)\r\n    }\r\n  },\r\n  onToolbarOperrateClick(code) {\r\n    let self = this\r\n    switch (code) {\r\n      case 'reverseCheck':\r\n        this.triggerReverseCheck().then((res) => {\r\n          this.$emit('triggerReverseCheck', { records: res }, this)\r\n          this.$emit('ProxyEvent', 'triggerReverseCheck', { records: res }, this)\r\n        }).catch(e => {\r\n          console.log(e)\r\n          throw (e)\r\n        })\r\n        break\r\n      case 'refresh':\r\n        this.$emit('onToolbarBtnClick', { context: this, xGrid: this.$refs.xGrid, code: 'refresh' })\r\n        // this.reloadTableConlums(this.tableColumnsConfig)\r\n        // this.refreshTable()\r\n        break\r\n      case 'calculator':\r\n        this.$XModal.message({ status: 'info', message: '此功能正在开发中' })\r\n        break\r\n      case 'zoom':\r\n        this.$refs.xGrid.zoom().then(() => { }).catch(() => { })\r\n        break\r\n      case 'export':\r\n        console.info('toolbarConfigIn.exportCustom==' + this.toolbarConfigIn.exportCustom)\r\n        if (this.toolbarConfigIn && this.toolbarConfigIn.exportCustom) {\r\n          this.$emit('onToolbarBtnClick', { context: this, xGrid: this.$refs.xGrid, code: 'export' })\r\n        } else {\r\n          this.triggerExportOption()\r\n        }\r\n        break\r\n      case 'custom':\r\n        break\r\n      case 'import':\r\n        this.triggerImportOption(\r\n          {\r\n            downloadTemplateCallback(Cb) {\r\n              self.downLoadImportTemplate()\r\n            },\r\n            importSuccessCallback(res) {\r\n              this.$emit('importSuccessCallback', res)\r\n            }\r\n          }\r\n        )\r\n        break\r\n      case 'expandAll':\r\n        this.expendAllLoading = true\r\n        // 设置宏任务，延迟执行避免js进程同步运行大量操作导致渲染进程loading假死\r\n        setTimeout(() => {\r\n          const handle = this.expandAllState\r\n            ? () => this.$refs.xGrid?.clearTreeExpand?.()\r\n            : () => this.$refs.xGrid?.setAllTreeExpand?.(true)\r\n          handle()\r\n            .finally(() => {\r\n              this.expandAllState = !this.expandAllState\r\n              this.expendAllLoading = false\r\n            })\r\n        }, 16.67)\r\n        break\r\n    }\r\n  },\r\n  setMoneyUnit(Unitlevel, oldUnitlevel) { // 设置金额单位\r\n    this.toolbarConfigInCopy.moneyUnitOptions.forEach((item, index) => {\r\n      if (item.value === Unitlevel) {\r\n        this.curSelectMoneyUnitOption = item\r\n      }\r\n    })\r\n    let xGrid = this.$refs.xGrid\r\n    if (!xGrid) {\r\n      return\r\n    }\r\n    xGrid.$forceUpdate()\r\n    xGrid.updateFooter().then(() => { }).catch(() => { })\r\n  },\r\n  /**\r\n   * 口径说明点击（显示弹窗）\r\n   */\r\n  caliberDeclareHandle() {\r\n    this.caliberDeclareVisible = !this.caliberDeclareVisible\r\n  }\r\n}\r\nconst pageEvent = { // 分页事件\r\n  setPagerConfig() {\r\n    // 更新分页配置\r\n    if (this.getbasicDataType(this.pagerConfig) === 'Boolean') {\r\n      this.pagerConfigIn = undefined\r\n    } else {\r\n      this.pagerConfigIn = Object.assign({}, this.pagerConfigIn ? this.pagerConfigIn : this.pagerConfigInCp, this.pagerConfig)\r\n    }\r\n  },\r\n  handlePageChange({ currentPage, pageSize }) {\r\n    // 分页改变事件\r\n    this.pagerConfigIn.currentPage = currentPage\r\n    this.pagerConfigIn.pageSize = pageSize\r\n    this.loadData()\r\n  },\r\n  handleRefresh() {\r\n    // 刷新\r\n    this.formSearchSubmit({ data: {} })\r\n  },\r\n  getColumnsList() {\r\n    let newColumnsList = []\r\n    this.tableColumnsConfig.forEach(v => {\r\n      newColumnsList.push(v.field)\r\n    })\r\n    return newColumnsList\r\n  },\r\n  delSearchfromMain() {\r\n    // 父组件调用此方法清空查询数据\r\n    this.formSearchData.filterValue = ''\r\n  },\r\n  formSearchSubmit({ data, $event }) {\r\n    let newTbleDatas = []\r\n    // this.formSearchData.filterValue\r\n    let search = this.formSearchData.filterValue\r\n    if (search !== '') {\r\n      this.tableDataIn.forEach(dataNews => {\r\n        let newColumnsList = this.tableColumnsFieldArr\r\n        console.log(newColumnsList)\r\n        for (let i = 0; i < Object.keys(dataNews).length; i++) {\r\n          if (newColumnsList.includes(Object.keys(dataNews)[i]) && String(dataNews[Object.keys(dataNews)[i]]).indexOf(search) > -1) {\r\n            newTbleDatas.push(dataNews)\r\n            break\r\n          }\r\n        }\r\n      })\r\n      this.reloadTableRenderData(newTbleDatas)\r\n    } else {\r\n      this.reloadTableRenderData(this.tableDataIn)\r\n    }\r\n  },\r\n  onFuzzySearchEnter() {\r\n    if (this.toolbarConfigInCopy.search !== 'remoteSearch') {\r\n      if (window.event.keyCode === 13 && this.filtertext) {\r\n\r\n      }\r\n    } else {\r\n      if (window.event.keyCode === 13 && this.filtertext) {\r\n        this.filtertextCp = this.filtertext\r\n        this.$refs.xGrid.updateData()\r\n      } else {\r\n        this.filtertextCp = ''\r\n        this.$refs.xGrid.updateData()\r\n      }\r\n    }\r\n  },\r\n  getHighlightedFilterText(val) { // 渲染施加高亮\r\n    if (this.filtertextCp) {\r\n      let regf = new RegExp(this.filtertextCp, 'ig')\r\n      return String(val).replace(regf, match => {\r\n        if (match) {\r\n          return `<span class=\"filter-lighting\">${match}</span>`\r\n        } else {\r\n          return ''\r\n        }\r\n      })\r\n    } else {\r\n      return val\r\n    }\r\n  },\r\n  loadData() {\r\n    // 加载数据\r\n    let self = this\r\n    let searchParams = {\r\n      params: this.formSearchData,\r\n      currentPage: this.pagerConfigIn.currentPage,\r\n      pageSize: this.pagerConfigIn.pageSize\r\n    }\r\n    self.$emit('ajaxData', searchParams, this)\r\n  },\r\n  onAdvancedSearchBtnClick() {\r\n    this.$emit('onAdvancedSearchBtnClick', {\r\n      params: this.formSearchData,\r\n      currentPage: this.pagerConfigIn.currentPage,\r\n      pageSize: this.pagerConfigIn.pageSize\r\n    }, this)\r\n  }\r\n}\r\nconst proxyFn = {\r\n  // resgistEventProxy() {\r\n  // let arg=[...arguments]\r\n  //   // 注册事件代理\r\n  //   let self = this\r\n  //   Object.keys(self.tableEventIn).forEach((item, index) => {\r\n  //     self.$on(self.hyphenate(item), self.tableEventIn[item].bind(self))\r\n  //   })\r\n  // }\r\n  handleSearch() {\r\n    const filterName = this.$XEUtils.toString(this.filterName).trim().toLowerCase()\r\n    if (filterName) {\r\n      const filterRE = new RegExp(filterName, 'gi')\r\n      const options = { children: 'list' }\r\n      const searchProps = ['name', 'desc', 'type', 'enum', 'defVal']\r\n      const rest = this.$XEUtils.searchTree(this.tableData, item => searchProps.some(key => item[key].toLowerCase().indexOf(filterName) > -1), options)\r\n      this.$XEUtils.eachTree(rest, item => {\r\n        searchProps.forEach(key => {\r\n          item[key] = item[key].replace(filterRE, match => `<span class=\"keyword-lighten\">${match}</span>`)\r\n        })\r\n      }, options)\r\n      this.apiList = rest\r\n      this.$nextTick(() => {\r\n        if (this.$refs.xTable) {\r\n          this.$refs.xTable.setAllTreeExpand(true)\r\n        }\r\n      })\r\n    } else {\r\n      this.apiList = this.tableData\r\n      this.$nextTick(() => {\r\n        if (this.$refs.xTable) {\r\n          this.$refs.xTable.setTreeExpand(this.defaultExpandRows, true)\r\n        }\r\n      })\r\n    }\r\n  },\r\n  // 调用频率间隔 500 毫秒\r\n  searchEvent() {\r\n    this.$XEUtils.debounce(function () {\r\n      this.handleSearch()\r\n    }, 500, { leading: false, trailing: true })\r\n  }\r\n}\r\nconst axiosEvent = {\r\n  async $asyncGet(url, params, cb) { // 使用异步调用，返回结果后再执行\r\n    await this.$http.get(url, params, origin)\r\n  },\r\n  async $asyncPost(url, params, cb) { // 使用异步调用，返回结果后再执行\r\n    await this.$http.post(url, params, origin)\r\n  },\r\n  $post(url, params, origin) {\r\n    let self = this\r\n    return new Promise((resolve, reject) => {\r\n      self.$http.post(url, {\r\n        params: params\r\n      })\r\n        .then(response => {\r\n          if (response.code === 200) {\r\n            resolve(response.data)\r\n          } else {\r\n            resolve([])\r\n          }\r\n        })\r\n        .catch(error => {\r\n          reject(error)\r\n        })\r\n    })\r\n  },\r\n  $get(url, params, origin) {\r\n    let self = this\r\n    return new Promise((resolve, reject) => {\r\n      self.$http.get(url, {\r\n        params: params\r\n      })\r\n        .then(response => {\r\n          if (response.code === 200) {\r\n            resolve(response.data)\r\n          } else {\r\n            resolve([])\r\n          }\r\n        })\r\n        .catch(error => {\r\n          reject(error)\r\n        })\r\n    })\r\n  }\r\n}\r\nconst tableEvent = {\r\n  cellOptionCallBack() { // 渲染器回调事件\r\n    this.$emit('cellOptionCallBack', ...arguments, this, this.$refs.xGrid)\r\n    this.$emit('ProxyEvent', 'cellOptionCallBack', ...arguments, this, this.$refs.xGrid)\r\n  },\r\n  // cellChange() { // 渲染器回调事件\r\n  //   this.$emit('cellChange', ...arguments, this, this.$refs.xGrid)\r\n  // },\r\n  keydown(obj) {\r\n    // 添加enter 切换下一个编辑单元格\r\n    // let self = this\r\n    // let event = obj.event || window.event\r\n    // const { xGrid } = self.$refs\r\n    // const { row, rowIndex, column } = xGrid.getActiveRecord()\r\n    // if (event.keyCode === 13 && row !== null) {\r\n    //   const { fullData } = self.getTableData()\r\n    //   let indexof = self.tableColumnsSingEditFieldArr.indexOf(column.property)\r\n    //   if (indexof + 1 < self.tableColumnsSingEditFieldArr.length) {\r\n    //     xGrid.setActiveCell(row, self.tableColumnsSingEditFieldArr[indexof + 1])\r\n    //   } else {\r\n    //     xGrid.setCurrentRow(fullData[rowIndex + 1]).then(() => {\r\n    //       xGrid.setActiveCell(fullData[rowIndex + 1], self.tableColumnsSingEditFieldArr[0])\r\n    //     })\r\n    //   }\r\n    // } else {\r\n    this.$emit('keydown', obj, this, this.$refs.xGrid)\r\n    this.$emit('ProxyEvent', 'keydown', obj, this, this.$refs.xGrid)\r\n    // }\r\n  }, // 当表格被激活且键盘被按下时会触发的事件  { $event }\r\n  radioChange(obj) {\r\n    this.$emit('radioChange', obj, this, this.$refs.xGrid)\r\n    this.$emit('ProxyEvent', 'radioChange', obj, this, this.$refs.xGrid)\r\n  }, // 只对 type = radio 有效， 当手动勾选并且值发生改变时触发的事件 { row, rowIndex, $rowIndex, column, columnIndex, $columnIndex, $event }\r\n  cellClick(obj) {\r\n    let self = this\r\n    const { xGrid } = this.$refs\r\n    if (this.tableConfigCp.globalConfig.cellClickCheck && this.tableGlobalConfigIn.cellClickCheck) {\r\n      // const { row, rowIndex, $rowIndex, column, columnIndex, $columnIndex, triggerRadio, triggerCheckbox, triggerTreeNode, triggerExpandNode, $event } = obj\r\n      const { row, $event, column } = obj\r\n      if (column.type !== 'checkbox') {\r\n        if ($event.shiftKey) {\r\n          // option\r\n        } else {\r\n          xGrid.setCheckboxRow([row], !xGrid.isCheckedByCheckboxRow(row)).then(() => {\r\n            self.selection = this.$refs.xGrid.getCheckboxRecords()\r\n            self.updateFooter().then(() => {\r\n              xGrid.setCurrentRow(row).then(() => {\r\n\r\n              })\r\n            }).catch(() => { })\r\n          })\r\n        }\r\n      }\r\n    }\r\n    this.$emit('cellClick', obj, this, this.$refs.xGrid)\r\n    this.$emit('ProxyEvent', 'cellClick', obj, this, this.$refs.xGrid)\r\n  }, // 单元格被点击时会触发该事件 { row, rowIndex, $rowIndex, column, columnIndex, $columnIndex, $event }\r\n  cellDblclick(obj) {\r\n    const { row, column } = obj\r\n    if (this.treeConfigIn && this.treeConfigIn.dblExpand) {\r\n      if (this.editConfigIn && column.treeNode) {\r\n        if (this.treeConfigIn.dblExpandAll) {\r\n          this.dblRowExpandAll(row)\r\n        } else {\r\n          this.tableOptionFn().toggleTreeExpand(row).then(() => { })\r\n        }\r\n      } else if (!this.editConfigIn && this.treeConfigIn.onlyDblTreeNodeExpand && column.treeNode) {\r\n        if (this.treeConfigIn.dblExpandAll) {\r\n          this.dblRowExpandAll(row)\r\n        } else {\r\n          this.tableOptionFn().toggleTreeExpand(row).then(() => { })\r\n        }\r\n      } else if (!this.editConfigIn) {\r\n        if (this.treeConfigIn.dblExpandAll) {\r\n          this.dblRowExpandAll(row)\r\n        } else {\r\n          this.tableOptionFn().toggleTreeExpand(row).then(() => { })\r\n        }\r\n      } else {\r\n\r\n      }\r\n    } else {\r\n      this.$emit('cellDblclick', obj, this, this.$refs.xGrid)\r\n      this.$emit('ProxyEvent', 'cellDblclick', obj, this, this.$refs.xGrid)\r\n    }\r\n  }, // 单元格被双击时会触发该事件 { row, rowIndex, $rowIndex, column, columnIndex, $columnIndex, $event }\r\n  dblRowExpandAll(row) {\r\n    let self = this\r\n    self.tableOptionFn().toggleTreeExpand(row).then((res) => {\r\n      if (Array.isArray(row[this.treeConfigIn.children]) && row[this.treeConfigIn.children].length) {\r\n        row[this.treeConfigIn.children].forEach((item, index) => {\r\n          self.dblRowExpandAll(item)\r\n        })\r\n      }\r\n    })\r\n  },\r\n  cellContextMenu(obj) {\r\n    this.$emit('cellContextMenu', obj, this, this.$refs.xGrid)\r\n    this.$emit('ProxyEvent', 'cellContextMenu', obj, this, this.$refs.xGrid)\r\n  }, // 只对 context - menu 配置时有效， 单元格被鼠标右键时触发该事件 { type, row, rowIndex, $rowIndex, column, columnIndex, $columnIndex, $event }\r\n  cellMouseenter(obj) {\r\n    this.$emit('cellMouseenter', obj, this, this.$refs.xGrid)\r\n    this.$emit('ProxyEvent', 'cellMouseenter', obj, this, this.$refs.xGrid)\r\n  }, // 当单元格 hover 进入时会触发该事件 { row, rowIndex, $rowIndex, column, columnIndex, $columnIndex, $event }\r\n  cellMouseleave(obj) {\r\n    this.$emit('cellMouseleave', obj, this, this.$refs.xGrid)\r\n    this.$emit('ProxyEvent', 'cellMouseleave', obj, this, this.$refs.xGrid)\r\n  }, // 当单元格 hover 退出时会触发该事件 { row, rowIndex, $rowIndex, column, columnIndex, $columnIndex, $event }\r\n  headerCellClick(obj) {\r\n    this.$emit('headerCellClick', obj, this, this.$refs.xGrid)\r\n    this.$emit('ProxyEvent', 'headerCellClick', obj, this, this.$refs.xGrid)\r\n  }, // 表头单元格被点击时会触发该事件 { $rowIndex, column, columnIndex, $columnIndex, triggerResizable, triggerSort, triggerFilter, $event }\r\n  headerCellDblclick(obj) {\r\n    this.$emit('headerCellDblclick', obj, this, this.$refs.xGrid)\r\n    this.$emit('ProxyEvent', 'headerCellDblclick', obj, this, this.$refs.xGrid)\r\n  }, // 表头单元格被双击时会触发该事件 { $rowIndex, column, columnIndex, $columnIndex, $event }\r\n  // headerCellContextMenu(obj) {\r\n  //   this.$emit('headerCellContextMenu', obj, this, this.$refs.xGrid)\r\n  // }, // 只对 context-menu 配置时有效，表头单元格被鼠标右键时触发该事件 { type, column, columnIndex, $event }\r\n  footerCellClick(obj) {\r\n    this.$emit('footerCellClick', obj, this, this.$refs.xGrid)\r\n    this.$emit('ProxyEvent', 'footerCellClick', obj, this, this.$refs.xGrid)\r\n  }, // 表尾单元格被点击时会触发该事件 // { items, $rowIndex, column, columnIndex, $columnIndex, $event }\r\n  footerCellDblclick(obj) {\r\n    this.$emit('footerCellDblclick', obj, this, this.$refs.xGrid)\r\n    this.$emit('ProxyEvent', 'footerCellDblclick', obj, this, this.$refs.xGrid)\r\n  }, // 表尾单元格被双击时会触发该事件 { items, $rowIndex, column, columnIndex, $columnIndex, $event }\r\n  footerCellContextMenu(obj) {\r\n    this.$emit('footerCellContextMenu', obj, this, this.$refs.xGrid)\r\n    this.$emit('ProxyEvent', 'footerCellContextMenu', obj, this, this.$refs.xGrid)\r\n  }, // 只对 context - menu 配置时有效， 表尾单元格被鼠标右键时触发该事件 { type, column, columnIndex, $event }\r\n  sortChange(obj) {\r\n    this.$emit('sortChange', obj, this, this.$refs.xGrid)\r\n    this.$emit('ProxyEvent', 'sortChange', obj, this, this.$refs.xGrid)\r\n  }, // 当排序条件发生变化时会触发该事件 { column, column.property, order, $event }\r\n  filterChange(obj) {\r\n    this.$emit('filterChange', obj, this, this.$refs.xGrid)\r\n    this.$emit('ProxyEvent', 'filterChange', obj, this, this.$refs.xGrid)\r\n  }, // 当筛选条件发生变化时会触发该事件 { column, property, values, datas, filters, $event }{ column, property, values, datas, filters, $event }\r\n  resizableChange(obj) {\r\n    this.$emit('resizableChange', obj, this, this.$refs.xGrid)\r\n    this.$emit('ProxyEvent', 'resizableChange', obj, this, this.$refs.xGrid)\r\n  }, // 当列宽拖动发生变化时会触发该事件 { $rowIndex, column, columnIndex, $columnIndex, $event }\r\n  toggleRowExpand(obj) {\r\n    // 懒加载子节点需要给子节点设置唯一键\r\n    setRowUuidKey(obj.row, this)\r\n\r\n    this.$emit('toggleRowExpand', obj, this, this.$refs.xGrid)\r\n    this.$emit('ProxyEvent', 'toggleRowExpand', obj, this, this.$refs.xGrid)\r\n  }, // 当行展开或收起时会触发该事件 { expanded, row, rowIndex, $rowIndex, column, columnIndex, $columnIndex, $event }\r\n  toggleTreeExpand(obj) {\r\n    this.$emit('toggleTreeExpand', obj, this, this.$refs.xGrid)\r\n    this.$emit('ProxyEvent', 'toggleTreeExpand', obj, this, this.$refs.xGrid)\r\n  }, // 当树节点展开或收起时会触发该事件 { expanded, row, column, columnIndex, $columnIndex, $event }\r\n  contextMenuClick(obj) {\r\n    this.$emit('contextMenuClick', obj, this, this.$refs.xGrid)\r\n    this.$emit('ProxyEvent', 'contextMenuClick', obj, this, this.$refs.xGrid)\r\n  }, // 只对 context-menu 配置时有效，当点击快捷菜单时会触发该事件 { menu, type, row, rowIndex, column, columnIndex, $event }\r\n  currentChange(obj) {\r\n    // this.performTableDataCalculate(obj)\r\n    this.$nextTick(() => {\r\n      this.$emit('currentChange', obj, this, this.$refs.xGrid)\r\n      this.$emit('ProxyEvent', 'currentChange', obj, this, this.$refs.xGrid)\r\n    })\r\n  }, // 只对 highlightCurrentRow 有效，当手动选中行并且值发生改变时触发的事件 { row, rowIndex, $rowIndex, column, columnIndex, $columnIndex, $event }\r\n  editClosed(obj) {\r\n    // this.performAfterEditClosedCalculate(obj).then((row) => {\r\n    obj.data = obj.data || obj.$grid.getTableData().fullData || []\r\n    this.performTableDataCalculate(obj).then(({ row }) => {\r\n      this.$emit('editClosed', obj, this, this.$refs.xGrid)\r\n      this.$emit('ProxyEvent', 'editClosed', obj, this, this.$refs.xGrid)\r\n    })\r\n  }, //\r\n  editActived(obj) {\r\n    this.$emit('editActived', obj, this, this.$refs.xGrid)\r\n    this.$emit('ProxyEvent', 'editActived', obj, this, this.$refs.xGrid)\r\n  }, // 只对 edit-config 配置时有效，单元格被激活编辑时会触发该事件 { row, rowIndex, $rowIndex, column, columnIndex, $columnIndex }\r\n  editDisabled(obj) {\r\n    this.$emit('editDisabled', obj, this, this.$refs.xGrid)\r\n    this.$emit('ProxyEvent', 'editDisabled', obj, this, this.$refs.xGrid)\r\n  }, // 只对 edit-config 配置时有效，当单元格激活时如果是禁用状态时会触发该事件 { row, rowIndex, $rowIndex, column, columnIndex, $columnIndex }\r\n  validError(obj) {\r\n    this.$emit('validError', obj, this, this.$refs.xGrid)\r\n    this.$emit('ProxyEvent', 'validError', obj, this, this.$refs.xGrid)\r\n  }, // 只对 edit-rules 配置时有效，当数据校验不通过时会触发该事件 { rule, row, rowIndex, $rowIndex, column, columnIndex, $columnIndex }\r\n  scroll(obj) {\r\n    // 页面滚动\r\n    let self = this\r\n    // const { type, scrollTop, scrollLeft, isX, isY, $event } = obj\r\n    const { scrollTop, $event } = obj\r\n    this.$emit('scroll', obj, this, this.$refs.xGrid)\r\n    this.$emit('ProxyEvent', 'scroll', obj, this, this.$refs.xGrid)\r\n    if (self.scrollLoadConfigCp && self.scrollLoadConfigCp.enabled) {\r\n      if (+scrollTop + $event.target.offsetHeight > ($event.target.scrollHeight - 20)) {\r\n        self.debounceItemChange(() => { self.performScrollLoad(obj) })\r\n      }\r\n    }\r\n  }, // 表格滚动时会触发该事件 { type, scrollTop, scrollLeft, isX, isY, $event }\r\n  performScrollLoad(obj) {\r\n    // 兼容手机端和PC端滚动加载\r\n    let self = this\r\n    // 滚动条的位置 在页面上返回内容的可视高度 返回整个元素的高度（包括带滚动条的隐蔽的地方）\r\n    self.scrollLoading = true\r\n    self.scrollLoadConfigCp.loadData(self.scrollLoadConfigCp, this.formSearchData)\r\n      .then((res) => {\r\n        self.scrollLoading = false\r\n        if (res && res.data && res.data.length) {\r\n          self.loadScrollTableData(res.data)\r\n          Object.assign(self.scrollLoadConfigCp, {\r\n            curGt: self.scrollLoadConfigCp.curGt + res.data.length,\r\n            currentPage: self.scrollLoadConfigCp.currentPage + 1,\r\n            tatal: res.total\r\n          })\r\n        }\r\n      })\r\n  },\r\n  custom(obj) {\r\n    this.$emit('custom', obj, this, this.$refs.xGrid)\r\n    this.$emit('ProxyEvent', 'custom', obj, this, this.$refs.xGrid)\r\n  },\r\n  formSubmitInvalid(obj) {\r\n    this.$emit('formSubmitInvalid', obj, this, this.$refs.xGrid)\r\n    this.$emit('ProxyEvent', 'formSubmitInvalid', obj, this, this.$refs.xGrid)\r\n  }, // 只对 form-config 配置时有效，表单提交时如果校验不通过会触发该事件 { data, errMap, $event }\r\n  formReset(obj) {\r\n    this.$emit('formReset', obj, this, this.$refs.xGrid)\r\n    this.$emit('ProxyEvent', 'formReset', obj, this, this.$refs.xGrid)\r\n  }, // 只对 form-config 配置时有效，表单重置时会触发该事件 { data, $event }\r\n  formToggleCollapse(obj) {\r\n    this.$emit('formToggleCollapse', obj, this, this.$refs.xGrid)\r\n    this.$emit('ProxyEvent', 'formToggleCollapse', obj, this, this.$refs.xGrid)\r\n  }, // 只对 form-config 配置时有效，当折叠按钮被手动点击时会触发该事件 { collapse, data, $event }\r\n  zoom(obj) {\r\n    this.$emit('zoom', obj, this, this.$refs.xGrid)\r\n    this.$emit('ProxyEvent', 'zoom', obj, this, this.$refs.xGrid)\r\n  } // 当最大化或还原操作被手动点击时会后触发该事件 { type, $event }\r\n  // checkboxChange(obj) {\r\n  //   this.$emit('checkboxChange', obj,  this, this.$refs.xGrid)\r\n  // } // 只对 type=checkbox 有效，当手动勾选并且值发生改变时触发的事件 { records, reserves, indeterminates, checked, row, rowIndex, $rowIndex, column, columnIndex, $columnIndex, $event }\r\n  //  checkboxAll(obj) {\r\n  //    this.$emit('checkboxAll', obj,  this, this.$refs.xGrid)\r\n  //  }, // 只对 type=checkbox 有效，当手动勾选全选时触发的事件 { records, reserves, indeterminates, checked, $event }\r\n  // 如果与工具栏关联， 在自定义列按钮被手动点击后会触发该事件 { type, $event }\r\n  // pageChange(obj) {\r\n  //      this.$emit('pageChange', obj,  this, this.$refs.xGrid)\r\n  // }, // 只对 pager-config 配置时有效，分页发生改变时会触发该事件 { type, currentPage, pageSize, $event }\r\n  // formSubmit (obj) {\r\n  //   this.$emit('formSubmit', obj,  this, this.$refs.xGrid)\r\n  // }, // 只对 form-config 配置时有效，表单提交时会触发该事件 { data, $event }\r\n}\r\nconst calculateTool = {\r\n  // 执行顺序： 取数-->行内计算-->分级汇总-->父级行内计算-->单元格交叉计算(涉及的行计算)-->行约束-->单元格约束\r\n  addMissingFieldsAndCalcColFormula(tableData) {\r\n    // 添加缺失字段并执行全量列计算\r\n    let self = this\r\n    tableData = Array.isArray(tableData) ? tableData : []\r\n    tableData.forEach((row) => {\r\n      self.tableColumnsFieldArr.forEach((item) => {\r\n        // let render = self.tableColumnsFieldMap[item].editRender || self.tableColumnsFieldMap[item].cellRender\r\n        // 遍历配置项生成的前缀数组，并且其前缀在数据包中不存在时，动态给其绑定一个前缀\r\n        // if (render && render.props && render.props.multiple) {\r\n        //   if (Array.isArray(row[item])) {\r\n        //     row[item + '__multiple'] = [...row[item]]\r\n        //   } else if (typeof row[item] === 'string') {\r\n        //     row[item + '__multiple'] = row[item].split(',')\r\n        //   } else {\r\n        //     row[item + '__multiple'] = []\r\n        //   }\r\n        // } else if (render && render.name === '$vxeMoney') {\r\n        //   row[item + '__moneySwitchinput'] = self.accurateChuFa((row[item] + '').replace(/null|undefined|NaN/ig, ''), self.moneyUnit) + ''\r\n        // } else {\r\n        // }\r\n        // 遍历配置项生成的前缀数组，并且其前缀在数据包中不存在时，动态给其绑定一个前缀\r\n        row[item] = typeof row[item] !== 'object' ? (row[item] === undefined ? '' : row[item]) : (row[item] === null ? '' : row[item])\r\n      })\r\n      row = this.reductionColFormula(this.calculateConstraintConfigIn.colFormulaConfig, row)\r\n      if (Array.isArray(row.children) && row.children.length && this.treeConfigIn) {\r\n        row.children = self.addMissingFieldsAndCalcColFormula(row.children)\r\n      }\r\n    })\r\n    self.reductionRowCodeFormula(this.calculateConstraintConfigIn.rowCodeFormulaConfig, tableData, self.id)\r\n    return tableData\r\n  },\r\n  reductionColFormula(colFormulaMap, row, property) {\r\n    // 单条数据计算\r\n    // rowFormulaMap= { \"colfield\":\"{colfield}[运算符]\" }\r\n    let xGrid = this.$refs.xGrid\r\n    const { visibleColumn = [] } = (xGrid && xGrid.getTableColumn && xGrid.getTableColumn()) || {}\r\n    let visibleColumnObj = {}\r\n    visibleColumn.forEach(item => {\r\n      if (!visibleColumnObj[item.property]) {\r\n        visibleColumnObj[item.property] = item\r\n      }\r\n    })\r\n    // property 标识当前编辑字段配置的有公式，但是该字段值是可编辑的，标记候后的值保存，不用重新按公式计算新值\r\n    let colFormulaMapCp = this.deepCopy(colFormulaMap)\r\n    let hasCalcColFormulaMap = {}\r\n    let i = 0\r\n    let ifDoWhile = true\r\n    // 处理当前编辑字段配置的有公式，但是该字段值是可编辑的，编辑后的值保存，不用重新按公式计算新值\r\n    // debugger\r\n    if (this.editConfigIn.formulaEditable && property && colFormulaMapCp[property]) {\r\n      delete colFormulaMapCp[property]\r\n    }\r\n    // 初始化回显时如果该字段有值，就显示自身默认值，不做公式计算\r\n    if (this.editConfigIn.formulaEditable && !property) {\r\n      const colFormulaMapArr = Object.keys(colFormulaMapCp)\r\n      colFormulaMapArr.forEach(key => {\r\n        if (row[key] || row[key] === 0) {\r\n          delete colFormulaMapCp[key]\r\n        }\r\n      })\r\n    }\r\n    try {\r\n      while (ifDoWhile) {\r\n        let colFormulaMapArr = Object.keys(colFormulaMapCp)\r\n        if (colFormulaMapArr.length) {\r\n          for (let cmai = 0; cmai < colFormulaMapArr.length; cmai++) {\r\n            i++\r\n            let item = colFormulaMapArr[cmai]\r\n            let formula = colFormulaMapCp[item]\r\n            let regR = new RegExp('({[a-zA-Z0-9_]*})', 'ig')\r\n            let rowsKey = formula.match(regR) === null ? [] : formula.match(regR)\r\n            if (rowsKey.length) {\r\n              for (let keyCF in rowsKey) {\r\n                let keyC = rowsKey[keyCF].replace(/\\{|\\}/g, '')\r\n                let reg = new RegExp('({' + keyC.replace(/\\$/ig, '\\\\$') + '})', 'ig')\r\n                if (row[keyC] !== undefined && !(hasCalcColFormulaMap[keyC] !== undefined || colFormulaMapCp[keyC])) {\r\n                  colFormulaMapCp[item] = formula.replace(reg, isNaN(parseFloat(row[keyC])) ? 0 : parseFloat(row[keyC]))\r\n                } else if (hasCalcColFormulaMap[keyC] !== undefined) {\r\n                  colFormulaMapCp[item] = formula.replace(reg, hasCalcColFormulaMap[keyC])\r\n                } else if (!colFormulaMapCp[keyC]) {\r\n                  colFormulaMapCp[item] = formula.replace(reg, 0)\r\n                }\r\n              }\r\n            } else {\r\n              // let calcResult = eval(formula)\r\n              let calcResult = evalCalcUtil.eval(formula)\r\n              hasCalcColFormulaMap[item] = calcResult === Infinity || calcResult === -Infinity || isNaN(calcResult) || calcResult === null ? '' : util.accurateFixed(calcResult, 2)\r\n              // 列单独配置元和万元单位\r\n              if (visibleColumnObj[item] && visibleColumnObj[item].params && visibleColumnObj[item].params.moneyUnit) {\r\n                hasCalcColFormulaMap[item] = this.accurateFixed(this.transToNumber(this.accurateChuFa(hasCalcColFormulaMap[item], visibleColumnObj[item].params.moneyUnit), visibleColumnObj[item].params.digits || 2), 2)\r\n              }\r\n              // feat：对于$vxeRatio渲染的百分比 可根据配置保留小数位\r\n              if (visibleColumnObj[item]?.cellRender?.name === '$vxeRatio') {\r\n                // 保留小数位数支持：外部单列配置 || 全局配置 || 默认配置\r\n                const digits = visibleColumnObj[item]?.params?.digits || this.formulaDigits || 2\r\n                // XEUtils.round四舍五入\r\n                hasCalcColFormulaMap[item] = calcResult === Infinity || calcResult === -Infinity || isNaN(calcResult) || calcResult === null\r\n                  ? ''\r\n                  : XEUtils.round(calcResult, digits)\r\n              }\r\n              delete colFormulaMapCp[item]\r\n            }\r\n          }\r\n        } else {\r\n          ifDoWhile = false\r\n        }\r\n        if (i === 100000) {\r\n          console.log(colFormulaMap, hasCalcColFormulaMap)\r\n          console.error('请核查公式')\r\n        }\r\n      }\r\n    } catch (e) {\r\n      // console.log(i)\r\n      // console.log(colFormulaMap, hasCalcColFormulaMap)\r\n      // console.error('请核查公式')\r\n    }\r\n    // console.log(hasCalcColFormulaMap)\r\n    // debugger\r\n    return Object.assign(row, hasCalcColFormulaMap)\r\n  },\r\n  reductionRowFormula(rowFormulaMap, data, tableId) {\r\n    // 单元格交叉计算\r\n    // rowFormulaMap= { \"colField:rowIndex\":\"{tableId:colField:rowIndex}[运算符]\" }\r\n    let rowFormulaMapCp = this.deepCopy(rowFormulaMap)\r\n    let hasCalcrowFormulaMap = {}\r\n    let i = 0\r\n    let ifDoWhile = true\r\n    try {\r\n      while (ifDoWhile) {\r\n        let rowFormulaMapArr = Object.keys(rowFormulaMapCp)\r\n        if (rowFormulaMapArr.length) {\r\n          for (let cmai = 0; cmai < rowFormulaMapArr.length; cmai++) {\r\n            i++\r\n            let item = rowFormulaMapArr[cmai]\r\n            let formula = rowFormulaMapCp[item]\r\n            let regR = new RegExp('({[a-zA-Z0-9_:\\$]*})', 'ig')\r\n            let rowsKey = formula.match(regR) === null ? [] : formula.match(regR)\r\n            if (rowsKey.length) {\r\n              for (let keyCF in rowsKey) {\r\n                let formulaArr = rowsKey[keyCF].replace(/\\{|\\}/g, '').split(':')\r\n                let reg = new RegExp('({' + formulaArr.join(':').replace(/\\$/ig, '\\\\$') + '})', 'ig')\r\n                if (formulaArr[0] === tableId) {\r\n                  if (data[formulaArr[2]] && data[formulaArr[2]][formulaArr[1]] !== undefined && !(hasCalcrowFormulaMap[formulaArr[1] + ':' + formulaArr[2]] !== undefined || rowFormulaMapCp[formulaArr[1] + ':' + formulaArr[2]])) {\r\n                    rowFormulaMapCp[item] = formula.replace(reg, isNaN(parseFloat(data[formulaArr[2]][formulaArr[1]])) ? 0 : parseFloat(data[formulaArr[2]][formulaArr[1]]))\r\n                  } else if (hasCalcrowFormulaMap[formulaArr[1] + ':' + formulaArr[2]] !== undefined) {\r\n                    rowFormulaMapCp[item] = formula.replace(reg, hasCalcrowFormulaMap[formulaArr[1] + ':' + formulaArr[2]])\r\n                  } else if (!rowFormulaMapCp[formulaArr[1] + ':' + formulaArr[2]]) {\r\n                    rowFormulaMapCp[item] = formula.replace(reg, 0)\r\n                  }\r\n                } else {\r\n                  rowFormulaMapCp[item] = formula.replace(reg, 0)\r\n                }\r\n              }\r\n            } else {\r\n              let calcResult = evalCalcUtil.eval(formula)\r\n              hasCalcrowFormulaMap[item] = calcResult === Infinity || calcResult === -Infinity || isNaN(calcResult) ? '' : util.accurateFixed(calcResult, 2)\r\n              delete rowFormulaMapCp[item]\r\n            }\r\n          }\r\n        } else {\r\n          ifDoWhile = false\r\n        }\r\n        if (i === 1000000) {\r\n          console.log(rowFormulaMap, hasCalcrowFormulaMap)\r\n          console.error('请核查公式')\r\n        }\r\n      }\r\n    } catch (e) {\r\n      console.log(rowFormulaMap, hasCalcrowFormulaMap)\r\n      console.error('请核查公式')\r\n    }\r\n    Object.keys(hasCalcrowFormulaMap).forEach((item, index) => {\r\n      let rowCellArr = item.split(':')\r\n      if (data[rowCellArr[1]]) {\r\n        data[rowCellArr[1]][rowCellArr[0]] = hasCalcrowFormulaMap[item] === '0.00' ? '' : hasCalcrowFormulaMap[item]\r\n      }\r\n    })\r\n    return data\r\n  },\r\n  reverDataCodeRowMap(data, codeKey, obj) {\r\n    // 递归生成数据code映射\r\n    let self = this\r\n    obj = obj || {\r\n      dataCodeRowMap: {}\r\n    }\r\n    data.forEach((item, index) => {\r\n      if (Array.isArray(item.children) && item.children.length) {\r\n        self.reverDataCodeRowMap(item.children, codeKey, obj)\r\n      } else {\r\n        obj.dataCodeRowMap[item[codeKey]] = item\r\n      }\r\n    })\r\n    return obj\r\n  },\r\n  reverCalcRowCodeFormula(reverCalcRowCodeFormula, data, tableId) {\r\n    // 递归进行单元格交叉依赖计算\r\n    let self = this\r\n    Object.keys(reverCalcRowCodeFormula).map((item, index) => {\r\n      return {\r\n        itemcode: item.split(':')[1],\r\n        property: item.split(':')[0]\r\n      }\r\n    }).forEach((item, id) => {\r\n      let formColCalList = self.getFormColCalBack(self.id + item.property + item.itemcode)\r\n      if (Object.keys(formColCalList).length) {\r\n        self.reductionRowCodeFormula(formColCalList, self.$refs.xGrid.getTableData().fullData, self.id)\r\n      }\r\n    })\r\n  },\r\n  getDataCodeRowMapCumulativeResult(dataCodeRowMap, field) {\r\n    // 获取重复itemcode的计算结果\r\n    return isNaN(parseFloat(dataCodeRowMap[field])) ? 0 : parseFloat(dataCodeRowMap[field])\r\n  },\r\n  reductionRowCodeFormula(rowCodeFormulaMap, data, tableId) {\r\n    // 单元格交叉计算根据行 code\r\n    // rowCodeFormulaMap= { \"colField:rowCode\":\"{tableId:colField:rowCode}[运算符]\" }\r\n    let self = this\r\n    let { calcAndConstraintTableId, dataType, calcAndConstraintItemCodeField, gradedSummaryFields } = self.calculateConstraintConfigIn\r\n    let isTreeData = dataType === undefined ? self.treeConfigIn : dataType === 'tree' ? 1 : 0\r\n    tableId = calcAndConstraintTableId || self.id\r\n    let treeData = this.getDataCodeTreeData(data, calcAndConstraintItemCodeField, gradedSummaryFields, isTreeData)\r\n    let { dataCodeRowMap } = self.recursiveDataCodeRowMap(treeData, calcAndConstraintItemCodeField, true)\r\n    let rowCodeFormulaMapCp = this.deepCopy(rowCodeFormulaMap)\r\n    let hasCalcrowCodeFormulaMap = {}\r\n    let i = 0\r\n    let ifDoWhile = true\r\n    try {\r\n      while (ifDoWhile) {\r\n        let rowCodeFormulaMapArr = Object.keys(rowCodeFormulaMapCp)\r\n        if (rowCodeFormulaMapArr.length) {\r\n          for (let cmai = 0; cmai < rowCodeFormulaMapArr.length; cmai++) {\r\n            i++\r\n            let item = rowCodeFormulaMapArr[cmai]\r\n            let formula = rowCodeFormulaMapCp[item]\r\n            let regR = new RegExp('({[a-zA-Z0-9_:\\$]*})', 'ig')\r\n            let rowsKey = formula.match(regR) === null ? [] : formula.match(regR)\r\n            if (rowsKey.length) {\r\n              for (let keyCF in rowsKey) {\r\n                let formulaArr = rowsKey[keyCF].replace(/\\{|\\}/g, '').split(':')\r\n                let reg = new RegExp('({' + formulaArr.join(':').replace(/\\$/ig, '\\\\$') + '})', 'ig')\r\n                if (formulaArr[0] === tableId) {\r\n                  if (dataCodeRowMap[formulaArr[2]] && !(hasCalcrowCodeFormulaMap[formulaArr[1] + ':' + formulaArr[2]] || rowCodeFormulaMapCp[formulaArr[1] + ':' + formulaArr[2]])) {\r\n                    rowCodeFormulaMapCp[item] = formula.replace(reg, self.getDataCodeRowMapCumulativeResult(dataCodeRowMap[formulaArr[2]], formulaArr[1]))\r\n                  } else if (hasCalcrowCodeFormulaMap[formulaArr[1] + ':' + formulaArr[2]]) {\r\n                    rowCodeFormulaMapCp[item] = formula.replace(reg, hasCalcrowCodeFormulaMap[formulaArr[1] + ':' + formulaArr[2]])\r\n                  } else if (!rowCodeFormulaMapCp[formulaArr[1] + ':' + formulaArr[2]]) {\r\n                    rowCodeFormulaMapCp[item] = formula.replace(reg, 0)\r\n                  }\r\n                } else {\r\n                  rowCodeFormulaMapCp[item] = formula.replace(reg, 0)\r\n                }\r\n              }\r\n            } else {\r\n              let calcResult = evalCalcUtil.eval(formula)\r\n              hasCalcrowCodeFormulaMap[item] = calcResult === Infinity || calcResult === -Infinity || isNaN(calcResult) ? '' : util.accurateFixed(calcResult, 2)\r\n              delete rowCodeFormulaMapCp[item]\r\n            }\r\n          }\r\n        } else {\r\n          ifDoWhile = false\r\n        }\r\n        if (i === 1000000) {\r\n          console.log(rowCodeFormulaMap, hasCalcrowCodeFormulaMap)\r\n          console.error('请核查公式')\r\n        }\r\n      }\r\n    } catch (e) {\r\n      console.log(rowCodeFormulaMap, hasCalcrowCodeFormulaMap)\r\n      throw (e)\r\n    }\r\n    try {\r\n      let rowCodeFormumaMap = self.checkWhetherExcuteColCalculate(this.deepCopy(hasCalcrowCodeFormulaMap))\r\n      for (let itemCode in rowCodeFormumaMap) {\r\n        let row = dataCodeRowMap[itemCode]\r\n        if (row) {\r\n          row = Object.assign(row, rowCodeFormumaMap[itemCode].curRowCodeFormulaMap)\r\n          self.reductionColFormula(rowCodeFormumaMap[itemCode].rowCodeFormulaFieldMap, row)\r\n        }\r\n      }\r\n    } catch (e) {\r\n      throw (e)\r\n    }\r\n\r\n    // Object.keys(hasCalcrowCodeFormulaMap).forEach((item, index) => {\r\n    //   let rowCellArr = item.split(':')\r\n    //   if (dataCodeRowMap[rowCellArr[1]]) {\r\n    //     dataCodeRowMap[rowCellArr[1]].forEach((row, rowIndex) => {\r\n    //       row[rowCellArr[0]] = hasCalcrowCodeFormulaMap[item] === '0.00' ? '' : hasCalcrowCodeFormulaMap[item]\r\n    //       row = self.reductionColFormula(, row)\r\n    //     })\r\n    //   }\r\n    // })\r\n    // this.reverCalcRowCodeFormula(rowCodeFormulaMap, data, tableId)\r\n    return data\r\n  },\r\n  checkWhetherExcuteColCalculate(hasCalcrowCodeFormulaMap) {\r\n    // 记录当前数据单元格交叉公式计算字段\r\n    let self = this\r\n    let rowCodeFormumaMap = {}\r\n    Object.keys(hasCalcrowCodeFormulaMap).forEach((item, index) => {\r\n      rowCodeFormumaMap[item.split(':')[0]] = {}\r\n    })\r\n    Object.keys(rowCodeFormumaMap).forEach((itemCode, itemCodeIndex) => {\r\n      let rowCodeFormulaFieldMap = Object.assign({}, self.calculateConstraintConfigIn.colFormulaConfig) // 单元格交叉计算\r\n      let curRowCodeFormulaMap = {}\r\n      Object.keys(hasCalcrowCodeFormulaMap).forEach((item, index) => {\r\n        let rowCellArr = item.split(':')\r\n        if (rowCellArr[0] === itemCode) {\r\n          curRowCodeFormulaMap[rowCellArr[1]] = hasCalcrowCodeFormulaMap[item] === '0.00' ? '' : hasCalcrowCodeFormulaMap[item]\r\n          delete rowCodeFormulaFieldMap[rowCellArr[0]]\r\n        }\r\n      })\r\n      rowCodeFormumaMap[itemCode] = {\r\n        rowCodeFormulaFieldMap: Object.assign({}, self.calculateConstraintConfigIn.colFormulaConfig, rowCodeFormulaFieldMap),\r\n        curRowCodeFormulaMap: curRowCodeFormulaMap\r\n      }\r\n    })\r\n    return rowCodeFormumaMap\r\n  },\r\n  riverColumnsGenerateCalcColFormulaMap(columns, obj) {\r\n    // 递归生成列计算全量映射\r\n    let self = this\r\n    obj = obj || {\r\n      tableColumnsFieldMap: {},\r\n      tableColumnsFieldArr: [],\r\n      tableColumnsSingArr: [],\r\n      tableColumnsTitleFieldMap: {},\r\n      colFormulaConfig: {},\r\n      tableColumnsSingEditFieldArr: [],\r\n      gradedSummaryFields: []\r\n    }\r\n    columns.forEach((conlum, index) => {\r\n      if (Array.isArray(conlum.children) && conlum.children.length) {\r\n        self.riverColumnsGenerateCalcColFormulaMap(conlum.children, obj)\r\n      } else {\r\n        if (conlum.field) {\r\n          obj.tableColumnsFieldMap[conlum.field] = conlum\r\n          obj.tableColumnsFieldArr.push(conlum.field)\r\n          obj.tableColumnsSingArr.push(conlum)\r\n          obj.tableColumnsTitleFieldMap[conlum.title] = conlum.field\r\n          if (conlum.formula) {\r\n            obj.colFormulaConfig[conlum.field] = conlum.formula\r\n          }\r\n          if (conlum.editRender) {\r\n            obj.tableColumnsSingEditFieldArr.push(conlum.field)\r\n          }\r\n          if ((conlum.combinedType && conlum.combinedType.indexOf('needGradedSummary') >= 0) || conlum.needResponsive || conlum.gradedSummary) {\r\n            obj.gradedSummaryFields.push(conlum.field)\r\n          }\r\n        }\r\n      }\r\n    })\r\n    return obj\r\n  },\r\n  generateCalcColFormulaMap(columns) {\r\n    // 生成列计算公式映射\r\n    let self = this\r\n    let obj = this.riverColumnsGenerateCalcColFormulaMap(columns)\r\n    self.tableColumnsFieldMap = obj.tableColumnsFieldMap\r\n    self.tableColumnsFieldArr = obj.tableColumnsFieldArr\r\n    self.tableColumnsSingArr = obj.tableColumnsSingArr\r\n    self.gradedSummaryFields = (Array.isArray(obj.gradedSummaryFields) && obj.gradedSummaryFields.length) ? obj.gradedSummaryFields : null\r\n    self.tableColumnsTitleFieldMap = obj.tableColumnsTitleFieldMap\r\n    self.tableColumnsSingEditFieldArr = obj.tableColumnsSingEditFieldArr\r\n    this.calculateConstraintConfigIn = Object.assign({}, this.calculateConstraintConfigIn, {\r\n      colFormulaConfig: obj.colFormulaConfig\r\n    })\r\n  },\r\n  getFormColCalBack(formulaConditions) {\r\n    // 根据单元格位置查询计算的公式\r\n    // let self = this\r\n    let formColCalList = {}\r\n    let rowFormula = this.calculateConstraintConfigIn.rowFormula\r\n    if (rowFormula) {\r\n      Object.keys(rowFormula).forEach((v, index) => {\r\n        if (v === formulaConditions) {\r\n          rowFormula[v].forEach(j => {\r\n            formColCalList = Object.assign(formColCalList, j)\r\n          })\r\n        }\r\n      })\r\n      return formColCalList\r\n    } else {\r\n      return ''\r\n    }\r\n  },\r\n  performTableDataCalculate(obj) { // 行改变事件执行单元格计算并刷新视图\r\n    // 执行顺序： 取数-->行内计算-->分级汇总-->父级行内计算-->单元格交叉计算(涉及的行计算)-->行约束-->单元格约束\r\n    return this.rePerformRowCalcAndConstraintSingleAndRerender(obj)\r\n  },\r\n  generateColumnsAllMap(columns, obj) {\r\n    // 生成导入view映射数据\r\n    let self = this\r\n    obj = obj || {\r\n      tableColumnsFieldMap: {},\r\n      tableColumnsTitleFieldMap: {},\r\n      viewToSourceMap: {},\r\n      colFormulaConfig: {},\r\n      rowsObjTemp: {},\r\n      tableColumnsTitleMap: {}\r\n    }\r\n    columns.forEach((conlum, index) => {\r\n      if (Array.isArray(conlum.children) && conlum.children.length) {\r\n        self.riverColumnsGenerateCalcColFormulaMap(conlum.children, obj)\r\n      } else {\r\n        if (conlum.formula) {\r\n          obj.colFormulaConfig[conlum.field] = conlum.formula\r\n          obj.tableColumnsTitleMap[conlum.title] = conlum\r\n        }\r\n        if (conlum.field) {\r\n          obj.rowsObjTemp[conlum.field] = ''\r\n          let map = {\r\n            needMap: true,\r\n            options: [],\r\n            multiple: false,\r\n            formula: conlum.formula\r\n          }\r\n          obj.tableColumnsFieldMap[conlum.field] = conlum\r\n          obj.tableColumnsTitleFieldMap[conlum.title] = conlum.field\r\n          let itemRender = conlum.cellRender || conlum.editRender || conlum.contentRender\r\n          if (itemRender) {\r\n            switch (itemRender.name) {\r\n              case '$vxeSelect':\r\n                if (itemRender.props && itemRender.props.multiple) {\r\n                  map = Object.assign({}, map, {\r\n                    needMap: true,\r\n                    name: itemRender.name,\r\n                    options: Array.isArray(itemRender.options) ? itemRender.options : [],\r\n                    multiple: true\r\n                  })\r\n                } else {\r\n                  map = Object.assign({}, map, {\r\n                    needMap: true,\r\n                    name: itemRender.name,\r\n                    options: Array.isArray(itemRender.options) ? itemRender.options : [],\r\n                    multiple: false\r\n                  })\r\n                }\r\n                break\r\n              case '$vxeRadio':\r\n                map = Object.assign({}, map, {\r\n                  needMap: true,\r\n                  name: itemRender.name,\r\n                  options: Array.isArray(itemRender.options) ? itemRender.options : [],\r\n                  multiple: false\r\n                })\r\n                break\r\n              case '$vxeCheckbox':\r\n                map = Object.assign({}, map, {\r\n                  needMap: true,\r\n                  name: itemRender.name,\r\n                  options: Array.isArray(itemRender.options) ? itemRender.options : [],\r\n                  multiple: true\r\n                })\r\n                break\r\n              case '$vxeSwitch':\r\n                map = Object.assign({}, map, {\r\n                  needMap: true,\r\n                  name: itemRender.name,\r\n                  options: Array.isArray(itemRender.options) ? itemRender.options : [],\r\n                  multiple: false\r\n                })\r\n                break\r\n              default:\r\n                map = Object.assign({}, map, {\r\n                  needMap: false,\r\n                  // pattern: ((itemRenderName, itemRenderType) => {\r\n                  //   switch (itemRenderName) {\r\n                  //     case '$vxeInput':\r\n                  //       // text, search, number, integer, float, password, date, time, datetime, week, month, year\r\n                  //       switch (itemRenderType) {\r\n                  //         case 'string':\r\n                  //           return (str) => {\r\n                  //             // 空\r\n                  //             str = str && str.toString()\r\n                  //             return !(str && str.trim() !== '')\r\n                  //           }\r\n                  //         case 'number':\r\n                  //           // 数字\r\n                  //           return (str) => {\r\n                  //             return /^[0-9]*$/.test(str)\r\n                  //           }\r\n                  //         case 'integer':\r\n                  //           // 数字\r\n                  //           return (str) => {\r\n                  //             return /^[1-9]+[0-9]*$/.test(str)\r\n                  //           }\r\n                  //         case 'time':\r\n                  //           // 时间\r\n                  //           return (str) => {\r\n                  //             return /^\\d*(?:\\.\\d{0,2})?$/.test(str)\r\n                  //           }\r\n                  //         case 'year':\r\n                  //           // 年\r\n                  //           return (str) => {\r\n                  //             return /^[1,9]{4}/.test(str)\r\n                  //           }\r\n                  //         case 'float':\r\n                  //           // 2位小叔\r\n                  //           return (str) => {\r\n                  //             return /^-?\\d+\\.?\\d{0,2}$/.test(str)\r\n                  //           }\r\n                  //       }\r\n                  //       break\r\n                  //     case '$vxeMoney':\r\n                  //       return (str) => {\r\n                  //         return /^-?\\d+\\.?\\d{0,2}$/.test(str)\r\n                  //       }\r\n                  //     case '$vxeCalculate':\r\n                  //       return (str) => {\r\n                  //         return /^-?\\d+\\.?\\d{0,2}$/.test(str)\r\n                  //       }\r\n                  //     case '$vxeEditDownTextarea':\r\n                  //       return (str) => {\r\n                  //         str = str && str.toString()\r\n                  //         return !(str && str.trim() !== '')\r\n                  //       }\r\n                  //     case '$vxeDays': {\r\n                  //       return (str) => {\r\n                  //         return /^-?\\d+\\.?\\d{0,2}$/.test(str)\r\n                  //       }\r\n                  //     }\r\n                  //     case '$vxeTime': {\r\n                  //       return (str) => {\r\n                  //         return /^-?\\d+\\.?\\d{0,2}$/.test(str)\r\n                  //       }\r\n                  //     }\r\n                  //     case '$vxeText': {\r\n                  //       return (str) => {\r\n                  //         return /^-?\\d+\\.?\\d{0,2}$/.test(str)\r\n                  //       }\r\n                  //     }\r\n\r\n                  //     default:\r\n                  //       break\r\n                  //   }\r\n                  // })(itemRender.name, itemRender.props && itemRender.props.type),\r\n                  name: itemRender.name,\r\n                  options: Array.isArray(itemRender.options) ? itemRender.options : [],\r\n                  multiple: false\r\n                })\r\n                break\r\n            }\r\n          } else {\r\n            map = Object.assign({}, map, {\r\n              needMap: false\r\n            })\r\n          }\r\n          obj.viewToSourceMap[conlum.field] = map\r\n        }\r\n      }\r\n    })\r\n    return obj\r\n  },\r\n  isEditForFormula(row, rowIndex, column, columnIndex) {\r\n    let isForFormulaData = column.property + ':' + row.itemcode\r\n    let isForFormula = true\r\n    let self = this\r\n    if (self.calculateConstraintConfigIn.rowCodeFormulaConfig[isForFormulaData] || self.calculateConstraintConfigIn.colFormulaConfig[column.property]) {\r\n      isForFormula = false\r\n    } else {\r\n      isForFormula = true\r\n    }\r\n    return isForFormula\r\n    // if (this.calculateConstraintConfigIn.constraintConfig === '') {\r\n    //   return true\r\n    // } else {\r\n    //   return false\r\n    // }\r\n  },\r\n  isActiveCellEdit({ row, rowIndex, column, columnIndex }) {\r\n    let isEditForFormula = this.isEditForFormula(row, rowIndex, column, columnIndex)\r\n    return isEditForFormula\r\n  }\r\n}\r\nconst calcAndConstraint = { // 计算约束部分\r\n  // 执行顺序： 取数--> 行内计算--> 分级汇总--> 父级行内计算--> 单元格交叉计算(涉及的行计算)--> 行约束--> 单元格约束\r\n  addMissingFields(tableData) {\r\n    // 添加缺失字段并执行全量列计算\r\n    let self = this\r\n    tableData = Array.isArray(tableData) ? tableData : []\r\n    tableData.forEach((row) => {\r\n      self.tableColumnsFieldArr.forEach((item) => {\r\n        row[item] = typeof row[item] !== 'object' ? (row[item] === undefined ? '' : row[item]) : (row[item] === null ? '' : row[item])\r\n      })\r\n      if (Array.isArray(row.children) && row.children.length && this.treeConfigIn) {\r\n        row.children = self.addMissingFields(row.children)\r\n      }\r\n    })\r\n    return tableData\r\n  },\r\n  // 取数\r\n  generatGetDataConfigMap(cellDataConfig) { // 生成取数和单元格计算\r\n    //  [{ itemcode: \"002\", itemname: \"一般公共预算\", cells: [{ itemcode: \"002\", colField: \"f001\", inputType: 1, formulaShow: \"提取\",formula:'tableId:colField:itemcode' }] }]\r\n    let rowCodeFormulaConfig = {}\r\n    let getDataConfig = {}\r\n    cellDataConfig.forEach((cell) => {\r\n      if (cell.formulaShow === '提取') {\r\n        getDataConfig[cell.itemCode + ':' + cell.colField] = cell.formula\r\n      } else if (cell.formulaShow === '计算') {\r\n        rowCodeFormulaConfig[cell.itemCode + ':' + cell.colField] = cell.formula\r\n      } else {\r\n      }\r\n    })\r\n    this.calculateConstraintConfigIn.rowCodeFormulaConfig = rowCodeFormulaConfig\r\n    this.calculateConstraintConfigIn.getDataConfig = getDataConfig\r\n  },\r\n  performGetData() { // 获取数据\r\n    let self = this\r\n    return new Promise((resolve, reject) => {\r\n      let { getDataAxiosConfig, getDataParams, getDataConfig } = this.calculateConstraintConfigIn\r\n      let dataFieldArr = getDataAxiosConfig.dataField ? getDataAxiosConfig.dataField.split('.')[0] ? getDataAxiosConfig.dataField.split('.') : ['data'] : ['data']\r\n      if (!getDataAxiosConfig.url || getDataAxiosConfig.data) {\r\n        resolve(getDataConfig)\r\n      } else {\r\n        self.$http[getDataAxiosConfig.method](\r\n          getDataAxiosConfig.url,\r\n          Object.assign({ tableId: this.id }, getDataParams || {})\r\n        ).then((res) => {\r\n          let resData = {}\r\n          if (self.getbasicDataType(res) === 'Array') {\r\n            resData = res\r\n            self.$XModal.message({ status: 'success', message: '操作成功' })\r\n          } else if (self.getbasicDataType(res) === 'Object') {\r\n            if (\r\n              res[getDataAxiosConfig.statusField || 'rscode'] ===\r\n              (getDataAxiosConfig.successCode || '200')\r\n            ) {\r\n              dataFieldArr.forEach((item, index) => {\r\n                if (index === 0) {\r\n                  resData = res[item]\r\n                } else {\r\n                  resData = resData[item]\r\n                }\r\n              })\r\n              resolve(self.generatGetDataMap(resData))\r\n              self.$XModal.message({ status: 'success', message: '操作成功' })\r\n            } else {\r\n              console.log('获取取树数据异常，当前返回数据为：\\n', res)\r\n              self.$XModal.message({ status: 'error', message: '获取取树数据异常' })\r\n              reject(res)\r\n            }\r\n          } else {\r\n            console.log('获取取数数据异常，当前返回数据为：\\n', res)\r\n            self.$XModal.message({ status: 'error', message: '获取取树数据异常' })\r\n            reject(res)\r\n          }\r\n        }).catch(e => {\r\n          self.$XModal.message({ status: 'error', message: '获取取树数据异常' })\r\n          reject(e)\r\n        })\r\n      }\r\n    })\r\n  },\r\n  generatGetDataMap(res) { // 生成取数map\r\n    //  [{ itemCode: \"002\", colField: \"f005\", value: \"1500.0\" }, { itemCode: \"002001\", colField: \"f005\", value: \"500.0\" }]\r\n    let getDataRenderMap = {}\r\n    res.forEach((item, index) => {\r\n      getDataRenderMap[item.itemCode + ':' + item.colField] = item.value\r\n    })\r\n    this.calculateConstraintConfigIn.getDataRenderMap = getDataRenderMap\r\n    return getDataRenderMap\r\n  },\r\n  // 全量计算和生成约束数据\r\n  performGetDataOption(data) { // 执行取数 并 重新计算和执行约束并渲染表格\r\n    let self = this\r\n    return new Promise((resolve, reject) => {\r\n      self.performGetData().then((getDataRenderMap) => {\r\n        self.calculateConstraintConfigIn.getDataRenderMap = getDataRenderMap\r\n        self.rePerformAllCalcAndConstraintByData(data || self.getTableData().fullData).then(({\r\n          dataCodeRowMap,\r\n          dataCodeRowArr,\r\n          afterCalcData }) => {\r\n          resolve(data)\r\n        }).catch(e => {\r\n          reject(e)\r\n        })\r\n      }).catch(e => {\r\n        reject(e)\r\n      })\r\n    })\r\n  },\r\n  rePerformRowCalcAndConstraintAllAndRerender(data) { // 执行行所设计的所有计算约束并重新渲染\r\n    let self = this\r\n    return new Promise((resolve, reject) => {\r\n      self.rePerformAllCalcAndConstraintByData(data).then(({\r\n        dataCodeRowMap,\r\n        dataCodeRowArr,\r\n        afterCalcData }) => {\r\n        self.updateFooter().then(() => {\r\n        }).catch((e) => {\r\n          throw (e)\r\n        })\r\n      }).catch(e => {\r\n        throw (e)\r\n      })\r\n    })\r\n  },\r\n  rePerformAllCalcAndConstraintByData(data) { // 重新计算和生成约束数据\r\n    // 执行顺序： 取数--> 行内计算--> 分级汇总--> 父级行内计算--> 单元格交叉计算(涉及的行计算)--> 行约束--> 单元格约束\r\n    let self = this\r\n    return new Promise((resolve, reject) => {\r\n      try {\r\n        if (Array.isArray && data.length) {\r\n          let { enabledType, colFormulaConfig, calcAndConstraintTableId, dataType, calcAndConstraintItemCodeField, rowCodeFormulaConfig, colConstraintConfig, rowCodeConstraintConfig, getDataRenderMap, gradedSummaryFields, enabled } = self.calculateConstraintConfigIn\r\n          if (enabled) {\r\n            let isTreeData = dataType === undefined ? self.treeConfigIn : dataType === 'tree' ? 1 : 0\r\n            let tableId = calcAndConstraintTableId || self.id\r\n            let treeData = this.getDataCodeTreeData(data, calcAndConstraintItemCodeField, self.gradedSummaryFields || gradedSummaryFields, isTreeData)\r\n            let { dataCodeRowMap, dataCodeRowArr } = self.recursiveDataCodeRowMap(treeData, calcAndConstraintItemCodeField, true)\r\n            if (enabledType.performGetData) {\r\n              self.performGetDataAll({ data, dataCodeRowMap, dataCodeRowArr, getDataRenderMap, tableId: tableId }) // 渲染取数\r\n            }\r\n            if (enabledType.performColFormula) {\r\n              self.performColFormulaAll({ data, dataCodeRowMap, dataCodeRowArr, gradedSummaryFields: self.gradedSummaryFields || gradedSummaryFields, colFormulaConfig, tableId: tableId, calcColType: 'lastLevel' }) // 行内计算\r\n            }\r\n            if (enabledType.gradedSummary) {\r\n              self.performGradedSummaryAll({ data: treeData, dataCodeRowMap, dataCodeRowArr, gradedSummaryFields: self.gradedSummaryFields || gradedSummaryFields, tableId: tableId }) // 分级汇总\r\n            }\r\n            if (enabledType.performColFormula) {\r\n              self.performColFormulaAll({ data, dataCodeRowMap, dataCodeRowArr, gradedSummaryFields: self.gradedSummaryFields || gradedSummaryFields, colFormulaConfig, tableId: tableId, calcColType: 'parent' }) // 父级行内计算\r\n            }\r\n            if (enabledType.performRowCodeFormula) {\r\n              self.performRowCodeFormula({ data, dataCodeRowMap, dataCodeRowArr, rowCodeFormulaConfig, tableId: tableId }) // 单元格交叉计算\r\n            }\r\n            if (enabledType.performColConstraint) {\r\n              self.performRowConstraintAll({ data, dataCodeRowMap, dataCodeRowArr, colConstraintConfig, tableId: tableId }) // 行内约束\r\n            }\r\n            if (enabledType.performCellConstraint) {\r\n              self.performCellConstraintAll({ data, dataCodeRowMap, dataCodeRowArr, rowCodeConstraintConfig, tableId: tableId }) // 单元格约束\r\n            }\r\n            if (enabledType.performColConstraint || enabledType.performCellConstraint) {\r\n              self.updatedDataAfterConstraint({ data, constrainRowDataMap: self.constrainRowDataMap, dataCodeRowMap, dataCodeRowArr })\r\n            }\r\n            resolve({\r\n              dataCodeRowMap,\r\n              dataCodeRowArr,\r\n              afterCalcData: data\r\n            })\r\n          } else {\r\n            resolve({\r\n              dataCodeRowMap: {},\r\n              dataCodeRowArr: data,\r\n              afterCalcData: data\r\n            })\r\n          }\r\n        } else {\r\n          resolve({\r\n            dataCodeRowMap: {},\r\n            dataCodeRowArr: [],\r\n            afterCalcData: []\r\n          })\r\n        }\r\n      } catch (e) {\r\n        reject(e)\r\n      }\r\n    })\r\n  },\r\n  rePerformRowCalcAndConstraintSingleAndRerender(obj) { // 执行行所涉及的所有计算约束并重新渲染\r\n    let self = this\r\n    return new Promise((resolve, reject) => {\r\n      self.rePerformRowCalcAndConstraintSingle(obj).then(({ row, data, dataCodeRowMap, dataCodeRowArr }) => {\r\n        self.updateFooter().then(() => {\r\n          resolve(true)\r\n        }).catch((e) => {\r\n          resolve(false)\r\n        })\r\n      }).catch(e => {\r\n        resolve(false)\r\n      })\r\n    })\r\n  },\r\n\r\n  rePerformRowCalcAndConstraintSingle({ row, data, column }) { // 重新计算和生成单条约束数据\r\n    // 执行顺序： 取数-->行内计算-->分级汇总-->父级行内计算-->单元格交叉计算(涉及的行计算)-->行约束-->单元格约束\r\n    let self = this\r\n    return new Promise((resolve, reject) => {\r\n      try {\r\n        let { enabledType, colFormulaConfig, calcAndConstraintTableId, dataType, calcAndConstraintItemCodeField, colConstraintConfig, rowCodeConstraintConfig, rowCodeFormulaConfig, gradedSummaryFields, enabled } = self.calculateConstraintConfigIn\r\n        if (enabled) {\r\n          let isTreeData = dataType === undefined ? self.treeConfigIn : dataType === 'tree' ? 1 : 0\r\n          let tableId = calcAndConstraintTableId || self.id\r\n          let treeData = this.getDataCodeTreeData(data, calcAndConstraintItemCodeField, self.gradedSummaryFields || gradedSummaryFields, isTreeData)\r\n          let { dataCodeRowMap, dataCodeRowArr } = self.recursiveDataCodeRowMap(treeData, calcAndConstraintItemCodeField, true)\r\n          // self.performGetDataAll({ data, dataCodeRowMap, dataCodeRowArr, getDataRenderMap, tableId: tableId, row }) // 渲染取数\r\n          if (enabledType.performColFormula) {\r\n            self.performColFormulaSingle({ column, data, dataCodeRowMap, gradedSummaryFields: self.gradedSummaryFields || gradedSummaryFields, calcAndConstraintItemCodeField, dataCodeRowArr, colFormulaConfig, tableId: tableId, row, calcColType: 'lastLevel' }) // 行内计算\r\n          }\r\n          if (enabledType.gradedSummary) {\r\n            let gradedSummaryRow = dataCodeRowMap[row['item__pNestCode'].split('_')[0]]\r\n            if (gradedSummaryRow) {\r\n              self.performGradedSummarySingle({ column, data: treeData, dataCodeRowMap, dataCodeRowArr, gradedSummaryFields: self.gradedSummaryFields || gradedSummaryFields, row: gradedSummaryRow, tableId: tableId }) // 分级汇总\r\n            }\r\n          }\r\n          if (enabledType.performColFormula) {\r\n            self.performColFormulaSingle({ data, dataCodeRowMap, column, dataCodeRowArr, calcAndConstraintItemCodeField, gradedSummaryFields: self.gradedSummaryFields || gradedSummaryFields, colFormulaConfig, row, tableId: tableId, calcColType: 'parent' }) // 父级行内计算\r\n          }\r\n          if (enabledType.performRowCodeFormula) {\r\n            self.performRowCodeFormula({ data, dataCodeRowMap, column, dataCodeRowArr, rowCodeFormulaConfig, tableId: tableId }) // 单元格交叉计算\r\n          }\r\n          if (enabledType.performColConstraint) {\r\n            self.performRowConstraintSingle({ data, row, column, dataCodeRowMap, dataCodeRowArr, colConstraintConfig, tableId: tableId }) // 行内约束\r\n          }\r\n          if (enabledType.performCellConstraint) {\r\n            self.performCellConstraintSingle({ data, row, column, dataCodeRowMap, dataCodeRowArr, rowCodeConstraintConfig, tableId: tableId }) // 单元格约束\r\n          }\r\n          if (enabledType.performColConstraint || enabledType.performCellConstraint) {\r\n            self.updatedDataAfterConstraint({ data, constrainRowDataMap: self.constrainRowDataMap, dataCodeRowMap, dataCodeRowArr })\r\n          }\r\n          resolve({ row, data, dataCodeRowMap, dataCodeRowArr })\r\n        } else {\r\n          resolve({ row, data, dataCodeRowMap: {}, dataCodeRowArr: data })\r\n        }\r\n      } catch (e) {\r\n        console.error(e)\r\n        reject(e)\r\n      }\r\n    })\r\n  },\r\n  getDataCodeTreeData(data, calcAndConstraintItemCodeField, gradedSummaryFields, isTreeData) { // 平行数据生成树形数据，以便下一步转换添加映射\r\n    if (isTreeData) {\r\n      return data\r\n    } else if (Array.isArray(gradedSummaryFields) && gradedSummaryFields.length && calcAndConstraintItemCodeField) {\r\n      return this.listToTreeByNestCodeLength(data, calcAndConstraintItemCodeField)\r\n    } else {\r\n      return data\r\n    }\r\n  },\r\n  recursiveDataCodeRowMap(data, codeKey, traverseTree, levelNo = 1, pCode = '', pNCode, obj = { dataCodeRowMap: {}, dataCodeRowArr: [] }) { // 递归生成数据code映射\r\n    let { extendMapInfoField } = this.calculateConstraintConfigIn\r\n    let self = this\r\n    data.forEach((row, index) => {\r\n      if (extendMapInfoField) {\r\n        row['item__level'] = levelNo\r\n        row['item__pcode'] = pCode\r\n        row['item__pNestCode'] = (pNCode ? pNCode + '_' + row[codeKey] : row[codeKey])\r\n      }\r\n      obj.dataCodeRowMap[row[codeKey]] = row\r\n      obj.dataCodeRowArr.push(row)\r\n      if (traverseTree) {\r\n        if (Array.isArray(row.children) && row.children.length) {\r\n          row['last__level'] = 0\r\n          self.recursiveDataCodeRowMap(row.children, codeKey, traverseTree, levelNo + 1, row[codeKey], row['item__pNestCode'], obj)\r\n        } else {\r\n          row['last__level'] = 1\r\n        }\r\n      } else {\r\n        row['last__level'] = 1\r\n      }\r\n    })\r\n    return obj\r\n  },\r\n  performGetDataAll({ data, dataCodeRowMap, getDataRenderMap, tableId }) { // 执行 取数\r\n    if (this.isEmptyObj(getDataRenderMap)) {\r\n      return data\r\n    }\r\n    Object.keys(getDataRenderMap).forEach((renderItemKey) => {\r\n      let renderItemKeyArr = renderItemKey.split(':')\r\n      if (dataCodeRowMap[renderItemKeyArr[0]]) {\r\n        dataCodeRowMap[renderItemKeyArr[0]][renderItemKeyArr[1]] = getDataRenderMap[renderItemKey] || ''\r\n      }\r\n    })\r\n  },\r\n  performGetDataSingle({ data, dataCodeRowMap, calcAndConstraintItemCodeField, getDataRenderMap, tableId, row }) { // 执行 单条数据 取数\r\n    if (this.isEmptyObj(getDataRenderMap)) {\r\n      return data\r\n    }\r\n    Object.keys(getDataRenderMap).forEach((renderItemKey) => {\r\n      let renderItemKeyArr = renderItemKey.split(':')\r\n      if (renderItemKeyArr[0] === row[calcAndConstraintItemCodeField]) {\r\n        row[renderItemKeyArr[0]][renderItemKeyArr[1]] = getDataRenderMap[renderItemKey]\r\n      }\r\n    })\r\n    return data\r\n  },\r\n  performColFormulaAll({ data, dataCodeRowMap, dataCodeRowArr, gradedSummaryFields, colFormulaConfig, tableId, calcColType }) { // 执行 行计算\r\n    // calcColType  执行  lastLevel:最底级，parent:父级 all:全部\r\n    if (this.isEmptyObj(colFormulaConfig)) {\r\n      return data\r\n    }\r\n    let self = this\r\n    dataCodeRowArr.forEach((row) => {\r\n      self.performColFormulaSingle({ data, dataCodeRowMap, dataCodeRowArr, gradedSummaryFields, colFormulaConfig, tableId, calcColType, row })\r\n    })\r\n    return data\r\n  },\r\n  performColFormulaSingle({ data, dataCodeRowMap, dataCodeRowArr, gradedSummaryFields, colFormulaConfig, tableId, calcColType, row }) { // 执行 单条 行计算\r\n    // calcColType  执行  lastLevel:最底级，parent:父级 all:全部\r\n    if (this.isEmptyObj(colFormulaConfig)) {\r\n      return row\r\n    }\r\n    let self = this\r\n    switch (calcColType) {\r\n      case 'all': // 全部计算\r\n        self.reductionColFormula(colFormulaConfig, row)\r\n        break\r\n      case 'parent': // 仅计算父级\r\n        if (row['last__level'] === 1) {\r\n          self.reductionColFormula(colFormulaConfig, row)\r\n        } else if ((Array.isArray(row.children) && row.children.length) || (row['last__level'] !== 0)) {\r\n          self.reductionColFormula(self.getParentColFormulaConfig(self.deepCopy(colFormulaConfig), gradedSummaryFields), row)\r\n        } else {\r\n          self.reductionColFormula(colFormulaConfig, row)\r\n        }\r\n        break\r\n      case 'lastLevel': // 仅计算最低级\r\n        if (!(Array.isArray(row.children) && row.children.length) || (row['last__level'] !== 0)) {\r\n          self.reductionColFormula(colFormulaConfig, row)\r\n        }\r\n        break\r\n    }\r\n    return row\r\n  },\r\n  getParentColFormulaConfig(colFormulaConfig, gradedSummaryFields) { // 分级汇总后如果父级既有分级汇总 也有 计算 以分级汇总为主\r\n    gradedSummaryFields.forEach((item) => {\r\n      delete colFormulaConfig[item]\r\n    })\r\n    return colFormulaConfig\r\n  },\r\n  performGradedSummaryAll({ data, dataCodeRowMap, gradedSummaryFields, tableId }) { // 执行 数组分级汇总计算\r\n    if (!(Array.isArray(gradedSummaryFields) && gradedSummaryFields.length)) {\r\n      return data\r\n    }\r\n    let self = this\r\n    data.forEach((row) => {\r\n      self.performGradedSummarySingle({ row, gradedSummaryFields })\r\n    })\r\n    return data\r\n  },\r\n  performGradedSummarySingle({ row, data, gradedSummaryFields }) { // 执行 单条数据分级汇总计算\r\n    if (!(Array.isArray(gradedSummaryFields) && gradedSummaryFields.length)) {\r\n      return row\r\n    }\r\n    let self = this\r\n    if (Array.isArray(row.children) && row.children.length) {\r\n      gradedSummaryFields.forEach((key) => {\r\n        row[key] = row.children.reduce((preResult, next) => {\r\n          let curItemGradedSummaryValue = 0\r\n          if (Array.isArray(next.children) && next.children.length) {\r\n            curItemGradedSummaryValue = parseFloat(self.performGradedSummarySingle({ row: next, gradedSummaryFields })[key])\r\n          } else {\r\n            curItemGradedSummaryValue = parseFloat(next[key])\r\n          }\r\n          return preResult + (isNaN(curItemGradedSummaryValue) ? 0 : curItemGradedSummaryValue)\r\n        }, 0)\r\n      })\r\n    }\r\n    return row\r\n  },\r\n  performRowCodeFormula({ data, dataCodeRowMap, rowCodeFormulaConfig, tableId }) { // 执行 单元格交叉计算\r\n    this.reductionRowCodeFormula(rowCodeFormulaConfig, data, tableId)\r\n  },\r\n  performRowConstraintAll({ data, dataCodeRowMap, dataCodeRowArr, colConstraintConfig, tableId }) { // 执行 行内约束\r\n    this.genarateRowConstraintMapAll({ data, dataCodeRowMap, dataCodeRowArr, colConstraintConfig, tableId })\r\n  },\r\n  performCellConstraintAll({ data, dataCodeRowMap, rowCodeConstraintConfig, dataCodeRowArr, tableId }) { // 执行 单元格约束\r\n    this.genarateCellConstraintMapAll({ data, dataCodeRowMap, rowCodeConstraintConfig, dataCodeRowArr, tableId })\r\n  },\r\n  performRowConstraintSingle({ data, dataCodeRowMap, colConstraintConfig, dataCodeRowArr, tableId, row }) { // 执行 单条数据的行内约束\r\n    this.genarateRowConstraintMapSingle({ data, dataCodeRowMap, colConstraintConfig, tableId, row })\r\n  },\r\n  performCellConstraintSingle({ rowCodeConstraintConfig, data, dataCodeRowMap, tableId, row, column }) { // 执行 单条数据的行内约束\r\n    let { calcAndConstraintItemCodeField } = this.calculateConstraintConfigIn\r\n    let curCellConstraint = rowCodeConstraintConfig[row[calcAndConstraintItemCodeField] + ':' + (column.property || column.field)]\r\n    if (curCellConstraint) {\r\n      this.genarateCellConstraintMapSingle(dataCodeRowMap, curCellConstraint, tableId)\r\n    }\r\n  }\r\n}\r\nconst constraintTool = {\r\n  // 约束部分 行内约束\r\n  // 底级取数-->行计算-->分级汇总-->父级行计算-->单元格交叉计算-->约束\r\n  genarateRowConstraintMapAll({ colConstraintConfig, tableData, dataCodeRowMap, dataCodeRowArr, tableId }) {\r\n    // 生成约束map\r\n    let self = this\r\n    this.each(dataCodeRowArr, (rowIndex, row) => {\r\n      self.genarateRowConstraintMapSingle({ colConstraintConfig, row, tableId })\r\n    })\r\n  },\r\n  genarateRowConstraintMapSingle({ colConstraintConfig, row, tableId }) { // 生成单条数据约束map\r\n    let self = this\r\n    let { calcAndConstraintItemCodeField } = this.calculateConstraintConfigIn\r\n    self.constrainRowDataMap[row[calcAndConstraintItemCodeField]] = self.constrainRowDataMap[row[calcAndConstraintItemCodeField]] || {}\r\n    let dataMap = self.constrainRowDataMap[row[calcAndConstraintItemCodeField]]\r\n    this.each(colConstraintConfig, (key, item) => {\r\n      self.parsingRowConstraintConfigToMapData(colConstraintConfig[key], row, dataMap, tableId, colConstraintConfig)\r\n    })\r\n  },\r\n  parsingRowConstraintConfigToMapData(expression, row, dataMap, tableId, colConstraintConfig) { // 生成单条数据约束map\r\n    let self = this\r\n    expression.split('--&&--').forEach((item, index) => {\r\n      let rowConstraintArr = item.split('::')\r\n      dataMap[rowConstraintArr[0]] = dataMap[rowConstraintArr[0]] || {}\r\n      dataMap[rowConstraintArr[0]][rowConstraintArr[1]] = self.parsingRowConstraintConfigToValueData(rowConstraintArr[2], rowConstraintArr[1], row)\r\n      if (rowConstraintArr[1] === 'value' || rowConstraintArr[1] === 'clear') { // 如果a的值改变导致c的值改变，c的值改变又会改变其他，则递归调用\r\n        if (colConstraintConfig[rowConstraintArr[0]]) {\r\n          self.parsingRowConstraintConfigToValueData(colConstraintConfig[rowConstraintArr[0]], row, dataMap, tableId, colConstraintConfig)\r\n        }\r\n      }\r\n    })\r\n  },\r\n  parsingRowConstraintConfigToValueData(expression, type, row, tableId) {\r\n    // 生成当条age:1001:1001\r\n    // type: visible editble clear style value getData\r\n    let value = null\r\n    switch (type) {\r\n      case 'visible':\r\n        value = !!this.evalEpression(this.replaceRowEpressionValue(expression, row, tableId))\r\n        break\r\n      case 'editable':\r\n        value = !!this.evalEpression(this.replaceRowEpressionValue(expression, row, tableId))\r\n        break\r\n      case 'clear':\r\n        value = !!this.evalEpression(this.replaceRowEpressionValue(expression, row, tableId))\r\n        break\r\n      case 'value':\r\n        value = this.evalEpression(this.replaceRowEpressionValue(expression, row, tableId))\r\n        break\r\n      case 'style':\r\n        value = this.transExpressionToObject(this.pasingExpression(this.replaceRowEpressionValue(expression, row, tableId)), row)\r\n        break\r\n      case 'getData':\r\n        value = {}\r\n        break\r\n    }\r\n    return value\r\n  },\r\n  replaceRowEpressionValue(expression, row, tableId) {\r\n    let regR = new RegExp('({[a-zA-Z0-9_]*})', 'ig')\r\n    let rowsKey = expression.match(regR) || []\r\n    rowsKey = Array.from(new Set(rowsKey))\r\n    if (rowsKey.length) {\r\n      for (let keyC in rowsKey) {\r\n        let reg = new RegExp('(' + rowsKey[keyC].replace(/\\$/ig, '\\\\$') + ')', 'ig')\r\n        let keyF = rowsKey[keyC].replace(/\\{|\\}/g, '')\r\n        expression = expression.replace(reg, row[keyF] || 0)\r\n      }\r\n    }\r\n    return expression\r\n  },\r\n  evalEpression(expression) {\r\n    // 执行表达式\r\n    // eslint-disable-next-line no-new-func\r\n    return new Function('return ' + expression)()\r\n  },\r\n  pasingExpression(expression) {\r\n    let str = ''\r\n    try {\r\n      this.each(expression.split('--+--'), (index, item) => {\r\n        if (index === 0) {\r\n          str += 'if(' + item.split('--??--')[0] + '){return \"' + item.split('--??--')[1] + '\"}'\r\n        } else {\r\n          str += 'else if(' + item.split('--??--')[0] + '){return \"' + item.split('--??--')[1] + '\"}'\r\n        }\r\n      })\r\n      str += 'else{return \"\"}'\r\n      return new Function(str)()\r\n    } catch (e) {\r\n      console.error(e)\r\n      return ''\r\n    }\r\n  },\r\n  performRowConstraintAndRerender(row) {\r\n    // 执行当前行约束并重新渲染\r\n    let calcAndConstraintItemCodeField = this.calculateConstraintConfigIn.calcAndConstraintItemCodeField\r\n    if (this.calculateConstraintConfigIn.constraintConfig.row) {\r\n      this.constrainRowDataMap[row[calcAndConstraintItemCodeField]] = self.constrainRowDataMap[row[calcAndConstraintItemCodeField]] || {}\r\n      this.constrainRowDataMap[row[calcAndConstraintItemCodeField]] = self.genarateRowConstraintMap(self.deepCopy(this.calculateConstraintConfigIn.constraintConfig.row), row, self.constrainRowDataMap[row[calcAndConstraintItemCodeField]])\r\n      this.$refs.xGrid.refreshColumn()\r\n    }\r\n  },\r\n  transExpressionToObject(value) {\r\n    // 获取全部参数,并转换成json对象\r\n    try {\r\n      let valueArr = value.split('&')\r\n      let len = valueArr.length\r\n      let result = {}\r\n      for (let i = 0; i < len; i++) {\r\n        let pos = valueArr[i].indexOf('=')\r\n        if (pos === -1) {\r\n          continue\r\n        }\r\n        let name = valueArr[i].substring(0, pos)\r\n        result[name] = valueArr[i].substring(pos + 1).match(new RegExp('({[a-zA-Z0-9_:\\$]*})', 'ig')) ? this.evalEpression(valueArr[i].substring(pos + 1)) : valueArr[i].substring(pos + 1)\r\n      }\r\n      return result\r\n    } catch (e) {\r\n      console.error(e)\r\n      return {}\r\n    }\r\n  },\r\n  performConstraintAndRerender() {\r\n    // 执行约束并重新渲染\r\n    this.constrainRowDataMap = {}\r\n    this.genarateConstraintMap(this.calculateConstraintConfigIn.constraintConfig, this.getTableData().fullData)\r\n    this.$refs.xGrid.refreshColumn()\r\n  },\r\n  // 约束部分 单元格间约束\r\n  genarateCellConstraintMapAll({ rowCodeConstraintConfig, data, dataCodeRowMap, tableId }) {\r\n    let self = this\r\n    self.each(rowCodeConstraintConfig, (itemkey, item) => {\r\n      self.genarateCellConstraintMapSingle(dataCodeRowMap, item, tableId, rowCodeConstraintConfig)\r\n    })\r\n  },\r\n  genarateCellConstraintMapSingle(dataCodeRowMap, item, tableId, rowCodeConstraintConfig) {\r\n    let self = this\r\n    try {\r\n      let { constrainRowDataMap } = this\r\n      item.split('--&&--').forEach((item, index) => {\r\n        let rowConstraintArr = item.split('::')\r\n        let itemCodeFieldArr = rowConstraintArr[0].split(':')\r\n        constrainRowDataMap[itemCodeFieldArr[0]] = constrainRowDataMap[itemCodeFieldArr[0]] || {}\r\n        constrainRowDataMap[itemCodeFieldArr[0]][itemCodeFieldArr[1]] = constrainRowDataMap[itemCodeFieldArr[0]][itemCodeFieldArr[1]] || {}\r\n        constrainRowDataMap[itemCodeFieldArr[0]][itemCodeFieldArr[1]][rowConstraintArr[1]] = self.parsingCellConstraintConfigToValueData(rowConstraintArr[2], rowConstraintArr[1], dataCodeRowMap, tableId)\r\n        if (rowConstraintArr[1] === 'value' || rowConstraintArr[1] === 'clear') { // 如果a的值改变导致c的值改变，c的值改变又会改变其他，则递归调用\r\n          if (rowCodeConstraintConfig[itemCodeFieldArr[0] + ':' + itemCodeFieldArr[1]]) {\r\n            self.genarateCellConstraintMapSingle(dataCodeRowMap, rowCodeConstraintConfig[itemCodeFieldArr[0] + ':' + itemCodeFieldArr[1]], tableId, rowCodeConstraintConfig)\r\n          }\r\n        }\r\n      })\r\n    } catch (e) {\r\n      console.error(e)\r\n    }\r\n  },\r\n  parsingCellConstraintConfigToValueData(expression, type, dataCodeRowMap, tableId) {\r\n    // 生成当条age:1001:1001\r\n    // type: visible editble clear style value getData\r\n    let value = null\r\n    switch (type) {\r\n      case 'visible':\r\n        value = !!this.evalEpression(this.replaceCellEpressionValue(expression, dataCodeRowMap, tableId))\r\n        break\r\n      case 'editable':\r\n        value = !!this.evalEpression(this.replaceCellEpressionValue(expression, dataCodeRowMap, tableId))\r\n        break\r\n      case 'clear':\r\n        value = !!this.evalEpression(this.replaceCellEpressionValue(expression, dataCodeRowMap, tableId))\r\n        break\r\n      case 'value':\r\n        value = this.evalEpression(this.replaceCellEpressionValue(expression, dataCodeRowMap, tableId))\r\n        break\r\n      case 'style':\r\n        value = this.transExpressionToObject(this.pasingExpression(this.replaceCellEpressionValue(expression, dataCodeRowMap, tableId)), dataCodeRowMap)\r\n        break\r\n      case 'getData':\r\n        value = {}\r\n        break\r\n    }\r\n    return value\r\n  },\r\n  replaceCellEpressionValue(expression, dataCodeRowMap, tableId) {\r\n    try {\r\n      let self = this\r\n      let regR = new RegExp('({[a-zA-Z0-9_:\\$]*})', 'ig')\r\n      let rowsKey = expression.match(regR) || []\r\n      rowsKey = Array.from(new Set(rowsKey))\r\n      if (rowsKey.length) {\r\n        for (let keyCF in rowsKey) {\r\n          let formulaArr = rowsKey[keyCF].replace(/\\{|\\}/g, '').split(':')\r\n          let reg = new RegExp('({' + formulaArr.join(':').replace(/\\$/ig, '\\\\$') + '})', 'ig')\r\n          if (formulaArr[0] === tableId) {\r\n            if (dataCodeRowMap[formulaArr[2]]) {\r\n              expression = expression.replace(reg, self.getDataCodeRowMapCumulativeResult(dataCodeRowMap[formulaArr[2]], formulaArr[1]))\r\n            } else {\r\n              expression = expression.replace(reg, 0)\r\n            }\r\n          } else {\r\n            expression = expression.replace(reg, 0)\r\n          }\r\n        }\r\n      }\r\n      return expression\r\n    } catch (e) {\r\n      console.error(e)\r\n      return ''\r\n    }\r\n  },\r\n  updatedDataAfterConstraint({ data, constrainRowDataMap, dataCodeRowMap, dataCodeRowArr }) { // 更新表格数据\r\n    let self = this\r\n    let calcAndConstraintItemCodeField = this.calculateConstraintConfigIn.calcAndConstraintItemCodeField\r\n    self.each(dataCodeRowArr, (rowIndex, row) => {\r\n      let curRowConstrainRowDataMap = constrainRowDataMap[row[calcAndConstraintItemCodeField]]\r\n      self.each(curRowConstrainRowDataMap, (itemkey, item) => {\r\n        if (item.value !== undefined) {\r\n          row[itemkey] = item.value\r\n        } else if (item.clear) {\r\n          row[itemkey] = ''\r\n        } else {\r\n\r\n        }\r\n      })\r\n    })\r\n    return data\r\n  }\r\n}\r\nconst otherFn = {\r\n  getListData() {\r\n    // 获取表单数据\r\n    const { fullData } = this.$refs.xGrid.getTableData()\r\n    const data = fullData || []\r\n    return this.dealData(data)\r\n  },\r\n  dealData(data) {\r\n    let newData = []\r\n    data.forEach((item) => {\r\n      const itemVal = Object.assign({}, item)\r\n      Object.keys(itemVal).map((val) => {\r\n        let value = String(itemVal[val]) || ''\r\n        if (value.includes('initId')) {\r\n          const prefix = val.substr(0, val.indexOf('id'))\r\n          itemVal[val] = ''\r\n          itemVal[prefix + 'code'] = ''\r\n          itemVal[prefix + 'name'] = ''\r\n        }\r\n      })\r\n      newData.push(itemVal)\r\n    })\r\n    return newData\r\n  },\r\n  regTreePrefix(item) {\r\n    const reg = /\\w*_$/g\r\n    return reg.test(item)\r\n  },\r\n  // 遍历正则对象，给树统一自动添加正则\r\n  addTreeReg(formValidationConfig) {\r\n    const reg = /^(?!initId)/g\r\n    Object.keys(formValidationConfig).forEach((item) => {\r\n      if (this.regTreePrefix(item)) {\r\n        formValidationConfig[item][0].pattern = reg\r\n      }\r\n    })\r\n\r\n    return formValidationConfig\r\n  },\r\n  // 遍历，动态给树组件添加双向绑定的前缀\r\n  addTreePrefixKey2(treeData) {\r\n    const reg = /_id$/\r\n    let treeArr = treeData || []\r\n    treeArr.forEach((row) => {\r\n      Object.keys(row).forEach((item) => {\r\n        // 以_id结尾，并且其前缀在数据包中不存在时，动态给其绑定一个前缀\r\n        if (reg.test(item)) {\r\n          const prefix = item.substr(0, item.indexOf('id'))\r\n          if (!row.hasOwnProperty(prefix)) {\r\n            this.$set(row, prefix, '')\r\n          }\r\n        }\r\n      })\r\n    })\r\n    return treeData\r\n  },\r\n  // 递归总计带children的合计总和\r\n  loopAddSubTotal(total = 0, itemData = {}, property) {\r\n    if (itemData.children && itemData.children.length) {\r\n      itemData.children.forEach(it => {\r\n        total = otherFn.loopAddSubTotal(total, it, property)\r\n      })\r\n    }\r\n    let itVal = ((typeof (itemData[property]) === 'number' || typeof (itemData[property]) === 'string') && itemData[property] !== '') ? parseFloat(itemData[property].toString().split(',').join('')) : 0\r\n    total += Number(itVal)\r\n    return total\r\n  }\r\n}\r\nconst batchModify = { // 批量修改\r\n  onBatchModifyItemChange(obj, modifyForm) {\r\n    this.$emit('onBatchModifyItemChange', obj, modifyForm)\r\n  },\r\n  omBatchModifySureClick({ modifyItem, formData }) {\r\n    // 批量修改确认\r\n    const selection = this.selection\r\n    selection.forEach((row, index) => {\r\n      row = Object.assign(row, formData)\r\n    })\r\n    self.reCalcAndReLoadTableData({ data: this.getTableData().fullData, modifyItem, modifyData: formData }).then((obj) => {\r\n      self.$emit('onBatchModifySuccess', obj, self, self.$refs.xGrid)\r\n    })\r\n  }\r\n}\r\nconst exportAndImportFn = {\r\n  /**\r\n   * 导出数据行相关数据字段计算\r\n   * @description 金额列根据单位计算；进度百分比列添加'%'\r\n   * @params row {Object} 当前行数据\r\n   * @params moneyKeys {Array} 金额列field数组\r\n   * @params ratioKeys {Array} 进度列field数组\r\n   * */\r\n  computedExportRow(row, moneyKeys, ratioKeys) {\r\n    // 金额列根据单位进行计算\r\n    moneyKeys.forEach(key => {\r\n      row[key] = (row[key] && this.moneyUnit) ? (row[key] / this.moneyUnit) : ''\r\n    })\r\n    // 进度列增加%\r\n    // ratioKeys.forEach(key => {\r\n    //   row[key] = row[key] ? Number.prototype.toFixed.call(row[key], 1) : ''\r\n    // })\r\n  },\r\n  getPrintOption(exportModalFormData) {\r\n    const checkColumns = []\r\n    this.$XEUtils.eachTree(exportModalFormData.columns, column => {\r\n      const isColGroup = column.children && column.children.length\r\n      if (!isColGroup) {\r\n        checkColumns.push(column)\r\n      }\r\n    })\r\n    return {\r\n      data: exportModalFormData[exportModalFormData.dataType],\r\n      isHeader: true,\r\n      columns: checkColumns\r\n    }\r\n  },\r\n  onPrintClick(obj) {\r\n    this.$refs.xGrid.$refs.xTable.print(Object.assign({}, this.getPrintOption(obj)))\r\n    // this.$VXETable.print()\r\n  },\r\n  triggerExportOption(obj) {\r\n    // 触发导出动作\r\n    let self = this\r\n    const columns = this.deepCopy(this.tableColumnsConfig)\r\n    const { tableData, fullData, treeExpandData, selection } = this.getTableData()\r\n\r\n    // 获取金额、进度特殊字段列表\r\n    const [moneyKeys, ratioKeys] = [[], []]\r\n    this.$XEUtils.eachTree(columns, item => {\r\n      if (item?.type === 'money' || item.cellRender?.name === '$vxeMoney') {\r\n        moneyKeys.push(item.field)\r\n      } else if (item.cellRender?.name === '$vxeRatio') {\r\n        ratioKeys.push(item.field)\r\n      }\r\n    })\r\n    // 深拷贝，为后续计算真实值做准备\r\n    const [\r\n      computedFullData,\r\n      computedExpandData\r\n    ] = [\r\n      this.$XEUtils.clone(fullData, true),\r\n      this.$XEUtils.clone(treeExpandData, true)\r\n    ]\r\n    const fullDataTreeArr = XEUtils.toTreeArray(computedFullData)\r\n    const treeExpandDataTreeArr = XEUtils.toTreeArray(computedExpandData)\r\n\r\n    this.$XEUtils.eachTree(computedFullData, item => {\r\n      if (self.isTreeSeqToFlat) {\r\n        const findIndex = fullDataTreeArr.findIndex(it => it[rowUuidKeyName] === item[rowUuidKeyName])\r\n        item.seqIndex = fullDataTreeArr[0]?.id === '#' ? item.id === '#' ? '#' : findIndex : findIndex + 1\r\n      }\r\n      columns.forEach(colItem => { // 添加导出formatter字段的配置\r\n        if (colItem.exportFormatter) {\r\n          let field = colItem.field\r\n          if (Object.hasOwn(item, field) && item[colItem.field]) {\r\n            let newFormatterValue = colItem.formatter({ row: item })\r\n            Reflect.set(item, field, newFormatterValue)\r\n            return item\r\n          }\r\n        }\r\n      })\r\n      this.computedExportRow(item, moneyKeys, ratioKeys)\r\n    })\r\n\r\n    this.$XEUtils.eachTree(computedExpandData, item => {\r\n      if (self.isTreeSeqToFlat) {\r\n        const findIndex = treeExpandDataTreeArr.findIndex(it => it[rowUuidKeyName] === item[rowUuidKeyName])\r\n        item.seqIndex = treeExpandDataTreeArr[0]?.id === '#' ? item.id === '#' ? '#' : findIndex : findIndex + 1\r\n      }\r\n      columns.forEach(colItem => { // 添加导出formatter字段的配置\r\n        if (colItem.exportFormatter) {\r\n          let field = colItem.field\r\n          if (Object.hasOwn(item, field) && item[colItem.field]) {\r\n            let newFormatterValue = colItem.formatter({ row: item })\r\n            Reflect.set(item, field, newFormatterValue)\r\n            return item\r\n          }\r\n        }\r\n      })\r\n      this.computedExportRow(item, moneyKeys, ratioKeys)\r\n    })\r\n\r\n    const latestTableData = {\r\n      columns, // 表头配置\r\n      fullData: computedFullData, // 使用计算后的fullData\r\n      tableData,\r\n      treeExpandData: computedExpandData, // 使用计算后的expendData\r\n      selection\r\n    }\r\n    this.exportModalData = Object.assign({\r\n      isExportTree: !!self.treeConfigIn,\r\n      saveType: '.xlsx',\r\n      fileName: 'export', // 文件名\r\n      dataType: !self.treeConfigIn ? 'fullData' : 'fullData',\r\n      isExportHead: true, // 是否导出表头\r\n      isExportFooter: false, // 是否导出表尾部\r\n      isExportOnlySourceField: false, // 是否只导出数据源表头字段，\r\n      isExportOnlyViewTitle: false, // 是否只导出数据表头名称，\r\n      isExportOriginalData: false, // 是否导出源数据\r\n      isExportData: true, // 是否导出数据\r\n      columns: columns, // 表头配置\r\n      fullData: fullData,\r\n      tableData: tableData,\r\n      treeExpandData: treeExpandData,\r\n      datas: [], // 源数据, 如果胃空数组则取dataType 对应的数据，否则直接以datas导出\r\n      selection: selection, // 选中数据\r\n      index: true, // 是否添加序号,\r\n      ignoreColsTypes: [\r\n        'dragSort',\r\n        'seq',\r\n        'checkbox',\r\n        'radio',\r\n        'optionRow',\r\n        'expand',\r\n        'attach',\r\n        'ach',\r\n        'list',\r\n        'attachlist'\r\n      ], // 忽略导出的列类型\r\n      viewValueFormat(value, row, column) {\r\n        // 视图数据格式化方法\r\n        // return value\r\n      }\r\n    }, this.tableGlobalConfig.customExportConfig, this.exportModalData || {}, obj || {}, latestTableData)\r\n    this.exportModalVisible = true\r\n  },\r\n  onExportClick(obj, ec) {\r\n    // 确定导出点击事件\r\n    obj.successCb = () => {\r\n      this.exportModalVisible = false\r\n    }\r\n    if (obj.onlyConfigExport) {\r\n      this.$emit('onExportClick', obj, ec)\r\n    } else {\r\n      console.log(obj)\r\n      this.$Export.exportExcel(obj, this)\r\n    }\r\n  },\r\n  dealExportViewData(obj = {\r\n    conlums: [],\r\n    viewData: []\r\n  }) {\r\n    // 处理 导入数据\r\n    let self = this\r\n    let { viewToSourceMap, tableColumnsTitleFieldMap, rowsObjTemp, colFormulaConfigm, colFormulaConfig } = this.generateColumnsAllMap(obj.conlums)\r\n    return obj.viewData.map((row, rowIndex) => {\r\n      Object.keys(row).map((key, keyIndex) => {\r\n        row[tableColumnsTitleFieldMap[key]] = self.reverseParseViewDataTosource(viewToSourceMap[tableColumnsTitleFieldMap[key]], row[key])\r\n      })\r\n      row = Object.assign({}, rowsObjTemp, row)\r\n      return this.reductionColFormula(colFormulaConfigm, self.reductionColFormula(colFormulaConfig, row))\r\n    })\r\n  },\r\n  deaImportViewData(obj = {\r\n    conlums: [],\r\n    viewData: [],\r\n    valiRules: {}\r\n  }) {\r\n    // 处理 导入数据\r\n    let self = this\r\n    let { viewToSourceMap, tableColumnsTitleFieldMap, tableColumnsFieldMap, rowsObjTemp, colFormulaConfig } = this.generateColumnsAllMap(obj.conlums)\r\n    let validResult = true\r\n    let validResultFieldTitle = []\r\n    let formatData = false\r\n    // let valiRule = []\r\n    if (process.env.VUE_APP_CONF_ISHB) {\r\n      let valiRule = {}\r\n      obj.viewData.map((row, rowIndex) => {\r\n        for (let key in tableColumnsFieldMap) {\r\n          let column = tableColumnsFieldMap[key]\r\n          let flag = false\r\n          // 每一列不重复校验\r\n          let fieldValue = row[column.title]\r\n          let field = column.field\r\n          if (column.required) {\r\n            // 必填\r\n            if (field === 'pay_amt' || field === 'pay_app_amt' || field === 'xpay_amt') {\r\n              // 金额需大于0\r\n              if (!fieldValue || isNaN(fieldValue) || row[field] * 1 < 0) {\r\n                flag = true\r\n                let msg = `第${rowIndex + 1}行${column.title}需为大于0的数字`\r\n                this.collectValidError(valiRule, rowIndex, field, column, msg)\r\n              }\r\n            } else {\r\n              if (!fieldValue) {\r\n                flag = true\r\n                this.collectValidError(valiRule, rowIndex, field, column, `第${rowIndex + 1}行${column.title}为必填项`)\r\n              }\r\n            }\r\n          }\r\n          if (column.reg && !flag) {\r\n            let value = fieldValue\r\n            if (!column.reg.test(value)) {\r\n              flag = true\r\n              this.collectValidError(valiRule, rowIndex, field, column, `第${rowIndex + 1}行${column.msg}`)\r\n            }\r\n          }\r\n          if (column.validator && typeof (column.validator) === 'function' && !flag) {\r\n            let data = row\r\n            let res = column.validator.call(this, data)\r\n            if (!res.result) {\r\n              this.collectValidError(valiRule, rowIndex, field, column, `第${rowIndex + 1}行${res.msg}`)\r\n            }\r\n          }\r\n          // 校验规则\r\n          if (obj.valiRules) {\r\n            let valiRules = Object.keys(obj.valiRules)\r\n            if (valiRules && valiRules.length > 0) {\r\n              if (fieldValue) {\r\n                valiRules.forEach(ruleField => {\r\n                  if (ruleField === field) {\r\n                    let reg = obj.valiRules[ruleField]\r\n                    if (reg instanceof RegExp) {\r\n                      let r = new RegExp(reg)\r\n                      if (!r.test(fieldValue)) {\r\n                        this.collectValidError(valiRule, rowIndex, field, column, `第${rowIndex + 1}行${obj.valiRules[ruleField + '_msg']}`)\r\n                      }\r\n                    } else if (reg instanceof Function) {\r\n                      let res = reg.call(this, fieldValue, row, column.title)\r\n                      if (res && !res.result) {\r\n                        this.collectValidError(valiRule, rowIndex, field, column, `第${rowIndex + 1}行${res.msg}`)\r\n                      }\r\n                    }\r\n                  }\r\n                })\r\n              }\r\n            }\r\n          }\r\n        }\r\n      })\r\n      if (Object.keys(valiRule).length > 0) {\r\n        return {\r\n          result: false,\r\n          valiRule: valiRule\r\n        }\r\n      }\r\n      this.importModalVisible = false\r\n    }\r\n    let viewData = obj.viewData.map((row, rowIndex) => {\r\n      Object.keys(row).forEach((key, keyIndex) => {\r\n        let parseViewValue = self.reverseParseViewDataTosource(viewToSourceMap[tableColumnsTitleFieldMap[key]], row[key])\r\n        // const customVal = String(parseViewValue).replace(/null|undefined|\\s+/ig, '') !== ''\r\n        if (tableColumnsFieldMap[tableColumnsTitleFieldMap[key]]) {\r\n          // self.validCellRules({ type: 'all', row, column: tableColumnsFieldMap[tableColumnsTitleFieldMap[key]], val: parseViewValue, valiRules: obj.valiRules })\r\n          //   .then(() => {\r\n          //     if (customVal) {\r\n          row[tableColumnsTitleFieldMap[key]] = parseViewValue\r\n          if (tableColumnsTitleFieldMap[key] === 'iname') {\r\n            row['itemcode'] = parseViewValue.split('-')[0].replace(/\\s+/ig, '')\r\n          }\r\n          //   }\r\n          // })\r\n          // .catch(({ rule }) => {\r\n          //   validResult = false\r\n          //   valiRule.push(rule)\r\n          //   if (customVal) {\r\n          //     row[tableColumnsTitleFieldMap[key]] = parseViewValue\r\n          //   }\r\n          // })\r\n        } else {\r\n          if (key !== '序号' || key !== 'seqIndex') {\r\n            validResultFieldTitle.push(key)\r\n          }\r\n        }\r\n      })\r\n      row = Object.assign({}, rowsObjTemp, row)\r\n      formatData = true\r\n      return this.reductionColFormula(colFormulaConfig, self.reductionColFormula(colFormulaConfig, row))\r\n    })\r\n    if (formatData) return viewData\r\n    self.reductionRowCodeFormula(this.calculateConstraintConfigIn.rowCodeFormulaConfig, viewData, self.id)\r\n    return validResult && !validResultFieldTitle.length && viewData\r\n  },\r\n  reverseParseViewDataTosource(viewToSourceMap, value) {\r\n    // 处理单个 导入数据\r\n    //  needMap: true,\r\n    //  name: itemRender.name,\r\n    //  options: Array.isArray(itemRender.options) ? itemRender.options : [],\r\n    //  multiple: true,\r\n    //  formula: conlum.formula\r\n    if (viewToSourceMap && viewToSourceMap.needMap) {\r\n      let transValue = ''\r\n      let viewValue = typeof (value) === 'string' ? value : ''\r\n      if (viewToSourceMap.multiple) {\r\n        if (viewValue.length) {\r\n          let viewToSourceValueArr = []\r\n          viewToSourceMap.options.forEach((item, index) => {\r\n            if (viewValue.indexOf(item.label) >= 0) {\r\n              viewToSourceValueArr.push(item.value)\r\n            }\r\n          })\r\n          transValue = viewToSourceValueArr.join(',')\r\n        } else {\r\n          transValue = ''\r\n        }\r\n      } else {\r\n        viewToSourceMap.options.forEach((item, index) => {\r\n          if (viewValue.indexOf(item.label) >= 0) {\r\n            transValue = item.value\r\n          }\r\n        })\r\n      }\r\n      return transValue\r\n    } else {\r\n      return value + ''.replace(/null|NaN|undefined|,/ig, '')\r\n    }\r\n  },\r\n  newRule(rule) {\r\n    // 错误规则信息\r\n    return Object.assign({}, {\r\n      $options: rule,\r\n      required: rule.required,\r\n      min: rule.min,\r\n      max: rule.min,\r\n      type: rule.type,\r\n      pattern: rule.pattern,\r\n      validator: rule.validator,\r\n      maxWidth: rule.maxWidth,\r\n      message: rule.message\r\n    })\r\n  },\r\n  validCellRules(argObj) {\r\n    // 校验单元格\r\n    let self = this\r\n    const { type, row, column, val, valiRules } = argObj\r\n    const property = column.field\r\n    const errorRules = []\r\n    const syncVailds = []\r\n    if (property && valiRules) {\r\n      const rules = self.$XEUtils.get(valiRules, property)\r\n      if (rules) {\r\n        const cellValue = val\r\n        // const cellValue = self.$XEUtils.isUndefined(val) ? self.$XEUtils.get(row, property) : val\r\n        rules.forEach(rule => {\r\n          if (type === 'all') {\r\n            if (self.$XEUtils.isFunction(rule.validator)) {\r\n              let customValid\r\n              customValid = rule.validator({\r\n                cellValue,\r\n                rule,\r\n                rules,\r\n                row,\r\n                rowIndex: row.index,\r\n                column,\r\n                $table: this\r\n              })\r\n              if (customValid) {\r\n                if (self.$XEUtils.isError(customValid)) {\r\n                  this.validRuleErr = true\r\n                  errorRules.push(self.newRule({ type: 'custom', message: customValid.message, rule: self.newRule(rule) }))\r\n                } else if (customValid.catch) {\r\n                  // 如果为异步校验（注：异步校验是并发无序的）\r\n                  syncVailds.push(\r\n                    customValid.catch(e => {\r\n                      this.validRuleErr = true\r\n                      errorRules.push(self.newRule({ type: 'custom', message: e ? e.message : rule.message, rule: self.newRule(rule) }))\r\n                    })\r\n                  )\r\n                }\r\n              }\r\n            } else {\r\n              const isNumber = rule.type === 'number'\r\n              const numVal = isNumber ? self.$XEUtils.toNumber(cellValue) : self.$XEUtils.getSize(cellValue)\r\n              if (rule.required && (cellValue === null || cellValue === undefined || cellValue === '')) {\r\n                this.validRuleErr = true\r\n                errorRules.push(self.newRule(rule))\r\n              } else if (\r\n                (isNumber && isNaN(cellValue)) ||\r\n                (!isNaN(rule.min) && numVal < parseFloat(rule.min)) ||\r\n                (!isNaN(rule.max) && numVal > parseFloat(rule.max)) ||\r\n                (rule.pattern && !(rule.pattern.test ? rule.pattern : new RegExp(rule.pattern)).test(cellValue))\r\n              ) {\r\n                this.validRuleErr = true\r\n                errorRules.push(self.newRule(rule))\r\n              }\r\n            }\r\n          }\r\n        })\r\n      }\r\n    }\r\n    return Promise.all(syncVailds).then(() => {\r\n      if (errorRules.length) {\r\n        const rest = { rules: errorRules, rule: errorRules[0] }\r\n        return Promise.reject(rest)\r\n      }\r\n    })\r\n  },\r\n  exportByTempalte(obj = {\r\n    data: [], // 模版数据，只拿第一行导出列配置\r\n    conlums: [] // 所有表头\r\n  }) {\r\n    // 按模版导出\r\n    let exportConlums = []\r\n    let exportConlumsTitle = obj.data[0]\r\n    const { tableColumnsTitleMap } = this.generateColumnsAllMap(obj.conlums)\r\n    exportConlumsTitle.forEach((item, index) => {\r\n      tableColumnsTitleMap[item] && exportConlums.push(tableColumnsTitleMap[item])\r\n    })\r\n    const fullData = this.getTableData().fullData\r\n    const selection = this.selection\r\n    this.$Export.exportExcel({\r\n      isExportTree: true,\r\n      saveType: '.xlsx',\r\n      fileName: 'export', // 文件名\r\n      dataType: 'fullData',\r\n      isExportHead: true, // 是否导出表头\r\n      isExportFooter: false, // 是否导出表尾部\r\n      isExportOnlySourceField: false, // 是否只导出数据源表头字段，\r\n      isExportOnlyViewTitle: false, // 是否只导出数据表头名称，\r\n      isExportOriginalData: false, // 是否导出源数据\r\n      isExportData: true, // 是否导出数据\r\n      columns: exportConlums, // 表头配置\r\n      fullData: fullData,\r\n      datas: [], // 源数据,\r\n      selection: selection, // 选中数据\r\n      index: true // 是否添加序号,\r\n    }, this)\r\n  },\r\n  downLoadImportTemplate(obj, tabPanal) {\r\n    // 下载导入模版\r\n    const tableColumnsConfig = this.tableColumnsConfig\r\n    this.$Export.exportExcel({\r\n      saveType: '.xlsx',\r\n      fileName: '导入模版', // 文件名\r\n      dataType: 'fullData',\r\n      isExportOnlyViewTitle: true, // 是否只导出数据源表头字段，\r\n      columns: tableColumnsConfig, // 表头配置\r\n      index: false // 是否添加序号,\r\n    }, this)\r\n  },\r\n  triggerImportOption(config = {}) {\r\n    // 触发导入\r\n    this.importConfig = config\r\n    this.importModalVisible = true\r\n  },\r\n  triggerDownloadTemplate(obj) {\r\n    this.onDownloadTemplateClick(obj)\r\n  },\r\n  onDownloadTemplateClick(obj) {\r\n    // 下载模版\r\n    if (typeof (this.importConfig.downloadTemplateCallback) === 'function') {\r\n      this.importConfig.downloadTemplateCallback(this.importData)\r\n    } else {\r\n      this.importData = []\r\n      const columns = this.tableColumnsConfig\r\n      const selection = this.selection\r\n      let defaultConfig = {\r\n        isExportTree: !!self.treeConfigIn,\r\n        saveType: '.xlsx',\r\n        fileName: 'importTempplate', // 文件名\r\n        dataType: 'fullData',\r\n        isExportOnlySourceField: true, // 是否只导出数据源表头字段，\r\n        isExportOnlyViewTitle: false, // 是否只导出数据表头名称，\r\n        isExportHead: true, // 是否导出表头\r\n        exportViewTitleType: 'nestTitle',\r\n        isExportFooter: false, // 是否导出表尾部\r\n        isExportOriginalData: true, // 是否导出源数据\r\n        isExportData: true, // 是否导出数据\r\n        columns: columns, // 表头配置\r\n        datas: [], // 源数据,\r\n        selection: selection, // 选中数据\r\n        index: true, // 是否添加序号,\r\n        ignoreColsTypes: [\r\n          'dragSort',\r\n          'seq',\r\n          'checkbox',\r\n          'radio',\r\n          'optionRow',\r\n          'expand',\r\n          'attach',\r\n          'ach',\r\n          'list',\r\n          'attachlist'\r\n        ] // 忽略导出的列类型\r\n      }\r\n      this.$Export.exportExcel(obj ? Object.assign(defaultConfig, obj) : obj, this)\r\n    }\r\n  },\r\n  async onImportFileClick() {\r\n    // 导入文件\r\n    let self = this\r\n    await this.$Import.importExcel({\r\n    }, (result, filename) => {\r\n      // this.tableDataIn = result\r\n      self.importData = result\r\n      self.fileConfig.fileName = filename\r\n    })\r\n  },\r\n  onImportClick() {\r\n    // 导入提交\r\n    if (!this.importData.length) {\r\n      this.$XModal.message({ status: 'error', message: '无数据导入请重新导入数据！' })\r\n    } else {\r\n      this.importModalVisible = false\r\n      if (typeof (this.importConfig.importSuccessCallback) === 'function') {\r\n        this.importConfig.importSuccessCallback(this.importData)\r\n      } else {\r\n        this.$emit('importSuccessCallback', this.importData)\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n// 设置column金额过滤\r\nconst useMoneyFilter = {\r\n  setColumnMoneyFilter (columns) {\r\n    columns?.forEach(column => {\r\n      const flag = column.cellRender?.name === '$vxeMoney' || column.type === 'money'\r\n        ? (this.tableConfig.globalConfig?.useMoneyFilter && column.useMoneyFilter !== false) || column.useMoneyFilter\r\n        : false\r\n\r\n      if (flag) {\r\n        Object.assign(column, getColumnMoneyFilterConfig(column))\r\n      }\r\n      column.children && this.setColumnMoneyFilter(column.children)\r\n    })\r\n  }\r\n}\r\n\r\nexport default {\r\n  ...util, // 工具类\r\n  ...sortMethods, // 排序\r\n  ...axiosEvent, // 请求\r\n  ...initMethods, // prop更新方法以及初始化函数\r\n  ...registFn, // 渲染注册函数\r\n  ...tableEventFn, // 表格事件\r\n  ...toolBarEvent, // toolbar事件\r\n  ...pageEvent, // 分页事件\r\n  ...formatters, // 全局formatter函数\r\n  ...tableOptionFn, // 表格操作函数\r\n  ...proxyFn, // 代理函数\r\n  ...tableEvent, // 表格事件\r\n  ...otherFn, // 其他函数\r\n  ...batchModify, // 批量修改\r\n  ...calculateTool, // 单元格计算\r\n  ...calcAndConstraint, // 计算约束部分\r\n  ...constraintTool, // 约束解析\r\n  ...exportAndImportFn, // 导入导出工具类\r\n  ...useMoneyFilter // 金额筛选\r\n}\r\n"],"mappings":"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"}]}