{"remainingRequest":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\何小龙\\Desktop\\platformweb-fb\\src\\views\\main\\monitProcFeedback\\monitProcFeedback.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\src\\views\\main\\monitProcFeedback\\monitProcFeedback.vue","mtime":1694576553946},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCg0KLyogLmNyZWF0ZVByb2Nlc3NpbmcgLnJhZGlvLXJpZ2h0ew0KZmxvYXQ6IHJpZ2h0Ow0KfQ0KLmNyZWF0ZVByb2Nlc3NpbmcgLlRpdGFucy10YWJsZSA6OnYtZGVlcCAgLnZ4ZS1ib2R5LS1yb3cucm93LXllbGxvdyB7DQogIGJhY2tncm91bmQtY29sb3I6IHllbGxvdzsNCiAgY29sb3I6ICNmZmY7DQp9DQouY3JlYXRlUHJvY2Vzc2luZyAuVGl0YW5zLXRhYmxlIDo6di1kZWVwICAudnhlLWJvZHktLXJvdy5yb3ctYmx1ZSB7DQogIGJhY2tncm91bmQtY29sb3I6IGJsdWU7DQogIGNvbG9yOiAjZmZmOw0KfQ0KLmNyZWF0ZVByb2Nlc3NpbmcgLlRpdGFucy10YWJsZSA6OnYtZGVlcCAgLnZ4ZS1ib2R5LS1yb3cucm93LXJlZCB7DQogIGJhY2tncm91bmQtY29sb3I6IHJlZDsNCiAgY29sb3I6ICNmZmY7DQp9DQogLmNyZWF0ZVByb2Nlc3NpbmcgLnVuaXQtdHJlZS1tYWluIC5lbC10cmVlLW5vZGVfX2NvbnRlbnQgLmN1c3RvbS1ub2RlLWJnew0KICBiYWNrZ3JvdW5kLWNvbG9yOiB0cmFuc3BhcmVudCAhaW1wb3J0YW50Ow0KfSAqLw0K"},{"version":3,"sources":["monitProcFeedback.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4vBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"monitProcFeedback.vue","sourceRoot":"src/views/main/monitProcFeedback","sourcesContent":["<!-- 预警明细查询（按规则） -->\r\n<template>\r\n  <div v-loading=\"tableLoading\" style=\"height: 100%\" class=\"createProcessing\">\r\n    <BsMainFormListLayout :default-split-pane-left-width=\"14\">\r\n      <template v-slot:topTap>\r\n      </template>\r\n      <template v-slot:topTabPane>\r\n        <BsTabPanel\r\n          ref=\"tabPanel\"\r\n          is-open\r\n          is-hide-query\r\n          :tab-status-btn-config=\"queryConfigInfo\"\r\n          :tab-status-num-config=\"tabStatusNumConfig\"\r\n          @onQueryConditionsClick=\"(open) => isShowQueryConditions = open\"\r\n          @btnClick=\"onTabPanelBtnClick\"\r\n        />\r\n      </template>\r\n      <template v-slot:query>\r\n        <BsQuery\r\n          ref=\"queryFrom\"\r\n          :query-form-item-config=\"queryConfig\"\r\n          :query-form-data=\"queryData\"\r\n          @onSearchClick=\"mainPagerConfig.page = 1,onSearch()\"\r\n          @onSearchResetClick=\"reset(),onSearch()\"\r\n          @itemChange=\"itemChange\"\r\n        />\r\n      </template>\r\n      <template v-slot:mainForm>\r\n        <BsTable\r\n          ref=\"mainTableRef\"\r\n          :footer-config=\"tableFooterConfig\"\r\n          :table-columns-config=\"tableColumnsConfig\"\r\n          :table-data=\"tableData\"\r\n          :table-config=\"tableConfig\"\r\n          :pager-config=\"mainPagerConfig\"\r\n          :toolbar-config=\"tableToolbarConfig\"\r\n          :cell-style=\"cellStyle\"\r\n          @onToolbarBtnClick=\"onToolbarBtnClick\"\r\n          @ajaxData=\"ajaxTableData\"\r\n          @cellClick=\"cellClick\"\r\n        >\r\n          <template v-slot:toolbarSlots>\r\n            <div class=\"table-toolbar-left\">\r\n              <div class=\"table-toolbar-contro-leftvisible\"></div>\r\n              <div class=\"table-toolbar-left-title\">\r\n                <span class=\"fn-inline\">{{ menuName }}</span>\r\n                <i class=\"fn-inline\"></i>\r\n              </div>\r\n            </div>\r\n          </template>\r\n        </BsTable>\r\n      </template>\r\n    </BsMainFormListLayout>\r\n    <BsOperationLog :logs-data=\"logData\" :show-log-view=\"showLogView\" />\r\n    <MonitProcFeedbackModal v-if=\"showModal\" ref=\"MonitProcFeedbackModal\" @close=\"showModal = false\" />\r\n    <AddDialog\r\n      v-if=\"dialogVisible\"\r\n      :title=\"dialogTitle\"\r\n      :param5=\"menuSettingConfig\"\r\n      :warning-code=\"warningCode\"\r\n      :fi-rule-code=\"fiRuleCode\"\r\n    />\r\n    <el-dialog title=\"确定要撤销选中数据吗？\" width=\"600px\" :visible.sync=\"dialogTableVisible\">\r\n      <div slot=\"footer\" class=\"dialog-footer\">\r\n        <el-input v-model=\"drawInformation\" type=\"textarea\" :rows=\"2\" placeholder=\"请输入内容\" />\r\n        <el-button v-deClick type=\"primary\" @click=\"mulWithdraw\">确定</el-button>\r\n      </div>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n// import { proconf } from './createProcessing'\r\nimport HttpModule from '@/api/frame/main/Monitoring/WarningDetailsByCompartment.js'\r\nimport api from '@/api/frame/main/fundMonitoring/createProcessing.js'\r\nimport MonitProcFeedbackModal from './monitProcFeedbackModal.vue'\r\nimport loadBsConfig from '@/views/main/dynamicTableSetting/config'\r\nimport AddDialog from '@/views/main/fundMonitoring/violationHandle/createProcessing/children/addDialog.vue'\r\nexport default {\r\n  mixins: [loadBsConfig],\r\n  components: {\r\n    MonitProcFeedbackModal,\r\n    AddDialog\r\n  },\r\n  computed: {\r\n    menuSettingConfig() {\r\n      return { ...this.transJson(this.$store.state.curNavModule.param5), hide: 1 }\r\n    },\r\n    userInfo() {\r\n      return this.$store.state.userInfo\r\n    }\r\n  },\r\n  watch: {\r\n\r\n  },\r\n  data() {\r\n    return {\r\n      configTypeId: {},\r\n      dialogTableVisible: false,\r\n      drawInformation: '',\r\n      // BsQuery 查询栏\r\n      showModal: false,\r\n      queryConfig: [],\r\n      queryData: {\r\n        roleId: this.$store.state.curNavModule.roleguid,\r\n        regulationClass: this.transJson(this.$store.state.curNavModule.param5).regulationClass,\r\n        regulationClassName: this.transJson(this.$store.state.curNavModule.param5).regulationClassName,\r\n        menuId: this.$store.state.curNavModule.guid,\r\n        isNormalDone: false,\r\n        flowStatus: '1-4', // 待审批\r\n        isProcessed: false,\r\n        isAgencyDone: false,\r\n        mofDivCodeList: [],\r\n        agencyCodeList: []\r\n      },\r\n      treeData: [],\r\n      createDataList: {},\r\n      tabStatusNumConfig: {},\r\n      queryConfigInfo: {},\r\n      // 头部工具栏 BsTabPanel config\r\n      toolBarStatusBtnConfig: {\r\n        methods: {\r\n          bsToolbarClickEvent: this.onStatusTabClick\r\n        },\r\n        changeBtns: true\r\n      },\r\n      isShowQueryConditions: false,\r\n      toolBarStatusSelect: {\r\n        type: 'button',\r\n        iconName: 'base-all.png',\r\n        iconNameActive: 'base-all-active.png',\r\n        iconUrl: '',\r\n        label: '全部',\r\n        code: '1',\r\n        curValue: '1'\r\n      },\r\n      // table 相关配置\r\n      tableLoading: false,\r\n      tableColumnsConfig: [],\r\n      tableData: [],\r\n      tableToolbarConfig: {\r\n        // table工具栏配置\r\n        disabledMoneyConversion: false,\r\n        moneyConversion: false, // 是否有金额转换\r\n        import: false, // 导入\r\n        export: true, // 导出\r\n        print: false, // 打印\r\n        zoom: true, // 缩放\r\n        custom: true, // 选配展示列\r\n        slots: {\r\n          tools: 'toolbarTools',\r\n          buttons: 'toolbarSlots'\r\n        }\r\n      },\r\n      mainPagerConfig: {\r\n        total: 0,\r\n        currentPage: 1,\r\n        pageSize: 20\r\n      },\r\n      tableConfig: {\r\n        renderers: {\r\n          // 修改 配置 下发 删除\r\n          $customerRender: {\r\n            renderDefault: (h, cellRender, { row, rowIndex }, context) => {\r\n              let vnode = (\r\n                <div>\r\n                  <el-button type=\"primary\" size=\"mini\" onClick={() => this.handleRowClick(row)}>查看详情</el-button>\r\n                  <el-button type=\"primary\" size=\"mini\" onClick={() => this.showLogModel(row)}>查看日志</el-button>\r\n                </div>\r\n              )\r\n              // {this.queryData.flowStatus === '2' ? <el-button type=\"primary\" size=\"mini\" onClick={() => this.withdraw(row)}>撤回</el-button> : ''}\r\n              return [\r\n                vnode\r\n              ]\r\n            }\r\n          },\r\n          $customerWarnLevel: {\r\n            renderDefault: (h, cellRender, { row, rowIndex }, context) => {\r\n              if (row.warnLevel) {\r\n                return [\r\n                  <div class={'warningLevel' + row.warnLevel} size=\"mini\" >{this.$store.state.warnInfo.warnLevelOptions.find(item => item.warnLevel === row.warnLevel)?.label}</div>\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      tableFooterConfig: {\r\n        showFooter: false\r\n      },\r\n      // 操作日志\r\n      logData: [],\r\n      showLogView: false,\r\n      // 请求 & 角色权限相关配置\r\n      menuName: '',\r\n      // userInfo: {},\r\n      roleguid: this.$store.state.curNavModule.roleguid,\r\n      // 文件\r\n      showAttachmentDialog: false,\r\n      showGlAttachmentDialog: false,\r\n      detailData: [],\r\n      codeList: [],\r\n      // 查看详情传参\r\n      warningCode: '',\r\n      dialogVisible: false,\r\n      dialogTitle: '',\r\n      fiRuleCode: ''\r\n      // -----\r\n    }\r\n  },\r\n  activated() {\r\n    this.updateRegulationClassNameFormConfig()\r\n  },\r\n  methods: {\r\n    handleRowClick(row) {\r\n      console.log('点击每行的方法', row)\r\n      this.fiRuleCode = row.fiRuleCode || ''\r\n      this.warningCode = row.warningCode || ''\r\n      this.dialogVisible = true\r\n      this.dialogTitle = '查看详情信息'\r\n    },\r\n    showLogModel(row) {\r\n      this.showLogView = true\r\n      this.queryActionLog(row)\r\n    },\r\n    // 操作日志\r\n    queryActionLog(row) {\r\n      let params2 = row.dealNo\r\n      // let params = { warningCode: row.warningCode }\r\n      // api.workFlowGetLogs(params).then(res => {\r\n      api.getLogs(params2).then(res => {\r\n        if (res.code === '000000') {\r\n          let tempData = res.data.map(item => {\r\n            return {\r\n              logid: item['logid'],\r\n              nodeName: item['nodeName'],\r\n              actionUser: item['operationUser'],\r\n              actionName: item['operationTypeName'],\r\n              actionTime: item['createdTime'] == null ? '' : item['createdTime'],\r\n              message: item['operationComment']\r\n            }\r\n          })\r\n          // this.logData = res.data\r\n          this.logData = tempData\r\n          console.log(this.logData)\r\n          this.showLogView = true\r\n        } else {\r\n          this.$message.error(res.message)\r\n        }\r\n      })\r\n    },\r\n    updateRegulationClassNameFormConfig () {\r\n      // 如果菜单参数有主题 当前模块就使用该主题查询\r\n      if (this.transJson(this.$store.state.curNavModule.param5)?.regulationClass) {\r\n        const index = this.queryConfig.findIndex(item => item.field === 'regulationClassName')\r\n        index > -1 && this.queryConfig?.splice(index, 1)\r\n      }\r\n    },\r\n    itemChange(changeEvent) {\r\n      console.log('change', changeEvent)\r\n      // 因为无法预知是否配置了预算单位搜索和区划搜索栏 所以暂时用这种处理单位搜索和区划搜索栏\r\n      if (changeEvent.property === 'mofDivCodes' || changeEvent.property === 'mofDivCodeList') {\r\n        this.queryData['mofDivCodeList'] = changeEvent.data[`${changeEvent.property}_code__multiple`]\r\n      } else if (changeEvent.property === 'agencyCodeList') {\r\n        this.queryData['agencyCodeList'] = changeEvent.data[`${changeEvent.property}_code__multiple`]\r\n      }\r\n    },\r\n    onSearch() {\r\n      let formData = this.$refs.queryFrom.getFormData()\r\n      let queryConfigSearchData = {}\r\n      if (this.queryConfig && this.queryConfig.length) {\r\n        this.queryConfig.forEach(item => {\r\n          // 因为无法预知是否配置了预算单位搜索和区划搜索栏 所以暂时用这种处理单位搜索和区划搜索栏\r\n          if (item.field !== 'mofDivCodeList' && item.field !== 'agencyCodeList' && item.field !== 'mofDivCodesList') {\r\n            queryConfigSearchData[item.field] = formData[item.field]\r\n          }\r\n        })\r\n      }\r\n      this.queryData = { ...this.queryData, ...queryConfigSearchData }\r\n      this.queryTableDatas()\r\n    },\r\n    // 初始化高级查询data\r\n    getSearchDataList() {\r\n      // 下拉树\r\n      let searchDataObj = {}\r\n      this.queryConfig.forEach(item => {\r\n        if (item.itemRender.name === '$formTreeInput' || item.itemRender.name === '$vxeTree') {\r\n          if (item.field) {\r\n            searchDataObj[item.field + 'code'] = ''\r\n          }\r\n        } else {\r\n          if (item.field) {\r\n            searchDataObj[item.field] = ''\r\n          }\r\n        }\r\n      })\r\n      this.queryData = searchDataObj\r\n    },\r\n    // 初始化高级查询参数condition\r\n    getConditionList() {\r\n      let condition = {}\r\n      this.queryConfig.forEach(item => {\r\n        if (item.itemRender.name === '$formTreeInput' || item.itemRender.name === '$vxeTree') {\r\n          if (item.field) {\r\n            if (item.field === 'cor_bgt_doc_no_') {\r\n              condition[item.field + 'name'] = []\r\n            } else {\r\n              condition[item.field + 'code'] = []\r\n            }\r\n          }\r\n        } else {\r\n          if (item.field) {\r\n            condition[item.field] = []\r\n          }\r\n        }\r\n      })\r\n      return condition\r\n    },\r\n    changeVisible(val) {\r\n      console.log(val, '输出')\r\n      this.breakRuleVisible = val\r\n    },\r\n    onToolbarBtnClick({ context, table, code }) {\r\n      switch (code) {\r\n        // 刷新\r\n        case 'refresh':\r\n          this.refresh()\r\n          break\r\n      }\r\n    },\r\n    /**\r\n     * 重置查询条件\r\n     */\r\n    reset() {\r\n      this.$refs.queryFrom.reset()\r\n      this.mainPagerConfig.currentPage = 1\r\n      this.mainPagerConfig.pageSize = 20\r\n      // 因为无法预知是否配置了预算单位搜索和区划搜索栏 所以暂时用这种处理重置单位搜索和区划搜索栏\r\n      if (this.queryConfig && this.queryConfig.length) {\r\n        this.queryConfig.forEach(item => {\r\n          if (item.field === 'mofDivCodes' || item.field === 'mofDivCodeList') {\r\n            this.queryData['mofDivCodeList'] = []\r\n          } else if (item.field === 'agencyCodeList') {\r\n            this.queryData['agencyCodeList'] = []\r\n          }\r\n        })\r\n      }\r\n    },\r\n    // 查看附件\r\n    showAttachment(row) {\r\n      console.log('查看附件', row)\r\n      if (row.attachmentid1 === null && row.attachmentid3 === null) {\r\n        this.$message.warning('该数据无附件')\r\n        return\r\n      }\r\n      this.billguid = row.attachmentid1 === null ? row.attachmentid3 : row.attachmentid1\r\n      // this.showAttachmentDialog = true\r\n      this.showGlAttachmentDialog = true\r\n    },\r\n    // 表格单元行单击\r\n    cellClick(obj, context, e) {\r\n      let key = obj.column.property\r\n      console.log(key, obj.row)\r\n      switch (key) {\r\n      }\r\n    },\r\n    // 刷新按钮 刷新查询栏，提示刷新 table 数据\r\n    refresh() {\r\n      this.onSearch()\r\n    },\r\n    closeAttachment() {\r\n      this.showGlAttachmentDialog = false\r\n    },\r\n    ajaxTableData({ params, currentPage, pageSize }) {\r\n      this.mainPagerConfig.currentPage = currentPage\r\n      this.mainPagerConfig.pageSize = pageSize\r\n      this.queryTableDatas()\r\n    },\r\n    // 查询 table 数据\r\n    queryTableDatas() {\r\n      // console.log('this.menuSettingConfig', this.menuSettingConfig)\r\n      let param = {\r\n        ...this.queryData,\r\n        page: this.mainPagerConfig.currentPage,\r\n        pageSize: this.mainPagerConfig.pageSize,\r\n        isUnit: this.menuSettingConfig.retroact,\r\n        roleId: this.$store.state.curNavModule.roleguid,\r\n        menuId: this.$store.state.curNavModule.guid\r\n      }\r\n      if (this.$store.state.curNavModule.f_FullName.substring(0, 4) === '直达资金') {\r\n        param.regulationClass = '0201'\r\n      }\r\n      const regulationClass = this.transJson(this.$store.state.curNavModule.param5)?.regulationClass\r\n      if (regulationClass) {\r\n        param.regulationClass = regulationClass\r\n      }\r\n      this.tableLoading = true\r\n      api.getWorkFlowDetail(param).then(res => {\r\n        this.selection = []\r\n        this.tableLoading = false\r\n        if (res.code === '000000') {\r\n          this.tableData = res.data.results\r\n          this.mainPagerConfig.total = res.data.totalCount\r\n        } else {\r\n          this.$message.error(res.message)\r\n        }\r\n      })\r\n    },\r\n    getdata() {\r\n\r\n    },\r\n    getTableConfByMenuguid(menuguid) {\r\n      // 根据菜单menuguid获取其下所有表配置\r\n      let self = this\r\n      return new Promise((resolve, reject) => {\r\n        self.$http\r\n          .get('mp-b-perm-service/v1/tableconf/menuguid', {\r\n            menuguid: menuguid,\r\n            mof_div_code: self.userInfo.province, // 区划\r\n            fiscalyear: self.userInfo.year // 年份\r\n          })\r\n          .then((res) => {\r\n            if (res.rscode === '100000') {\r\n              resolve(res.data)\r\n              // resolve(self.generateCurTableConfDataMap(res.data))\r\n            }\r\n          })\r\n          .catch((error) => {\r\n            reject(error)\r\n          })\r\n      })\r\n    },\r\n    // 生成\r\n    handleCreate() {\r\n      let selection = this.$refs.mainTableRef.getSelectionData()\r\n      if (selection.length !== 1) {\r\n        this.$message.warning('请选择一条数据')\r\n      }\r\n      this.$set(this.$refs.mainTableRef, 'createDataList', selection[0])\r\n    },\r\n    async onTabPanelBtnClick(obj) { // 按钮点击\r\n      console.log(777, obj)\r\n      let selection = this.$refs.mainTableRef.getSelectionData()\r\n      if (selection.length !== 1) {\r\n        this.$message.warning('请选择一条数据')\r\n        return\r\n      }\r\n      if (obj.code === 'dcl-hsfk') {\r\n        this.showModal = true\r\n        await this.$nextTick()\r\n        let serverTime = await HttpModule.getCurrentTime()\r\n        let formItemText = selection[0].mflowBizInfoList || []// 拿到上一个节点表单结构\r\n        let preNodeFormObj = {}// 上一个节点表单填得值\r\n        if (formItemText && formItemText.length) {\r\n          formItemText.forEach(item => {\r\n            preNodeFormObj[item.bizKey] = item.bizValue\r\n          })\r\n        }\r\n        let ortherData = {\r\n          serverTime: serverTime.data,\r\n          createdAttachmentid: this.$ToolFn.utilFn.getUuid(),\r\n          userName: this.userInfo.name,\r\n          menuName: this.menuName\r\n        }\r\n        if (this.$route.name === 'monitProcFeedbackSpe' || this.$route.name === 'monitProcFeedbackDfr') {\r\n          ortherData.commentDept = '1'// 单位材料整改初始值设置为1 先暂时这样改\r\n        }\r\n        this.$set(this.$refs.MonitProcFeedbackModal, 'createDataList', { ...selection[0], ...preNodeFormObj, ...ortherData })\r\n        this.$refs.MonitProcFeedbackModal.tabCode = obj.code\r\n        this.$refs.MonitProcFeedbackModal.dialogVisible = true\r\n        this.$refs.MonitProcFeedbackModal.initModal()\r\n      } else if (obj.code === 'dcl-cx') {\r\n        let selection = this.$refs.mainTableRef.getSelectionData() || []\r\n        if (selection.length === 0) {\r\n          this.$message.warning('请选择数据')\r\n          return\r\n        }\r\n        this.selection = selection\r\n        this.dialogTableVisible = true\r\n      }\r\n    },\r\n    transJson(str) {\r\n      if (!str) return\r\n      var params = str.split(',')\r\n      var result = {}\r\n      if (params && params.length > 0) {\r\n        for (var i = 0; i < params.length; i++) {\r\n          var map = params[i].split('=')\r\n          result[map[0]] = map[1]\r\n        }\r\n      }\r\n      return result\r\n    },\r\n    // 切换状态栏\r\n    onStatusTabClick(obj) {\r\n      if (!obj.type) return\r\n      this.reset()\r\n      this.queryData.flowStatus = obj.code\r\n      this.onSearch()\r\n    },\r\n    getViolationType() {\r\n      let params = {\r\n        page: 1,\r\n        size: 99999\r\n      }\r\n      api.queryViolationType(params).then(res => {\r\n        if (res.code === '000000') {\r\n          res.data.results.map(v => {\r\n            v.value = v.code\r\n            v.label = v.name\r\n          })\r\n          this.$set(this.queryConfig[0].itemRender, 'options', res.data.results)\r\n        }\r\n      })\r\n    },\r\n    getCount() {\r\n      let param = {\r\n        roleId: this.$store.state.curNavModule.roleguid\r\n      }\r\n      const regulationClass = this.transJson(this.$store.state.curNavModule.param5)?.regulationClass\r\n      if (regulationClass) {\r\n        param.regulationClass = regulationClass\r\n      }\r\n      api.getCount(param).then(res => {\r\n        if (res.code === '000000') {\r\n          // 主管处室\r\n          // this.tabStatusNumConfig['dcl'] = res.data.dcl\r\n          // this.tabStatusNumConfig['yxf'] = res.data.yxf\r\n          // this.tabStatusNumConfig['dsh'] = res.data.dsh\r\n          // this.tabStatusNumConfig['yth'] = res.data.yth\r\n          // this.tabStatusNumConfig['rdzc'] = res.data.rdzc\r\n          // this.tabStatusNumConfig['yzg'] = res.data.yzg\r\n          // // 单位\r\n          // this.tabStatusNumConfig['dhs'] = res.data.dhs\r\n          // this.tabStatusNumConfig['dcszg'] = res.data.dcszg\r\n          // this.tabStatusNumConfig['csysh'] = res.data.csysh\r\n          // this.tabStatusNumConfig['bth'] = res.data.bth\r\n        }\r\n      })\r\n    },\r\n    check() {\r\n      let selection = this.$refs.mainTableRef.getSelectionData()\r\n      if (selection.length === 0) {\r\n        this.$message.warning('请选择数据')\r\n        return\r\n      }\r\n      this.tableLoading = true\r\n      HttpModule.check(selection[0].dealNo).then(res => {\r\n        this.tableLoading = false\r\n        if (res.code === '66020026') {\r\n          this.$message.success(res.message)\r\n        } else {\r\n          this.$message.error(res.message)\r\n        }\r\n      })\r\n    },\r\n    // 打印\r\n    print() {\r\n      let selection = this.$refs.mainTableRef.getSelectionData()\r\n      if (selection.length !== 1) {\r\n        this.$message.warning('请选择一条数据')\r\n        return\r\n      }\r\n      const params = {\r\n        dealNo: selection[0].dealNo\r\n      }\r\n      this.tableLoading = true\r\n      HttpModule.getReport(params).then(res => {\r\n        this.tableLoading = false\r\n        if (res.code === '000000') {\r\n          this.fileGuid = res.data\r\n          this.filePreviewDialogVisible = true\r\n        } else {\r\n          this.$message.error(res.message)\r\n        }\r\n      })\r\n    },\r\n    cellStyle({ row, rowIndex, column }) {\r\n      if (['warnLevel'].includes(column.property)) {\r\n        switch (row.warnLevel) {\r\n          case 3:\r\n            return {\r\n              color: '#BBBB00'\r\n            }\r\n          case 2:\r\n            return {\r\n              color: 'orange'\r\n            }\r\n          case 1:\r\n            return {\r\n              color: 'red'\r\n            }\r\n          case 4:\r\n            return {\r\n              color: 'blue'\r\n            }\r\n          case 5:\r\n            return {\r\n              color: 'gray'\r\n            }\r\n          default:\r\n            break\r\n        }\r\n      }\r\n    },\r\n    withdraw(row) {\r\n      this.selection = [row]\r\n      this.dialogTableVisible = true\r\n      // let params = [{\r\n      //   menuId: this.$store.state.curNavModule.guid,\r\n      //   warningCode: row.warningCode,\r\n      //   commentDept: '5', // 5  撤回\r\n      //   dealNo: row.dealNo\r\n      // }]\r\n      // this.tableLoading = true\r\n      // api.workFlowRevoke(params).then(res => {\r\n      //   this.tableLoading = false\r\n      //   if (res.code === '000000') {\r\n      //     this.$message.success('撤回成功')\r\n      //     this.dialogTableVisible = false\r\n      //     this.queryTableDatas()\r\n      //   }\r\n      // })\r\n    },\r\n    mulWithdraw() {\r\n      let commentName = '撤销'\r\n      console.log(777, this.queryConfigInfo, this.queryConfigInfo)\r\n      let operationBtn = this.queryConfigInfo.buttonsInfo || []\r\n      for (const btnInfoKey in operationBtn) {\r\n        const tabBtnConfig = operationBtn[btnInfoKey]\r\n        for (let i = 0; i < tabBtnConfig.length; i++) {\r\n          const btn = tabBtnConfig[i]\r\n          if (btn.code === 'dcl-cs') {\r\n            commentName = btn.label\r\n          }\r\n        }\r\n      }\r\n      let params = this.selection.map(row => {\r\n        return {\r\n          menuId: this.$store.state.curNavModule.guid,\r\n          warningCode: row.warningCode,\r\n          commentDept: '5', // 5  撤回\r\n          dealNo: row.dealNo,\r\n          commentName: commentName,\r\n          menuName: this.menuName,\r\n          information1: this.drawInformation\r\n        }\r\n      })\r\n      this.tableLoading = true\r\n      api.workFlowRevoke(params).then(res => {\r\n        this.tableLoading = false\r\n        if (res.code === '000000') {\r\n          this.$message.success('撤回成功')\r\n          this.dialogTableVisible = false\r\n          this.onSearch()\r\n        }\r\n      })\r\n    },\r\n    getMofDiv(fiscalYear = this.$store.state.userInfo?.year) {\r\n      HttpModule.getMofTreeData({ fiscalYear }).then(res => {\r\n        if (res.code === '000000') {\r\n          let treeResdata = this.getChildrenNewData1(res.data)\r\n          this.$set(this.queryConfig[0].itemRender, 'options', treeResdata)\r\n          // this.queryConfig[0].itemRender.options = treeResdata\r\n        } else {\r\n          this.$message.error(res.message)\r\n        }\r\n      })\r\n    },\r\n    getAgency() {\r\n      const param = {\r\n        elementCode: 'AGENCY',\r\n        date: this.$store.state.userInfo.year,\r\n        tokenid: this.$store.getters.getLoginAuthentication.tokenid,\r\n        appguid: 'apaas',\r\n        year: this.$store.state.userInfo.year,\r\n        mofDivCode: this.$store.state.userInfo.province,\r\n        parameters: {}\r\n      }\r\n      api.getTreeAgency(param).then(res => {\r\n        let treeResdata = res.data\r\n        this.queryConfig[0].itemRender.options = treeResdata\r\n      })\r\n    },\r\n    getChildrenNewData1(datas) {\r\n      let that = this\r\n      datas.forEach(item => {\r\n        item.label = item.name\r\n        if (item.children) {\r\n          that.getChildrenNewData1(item.children)\r\n        }\r\n      })\r\n      return datas\r\n    },\r\n    async loadConfig(configTypeId) {\r\n      let { table } = configTypeId\r\n      if (!table) return\r\n      let params = {\r\n        tableId: {\r\n          id: table,\r\n          fiscalyear: this.userInfo.year,\r\n          mof_div_code: this.userInfo.province,\r\n          menuguid: this.$store.state.curNavModule.guid\r\n        }\r\n      }\r\n      let configQueryData = await this.loadBsConfig(params)\r\n      this.tableColumnsConfig = configQueryData.itemsConfig\r\n      this.menuName = configQueryData.dataConfig.menuname\r\n    },\r\n    async loadTabConfig(configTypeId) {\r\n      let { tabPanel } = configTypeId\r\n      if (!tabPanel) return\r\n      let params = {\r\n        tableId: {\r\n          id: tabPanel,\r\n          fiscalyear: this.userInfo.year,\r\n          mof_div_code: this.userInfo.province,\r\n          menuguid: this.$store.state.curNavModule.guid\r\n        }\r\n      }\r\n      let configQueryData = await this.loadBsConfig(params)\r\n      this.$set(this, 'queryConfigInfo', { ...this.toolBarStatusBtnConfig, ...configQueryData.itemsConfig[0] })\r\n    },\r\n    async loadQueryFormConfig(configTypeId) {\r\n      let { queryForm } = configTypeId\r\n      if (!queryForm) return\r\n      let params = {\r\n        tableId: {\r\n          id: queryForm,\r\n          fiscalyear: this.userInfo.year,\r\n          mof_div_code: this.userInfo.province,\r\n          menuguid: this.$store.state.curNavModule.guid\r\n        }\r\n      }\r\n      let configQueryData = await this.loadBsConfig(params)\r\n      this.$set(this, 'queryConfig', configQueryData.itemsConfig)\r\n      if (configQueryData.itemsConfig && configQueryData.itemsConfig.length && configQueryData.itemsConfig[0].field === 'mofDivCodes') {\r\n        this.getMofDiv()// 财政区划添加下拉按钮选项\r\n      } else if (configQueryData.itemsConfig && configQueryData.itemsConfig.length && configQueryData.itemsConfig[0].field === 'agencyCodeList') {\r\n        this.getAgency()// 预算单位加载\r\n      }\r\n    }\r\n  },\r\n  mounted() {\r\n  },\r\n  created() {\r\n    this.getTableConfByMenuguid(this.$store.state.curNavModule.guid).then(res => {\r\n      res.forEach(item => {\r\n        this.configTypeId[item.type] = item.id\r\n      })\r\n      let taskQueue = [this.loadConfig(this.configTypeId), this.loadTabConfig(this.configTypeId), this.loadQueryFormConfig(this.configTypeId)]\r\n      Promise.all(taskQueue).then(() => {\r\n        this.$nextTick(async () => { // 渲染优化 放到mounted之后渲染\r\n          this.onSearch()\r\n        })\r\n      })\r\n      // this.loadConfig(this.configTypeId)// 加载表格\r\n      // this.loadTabConfig(this.configTypeId)// 加载tab\r\n      // this.loadQueryFormConfig(this.configTypeId)// 加载query\r\n    })\r\n  }\r\n}\r\n</script>\r\n<style >\r\n/* .createProcessing .radio-right{\r\nfloat: right;\r\n}\r\n.createProcessing .Titans-table ::v-deep  .vxe-body--row.row-yellow {\r\n  background-color: yellow;\r\n  color: #fff;\r\n}\r\n.createProcessing .Titans-table ::v-deep  .vxe-body--row.row-blue {\r\n  background-color: blue;\r\n  color: #fff;\r\n}\r\n.createProcessing .Titans-table ::v-deep  .vxe-body--row.row-red {\r\n  background-color: red;\r\n  color: #fff;\r\n}\r\n .createProcessing .unit-tree-main .el-tree-node__content .custom-node-bg{\r\n  background-color: transparent !important;\r\n} */\r\n</style>\r\n"]}]}