{"remainingRequest":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\何小龙\\Desktop\\platformweb-fb\\src\\views\\main\\handlingOfViolations\\components\\AttachmentInfo.vue?vue&type=style&index=0&id=97a50e1e&lang=scss&scoped=true&","dependencies":[{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\src\\views\\main\\handlingOfViolations\\components\\AttachmentInfo.vue","mtime":1694576524765},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\css-loader\\dist\\cjs.js","mtime":1696752946978},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCg0KLnVwbG9hZC10b3Agew0KICBkaXNwbGF5OiBmbGV4Ow0KICBhbGlnbi1pdGVtczogZmxleC1zdGFydDsNCn0NCi51cGxvYWQtdGlwIHsNCiAgbWFyZ2luLWxlZnQ6IDEycHg7DQogIGxpbmUtaGVpZ2h0OiAyOHB4Ow0KICBmb250LXNpemU6IDEycHg7DQogIGNvbG9yOiAjOTk5Ow0KICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KfQ0KLmxhYmVsIHsNCiAgd2lkdGg6IDgwcHg7DQogIHRleHQtYWxpZ246IHJpZ2h0Ow0KICBwYWRkaW5nLXJpZ2h0OiAxNnB4Ow0KICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KfQ0KLnJlcXVpcmVkIHsNCiAgJjo6YmVmb3JlIHsNCiAgICBjb250ZW50OiAiKiI7DQogICAgY29sb3I6ICNmNTZjNmM7DQogICAgbWFyZ2luLXJpZ2h0OiAwLjJlbTsNCiAgICBmb250LWZhbWlseTogVmVyZGFuYSxBcmlhbCxUYWhvbWE7DQogICAgZm9udC13ZWlnaHQ6IDQwMDsNCiAgfQ0KfQ0KLmZpbGUgew0KICBwYWRkaW5nOiA4cHg7DQogIG1hcmdpbjogOHB4IDAgOHB4IDUwcHg7DQogIGJvcmRlcjogMXB4IHNvbGlkICNmMGYwZjA7DQogIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQp9DQoNCi5maWxlLWxpc3QtY29udGFpbmVyIHsNCiAgcGFkZGluZy1sZWZ0OiA4MHB4Ow0KICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KDQogIC5maWxlLWl0ZW0gew0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAgYWxpZ24tY29udGVudDogY2VudGVyOw0KICAgIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsNCiAgICBwYWRkaW5nOiAxMHB4Ow0KICAgIG1hcmdpbi10b3A6IDhweDsNCiAgICBib3gtc2l6aW5nOiBib3JkZXItYm94Ow0KICAgIGJhY2tncm91bmQtY29sb3I6IHJnYmEoI2U3ZjFmZSwgMC41KTsNCg0KICAgIC5lbC1pY29uLWRvY3VtZW50LA0KICAgIC5lbC1pY29uLWRlbGV0ZSB7DQogICAgICBsaW5lLWhlaWdodDogMjJweDsNCiAgICB9DQogICAgLmVsLWljb24tZGVsZXRlIHsNCiAgICAgIHBhZGRpbmc6IDAgMTZweDsNCiAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgICB0cmFuc2l0aW9uOiBhbGwgMC4zczsNCiAgICAgICY6aG92ZXIgew0KICAgICAgICBjb2xvcjogdmFyKC0tcHJpbWFyeS1jb2xvcik7DQogICAgICB9DQogICAgfQ0KICB9DQp9DQo="},{"version":3,"sources":["AttachmentInfo.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"AttachmentInfo.vue","sourceRoot":"src/views/main/handlingOfViolations/components","sourcesContent":["<template>\r\n  <div style=\"margin-top: 16px\">\r\n    <bs-table-title title=\"附件信息\" style=\"margin-bottom: 10px\" />\r\n    <div\r\n      v-if=\"isUnitFeedbackPage && modalType === ModalTypeEnum.AUDIT\"\r\n      v-loading=\"loading || deleteLoading\"\r\n      :element-loading-text=\"deleteLoading ? '附件数据删除中...' : '附件数据加载中...'\"\r\n      class=\"attachment-upload-wrapper\"\r\n    >\r\n      <div class=\"upload-top\">\r\n        <span :class=\"['label', !!Number(required) ? 'required' : ''] \">附件</span>\r\n        <el-button\r\n          size=\"mini\"\r\n          @click=\"uploadBtnClick\"\r\n        >\r\n          <i :class=\"loadingState ? 'el-icon-loading' : 'el-icon-upload'\"></i>\r\n          上传\r\n        </el-button>\r\n        <span class=\"upload-tip\">支持png/jpg/pdf等，不超过10M</span>\r\n      </div>\r\n      <div class=\"file-list-container\">\r\n        <div\r\n          v-for=\"(file, index) in fileList\"\r\n          :key=\"file.fileguid\"\r\n          class=\"file-item\"\r\n        >\r\n          <div>\r\n            <i class=\"el-icon-document el-icon--left\"></i>\r\n            <span>{{ file.filename }}</span>\r\n          </div>\r\n          <i class=\"el-icon-delete el-icon--right\" @click=\"deleteFileHandle(file, index)\"></i>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div v-else>\r\n      <BsTable\r\n        :loading=\"loading\"\r\n        :table-config=\"tableConfig\"\r\n        :table-columns-config=\"columns\"\r\n        :table-data=\"fileList\"\r\n        :toolbar-config=\"false\"\r\n        :pager-config=\"false\"\r\n        :max-height=\"260\"\r\n        size=\"medium\"\r\n      />\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { computed, defineComponent, inject, unref } from '@vue/composition-api'\r\nimport { readLocalFile } from '@/utils/readLocalFile'\r\nimport useLoadingState from '@/hooks/useLoadingState'\r\nimport useTable from '@/hooks/useTable'\r\nimport { FileStatusEnum, ModalTypeEnum, RouterPathEnum } from '../model/enum'\r\n\r\nimport { Message } from 'element-ui'\r\nimport { fileColumns } from '../model/data'\r\n// deleteFile\r\nimport { uploadFile } from '@/api/frame/common/file'\r\nimport { checkRscode } from '@/utils/checkRscode'\r\nimport { downloadByFileId } from '@/utils/download'\r\n\r\n// 附件最大值(1M)\r\nconst maxSize = 1024 * 1024 * 10\r\nexport default defineComponent({\r\n  props: {\r\n    // 文件列表\r\n    fileList: {\r\n      type: Array,\r\n      default: () => ([])\r\n    },\r\n    // 文件分组的的id\r\n    billguid: {\r\n      type: String,\r\n      default: ''\r\n    },\r\n    // 加载状态\r\n    loading: {\r\n      type: Boolean,\r\n      default: false\r\n    },\r\n    // 是否必传\r\n    required: {\r\n      type: [String, Number, Boolean],\r\n      default: 0\r\n    }\r\n  },\r\n  setup(props, { emit }) {\r\n    const modalType = inject('modalType')\r\n\r\n    // 页面路由(也可root中获取route)\r\n    const pagePath = inject('pagePath')\r\n\r\n    // 是否是单位反馈页面\r\n    const isUnitFeedbackPage = computed(() => {\r\n      console.log('RouterPathEnum', RouterPathEnum())\r\n      return unref(pagePath).indexOf('nitFeedback') !== -1\r\n    })\r\n\r\n    const [loadingState, setLoadingState] = useLoadingState()\r\n    /**\r\n     * 点击上传\r\n     * @return {Promise<void>}\r\n     */\r\n    async function uploadBtnClick() {\r\n      const { file: localFile } = await readLocalFile()\r\n      const {\r\n        size: filesize,\r\n        name: filename\r\n      } = localFile\r\n\r\n      if (localFile.size > maxSize) {\r\n        Message.warning('文件大小超过限制,请重新选择')\r\n        return\r\n      }\r\n      try {\r\n        setLoadingState(true)\r\n        const { data: fileguid } = checkRscode(\r\n          await uploadFile({\r\n            file: localFile,\r\n            filename,\r\n            // 文件分组的id\r\n            billguid: props.billguid\r\n          })\r\n        )\r\n        Message.success('上传成功！')\r\n\r\n        // 往违规单中存入文件信息\r\n        emit('uploadAfter', {\r\n          fileguid,\r\n          filename,\r\n          filesize,\r\n          file: localFile,\r\n          // 保留\r\n          status: FileStatusEnum.RETAIN\r\n        })\r\n      } finally {\r\n        setLoadingState(false)\r\n      }\r\n    }\r\n\r\n    const [deleteLoading, setDeleteLoading] = useLoadingState()\r\n    /**\r\n     * 删除文件\r\n     * */\r\n    async function deleteFileHandle(file, index) {\r\n      try {\r\n        setDeleteLoading(true)\r\n        // 暂时取消立即从平台删除操作：后续重新打开该处理单后根据后端返回的附件列表，在平台附件里面过滤，并删除后端没有存的文件\r\n        // 避免平台附件删除后，用户取消送审、确认操作 导致数据不一致问题\r\n        // checkRscode(await deleteFile(file.fileguid))\r\n        Message.success('删除成功！')\r\n        emit('deleteFile', {\r\n          file,\r\n          index\r\n        })\r\n      } finally {\r\n        setDeleteLoading(false)\r\n      }\r\n    }\r\n\r\n    /**\r\n     * 下载附件\r\n     * */\r\n    function downloadHandle({ row }) {\r\n      downloadByFileId(row.fileguid)\r\n    }\r\n\r\n    // 操作列\r\n    const columnActions = [\r\n      {\r\n        label: '下载',\r\n        // ri-download-cloud-fill\r\n        class: 'cursor f-c-c',\r\n        handle: downloadHandle\r\n      }\r\n    ]\r\n    /**\r\n     * 表格\r\n     * */\r\n    const [\r\n      {\r\n        columns,\r\n        tableConfig\r\n      }\r\n    ] = useTable({\r\n      columnActions,\r\n      columns: fileColumns\r\n    })\r\n\r\n    // 全局配置\r\n    tableConfig.globalConfig = {\r\n      checkType: false,\r\n      seq: true,\r\n      cellClickCheck: false\r\n    }\r\n    return {\r\n      uploadBtnClick,\r\n      loadingState,\r\n      modalType,\r\n      ModalTypeEnum,\r\n      isUnitFeedbackPage,\r\n\r\n      deleteLoading,\r\n      deleteFileHandle,\r\n\r\n      columns,\r\n      tableConfig\r\n    }\r\n  }\r\n})\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.upload-top {\r\n  display: flex;\r\n  align-items: flex-start;\r\n}\r\n.upload-tip {\r\n  margin-left: 12px;\r\n  line-height: 28px;\r\n  font-size: 12px;\r\n  color: #999;\r\n  box-sizing: border-box;\r\n}\r\n.label {\r\n  width: 80px;\r\n  text-align: right;\r\n  padding-right: 16px;\r\n  box-sizing: border-box;\r\n}\r\n.required {\r\n  &::before {\r\n    content: \"*\";\r\n    color: #f56c6c;\r\n    margin-right: 0.2em;\r\n    font-family: Verdana,Arial,Tahoma;\r\n    font-weight: 400;\r\n  }\r\n}\r\n.file {\r\n  padding: 8px;\r\n  margin: 8px 0 8px 50px;\r\n  border: 1px solid #f0f0f0;\r\n  box-sizing: border-box;\r\n}\r\n\r\n.file-list-container {\r\n  padding-left: 80px;\r\n  box-sizing: border-box;\r\n\r\n  .file-item {\r\n    display: flex;\r\n    align-content: center;\r\n    justify-content: space-between;\r\n    padding: 10px;\r\n    margin-top: 8px;\r\n    box-sizing: border-box;\r\n    background-color: rgba(#e7f1fe, 0.5);\r\n\r\n    .el-icon-document,\r\n    .el-icon-delete {\r\n      line-height: 22px;\r\n    }\r\n    .el-icon-delete {\r\n      padding: 0 16px;\r\n      box-sizing: border-box;\r\n      cursor: pointer;\r\n      transition: all 0.3s;\r\n      &:hover {\r\n        color: var(--primary-color);\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n"]}]}