{"remainingRequest":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\何小龙\\Desktop\\platformweb-fb\\src\\views\\main\\monitor\\children\\addDialog.vue?vue&type=style&index=0&lang=scss&","dependencies":[{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\src\\views\\main\\monitor\\children\\addDialog.vue","mtime":1694505522810},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoNCi5wYXlWb3VjaGVySW5wdXQgew0KICBtYXJnaW46IDE1cHg7DQoNCiAgLmVsLWNhcmQgew0KICAgIG1hcmdpbi10b3A6IDA7DQogIH0NCn0NCg0KLnZ4ZS1tb2RhbC0td3JhcHBlciAudnhlLW1vZGFsLS1ib3ggew0KICB6LWluZGV4OiAwOw0KfQ0KDQojYmlnYm94IHsNCiAgd2lkdGg6IDEwMCU7DQogIGhlaWdodDogMTAwJTsNCiAgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7DQogIHotaW5kZXg6IDEwOw0KICBwb3NpdGlvbjogYWJzb2x1dGU7DQogIHRvcDogMDsNCiAgbGVmdDogMDsNCiAgcmlnaHQ6IDA7DQogIGJvdHRvbTogMDsNCiAgb3BhY2l0eTogMC4zOw0KfQ0KDQouZWwtcm93LWl0ZW0gLmZvbnQtc2V0LXNtYWxsIC5obGluZSB7DQogIHdpZHRoOiA3MnB4Ow0KfQ0K"},{"version":3,"sources":["addDialog.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4hBA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA","file":"addDialog.vue","sourceRoot":"src/views/main/monitor/children","sourcesContent":["<!--监控规则函数管理新增页面弹框-->\r\n<template>\r\n  <div style=\"height: 100%\">\r\n    <vxe-modal\r\n      v-model=\"dialogVisible\"\r\n      :title=\"title\"\r\n      width=\"80%\"\r\n      height=\"646px\"\r\n      :show-footer=\"true\"\r\n      @close=\"dialogClose\"\r\n    >\r\n      <div v-show=\"isShowQueryConditions\" class=\"main-query\">\r\n        <BsQuery\r\n          ref=\"queryFrom\"\r\n          :query-form-item-config=\"queryConfig\"\r\n          :query-form-data=\"searchDataList\"\r\n          @onSearchClick=\"search\"\r\n        />\r\n      </div>\r\n      <div v-loading=\"addLoading\" class=\"payVoucherInput\">\r\n        <BsTable\r\n          ref=\"addTableRef\"\r\n          height=\"400\"\r\n          :footer-config=\"{}\"\r\n          :table-columns-config=\"tableColumnsConfig\"\r\n          :table-data=\"tableData\"\r\n          :table-config=\"tableConfig\"\r\n          :pager-config=\"mainPagerConfig\"\r\n          :toolbar-config=\"false\"\r\n          @ajaxData=\"ajaxTableData\"\r\n        />\r\n      </div>\r\n      <div slot=\"footer\" style=\"height: 80px; margin: 0 15px\">\r\n        <div type=\"flex\" justify=\"space-around\">\r\n          <div>\r\n            <!-- <vxe-button v-if=\"btnShShow\" status=\"primary\" @click=\"doInsertFlow\">执行工作流</vxe-button> -->\r\n            <vxe-button v-if=\"btnShow\" status=\"primary\" @click=\"doInsert\">执行</vxe-button>\r\n            <vxe-button v-if=\"!btnShow\" status=\"primary\" @click=\"goNext\">确认</vxe-button>\r\n            <vxe-button @click=\"dialogClose\">取消</vxe-button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </vxe-modal>\r\n    <DetailDialog\r\n      v-if=\"mofShow\"\r\n      :add-param=\"addParam\"\r\n    />\r\n  </div>\r\n</template>\r\n<script>\r\n// import { proconf } from '../PoliciesAndRegulationsManagement.js'\r\nimport DetailDialog from './mofDialog'\r\nimport HttpModule from '@/api/frame/main/Monitoring/Monitoring.js'\r\n\r\nexport default {\r\n  name: 'AddDialog',\r\n  components: {\r\n    DetailDialog\r\n  },\r\n  computed: {\r\n    curNavModule() {\r\n      return this.$store.state.curNavModule\r\n    }\r\n  },\r\n  props: {\r\n    title: {\r\n      type: String,\r\n      default: ''\r\n    },\r\n    functionCode: {\r\n      type: String,\r\n      default: ''\r\n    },\r\n    userInfo: {\r\n      type: Object,\r\n      default: function _default() {\r\n        return {}\r\n      }\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n      mofShow: false,\r\n      btnShow: true,\r\n      btnShShow: false,\r\n      isFlow: false,\r\n      tableToolbarConfig: {\r\n        // table工具栏配置\r\n        disabledMoneyConversion: false,\r\n        moneyConversion: false, // 是否有金额转换\r\n        search: false, // 是否有search\r\n        import: false, // 导入\r\n        export: true, // 导出\r\n        print: false, // 打印\r\n        zoom: true, // 缩放\r\n        custom: true, // 选配展示列\r\n        slots: {\r\n          tools: 'toolbarTools',\r\n          buttons: 'toolbarSlots'\r\n        }\r\n      },\r\n      mainPagerConfig: {\r\n        total: 0,\r\n        currentPage: 1,\r\n        pageSize: 20\r\n      },\r\n      tableData: [],\r\n      tableConfig: {},\r\n      tableColumnsConfig: [\r\n        {\r\n          title: '监控主题',\r\n          field: 'regulationClassName',\r\n          sortable: false,\r\n          align: 'left'\r\n        },\r\n        {\r\n          title: '管理级次',\r\n          field: 'regulationType',\r\n          sortable: false,\r\n          width: 100,\r\n          align: 'left',\r\n          cellRender: {\r\n            name: '$vxeSelect',\r\n            options: [\r\n              {\r\n                value: '1',\r\n                label: '系统'\r\n              },\r\n              {\r\n                value: '2',\r\n                label: '财政'\r\n              },\r\n              {\r\n                value: '3',\r\n                label: '部门'\r\n              }\r\n            ],\r\n            defaultValue: '',\r\n            props: {}\r\n          }\r\n        },\r\n        {\r\n          title: '规则名称',\r\n          width: 333,\r\n          field: 'fiRuleName',\r\n          align: 'left',\r\n          sortable: 'true'\r\n        },\r\n        {\r\n          title: '预警级别',\r\n          field: 'warnLevel',\r\n          sortable: false,\r\n          align: 'left',\r\n          cellRender: {\r\n            name: '$vxeSelect',\r\n            options: this.$store.state.warnInfo.warnLevelOptions.map(item => {\r\n              return {\r\n                ...item,\r\n                value: String(item.value)\r\n              }\r\n            }),\r\n            defaultValue: '',\r\n            props: {}\r\n          }\r\n        },\r\n        {\r\n          title: '处理方式',\r\n          field: 'controlType',\r\n          sortable: false,\r\n          align: 'left',\r\n          cellRender: {\r\n            name: '$vxeSelect',\r\n            options: this.$store.state.warnInfo.warnControlTypeOptions.map(item => {\r\n              return {\r\n                ...item,\r\n                value: String(item.value)\r\n              }\r\n            }),\r\n            defaultValue: '',\r\n            props: {}\r\n          }\r\n        },\r\n        {\r\n          title: '规则模板',\r\n          field: 'regulationModelName',\r\n          width: 240,\r\n          sortable: false,\r\n          align: 'left'\r\n        },\r\n        {\r\n          title: '规则说明',\r\n          field: 'fiRuleDesc',\r\n          width: 67,\r\n          sortable: false,\r\n          align: 'left'\r\n        },\r\n        {\r\n          title: '启用时间',\r\n          field: 'beginTime',\r\n          sortable: false,\r\n          align: 'left'\r\n        }\r\n      ],\r\n      dataSourceCode: '',\r\n      dataSourceName: '',\r\n      dataSourceCodeoptions: [],\r\n      functionType: '',\r\n      functionTypeoptions: [\r\n        { value: '1', label: '字段' },\r\n        { value: '2', label: '自定义SQL' },\r\n        { value: '3', label: '自定义接口' },\r\n        { value: '4', label: '自定义校验接口' }\r\n      ],\r\n      functionName: '',\r\n      functionApi: '',\r\n      functionParameter: '',\r\n      description: '',\r\n      dialogVisible: true,\r\n      addLoading: true,\r\n      token: '',\r\n      isContinuity: false,\r\n      // 文件上传相关参数\r\n      fileList: [],\r\n      fileData: [],\r\n      fileDataBakDel: [],\r\n      attachmentId: '',\r\n      showbox: false,\r\n      addParam: {},\r\n      queryConfig: [\r\n        {\r\n          title: '监控主题',\r\n          field: 'regulationClass',\r\n          width: '8',\r\n          align: 'left',\r\n          formula: '',\r\n          name: '$vxeTree',\r\n          itemRender: {\r\n            name: '$vxeTree',\r\n            options: [],\r\n            'props': {\r\n              'selectOnNodeClick': false,\r\n              'config': {\r\n                'treeProps': {\r\n                  'nodeKey': 'id',\r\n                  'label': 'label',\r\n                  'children': 'children'\r\n                },\r\n                'placeholder': '监控主题',\r\n                'multiple': false,\r\n                'readonly': true,\r\n                'isleaf': false\r\n              }\r\n            }\r\n          }\r\n        },\r\n        {\r\n          title: '规则名称',\r\n          field: 'fiRuleName',\r\n          align: 'left',\r\n          itemRender: {\r\n            name: '$vxeInput',\r\n            props: {\r\n              placeholder: '规则名称'\r\n            }\r\n          }\r\n        }\r\n      ],\r\n      searchDataList: {\r\n        regulationClass: '',\r\n        fiRuleName: ''\r\n      },\r\n      isShowQueryConditions: true,\r\n      fiRuleName: '',\r\n      regulationClass: ''\r\n    }\r\n  },\r\n  methods: {\r\n    // 初始化高级查询data\r\n    getSearchDataList() {\r\n      // 下拉树\r\n      let searchDataObj = {}\r\n      this.queryConfig.forEach((item) => {\r\n        if (\r\n          item.itemRender.name === '$formTreeInput' ||\r\n          item.itemRender.name === '$vxeTree'\r\n        ) {\r\n          if (item.field) {\r\n            searchDataObj[item.field + 'code'] = ''\r\n          }\r\n        } else {\r\n          if (item.field) {\r\n            searchDataObj[item.field] = ''\r\n          }\r\n        }\r\n      })\r\n      this.searchDataList = searchDataObj\r\n    },\r\n    // 初始化高级查询参数condition\r\n    getConditionList() {\r\n      let condition = {}\r\n      this.queryConfig.forEach((item) => {\r\n        if (\r\n          item.itemRender.name === '$formTreeInput' ||\r\n          item.itemRender.name === '$vxeTree'\r\n        ) {\r\n          if (item.field) {\r\n            if (item.field === 'cor_bgt_doc_no_') {\r\n              condition[item.field + 'name'] = []\r\n            } else {\r\n              condition[item.field + 'code'] = []\r\n            }\r\n          }\r\n        } else {\r\n          if (item.field) {\r\n            condition[item.field] = []\r\n          }\r\n        }\r\n      })\r\n      return condition\r\n    },\r\n    // 搜索\r\n    search(val) {\r\n      console.log(val)\r\n      this.searchDataList = val\r\n      let condition = this.getConditionList()\r\n      for (let key in condition) {\r\n        if (\r\n          (this.searchDataList[key] !== undefined) &\r\n          (this.searchDataList[key] !== null)\r\n        ) {\r\n          if (Array.isArray(this.searchDataList[key])) {\r\n            condition[key] = this.searchDataList[key]\r\n          } else if (typeof this.searchDataList[key] === 'string') {\r\n            if (this.searchDataList[key].trim() !== '') {\r\n              this.searchDataList[key].split(',').forEach((item) => {\r\n                condition[key].push(item)\r\n              })\r\n            }\r\n          }\r\n        }\r\n      }\r\n      this.condition = condition\r\n      // this.regulationClassName = this.condition.regulationClassName[0]\r\n      this.regulationClass = val.regulationClass_code\r\n      this.fiRuleName = this.condition.fiRuleName[0]\r\n      this.getDataSourceInfo()\r\n    },\r\n    ajaxTableData({ params, currentPage, pageSize }) {\r\n      this.mainPagerConfig.currentPage = currentPage\r\n      this.mainPagerConfig.pageSize = pageSize\r\n      this.getDataSourceInfo()\r\n    },\r\n    dialogClose() {\r\n      this.$parent.addDialogVisible = false\r\n      this.$parent.queryTableDatas()\r\n    },\r\n    // 获取数据源列表\r\n    getDataSourceInfo() {\r\n      this.addLoading = true\r\n      const param = {\r\n        regulationClass: this.regulationClass,\r\n        fiRuleName: this.fiRuleName,\r\n        page: this.mainPagerConfig.currentPage, // 页码\r\n        pageSize: this.mainPagerConfig.pageSize // 每页条数\r\n      }\r\n      HttpModule.qyeryRuleList(param).then((res) => {\r\n        if (res.code === '000000') {\r\n          this.tableData = res.data.results\r\n          this.mainPagerConfig.total = res.data.totalCount\r\n          // this.tabStatusNumConfig['1'] = res.data.totalCount\r\n          this.addLoading = false\r\n        } else {\r\n          this.$message.error(res.message)\r\n        }\r\n      })\r\n    },\r\n    // 选择数据源编码\r\n    changeDataSourceCode(val) {\r\n      console.log(val)\r\n      this.SysparentId = val\r\n      this.dataSourceCode = ''\r\n      let busName = this.dataSourceCodeoptions.find((item) => {\r\n        return item.id === val\r\n      })\r\n      this.dataSourceName = busName.dataSourceName\r\n      this.dataSourceCode = busName.dataSourceCode\r\n    },\r\n    // 修改回显\r\n    showInfo() {\r\n      if (this.title === '新增') {\r\n        this.attachmentId = this.$ToolFn.utilFn.getUuid()\r\n      }\r\n      /* HttpModule.getDetail(params).then((res) => {\r\n        if (res.code === '000000') {\r\n          this.functionName = res.data.functionName\r\n          this.functionType = res.data.functionType.toString()\r\n          this.functionApi = res.data.functionApi\r\n          this.functionParameter = res.data.functionParameter\r\n          this.description = res.data.description\r\n          this.dataSourceName = res.data.dataSourceName\r\n          this.dataSourceCode = res.data.dataSourceCode\r\n        } else {\r\n          this.$message.error(res.message)\r\n        }\r\n      }) */\r\n      // this.attachmentId =\r\n      //   this.modifyData.attachment_id != null\r\n      //     ? this.modifyData.attachment_id\r\n      //     : this.$ToolFn.utilFn.getUuid()\r\n      // let param = 'attachmentId=' + this.attachmentId\r\n      /* HttpModule.getFiles(param).then((res) => {\r\n        if (res.rscode === '200') {\r\n          // 获取附件信息\r\n          this.fileData = res.data.fileList\r\n        }\r\n      }) */\r\n    },\r\n    // doInsertFlow() {\r\n    //   this.isFlow = true\r\n    //   this.doInsert()\r\n    // },\r\n    // 保存新增的计划信息\r\n    doInsert() {\r\n      let selectData = this.$refs.addTableRef.getSelectionData()\r\n      if (selectData.length > 0) {\r\n        if (this.title === '删除预警数据') {\r\n          let param = {\r\n            regulationClass: selectData[0].regulationClass,\r\n            firulecode: selectData[0].fiRuleCode\r\n          }\r\n          this.addLoading = true\r\n          HttpModule.deleteData(param).then((res) => {\r\n            this.addLoading = false\r\n            if (res.code === '000000') {\r\n              this.$message.success('删除成功')\r\n              this.$parent.addDialogVisible = false\r\n              this.$parent.queryTableDatas()\r\n            } else {\r\n              this.$message.error(res.message)\r\n            }\r\n          })\r\n        } else {\r\n          this.$confirm('确定要手动执行吗？', '提示', {\r\n            confirmButtonText: '确定',\r\n            cancelButtonText: '取消',\r\n            type: 'warning'\r\n          }).then(() => {\r\n            let id = selectData.map((item) => {\r\n              return item.fiRuleCode\r\n            })\r\n            let param = {\r\n              ruleCodes: id,\r\n              menuName: this.$store.state.curNavModule.name\r\n            }\r\n            if (this.isFlow) {\r\n              param.isFlow = '1'\r\n            }\r\n            param.fullType = this.title === '增量查询' ? 'false' : 'true'\r\n            this.addLoading = true\r\n            HttpModule.warnLogAdd(param).then((res) => {\r\n              this.addLoading = false\r\n              if (res.code === '000000') {\r\n                this.$message.success('新增成功')\r\n                this.$parent.addDialogVisible = false\r\n                this.$parent.queryTableDatas()\r\n                this.isFlow = false\r\n              } else {\r\n                this.$message.error(res.message)\r\n              }\r\n            })\r\n          })\r\n        }\r\n      } else {\r\n        this.$message.warning('请选择监控规则！')\r\n      }\r\n    },\r\n    goNext() {\r\n      let selectData = this.$refs.addTableRef.getSelectionData()\r\n      if (selectData.length > 0) {\r\n        if (selectData.length === 1) {\r\n          let id = selectData.map((item) => {\r\n            return item.fiRuleCode\r\n          })\r\n          let param = {\r\n            ruleCodes: id,\r\n            menuName: this.$store.state.curNavModule.name\r\n          }\r\n          param.fullType = this.title === '增量查询' ? 'false' : 'true'\r\n          this.addParam = param\r\n        } else {\r\n          this.$message.warning('监控规则只能选择一条！')\r\n          return\r\n        }\r\n      } else {\r\n        this.$message.warning('请选择监控规则！')\r\n        return\r\n      }\r\n      this.mofShow = true\r\n    },\r\n    getRegulationChildrenData(datas) {\r\n      let that = this\r\n      datas.forEach(item => {\r\n        item.name = item.ruleName ? item.ruleName : item.name\r\n        item.label = item.text || `${item.code}-${item.name}`\r\n        if (item.children && item.children.length > 0) {\r\n          that.getRegulationChildrenData(item.children)\r\n          item.leaf = false\r\n        } else {\r\n          item.leaf = true\r\n        }\r\n      })\r\n\r\n      return datas\r\n    }\r\n  },\r\n  watch: {\r\n    queryConfig() {\r\n      this.getSearchDataList()\r\n    }\r\n  },\r\n  created() {\r\n    this.getDataSourceInfo()\r\n    this.showInfo()\r\n  },\r\n  mounted() {\r\n    HttpModule.monitorTheme().then((res) => {\r\n      if (res.code === '000000') {\r\n        let resData = this.getRegulationChildrenData(res.data)\r\n        this.queryConfig[0].itemRender.options = resData\r\n      } else {\r\n        this.$message.error(res.message)\r\n      }\r\n    })\r\n    // if (this.userInfo.province.substring(0, 2) === '31') {\r\n    //   this.btnShShow = true\r\n    // }\r\n  }\r\n}\r\n</script>\r\n<style lang=\"scss\">\r\n.payVoucherInput {\r\n  margin: 15px;\r\n\r\n  .el-card {\r\n    margin-top: 0;\r\n  }\r\n}\r\n\r\n.vxe-modal--wrapper .vxe-modal--box {\r\n  z-index: 0;\r\n}\r\n\r\n#bigbox {\r\n  width: 100%;\r\n  height: 100%;\r\n  background-color: white;\r\n  z-index: 10;\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  opacity: 0.3;\r\n}\r\n\r\n.el-row-item .font-set-small .hline {\r\n  width: 72px;\r\n}\r\n</style>\r\n"]}]}