{"remainingRequest":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\何小龙\\Desktop\\platformweb-fb\\src\\components\\TableBak\\export\\Export.vue?vue&type=style&index=0&lang=scss&","dependencies":[{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\src\\components\\TableBak\\export\\Export.vue","mtime":1694505521584},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\css-loader\\dist\\cjs.js","mtime":1696752946978},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoNCi5leHBvcnQtbW9kdWxlIHsNCiAgcGFkZGluZzogMCAwIDIwcHggMDsNCiAgLnZ4ZS1mb3JtIHsNCiAgICBwYWRkaW5nOiAwIDYwcHg7DQogICAgbWFyZ2luOiAwIGF1dG87DQogICAgLnZ4ZS1mb3JtLS1pdGVtIHsNCiAgICAgIHBhZGRpbmc6IDNweCAwOw0KICAgIH0NCiAgICAuZXhwb3J0LW9wdGlvbiB7DQogICAgICBib3JkZXI6IDFweCBzb2xpZCAjZGNkZmU2Ow0KICAgICAgbWFyZ2luOiAzcHggMDsNCiAgICAgIGJvcmRlci1yYWRpdXM6IDRweDsNCiAgICAgIHVzZXItc2VsZWN0OiBub25lOw0KICAgICAgLmV4cG9ydC1vcHRpb24tdGl0bGUgew0KICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjhmOGY5Ow0KICAgICAgICBmb250LXdlaWdodDogNzAwOw0KICAgICAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgI2RhZGNlMDsNCiAgICAgICAgbGluZS1oZWlnaHQ6IDMwcHg7DQogICAgICAgIHBhZGRpbmc6IDAgMjNweDsNCiAgICAgIH0NCiAgICAgIC5leHBvcnQtb3B0aW9uLXRyZWUgew0KICAgICAgICBtYXgtaGVpZ2h0OiAyNjVweDsNCiAgICAgICAgb3ZlcmZsb3c6IGF1dG87DQogICAgICB9DQoNCiAgICAgIC52eGUtY2hlY2tib3gtZ3JvdXAgew0KICAgICAgICBsaW5lLWhlaWdodDogMjRweDsNCiAgICAgICAgbGluZS1oZWlnaHQ6IG5vcm1hbDsNCiAgICAgICAgLnZ4ZS1jaGVja2JveCB7DQogICAgICAgICAgbWFyZ2luOiAwIDVweCAwIDA7DQogICAgICAgIH0NCiAgICAgICAgLnZ4ZS1jaGVja2JveCArIC52eGUtY2hlY2tib3ggew0KICAgICAgICAgIG1hcmdpbjogMCA1cHggMCAwOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAudnhlLWNoZWNrYm94LWdyb3VwIHsNCiAgICAgICAgbGluZS1oZWlnaHQ6IDI0cHg7DQogICAgICB9DQogICAgfQ0KICB9DQogIC5idG4tZ3JvdXAgew0KICAgIHRleHQtYWxpZ246IHJpZ2h0Ow0KICAgIHBhZGRpbmc6IDAgMjBweDsNCiAgICAudnhlLWJ1dHRvbiB7DQogICAgICBib3JkZXItcmFkaXVzOiA2cHg7DQogICAgfQ0KICB9DQp9DQo="},{"version":3,"sources":["Export.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Export.vue","sourceRoot":"src/components/TableBak/export","sourcesContent":["<template>\r\n  <vxe-modal\r\n    v-model=\"exportModalVisible\"\r\n    title=\"导出参数设置\"\r\n    width=\"660\"\r\n    height=\"auto\"\r\n    remember\r\n    transfer\r\n  >\r\n    <div class=\"export-module\">\r\n      <vxe-form\r\n        :data=\"exportModalFormData\"\r\n        size=\"medium\"\r\n        title-width=\"120\"\r\n        title-align=\"right\"\r\n        align=\"left\"\r\n        title-colon\r\n      >\r\n        <vxe-form-item title=\"名称\" field=\"fileName\" :span=\"24\">\r\n          <template v-slot>\r\n            <vxe-input v-model=\"exportModalFormData.fileName\" placeholder=\"请输入文件名\" clearable />\r\n          </template>\r\n        </vxe-form-item>\r\n        <vxe-form-item title=\"保存类型\" field=\"saveType\" :span=\"24\">\r\n          <template v-slot>\r\n            <vxe-select v-model=\"exportModalFormData.saveType\" placeholder=\"请选择保存类型\" clearable>\r\n              <vxe-option value=\".xlsx\" label=\"Excel 工作簿(*.xlsx)\" />\r\n              <!-- <vxe-option value=\".csv\" label=\"CSV (逗号分隔)(*.csv)\" /> -->\r\n            </vxe-select>\r\n          </template>\r\n        </vxe-form-item>\r\n        <vxe-form-item title=\"要导出的数据\" field=\"saveType\" :span=\"24\">\r\n          <template v-slot>\r\n            <vxe-select v-model=\"exportModalFormData.dataType\" placeholder=\"要导出的数据\" clearable>\r\n              <vxe-option value=\"fullData\" label=\"当前页数据\" />\r\n              <vxe-option value=\"selection\" label=\"选中数据\" />\r\n              <!-- <vxe-option value=\"allData\" label=\"所有数据\" /> -->\r\n            </vxe-select>\r\n          </template>\r\n        </vxe-form-item>\r\n        <vxe-form-item title=\"导出列选项\" field=\"exportOption\" :span=\"24\">\r\n          <template v-slot>\r\n            <div class=\"export-option\">\r\n              <div class=\"export-option-title\">\r\n                <vxe-checkbox\r\n                  v-model=\"checkAllColumns\"\r\n                  label=\"allFields\"\r\n                  content=\"全部列\"\r\n                  size=\"medium\"\r\n                />\r\n              </div>\r\n              <div class=\"export-option-tree\">\r\n                <el-tree\r\n                  ref=\"exportColumsTree\"\r\n                  :data=\"columns\"\r\n                  show-checkbox\r\n                  node-key=\"nestedId\"\r\n                  default-expand-all\r\n                  :default-checked-keys=\"defaultCheckedKeys\"\r\n                  :props=\"defaultProps\"\r\n                />\r\n              </div>\r\n            </div>\r\n          </template>\r\n        </vxe-form-item>\r\n        <vxe-form-item title=\"导出类型\" field=\"exportOption\" :span=\"24\">\r\n          <template v-slot>\r\n            <div class=\"vxe-checkbox-group fn-inline\">\r\n              <vxe-checkbox\r\n                v-model=\"exportModalFormData.isExportOnlySourceField\"\r\n                label=\"isExportOnlySourceField\"\r\n                content=\"只导出表列字段\"\r\n                size=\"medium\"\r\n              />\r\n              <vxe-checkbox\r\n                v-model=\"exportModalFormData.isExportOnlyViewTitle\"\r\n                label=\"isExportOnlySourceField\"\r\n                content=\"只导出表列名称\"\r\n                size=\"medium\"\r\n              />\r\n            </div>\r\n          </template>\r\n        </vxe-form-item>\r\n        <vxe-form-item v-if=\"!(exportModalFormData.isExportOnlySourceField || exportModalFormData.isExportOnlyViewTitle)\" title=\"导出选项\" field=\"exportOption\" :span=\"24\">\r\n          <template v-slot>\r\n            <div class=\"vxe-checkbox-group\">\r\n              <vxe-checkbox\r\n                v-model=\"exportModalFormData.isExportHead\"\r\n                label=\"isExportHead\"\r\n                content=\"表头\"\r\n                size=\"medium\"\r\n              />\r\n              <vxe-checkbox\r\n                v-model=\"exportModalFormData.isExportFooter\"\r\n                label=\"isExportFooter\"\r\n                content=\"表尾\"\r\n                size=\"medium\"\r\n              />\r\n              <vxe-checkbox\r\n                v-model=\"exportModalFormData.isExportData\"\r\n                label=\"isExportData\"\r\n                content=\"视图数据\"\r\n                size=\"medium\"\r\n              />\r\n              <vxe-checkbox\r\n                v-model=\"exportModalFormData.isExportOriginalData\"\r\n                label=\"isExportOriginalData\"\r\n                content=\"源数据\"\r\n                size=\"medium\"\r\n              />\r\n            </div>\r\n          </template>\r\n        </vxe-form-item>\r\n        <vxe-form-item title=\"其他导出选项\" field=\"exportOption\" :span=\"24\">\r\n          <template v-slot>\r\n            <div class=\"vxe-checkbox-group\">\r\n              <vxe-checkbox\r\n                v-model=\"exportModalFormData.isExportTree\"\r\n                label=\"isExportTree\"\r\n                content=\"导出树形数据\"\r\n                size=\"medium\"\r\n              />\r\n            </div>\r\n          </template>\r\n        </vxe-form-item>\r\n      </vxe-form>\r\n      <div class=\"btn-group\">\r\n        <vxe-button size=\"medium\" content=\"中等尺寸\" @click=\"onPrintClick\">打印</vxe-button>\r\n        <vxe-button type=\"submit\" status=\"primary\" size=\"medium\" @click=\"onExportClick\">导出</vxe-button>\r\n      </div>\r\n    </div>\r\n  </vxe-modal>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: 'Export',\r\n  components: {},\r\n  props: {\r\n    exportModalVisible: {\r\n      type: Boolean\r\n    },\r\n    exportModalData: {\r\n      type: Object,\r\n      default() {\r\n        return {}\r\n      }\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n      exportModalFormData: {\r\n        saveType: '.xlsx',\r\n        fileName: 'export.xlsx', // 文件名\r\n        dataType: 'fullData',\r\n        isExportHead: true, // 是否导出表头\r\n        isExportFooter: true, // 是否导出表尾部\r\n        isExportOriginalData: true, // 是否导出源数据\r\n        isExportData: true, // 是否导出数据\r\n        columns: [], // 表头配置\r\n        datas: [], // 源数据,\r\n        selection: [], // 选中数据\r\n        isExportTree: false,\r\n        ignoreColsTypes: [], // 忽略导出的列类型\r\n        viewValueFormat(value, row, column) {\r\n          // 视图数据格式化方法\r\n          // return value\r\n        }\r\n      },\r\n      columns: [\r\n        // {\r\n        //   id: 1,\r\n        //   title: '一级 1',\r\n        //   children: [\r\n        //     {\r\n        //       id: 4,\r\n        //       title: '二级 1-1',\r\n        //       children: [\r\n        //         {\r\n        //           id: 9,\r\n        //           title: '三级 1-1-1'\r\n        //         },\r\n        //         {\r\n        //           id: 10,\r\n        //           title: '三级 1-1-2'\r\n        //         }\r\n        //       ]\r\n        //     }\r\n        //   ]\r\n        // },\r\n        // {\r\n        //   id: 2,\r\n        //   title: '一级 2',\r\n        //   children: [\r\n        //     {\r\n        //       id: 5,\r\n        //       title: '二级 2-1'\r\n        //     },\r\n        //     {\r\n        //       id: 6,\r\n        //       title: '二级 2-2'\r\n        //     }\r\n        //   ]\r\n        // },\r\n        // {\r\n        //   id: 3,\r\n        //   title: '一级 3',\r\n        //   children: [\r\n        //     {\r\n        //       id: 7,\r\n        //       title: '二级 3-1'\r\n        //     },\r\n        //     {\r\n        //       id: 8,\r\n        //       title: '二级 3-2'\r\n        //     }\r\n        //   ]\r\n        // }\r\n      ],\r\n      defaultProps: {\r\n        children: 'children',\r\n        label: 'title'\r\n      },\r\n      defaultCheckedKeys: [],\r\n      checkAllColumns: false\r\n    }\r\n  },\r\n  methods: {\r\n    deepCopy(obj) {\r\n      // 深拷贝通用方法\r\n      if (typeof obj !== 'object' || obj === null) return obj\r\n      let newObj = obj instanceof Array ? [] : {}\r\n      for (let key in obj) {\r\n        if (obj.hasOwnProperty(key)) {\r\n          newObj[key] =\r\n            typeof obj[key] === 'object' ? this.deepCopy(obj[key]) : obj[key]\r\n        }\r\n      }\r\n      return newObj\r\n    },\r\n    generateTree(arr) {\r\n      // 平行数据转化树形数据\r\n      let copy = this.deepCopy(arr)\r\n      let obj = {}\r\n      copy.forEach((item, index) => {\r\n        delete item.children\r\n        obj[item.nestedId] = item\r\n      })\r\n      let res = []\r\n      copy.forEach((item) => {\r\n        if (item.nestedPid === 0) {\r\n          res.push(item)\r\n        }\r\n        for (let key in obj) {\r\n          if (item.nestedId === obj[key].nestedPid) {\r\n            if (item.children) {\r\n              item.children.push(obj[key])\r\n            } else {\r\n              item.children = [obj[key]]\r\n            }\r\n          }\r\n        }\r\n      })\r\n      return res\r\n    },\r\n    deepEachTraversalArr(data, cb) {\r\n      // 深度递归遍历新增嵌套索引关系\r\n      deepEachTraversalArrFn(data)\r\n      return data\r\n      function deepEachTraversalArrFn(root, nestedId, cb) {\r\n        if (Array.isArray(root) && root.length) {\r\n          root.forEach((item, index) => {\r\n            item.sortIndex = index\r\n            item.nestedPid = nestedId === undefined ? 0 : nestedId\r\n            item.nestedId =\r\n              nestedId !== undefined ? nestedId + '_' + (index + 1) : index + 1\r\n            cb && typeof cb === 'function' && cb(root)\r\n            if (item.children && item.children.length) {\r\n              deepEachTraversalArrFn(item.children, item.nestedId)\r\n            }\r\n          })\r\n        }\r\n      }\r\n    },\r\n    setExportColumns(columns, ignoreColsTypes) {\r\n      // 设置导出列\r\n      columns = columns.filter((item) => {\r\n        return ignoreColsTypes.indexOf(item.type) < 0\r\n      })\r\n      columns.unshift({ title: '序号', field: 'seqIndex', type: 'seqIndex' })\r\n      return this.filterColums(columns, 'visible', false)\r\n    },\r\n    filterColums(columns, key, value) {\r\n      // 过滤,属性key不等于Value过滤\r\n      let self = this\r\n      return columns.filter((item, index) => {\r\n        if (\r\n          item.children &&\r\n          item.children.length &&\r\n          (item[key] !== value || item[key] === undefined)\r\n        ) {\r\n          item.children = self.filterColums(item.children, key, value)\r\n          return true\r\n        } else {\r\n          return item[key] !== value\r\n        }\r\n      })\r\n    },\r\n    valiAndSet(exportModalFormData) {\r\n      //  exportModalFormData: {\r\n      //         saveType: '.xlsx',\r\n      //         fileName: 'export.xlsx', // 文件名\r\n      //         dataType: 'fullData',\r\n      //         isExportHead: true, // 是否导出表头\r\n      //         isExportFooter: true, // 是否导出表尾部\r\n      //         isExportOriginalData: true, // 是否导出源数据\r\n      //         isExportData: true, // 是否导出数据\r\n      //         columns: [], // 表头配置\r\n      //         datas: [], // 源数据,\r\n      //         selection: [], // 选中数据\r\n      //         ignoreColsTypes: [], // 忽略导出的列类型\r\n      //         viewValueFormat(value, row, column) { // 视图数据格式化方法\r\n      //         // return value\r\n      //         }\r\n      //       },\r\n      let { fileName } = exportModalFormData\r\n      let reg = new RegExp('^[a-zA-Z0-9-_\\u4e00-\\u9fa5]{0,2000}$', 'ig')\r\n      if (!reg.test(fileName)) {\r\n        fileName = this.exportModalData.fileName\r\n      }\r\n      exportModalFormData.fileName = fileName\r\n      return exportModalFormData\r\n    },\r\n    init() {\r\n      this.exportModalFormData = Object.assign(\r\n        {},\r\n        this.exportModalFormData,\r\n        this.exportModalData\r\n      )\r\n      this.columns = this.deepEachTraversalArr(\r\n        this.setExportColumns(\r\n          this.exportModalFormData.columns,\r\n          this.exportModalFormData.ignoreColsTypes\r\n        )\r\n      )\r\n      this.checkAllColumns = true\r\n      this.defaultCheckedKeys = this.columns.map((item, index) => {\r\n        return item.nestedId\r\n      })\r\n    },\r\n    onPrintClick() {\r\n      // 打印点击事件\r\n    },\r\n    onExportClick() {\r\n      // 导出点击事件\r\n      let exportColumns = this.generateTree(\r\n        this.$refs.exportColumsTree\r\n          .getCheckedNodes()\r\n          .concat(this.$refs.exportColumsTree.getHalfCheckedNodes())\r\n      ).sort((a, b) => {\r\n        return a.sortIndex - b.sortIndex\r\n      })\r\n      let exportModalFormData = Object.assign({}, this.exportModalFormData, {\r\n        columns: exportColumns\r\n      })\r\n      exportModalFormData = this.valiAndSet(exportModalFormData)\r\n      this.$emit('onExportClick', exportModalFormData)\r\n    }\r\n  },\r\n  mounted() {},\r\n  watch: {\r\n    exportModalVisible: {\r\n      handler(newVal) {\r\n        this.$emit('update:exportModalVisible', newVal)\r\n        if (newVal) {\r\n          this.init()\r\n        }\r\n      },\r\n      immediate: true\r\n    },\r\n    exportModalFormData: {\r\n      handler() {},\r\n      deep: true,\r\n      immediate: true\r\n    },\r\n    checkAllColumns: {\r\n      handler(newValue) {\r\n        if (newValue) {\r\n          this.$refs.exportColumsTree &&\r\n            this.$refs.exportColumsTree.setCheckedNodes(this.columns)\r\n        } else {\r\n          this.$refs.exportColumsTree &&\r\n            this.$refs.exportColumsTree.setCheckedNodes([])\r\n        }\r\n      },\r\n      immediate: true\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang='scss'>\r\n.export-module {\r\n  padding: 0 0 20px 0;\r\n  .vxe-form {\r\n    padding: 0 60px;\r\n    margin: 0 auto;\r\n    .vxe-form--item {\r\n      padding: 3px 0;\r\n    }\r\n    .export-option {\r\n      border: 1px solid #dcdfe6;\r\n      margin: 3px 0;\r\n      border-radius: 4px;\r\n      user-select: none;\r\n      .export-option-title {\r\n        background-color: #f8f8f9;\r\n        font-weight: 700;\r\n        border-bottom: 1px solid #dadce0;\r\n        line-height: 30px;\r\n        padding: 0 23px;\r\n      }\r\n      .export-option-tree {\r\n        max-height: 265px;\r\n        overflow: auto;\r\n      }\r\n\r\n      .vxe-checkbox-group {\r\n        line-height: 24px;\r\n        line-height: normal;\r\n        .vxe-checkbox {\r\n          margin: 0 5px 0 0;\r\n        }\r\n        .vxe-checkbox + .vxe-checkbox {\r\n          margin: 0 5px 0 0;\r\n        }\r\n      }\r\n      .vxe-checkbox-group {\r\n        line-height: 24px;\r\n      }\r\n    }\r\n  }\r\n  .btn-group {\r\n    text-align: right;\r\n    padding: 0 20px;\r\n    .vxe-button {\r\n      border-radius: 6px;\r\n    }\r\n  }\r\n}\r\n</style>\r\n"]}]}