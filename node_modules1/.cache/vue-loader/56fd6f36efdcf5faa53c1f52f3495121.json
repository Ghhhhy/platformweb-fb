{"remainingRequest":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\何小龙\\Desktop\\platformweb-fb\\src\\directive\\html2canvasDirective\\DownHtml.vue?vue&type=style&index=0&id=1767be23&lang=scss&scoped=true&","dependencies":[{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\src\\directive\\html2canvasDirective\\DownHtml.vue","mtime":1694505522119},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKDQouZG93bi1pY29uLXdyYXBwZXIgew0KICBwb3NpdGlvbjogYWJzb2x1dGU7DQogIHJpZ2h0OiAycHg7DQogIHRvcDogNHB4Ow0KICBjdXJzb3I6IHBvaW50ZXI7DQogIHpJbmRleDogMTA7DQp9DQouZG93bmxvYWQtaWNvbiB7DQogIHdpZHRoOiAxNnB4Ow0KfQ0K"},{"version":3,"sources":["DownHtml.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"DownHtml.vue","sourceRoot":"src/directive/html2canvasDirective","sourcesContent":["<template>\r\n  <div\r\n    class=\"down-icon-wrapper html2canvas-ignore\"\r\n    title=\"下载为图片\"\r\n    @click=\"downTrigger\"\r\n  >\r\n    <svg\r\n      t=\"1675996435068\"\r\n      class=\"icon download-icon\"\r\n      viewBox=\"0 0 1024 1024\"\r\n      version=\"1.1\"\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n      p-id=\"6832\"\r\n      xmlns:xlink=\"http://www.w3.org/1999/xlink\"\r\n      width=\"32\"\r\n      height=\"32\"\r\n    >\r\n      <path d=\"M372.8 0.256v366.144H189.76l305.088 366.144L800 366.4H616.96V0.256zM128.64 901.76h732.288v121.984H128.64z\" fill=\"#2A8BFD\" p-id=\"6833\" />\r\n    </svg>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport html2canvas from 'html2canvas'\r\n\r\nexport default {\r\n  name: 'DownHtml',\r\n  props: {\r\n    // 保存的文件名称\r\n    fileName: {\r\n      type: String,\r\n      default: 'echarts'\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n    }\r\n  },\r\n  methods: {\r\n    // 点击下载按钮触发器\r\n    async downTrigger() {\r\n      if (!this.$el?.parentElement) return\r\n      await this.$nextTick()\r\n      try {\r\n        this.htmlToCanvas()\r\n      } catch (e) {\r\n        console.log(e)\r\n      }\r\n    },\r\n    htmlToCanvas () {\r\n      // 获取需要转canvas元素的宽高\r\n      const { width, height } = this.$el.parentElement?.getBoundingClientRect?.()\r\n      // 开始转换\r\n      html2canvas(this.$el.parentElement, {\r\n        width,\r\n        height,\r\n        // 过滤掉不需要的元素\r\n        ignoreElements: element => {\r\n          // compareDocumentPosition比较节点与指定节点相对位置\r\n          // 例如：P1.compareDocumentPosition(P2)\r\n          // 0：自身\r\n          // 1：没有关系，这两个节点不属于同一个文档。\r\n          // 2：第一节点（P1）位于第二个节点后（P2）。\r\n          // 4：第一节点（P1）定位在第二节点（P2）前。\r\n          // 8：第一节点（P1）位于第二节点内（P2）。\r\n          // 16：第二节点（P2）位于第一节点内（P1）。\r\n          const positionIndex = this.$el?.parentElement?.compareDocumentPosition?.(element)\r\n\r\n          // 重要！！！\r\n          // 保留样式。因为样式在head标签内，所以要将html、head也要保留，否则下载的图片样式有丢失\r\n          const whiteNodeNames = ['STYLE', 'HTML', 'HEAD']\r\n          const nodeType = element.nodeName?.toUpperCase?.()\r\n\r\n          // 过滤html2canvas-ignore类名的元素\r\n          const hasClass = element.classList?.contains?.('html2canvas-ignore')\r\n\r\n          return whiteNodeNames.includes(nodeType) ? false : (positionIndex !== 0 && positionIndex < 8) || hasClass\r\n        }\r\n      })\r\n        .then(canvas => {\r\n          this.downLoad(canvas)\r\n        })\r\n    },\r\n    // 将canvas转dataUrl，并利用a标签下载\r\n    downLoad(canvas) {\r\n      const dataUrl = canvas.toDataURL('image/png', 1.0)\r\n      const tempLink = document.createElement('a')\r\n      tempLink.style.display = 'none'\r\n      tempLink.href = dataUrl\r\n      tempLink.setAttribute('download', `${this.fileName}.png`)\r\n      // 不支持就另开页签开打\r\n      if (typeof tempLink.download === 'undefined') {\r\n        tempLink.setAttribute('target', '_blank')\r\n      }\r\n      document.body.appendChild(tempLink)\r\n      tempLink.click()\r\n      document.body.removeChild(tempLink)\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.down-icon-wrapper {\r\n  position: absolute;\r\n  right: 2px;\r\n  top: 4px;\r\n  cursor: pointer;\r\n  zIndex: 10;\r\n}\r\n.download-icon {\r\n  width: 16px;\r\n}\r\n</style>\r\n"]}]}