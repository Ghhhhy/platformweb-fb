{"remainingRequest":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\何小龙\\Desktop\\platformweb-fb\\src\\views\\main\\MointoringMatters\\threePublicExpensesTableEntry\\index.vue?vue&type=style&index=1&lang=scss&","dependencies":[{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\src\\views\\main\\MointoringMatters\\threePublicExpensesTableEntry\\index.vue","mtime":1695716045256},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\css-loader\\dist\\cjs.js","mtime":1696752946978},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoNCi5icy10YWJsZS1oZWFkZXItY2VsbCB7DQogIGZvbnQtc2l6ZTogdmFyKC0tYnMtdGFibGUtZm9udC1zaXplKTsNCiAgZm9udC13ZWlnaHQ6IGJvbGQ7DQogIGJhY2tncm91bmQ6IHZhcigtLWhpZ2h0bGlnaHQtY29sb3IpOw0KfQ0K"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAudA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/main/MointoringMatters/threePublicExpensesTableEntry","sourcesContent":["<template>\r\n  <div class=\"table-entry\" style=\"height: 100%\">\r\n    <BsMainFormListLayout :left-visible.sync=\"leftTreeVisible\">\r\n      <template v-slot:topTabPane>\r\n        <BsTabPanel\r\n          :tab-status-btn-config=\"tabStatusBtnConfig\"\r\n          @tabClick=\"onTabClick\"\r\n          @onQueryConditionsClick=\"onQueryConditionsClick\"\r\n        />\r\n      </template>\r\n      <template v-slot:query>\r\n        <div v-show=\"isShowSearchForm\" class=\"main-query\">\r\n          <BsQuery\r\n            ref=\"queryFrom\"\r\n            :query-form-item-config=\"formSchemas\"\r\n            :query-form-data=\"formData\"\r\n            @onSearchClick=\"search\"\r\n            @register=\"registerForm\"\r\n          />\r\n        </div>\r\n      </template>\r\n      <template v-slot:mainTree>\r\n        <BsTreeTitle\r\n          :visiable.sync=\"leftTreeVisible\"\r\n          :input-value.sync=\"treeFilterText\"\r\n          placeholder=\"搜索区划\"\r\n        />\r\n        <BsTree\r\n          ref=\"leftTree\"\r\n          open-loading\r\n          :filter-text=\"treeFilterText\"\r\n          :config=\"{ expandOnClickNode: false, showFilter: false, treeProps }\"\r\n          :tree-data=\"treeData\"\r\n          @onNodeClick=\"treeNodeClick\"\r\n        />\r\n      </template>\r\n      <template v-slot:mainForm>\r\n        <div class=\"table-header\">\r\n          <div class=\"table-header-left\">\r\n            <div\r\n              v-if=\"!leftTreeVisible\"\r\n              class=\"ri-indent-wrapper\"\r\n              style=\"marginRight: 8px\"\r\n              @click=\"setLeftTreeVisible\"\r\n            >\r\n              <i class=\"ri-indent-decrease\"></i>\r\n            </div>\r\n            <el-button-group>\r\n              <el-button\r\n                v-for=\"tab in tableTabs\"\r\n                :key=\"tab.value\"\r\n                size=\"small\"\r\n                :type=\"tab.value === currentTableTab ? 'primary' : ''\"\r\n                @click=\"changeTableTab(tab.value)\"\r\n              >\r\n                {{ tab.label }}\r\n              </el-button>\r\n            </el-button-group>\r\n            <p class=\"table-top-tips\">{{ tableTips }}</p>\r\n          </div>\r\n          <div class=\"table-header-right\">\r\n            <span>单位：万元</span>\r\n          </div>\r\n        </div>\r\n        <div style=\"height: calc(100% - 60px)\">\r\n          <vxe-grid\r\n            ref=\"tableRef\"\r\n            :loading=\"tableLoadingState\"\r\n            show-overflow=\"tooltip\"\r\n            show-header-overflow=\"tooltip\"\r\n            header-cell-class-name=\"bs-table-header-cell\"\r\n            :columns=\"currentColumns\"\r\n            :data=\"tableData\"\r\n            :edit-config=\"editConfig\"\r\n            :valid-config=\"validConfig\"\r\n            :edit-rules=\"editRules\"\r\n            :footer-method=\"\r\n              currentTableTab !== TableTabsEnum.MONITOR_BASIC_INFORMATION\r\n                ? footerMethod\r\n                : () => []\r\n            \"\r\n            size=\"mini\"\r\n            :empty-text=\"\r\n              currentTab === TabEnum.UNSUBMIT\r\n                ? '暂无数据，如需录入数据请新增行'\r\n                : '暂无数据'\r\n            \"\r\n            auto-resize\r\n            sync-resize\r\n            show-footer\r\n            stripe\r\n            border\r\n            height=\"auto\"\r\n          >\r\n            <template v-if=\"tableFooterTips[currentTableTab]\" #bottom>\r\n              <p class=\"table-bottom-tips\">\r\n                {{ tableFooterTips[currentTableTab] }}\r\n              </p>\r\n            </template>\r\n          </vxe-grid>\r\n        </div>\r\n      </template>\r\n    </BsMainFormListLayout>\r\n    <AddRowsModal\r\n      v-if=\"addRowsModalVisible\"\r\n      v-model=\"addRowsModalVisible\"\r\n      @addRows=\"addRows\"\r\n    />\r\n    <ImportModel\r\n      :file-config=\"fileConfig\"\r\n      :import-modal-visible.sync=\"importModalVisible\"\r\n      @onDownloadTemplateClick=\"() => exportHandle('下载成功！','template')\"\r\n      @onImportClick=\"onImportClick\"\r\n      @onImportFileClick=\"onImportFileClick\"\r\n    />\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n  defineComponent,\r\n  ref,\r\n  unref,\r\n  computed,\r\n  watch\r\n} from '@vue/composition-api'\r\nimport AddRowsModal from './components/AddRowsModal'\r\nimport ImportModel from '@/components/Table/import/import.vue'\r\n\r\nimport useForm from '@/hooks/useForm'\r\nimport useTree from '@/hooks/useTree'\r\nimport useTabPlanel from './hooks/useTabPlanel'\r\nimport useTableTab from './hooks/useTableTab'\r\nimport useImport from './hooks/useImport'\r\nimport useTable from './hooks/useTable'\r\nimport useFetchTable from '@/hooks/useTable'\r\n\r\nimport {\r\n  formSchemas as formSchemasOrigin,\r\n  tableColumnsByNoBudget,\r\n  tableColumnsByFundsIsNotStandardized,\r\n  tableFooterTips,\r\n  tableColumnsByMonitorBasicInfo,\r\n  tableColumnsByBudgetExecuteMonitor\r\n} from './model/data'\r\nimport { TabEnum, TableTabsEnum } from './model/enum'\r\nimport HttpModule from '@/api/frame/main/Monitoring/FinancialBasicTableEntry.js'\r\nimport store from '@/store'\r\nimport { generateEditorRules, generateRows } from './utils'\r\nimport { getThreePublicTable } from '@/api/frame/main/fundMonitoring/threePublicExpensesTableEntry.js'\r\n\r\nexport default defineComponent({\r\n  components: { AddRowsModal, ImportModel },\r\n  setup() {\r\n    // 左侧树是否显示\r\n    const leftTreeVisible = ref(true)\r\n    function setLeftTreeVisible(visible = true) {\r\n      leftTreeVisible.value = visible\r\n    }\r\n\r\n    /**\r\n     * 搜索表单\r\n     */\r\n    const [{ formData, formSchemas, setSubmitFormData }, registerForm] =\r\n      useForm(formSchemasOrigin)\r\n\r\n    /**\r\n     * 获取区划wheresql参数\r\n     * @param {string} province 区划码\r\n     * */\r\n    function getWheresql(province) {\r\n      for (let item of [9, 7, 5]) {\r\n        const arr = province.slice(11 - item)\r\n        const set = new Set(arr)\r\n        if (set.size === 1) {\r\n          return province.slice(0, 11 - item)\r\n        }\r\n      }\r\n      return province\r\n    }\r\n    // 当前选中的区划树节点\r\n    const currentTreeNode = ref(null)\r\n    /**\r\n     * 区划树\r\n     * */\r\n    const {\r\n      treeProps,\r\n      treeData,\r\n      treeFilterText,\r\n      fetchTreeData,\r\n      getTree,\r\n      treeLoading,\r\n      register: treeRegister\r\n    } = useTree({\r\n      fetch: HttpModule.getLeftTree,\r\n      beforeFetch: (params) => {\r\n        const { province, year } = store.state.userInfo\r\n        return {\r\n          ...params,\r\n          elementcode: 'admdiv',\r\n          province,\r\n          year: year,\r\n          wheresql: 'and code like ' + getWheresql(province) + '%'\r\n        }\r\n      },\r\n      treeProps: {\r\n        nodeKey: 'code'\r\n      }\r\n    })\r\n\r\n    /**\r\n     * 区划树节点点击\r\n     * */\r\n    function treeNodeClick({ node }) {\r\n      currentTreeNode.value = node\r\n      fetchTableData()\r\n    }\r\n\r\n    /**\r\n     * 搜索\r\n     * @param val\r\n     */\r\n    function search(val) {\r\n      setSubmitFormData(val)\r\n      fetchTableData()\r\n    }\r\n\r\n    /**\r\n     * 表格顶部tab\r\n     */\r\n    const { tableTabs, currentTableTab, changeTableTab } = useTableTab()\r\n    // 当前显示的列\r\n    const currentColumns = computed(() => {\r\n      const columnsMap = {\r\n        [TableTabsEnum.MONITOR_BASIC_INFORMATION]:\r\n          tableColumnsByMonitorBasicInfo,\r\n        [TableTabsEnum.NO_BUDGET]: tableColumnsByNoBudget,\r\n        [TableTabsEnum.FUNDS_IS_NOT_STANDARDIZED]:\r\n          tableColumnsByFundsIsNotStandardized,\r\n        [TableTabsEnum.BUDGET_MONITOR]: tableColumnsByBudgetExecuteMonitor\r\n      }\r\n      return columnsMap[unref(currentTableTab)]\r\n    })\r\n\r\n    /**\r\n     * 表格模块\r\n     * */\r\n    const {\r\n      editConfig,\r\n      validConfig,\r\n      editRules,\r\n      setTableEditorState,\r\n      footerMethod\r\n    } = useTable(unref(currentColumns), currentTableTab)\r\n\r\n    // 请求参数\r\n    const requestPayload = computed(() => {\r\n      const [fiscalYear, month] = formData.month?.split('-') || ['', '']\r\n      return {\r\n        fiscalYear,\r\n        month,\r\n        status: unref(currentTab),\r\n        reportType: unref(currentTableTab),\r\n        mofDivCode: unref(currentTreeNode)?.code\r\n      }\r\n    })\r\n\r\n    const tableTips = ref('')\r\n    const [{ tableData, tableRef, fetchTableData, tableLoadingState }] =\r\n      useFetchTable({\r\n        dataKey: requestPayload.value.reportType === 4 ? 'data.dataSummary' : 'data.datas',\r\n        openPager: false,\r\n        fetch: getThreePublicTable,\r\n        // 请求前置钩子\r\n        beforeFetch(params) {\r\n          return {\r\n            ...params,\r\n            ...unref(requestPayload)\r\n          }\r\n        },\r\n        // 请求后置钩子\r\n        afterFetch(data) {\r\n          // 未提交页卡\r\n          const isUncommitted = unref(currentTab) === TabEnum.UNSUBMIT\r\n          // 监控基础信息表\r\n          const isMonitorBasicInfo =\r\n            unref(currentTableTab) === TableTabsEnum.MONITOR_BASIC_INFORMATION\r\n          if (!data?.datas?.length && isUncommitted && isMonitorBasicInfo) {\r\n            data.datas = generateRows(1, unref(currentColumns))\r\n          }\r\n          if (unref(requestPayload).reportType === 4) {\r\n            data.datas = unref(data.dataSummary)\r\n          }\r\n          // 表格tips信息\r\n          tableTips.value = data?.hint || ''\r\n          return data\r\n        }\r\n      })\r\n\r\n    /**\r\n     * 文件导入\r\n     * */\r\n    const { fileConfig, importModalVisible, onImportClick, onImportFileClick } =\r\n      useImport(currentColumns, tableData)\r\n\r\n    /**\r\n     * tab区域\r\n     */\r\n    const {\r\n      tabStatusBtnConfig,\r\n      onQueryConditionsClick,\r\n      isShowSearchForm,\r\n      addRowsModalVisible,\r\n      addRows,\r\n      exportHandle,\r\n      currentTab,\r\n      onTabClick,\r\n      updateButtons\r\n    } = useTabPlanel(\r\n      tableRef,\r\n      currentColumns,\r\n      tableData,\r\n      importModalVisible,\r\n      requestPayload,\r\n      fetchTableData\r\n    )\r\n\r\n    /**\r\n     * 监听报表tab切换\r\n     */\r\n    watch(currentTableTab, (curVal, preVal) => {\r\n      if (curVal === preVal) return\r\n      // 更新表格校验规则\r\n      editRules.value = generateEditorRules(unref(currentColumns))\r\n      // 更新按钮\r\n      updateButtons(curVal)\r\n      // 重置表格数据 重新请求\r\n      tableData.value = []\r\n      fetchTableData()\r\n    })\r\n\r\n    /**\r\n     * 监听顶部页卡切换\r\n     */\r\n    watch(currentTab, (val) => {\r\n      // 设置表格编辑状态\r\n      setTableEditorState(val === TabEnum.UNSUBMIT)\r\n      // 重置表格数据 重新请求\r\n      tableData.value = []\r\n      fetchTableData()\r\n    })\r\n\r\n    return {\r\n      leftTreeVisible,\r\n      setLeftTreeVisible,\r\n\r\n      tabStatusBtnConfig,\r\n      onQueryConditionsClick,\r\n      isShowSearchForm,\r\n      onTabClick,\r\n      currentTab,\r\n      TabEnum,\r\n      exportHandle,\r\n\r\n      formData,\r\n      formSchemas,\r\n      search,\r\n      registerForm,\r\n\r\n      treeProps,\r\n      treeData,\r\n      treeFilterText,\r\n      fetchTreeData,\r\n      getTree,\r\n      treeLoading,\r\n      treeNodeClick,\r\n      treeRegister,\r\n\r\n      tableTabs,\r\n      currentTableTab,\r\n      changeTableTab,\r\n      TableTabsEnum,\r\n\r\n      tableColumnsByNoBudget,\r\n      tableColumnsByFundsIsNotStandardized,\r\n      tableFooterTips,\r\n      tableData,\r\n      editConfig,\r\n      validConfig,\r\n      editRules,\r\n      tableRef,\r\n      footerMethod,\r\n      currentColumns,\r\n      tableLoadingState,\r\n      tableTips,\r\n\r\n      addRows,\r\n      addRowsModalVisible,\r\n\r\n      fileConfig,\r\n      importModalVisible,\r\n      onImportClick,\r\n      onImportFileClick\r\n    }\r\n  }\r\n})\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.table-header {\r\n  min-height: 60px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  font-size: 14px;\r\n\r\n  .table-header-left {\r\n    flex: 1;\r\n    display: flex;\r\n    align-items: center;\r\n  }\r\n\r\n  .ri-indent-wrapper {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    width: 32px;\r\n    height: 48px;\r\n    color: #fff;\r\n    font-size: 19px;\r\n    background: var(--primary-color);\r\n  }\r\n}\r\n.table-entry {\r\n  /deep/ .T-mainFormListLayout-modulebox .mmc-formlist {\r\n    margin-left: 0;\r\n  }\r\n  /deep/.vxe-table\r\n    .vxe-body--column.col--ellipsis:not(.col--actived)\r\n    > .vxe-cell {\r\n    white-space: nowrap !important;\r\n  }\r\n  /deep/.vxe-table .vxe-table--empty-content {\r\n    font-size: 16px;\r\n    color: #666;\r\n  }\r\n}\r\n.table-bottom-tips {\r\n  padding: 8px 0;\r\n  font-size: 12px;\r\n}\r\n\r\n.table-top-tips {\r\n  font-size: 1em;\r\n  margin-left: 16px;\r\n  color: #ed411e;\r\n}\r\n/deep/.splitter-pane .el-button--primary.el-button:hover {\r\n  color: #fff !important;\r\n  background-color: var(--secondary-color-hover) !important;\r\n  border-color: var(--secondary-color-hover) !important;\r\n}\r\n/deep/.splitter-pane .el-button:hover {\r\n  color: var(--secondary-color) !important;\r\n  background-color: var(--hightlight-color) !important;\r\n  border-color: var(--secondary-color-hover) !important;\r\n}\r\n\r\n</style>\r\n\r\n<style lang=\"scss\">\r\n.bs-table-header-cell {\r\n  font-size: var(--bs-table-font-size);\r\n  font-weight: bold;\r\n  background: var(--hightlight-color);\r\n}\r\n</style>\r\n"]}]}