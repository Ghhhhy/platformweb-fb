{"remainingRequest":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\何小龙\\Desktop\\platformweb-fb\\src\\views\\main\\handlingOfViolations\\components\\AttachmentInfo.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\src\\views\\main\\handlingOfViolations\\components\\AttachmentInfo.vue","mtime":1694576524765},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgeyBjb21wdXRlZCwgZGVmaW5lQ29tcG9uZW50LCBpbmplY3QsIHVucmVmIH0gZnJvbSAnQHZ1ZS9jb21wb3NpdGlvbi1hcGknDQppbXBvcnQgeyByZWFkTG9jYWxGaWxlIH0gZnJvbSAnQC91dGlscy9yZWFkTG9jYWxGaWxlJw0KaW1wb3J0IHVzZUxvYWRpbmdTdGF0ZSBmcm9tICdAL2hvb2tzL3VzZUxvYWRpbmdTdGF0ZScNCmltcG9ydCB1c2VUYWJsZSBmcm9tICdAL2hvb2tzL3VzZVRhYmxlJw0KaW1wb3J0IHsgRmlsZVN0YXR1c0VudW0sIE1vZGFsVHlwZUVudW0sIFJvdXRlclBhdGhFbnVtIH0gZnJvbSAnLi4vbW9kZWwvZW51bScNCg0KaW1wb3J0IHsgTWVzc2FnZSB9IGZyb20gJ2VsZW1lbnQtdWknDQppbXBvcnQgeyBmaWxlQ29sdW1ucyB9IGZyb20gJy4uL21vZGVsL2RhdGEnDQovLyBkZWxldGVGaWxlDQppbXBvcnQgeyB1cGxvYWRGaWxlIH0gZnJvbSAnQC9hcGkvZnJhbWUvY29tbW9uL2ZpbGUnDQppbXBvcnQgeyBjaGVja1JzY29kZSB9IGZyb20gJ0AvdXRpbHMvY2hlY2tSc2NvZGUnDQppbXBvcnQgeyBkb3dubG9hZEJ5RmlsZUlkIH0gZnJvbSAnQC91dGlscy9kb3dubG9hZCcNCg0KLy8g6ZmE5Lu25pyA5aSn5YC8KDFNKQ0KY29uc3QgbWF4U2l6ZSA9IDEwMjQgKiAxMDI0ICogMTANCmV4cG9ydCBkZWZhdWx0IGRlZmluZUNvbXBvbmVudCh7DQogIHByb3BzOiB7DQogICAgLy8g5paH5Lu25YiX6KGoDQogICAgZmlsZUxpc3Q6IHsNCiAgICAgIHR5cGU6IEFycmF5LA0KICAgICAgZGVmYXVsdDogKCkgPT4gKFtdKQ0KICAgIH0sDQogICAgLy8g5paH5Lu25YiG57uE55qE55qEaWQNCiAgICBiaWxsZ3VpZDogew0KICAgICAgdHlwZTogU3RyaW5nLA0KICAgICAgZGVmYXVsdDogJycNCiAgICB9LA0KICAgIC8vIOWKoOi9veeKtuaAgQ0KICAgIGxvYWRpbmc6IHsNCiAgICAgIHR5cGU6IEJvb2xlYW4sDQogICAgICBkZWZhdWx0OiBmYWxzZQ0KICAgIH0sDQogICAgLy8g5piv5ZCm5b+F5LygDQogICAgcmVxdWlyZWQ6IHsNCiAgICAgIHR5cGU6IFtTdHJpbmcsIE51bWJlciwgQm9vbGVhbl0sDQogICAgICBkZWZhdWx0OiAwDQogICAgfQ0KICB9LA0KICBzZXR1cChwcm9wcywgeyBlbWl0IH0pIHsNCiAgICBjb25zdCBtb2RhbFR5cGUgPSBpbmplY3QoJ21vZGFsVHlwZScpDQoNCiAgICAvLyDpobXpnaLot6/nlLEo5Lmf5Y+vcm9vdOS4reiOt+WPlnJvdXRlKQ0KICAgIGNvbnN0IHBhZ2VQYXRoID0gaW5qZWN0KCdwYWdlUGF0aCcpDQoNCiAgICAvLyDmmK/lkKbmmK/ljZXkvY3lj43ppojpobXpnaINCiAgICBjb25zdCBpc1VuaXRGZWVkYmFja1BhZ2UgPSBjb21wdXRlZCgoKSA9PiB7DQogICAgICBjb25zb2xlLmxvZygnUm91dGVyUGF0aEVudW0nLCBSb3V0ZXJQYXRoRW51bSgpKQ0KICAgICAgcmV0dXJuIHVucmVmKHBhZ2VQYXRoKS5pbmRleE9mKCduaXRGZWVkYmFjaycpICE9PSAtMQ0KICAgIH0pDQoNCiAgICBjb25zdCBbbG9hZGluZ1N0YXRlLCBzZXRMb2FkaW5nU3RhdGVdID0gdXNlTG9hZGluZ1N0YXRlKCkNCiAgICAvKioNCiAgICAgKiDngrnlh7vkuIrkvKANCiAgICAgKiBAcmV0dXJuIHtQcm9taXNlPHZvaWQ+fQ0KICAgICAqLw0KICAgIGFzeW5jIGZ1bmN0aW9uIHVwbG9hZEJ0bkNsaWNrKCkgew0KICAgICAgY29uc3QgeyBmaWxlOiBsb2NhbEZpbGUgfSA9IGF3YWl0IHJlYWRMb2NhbEZpbGUoKQ0KICAgICAgY29uc3Qgew0KICAgICAgICBzaXplOiBmaWxlc2l6ZSwNCiAgICAgICAgbmFtZTogZmlsZW5hbWUNCiAgICAgIH0gPSBsb2NhbEZpbGUNCg0KICAgICAgaWYgKGxvY2FsRmlsZS5zaXplID4gbWF4U2l6ZSkgew0KICAgICAgICBNZXNzYWdlLndhcm5pbmcoJ+aWh+S7tuWkp+Wwj+i2hei/h+mZkOWItizor7fph43mlrDpgInmi6knKQ0KICAgICAgICByZXR1cm4NCiAgICAgIH0NCiAgICAgIHRyeSB7DQogICAgICAgIHNldExvYWRpbmdTdGF0ZSh0cnVlKQ0KICAgICAgICBjb25zdCB7IGRhdGE6IGZpbGVndWlkIH0gPSBjaGVja1JzY29kZSgNCiAgICAgICAgICBhd2FpdCB1cGxvYWRGaWxlKHsNCiAgICAgICAgICAgIGZpbGU6IGxvY2FsRmlsZSwNCiAgICAgICAgICAgIGZpbGVuYW1lLA0KICAgICAgICAgICAgLy8g5paH5Lu25YiG57uE55qEaWQNCiAgICAgICAgICAgIGJpbGxndWlkOiBwcm9wcy5iaWxsZ3VpZA0KICAgICAgICAgIH0pDQogICAgICAgICkNCiAgICAgICAgTWVzc2FnZS5zdWNjZXNzKCfkuIrkvKDmiJDlip/vvIEnKQ0KDQogICAgICAgIC8vIOW+gOi/neinhOWNleS4reWtmOWFpeaWh+S7tuS/oeaBrw0KICAgICAgICBlbWl0KCd1cGxvYWRBZnRlcicsIHsNCiAgICAgICAgICBmaWxlZ3VpZCwNCiAgICAgICAgICBmaWxlbmFtZSwNCiAgICAgICAgICBmaWxlc2l6ZSwNCiAgICAgICAgICBmaWxlOiBsb2NhbEZpbGUsDQogICAgICAgICAgLy8g5L+d55WZDQogICAgICAgICAgc3RhdHVzOiBGaWxlU3RhdHVzRW51bS5SRVRBSU4NCiAgICAgICAgfSkNCiAgICAgIH0gZmluYWxseSB7DQogICAgICAgIHNldExvYWRpbmdTdGF0ZShmYWxzZSkNCiAgICAgIH0NCiAgICB9DQoNCiAgICBjb25zdCBbZGVsZXRlTG9hZGluZywgc2V0RGVsZXRlTG9hZGluZ10gPSB1c2VMb2FkaW5nU3RhdGUoKQ0KICAgIC8qKg0KICAgICAqIOWIoOmZpOaWh+S7tg0KICAgICAqICovDQogICAgYXN5bmMgZnVuY3Rpb24gZGVsZXRlRmlsZUhhbmRsZShmaWxlLCBpbmRleCkgew0KICAgICAgdHJ5IHsNCiAgICAgICAgc2V0RGVsZXRlTG9hZGluZyh0cnVlKQ0KICAgICAgICAvLyDmmoLml7blj5bmtojnq4vljbPku47lubPlj7DliKDpmaTmk43kvZzvvJrlkI7nu63ph43mlrDmiZPlvIDor6XlpITnkIbljZXlkI7moLnmja7lkI7nq6/ov5Tlm57nmoTpmYTku7bliJfooajvvIzlnKjlubPlj7DpmYTku7bph4zpnaLov4fmu6TvvIzlubbliKDpmaTlkI7nq6/msqHmnInlrZjnmoTmlofku7YNCiAgICAgICAgLy8g6YG/5YWN5bmz5Y+w6ZmE5Lu25Yig6Zmk5ZCO77yM55So5oi35Y+W5raI6YCB5a6h44CB56Gu6K6k5pON5L2cIOWvvOiHtOaVsOaNruS4jeS4gOiHtOmXrumimA0KICAgICAgICAvLyBjaGVja1JzY29kZShhd2FpdCBkZWxldGVGaWxlKGZpbGUuZmlsZWd1aWQpKQ0KICAgICAgICBNZXNzYWdlLnN1Y2Nlc3MoJ+WIoOmZpOaIkOWKn++8gScpDQogICAgICAgIGVtaXQoJ2RlbGV0ZUZpbGUnLCB7DQogICAgICAgICAgZmlsZSwNCiAgICAgICAgICBpbmRleA0KICAgICAgICB9KQ0KICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgc2V0RGVsZXRlTG9hZGluZyhmYWxzZSkNCiAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiDkuIvovb3pmYTku7YNCiAgICAgKiAqLw0KICAgIGZ1bmN0aW9uIGRvd25sb2FkSGFuZGxlKHsgcm93IH0pIHsNCiAgICAgIGRvd25sb2FkQnlGaWxlSWQocm93LmZpbGVndWlkKQ0KICAgIH0NCg0KICAgIC8vIOaTjeS9nOWIlw0KICAgIGNvbnN0IGNvbHVtbkFjdGlvbnMgPSBbDQogICAgICB7DQogICAgICAgIGxhYmVsOiAn5LiL6L29JywNCiAgICAgICAgLy8gcmktZG93bmxvYWQtY2xvdWQtZmlsbA0KICAgICAgICBjbGFzczogJ2N1cnNvciBmLWMtYycsDQogICAgICAgIGhhbmRsZTogZG93bmxvYWRIYW5kbGUNCiAgICAgIH0NCiAgICBdDQogICAgLyoqDQogICAgICog6KGo5qC8DQogICAgICogKi8NCiAgICBjb25zdCBbDQogICAgICB7DQogICAgICAgIGNvbHVtbnMsDQogICAgICAgIHRhYmxlQ29uZmlnDQogICAgICB9DQogICAgXSA9IHVzZVRhYmxlKHsNCiAgICAgIGNvbHVtbkFjdGlvbnMsDQogICAgICBjb2x1bW5zOiBmaWxlQ29sdW1ucw0KICAgIH0pDQoNCiAgICAvLyDlhajlsYDphY3nva4NCiAgICB0YWJsZUNvbmZpZy5nbG9iYWxDb25maWcgPSB7DQogICAgICBjaGVja1R5cGU6IGZhbHNlLA0KICAgICAgc2VxOiB0cnVlLA0KICAgICAgY2VsbENsaWNrQ2hlY2s6IGZhbHNlDQogICAgfQ0KICAgIHJldHVybiB7DQogICAgICB1cGxvYWRCdG5DbGljaywNCiAgICAgIGxvYWRpbmdTdGF0ZSwNCiAgICAgIG1vZGFsVHlwZSwNCiAgICAgIE1vZGFsVHlwZUVudW0sDQogICAgICBpc1VuaXRGZWVkYmFja1BhZ2UsDQoNCiAgICAgIGRlbGV0ZUxvYWRpbmcsDQogICAgICBkZWxldGVGaWxlSGFuZGxlLA0KDQogICAgICBjb2x1bW5zLA0KICAgICAgdGFibGVDb25maWcNCiAgICB9DQogIH0NCn0pDQo="},{"version":3,"sources":["AttachmentInfo.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkDA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"AttachmentInfo.vue","sourceRoot":"src/views/main/handlingOfViolations/components","sourcesContent":["<template>\r\n  <div style=\"margin-top: 16px\">\r\n    <bs-table-title title=\"附件信息\" style=\"margin-bottom: 10px\" />\r\n    <div\r\n      v-if=\"isUnitFeedbackPage && modalType === ModalTypeEnum.AUDIT\"\r\n      v-loading=\"loading || deleteLoading\"\r\n      :element-loading-text=\"deleteLoading ? '附件数据删除中...' : '附件数据加载中...'\"\r\n      class=\"attachment-upload-wrapper\"\r\n    >\r\n      <div class=\"upload-top\">\r\n        <span :class=\"['label', !!Number(required) ? 'required' : ''] \">附件</span>\r\n        <el-button\r\n          size=\"mini\"\r\n          @click=\"uploadBtnClick\"\r\n        >\r\n          <i :class=\"loadingState ? 'el-icon-loading' : 'el-icon-upload'\"></i>\r\n          上传\r\n        </el-button>\r\n        <span class=\"upload-tip\">支持png/jpg/pdf等，不超过10M</span>\r\n      </div>\r\n      <div class=\"file-list-container\">\r\n        <div\r\n          v-for=\"(file, index) in fileList\"\r\n          :key=\"file.fileguid\"\r\n          class=\"file-item\"\r\n        >\r\n          <div>\r\n            <i class=\"el-icon-document el-icon--left\"></i>\r\n            <span>{{ file.filename }}</span>\r\n          </div>\r\n          <i class=\"el-icon-delete el-icon--right\" @click=\"deleteFileHandle(file, index)\"></i>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div v-else>\r\n      <BsTable\r\n        :loading=\"loading\"\r\n        :table-config=\"tableConfig\"\r\n        :table-columns-config=\"columns\"\r\n        :table-data=\"fileList\"\r\n        :toolbar-config=\"false\"\r\n        :pager-config=\"false\"\r\n        :max-height=\"260\"\r\n        size=\"medium\"\r\n      />\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { computed, defineComponent, inject, unref } from '@vue/composition-api'\r\nimport { readLocalFile } from '@/utils/readLocalFile'\r\nimport useLoadingState from '@/hooks/useLoadingState'\r\nimport useTable from '@/hooks/useTable'\r\nimport { FileStatusEnum, ModalTypeEnum, RouterPathEnum } from '../model/enum'\r\n\r\nimport { Message } from 'element-ui'\r\nimport { fileColumns } from '../model/data'\r\n// deleteFile\r\nimport { uploadFile } from '@/api/frame/common/file'\r\nimport { checkRscode } from '@/utils/checkRscode'\r\nimport { downloadByFileId } from '@/utils/download'\r\n\r\n// 附件最大值(1M)\r\nconst maxSize = 1024 * 1024 * 10\r\nexport default defineComponent({\r\n  props: {\r\n    // 文件列表\r\n    fileList: {\r\n      type: Array,\r\n      default: () => ([])\r\n    },\r\n    // 文件分组的的id\r\n    billguid: {\r\n      type: String,\r\n      default: ''\r\n    },\r\n    // 加载状态\r\n    loading: {\r\n      type: Boolean,\r\n      default: false\r\n    },\r\n    // 是否必传\r\n    required: {\r\n      type: [String, Number, Boolean],\r\n      default: 0\r\n    }\r\n  },\r\n  setup(props, { emit }) {\r\n    const modalType = inject('modalType')\r\n\r\n    // 页面路由(也可root中获取route)\r\n    const pagePath = inject('pagePath')\r\n\r\n    // 是否是单位反馈页面\r\n    const isUnitFeedbackPage = computed(() => {\r\n      console.log('RouterPathEnum', RouterPathEnum())\r\n      return unref(pagePath).indexOf('nitFeedback') !== -1\r\n    })\r\n\r\n    const [loadingState, setLoadingState] = useLoadingState()\r\n    /**\r\n     * 点击上传\r\n     * @return {Promise<void>}\r\n     */\r\n    async function uploadBtnClick() {\r\n      const { file: localFile } = await readLocalFile()\r\n      const {\r\n        size: filesize,\r\n        name: filename\r\n      } = localFile\r\n\r\n      if (localFile.size > maxSize) {\r\n        Message.warning('文件大小超过限制,请重新选择')\r\n        return\r\n      }\r\n      try {\r\n        setLoadingState(true)\r\n        const { data: fileguid } = checkRscode(\r\n          await uploadFile({\r\n            file: localFile,\r\n            filename,\r\n            // 文件分组的id\r\n            billguid: props.billguid\r\n          })\r\n        )\r\n        Message.success('上传成功！')\r\n\r\n        // 往违规单中存入文件信息\r\n        emit('uploadAfter', {\r\n          fileguid,\r\n          filename,\r\n          filesize,\r\n          file: localFile,\r\n          // 保留\r\n          status: FileStatusEnum.RETAIN\r\n        })\r\n      } finally {\r\n        setLoadingState(false)\r\n      }\r\n    }\r\n\r\n    const [deleteLoading, setDeleteLoading] = useLoadingState()\r\n    /**\r\n     * 删除文件\r\n     * */\r\n    async function deleteFileHandle(file, index) {\r\n      try {\r\n        setDeleteLoading(true)\r\n        // 暂时取消立即从平台删除操作：后续重新打开该处理单后根据后端返回的附件列表，在平台附件里面过滤，并删除后端没有存的文件\r\n        // 避免平台附件删除后，用户取消送审、确认操作 导致数据不一致问题\r\n        // checkRscode(await deleteFile(file.fileguid))\r\n        Message.success('删除成功！')\r\n        emit('deleteFile', {\r\n          file,\r\n          index\r\n        })\r\n      } finally {\r\n        setDeleteLoading(false)\r\n      }\r\n    }\r\n\r\n    /**\r\n     * 下载附件\r\n     * */\r\n    function downloadHandle({ row }) {\r\n      downloadByFileId(row.fileguid)\r\n    }\r\n\r\n    // 操作列\r\n    const columnActions = [\r\n      {\r\n        label: '下载',\r\n        // ri-download-cloud-fill\r\n        class: 'cursor f-c-c',\r\n        handle: downloadHandle\r\n      }\r\n    ]\r\n    /**\r\n     * 表格\r\n     * */\r\n    const [\r\n      {\r\n        columns,\r\n        tableConfig\r\n      }\r\n    ] = useTable({\r\n      columnActions,\r\n      columns: fileColumns\r\n    })\r\n\r\n    // 全局配置\r\n    tableConfig.globalConfig = {\r\n      checkType: false,\r\n      seq: true,\r\n      cellClickCheck: false\r\n    }\r\n    return {\r\n      uploadBtnClick,\r\n      loadingState,\r\n      modalType,\r\n      ModalTypeEnum,\r\n      isUnitFeedbackPage,\r\n\r\n      deleteLoading,\r\n      deleteFileHandle,\r\n\r\n      columns,\r\n      tableConfig\r\n    }\r\n  }\r\n})\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.upload-top {\r\n  display: flex;\r\n  align-items: flex-start;\r\n}\r\n.upload-tip {\r\n  margin-left: 12px;\r\n  line-height: 28px;\r\n  font-size: 12px;\r\n  color: #999;\r\n  box-sizing: border-box;\r\n}\r\n.label {\r\n  width: 80px;\r\n  text-align: right;\r\n  padding-right: 16px;\r\n  box-sizing: border-box;\r\n}\r\n.required {\r\n  &::before {\r\n    content: \"*\";\r\n    color: #f56c6c;\r\n    margin-right: 0.2em;\r\n    font-family: Verdana,Arial,Tahoma;\r\n    font-weight: 400;\r\n  }\r\n}\r\n.file {\r\n  padding: 8px;\r\n  margin: 8px 0 8px 50px;\r\n  border: 1px solid #f0f0f0;\r\n  box-sizing: border-box;\r\n}\r\n\r\n.file-list-container {\r\n  padding-left: 80px;\r\n  box-sizing: border-box;\r\n\r\n  .file-item {\r\n    display: flex;\r\n    align-content: center;\r\n    justify-content: space-between;\r\n    padding: 10px;\r\n    margin-top: 8px;\r\n    box-sizing: border-box;\r\n    background-color: rgba(#e7f1fe, 0.5);\r\n\r\n    .el-icon-document,\r\n    .el-icon-delete {\r\n      line-height: 22px;\r\n    }\r\n    .el-icon-delete {\r\n      padding: 0 16px;\r\n      box-sizing: border-box;\r\n      cursor: pointer;\r\n      transition: all 0.3s;\r\n      &:hover {\r\n        color: var(--primary-color);\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n"]}]}