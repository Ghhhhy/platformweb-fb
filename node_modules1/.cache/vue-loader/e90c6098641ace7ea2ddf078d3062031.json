{"remainingRequest":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\何小龙\\Desktop\\platformweb-fb\\src\\views\\main\\fundMonitoring\\DfrDatabaseSpecial\\DfrDatabaseSpecial.vue?vue&type=style&index=0&id=46a97f0e&lang=scss&scoped=true&","dependencies":[{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\src\\views\\main\\fundMonitoring\\DfrDatabaseSpecial\\DfrDatabaseSpecial.vue","mtime":1694505522512},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\css-loader\\dist\\cjs.js","mtime":1696752946978},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoNCi5wYXktYWNjb3JkaW5nLXRvLWluY29tZXsNCiAgaGVpZ2h0OiAxMDAlOw0KfQ0KLnJhZGlvLXJpZ2h0ew0KICBmbG9hdDogcmlnaHQ7DQp9DQovZGVlcC8gLlRpdGFucy10YWJsZSAuZ2xvYWJsZU9wdGlvblJvdyAuZ2xvYWJsZS1vcHRpb24tcm93ew0KICBmb250LXNpemU6IDEycHg7DQogIGxpbmUtaGVpZ2h0OiAyMHB4Ow0KfQ0K"},{"version":3,"sources":["DfrDatabaseSpecial.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4YA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"DfrDatabaseSpecial.vue","sourceRoot":"src/views/main/fundMonitoring/DfrDatabaseSpecial","sourcesContent":["<template>\r\n  <div v-loading=\"showLoading\" class=\"pay-according-to-income\">\r\n    <BsMainFormListLayout :left-visible=\"false\">\r\n      <template v-slot:topTabPane>\r\n        <BsTabPanel\r\n          ref=\"tabPanel\"\r\n          :is-open=\"isShowQueryConditions\"\r\n          :is-hide-query=\"true\"\r\n          :tab-status-btn-config=\"toolBarStatusBtnConfig\"\r\n          @onQueryConditionsClick=\"onQueryConditionsClick\"\r\n        />\r\n      </template>\r\n      <template v-slot:query>\r\n        <div v-show=\"isShowQueryConditions\" class=\"main-query\">\r\n          <BsQuery\r\n            ref=\"queryFrom\"\r\n            :query-form-item-config=\"highQueryConfig\"\r\n            :query-form-data=\"searchDataList\"\r\n            @onSearchClick=\"onSearch\"\r\n          />\r\n        </div>\r\n      </template>\r\n      <template v-slot:mainTree>\r\n      </template>\r\n      <template v-slot:mainForm>\r\n        <BsTable\r\n          ref=\"addTableRef\"\r\n          :table-columns-config=\"tableColumnsConfig\"\r\n          :table-data=\"tableData\"\r\n          :table-config=\"tableConfig\"\r\n          :toolbar-config=\"tableToolbarConfig\"\r\n          :pager-config=\"mainPagerConfig\"\r\n          @ajaxData=\"ajaxData\"\r\n          @onToolbarBtnClick=\"onToolbarBtnClick\"\r\n          @cellClick=\"onCellClick\"\r\n        >\r\n          <template v-slot:toolbarSlots>\r\n            <div class=\"table-toolbar-left\">\r\n              <div class=\"table-toolbar-left-title\">\r\n                <span class=\"fn-inline\">{{ menuName }}</span>\r\n                <i class=\"fn-inline\"></i>\r\n              </div>\r\n            </div>\r\n          </template>\r\n        </BsTable>\r\n      </template>\r\n      <template v-slot:mainCon></template>\r\n    </BsMainFormListLayout>\r\n    <BsUpload\r\n      ref=\"fileUpload\"\r\n      :queryparams=\"queryparams\"\r\n      :open-loading=\"false\"\r\n      uniqe-name=\"uploadOne\"\r\n      :accept=\"accept\"\r\n      :after-upload=\"afterUpload\"\r\n      :downloadparams=\"downloadParams\"\r\n      :designated-year=\"'2022'\"\r\n    />\r\n    <FilePreview\r\n      v-if=\"filePreviewDialogVisible\"\r\n      :visible.sync=\"filePreviewDialogVisible\"\r\n      :file-guid=\"fileGuid\"\r\n      :app-id=\"appId\"\r\n    />\r\n  </div>\r\n</template>\r\n<script>\r\nimport MenuModule from '@/api/frame/common/menu.js'\r\nconst TABLE_COLUMNS = [\r\n  { title: '文件名',\r\n    field: 'filename',\r\n    cellRender: {\r\n      name: '$href'\r\n    } },\r\n  { title: '上传时间', field: 'createtime', width: 400 },\r\n  {\r\n    title: '操作',\r\n    field: 'gloableOptionRow',\r\n    className: 'gloableOptionRow',\r\n    align: 'center',\r\n    fixed: 'right',\r\n    sortable: false,\r\n    filters: false,\r\n    width: 200,\r\n    cellRender: {\r\n      name: '$gloableOptionRow'\r\n    }\r\n  }\r\n]\r\n\r\nexport default {\r\n  name: 'DfrDatabaseSpecial',\r\n  components: {},\r\n  data() {\r\n    const self = this\r\n    return {\r\n      fileGuid: '',\r\n      appId: 'fi',\r\n      filePreviewDialogVisible: false,\r\n      queryparams: {\r\n        billguid: ''\r\n      },\r\n      selectCode: '1',\r\n      billguidPrefix: 'special-',\r\n      accept: 'jpg,png,pdf,doc,docx',\r\n      showLoading: false,\r\n      leftTreeVisible: false,\r\n      isShowQueryConditions: false,\r\n      highQueryConfig: [\r\n      ],\r\n      searchDataList: {},\r\n      toolBarStatusBtnConfig: {\r\n        // 状态按钮和左侧按钮触发后回调\r\n        changeBtns: true,\r\n        curButton: {\r\n          code: '1',\r\n          curValue: '1',\r\n          type: 'button'\r\n        },\r\n        buttons: [\r\n          {\r\n            code: '1',\r\n            label: '专项资料',\r\n            iconName: 'base-all.png',\r\n            iconNameActive: 'base-all-active.png',\r\n            type: 'button',\r\n            curValue: '1'\r\n          }\r\n          /*,\r\n          {\r\n            code: '2',\r\n            label: '学习资料',\r\n            iconName: 'base-all.png',\r\n            iconNameActive: 'base-all-active.png',\r\n            type: 'button',\r\n            curValue: '2'\r\n          }\r\n          */\r\n        ],\r\n        buttonsInfo: this.transJson(this.$store.state.curNavModule?.param5).isShowTabButtons ? {\r\n          '1': [\r\n            { code: 'toolbar-upload', label: '上传文件' },\r\n            { code: 'toolbar-deleteFile', label: '删除文件' }\r\n          ],\r\n          '2': [\r\n            { code: 'toolbar-upload', label: '上传文件' },\r\n            { code: 'toolbar-deleteFile', label: '删除文件' }\r\n          ]\r\n        } : false,\r\n        methods: {\r\n          bsToolbarClickEvent: self.onStatusTabClick\r\n        }\r\n      },\r\n      tableFooterConfig: {\r\n      },\r\n      tableColumnsConfig: [],\r\n      tableData: [],\r\n      tableConfig: {\r\n        renderers: {\r\n          // 编辑 附件 操作日志\r\n          $gloableOptionRow: {\r\n            renderDefault(h, cellRender, params, context) {\r\n              const { row, column } = params\r\n              return [\r\n                <el-tooltip content=\"查看\" placement=\"top\" effect=\"light\">\r\n                  <a class=\" gloable-option-row fn-inline\" onClick={() => self.onOptionRowClick({ row, column, optionType: 'showFile' })}>查看</a>,\r\n                </el-tooltip>,\r\n                <el-tooltip content=\"下载\" placement=\"top\" effect=\"light\">\r\n                  <a class=\" gloable-option-row fn-inline\" onClick={() => self.onOptionRowClick({ row, column, optionType: 'downloadFile' })}>下载</a>,\r\n                </el-tooltip>\r\n              ]\r\n            }\r\n          }\r\n        },\r\n        methods: {\r\n          onOptionRowClick: self.onOptionRowClick\r\n        }\r\n      },\r\n      tableToolbarConfig: {\r\n        // table工具栏配置\r\n        disabledMoneyConversion: false,\r\n        moneyConversion: false, // 是否有金额转换\r\n        search: false, // 是否有search\r\n        import: false, // 导入\r\n        export: false, // 导出\r\n        print: false, // 打印\r\n        zoom: true, // 缩放\r\n        custom: false, // 选配展示列\r\n        slots: {\r\n          tools: 'toolbarTools',\r\n          buttons: 'toolbarSlots'\r\n        }\r\n      },\r\n      mainPagerConfig: {\r\n        total: 0,\r\n        pageSize: 20,\r\n        currentPage: 1\r\n      },\r\n      menuName: '专项行动综合管理平台',\r\n      userInfo: {},\r\n      conditions: {},\r\n      downloadParams: {\r\n        fileguid: ''\r\n      }\r\n    }\r\n  },\r\n  created() {\r\n    this.userInfo = this.$store.state.userInfo\r\n    // 不是财政或者管理员不显示按钮\r\n    if (this.userInfo.usertype !== '1' && this.userInfo.usertype !== '2') {\r\n      this.toolBarStatusBtnConfig.buttonsInfo = {}\r\n    }\r\n    this.getSearchDataList()\r\n    this.generateTableColumns()\r\n    this.onSearch()\r\n  },\r\n  computed: {\r\n    mof_div_code() {\r\n      return this.userInfo.province\r\n    },\r\n    fiscal_year() {\r\n      return this.userInfo.year\r\n    }\r\n  },\r\n  methods: {\r\n    afterUpload(val1, val2) {\r\n      this.refresh()\r\n    },\r\n    generateTableColumns() {\r\n      this.tableColumnsConfig = TABLE_COLUMNS.map(el => {\r\n        let tableColumn = {\r\n          align: 'center',\r\n          associatedQuery: '',\r\n          className: '',\r\n          combinedType: '',\r\n          combinedType_select_sort: '',\r\n          constraint: '',\r\n          filters: false,\r\n          fixed: '',\r\n          formula: '',\r\n          sortable: 'true',\r\n          ...el\r\n        }\r\n        return tableColumn\r\n      })\r\n    },\r\n    getSearchParams() {\r\n      this.conditions = {}\r\n      this.highQueryConfig.forEach(item => {\r\n        this.conditions[item.field] = this.searchDataList[item.field + 'code__multiple']\r\n      })\r\n    },\r\n    ajaxData({ params, currentPage, pageSize }) {\r\n      this.mainPagerConfig.currentPage = currentPage\r\n      this.mainPagerConfig.pageSize = pageSize\r\n      this.refresh()\r\n    },\r\n    getTableData() {\r\n      let billId = this.selectCode === '1' ? 'special-' : 'learningFiles-'\r\n      let params = {\r\n        billguid: billId,\r\n        province: this.$store.state.userInfo.province,\r\n        year: this.$store.state.userInfo.year\r\n      }\r\n      this.showLoading = true\r\n      return new Promise((resolve, reject) => {\r\n        MenuModule.getOperationGuideDatas(params).then(res => {\r\n          const { data, rscode } = res\r\n          if (rscode === '100000') {\r\n            let tableData = [].concat(data)\r\n            resolve(tableData)\r\n          } else {\r\n            reject(new Error('获取信息失败！'))\r\n          }\r\n          this.showLoading = false\r\n        }, err => {\r\n          this.showLoading = false\r\n          reject(err)\r\n        })\r\n      })\r\n    },\r\n    getSearchDataList() {\r\n      // 下拉树\r\n      let searchDataObj = {}\r\n      this.highQueryConfig.forEach(item => {\r\n        if (item.field) {\r\n          searchDataObj[item.field] = ''\r\n        }\r\n      })\r\n      this.searchDataList = searchDataObj\r\n    },\r\n    asideChange() {\r\n      this.leftTreeVisible = false\r\n    },\r\n    onQueryConditionsClick(isOpen) {\r\n      this.isShowQueryConditions = isOpen\r\n    },\r\n    onToolbarBtnClick({ context, table, code }) {\r\n      switch (code) {\r\n        // 刷新\r\n        case 'refresh':\r\n          this.refresh()\r\n          break\r\n      }\r\n    },\r\n    async refresh() {\r\n      const start = this.mainPagerConfig.pageSize * (this.mainPagerConfig.currentPage - 1)\r\n      const end = start + this.mainPagerConfig.pageSize\r\n      try {\r\n        const result = await this.getTableData()\r\n        this.tableData = result.slice(start, end)\r\n        this.mainPagerConfig.total = result.length\r\n      } catch (error) {\r\n        this.$XModal.message({ status: 'error', message: '获取信息失败' })\r\n      }\r\n    },\r\n    onSearch() {\r\n      this.mainPagerConfig.currentPage = 1\r\n      this.getSearchParams()\r\n      this.refresh()\r\n    },\r\n    onStatusTabClick(btnObj) {\r\n      if (!btnObj.type) {\r\n        this.operationToolbarButtonClickEvent(btnObj)\r\n        return\r\n      }\r\n      this.selectCode = btnObj?.code\r\n      this.mainPagerConfig.currentPage = 1\r\n      this.selectCode === '1' ? this.billguidPrefix = 'special-' : this.billguidPrefix = 'learningFiles-'\r\n      this.menuName = this.selectCode === '1' ? '专项资料' : '学习资料'\r\n      this.refresh()\r\n    },\r\n    operationToolbarButtonClickEvent(obj, context, e) {\r\n      const { code } = obj\r\n      switch (code) {\r\n        case 'toolbar-upload':\r\n          this.uploadFile()\r\n          break\r\n        case 'toolbar-deleteFile':\r\n          this.deleteFiles()\r\n          break\r\n      }\r\n    },\r\n    uploadFile() {\r\n      this.queryparams.billguid = this.billguidPrefix + this.$ToolFn.utilFn.getUuid()\r\n      this.$refs.fileUpload.upload()\r\n    },\r\n    deleteFiles() {\r\n      let selection = this.$refs.addTableRef.getSelectionData() || []\r\n      if (selection.length < 1) {\r\n        this.$XModal.message({ status: 'error', message: '请至少选择一条数据' })\r\n        return\r\n      }\r\n      let fileguids = ''\r\n      selection.forEach(item => {\r\n        fileguids += item.fileguid + ','\r\n      })\r\n      let params = 'fileguids=' + fileguids + '&' + 'appid=fi'\r\n      MenuModule.deleteAttachment(params).then(res => {\r\n        if (res.rscode === '100000') {\r\n          this.$XModal.message({ status: 'success', message: '删除文件成功' })\r\n          this.refresh()\r\n        } else {\r\n          this.$XModal.message({ status: 'error', message: '删除文件失败' })\r\n        }\r\n      }).catch()\r\n    },\r\n    onOptionRowClick(option) {\r\n      const { row, optionType } = option\r\n      if (optionType === 'showFile') {\r\n        this.showFile(row.fileguid)\r\n      } else if (optionType === 'downloadFile') {\r\n        this.downloadFile(row.fileguid)\r\n      }\r\n    },\r\n    onCellClick(obj) {\r\n      let key = obj.column.property\r\n      switch (key) {\r\n        case 'filename':\r\n          this.showFile(obj.row.fileguid)\r\n          break\r\n      }\r\n    },\r\n    showFile(guid) {\r\n      this.appId = 'fi'\r\n      this.fileGuid = guid\r\n      this.filePreviewDialogVisible = true\r\n    },\r\n    downloadFile(guid) {\r\n      this.downloadParams.fileguid = guid\r\n      this.$refs.fileUpload.downloadMoreFile()\r\n    }\r\n  }\r\n}\r\n</script>\r\n<style lang=\"scss\" scoped>\r\n.pay-according-to-income{\r\n  height: 100%;\r\n}\r\n.radio-right{\r\n  float: right;\r\n}\r\n/deep/ .Titans-table .gloableOptionRow .gloable-option-row{\r\n  font-size: 12px;\r\n  line-height: 20px;\r\n}\r\n</style>\r\n"]}]}