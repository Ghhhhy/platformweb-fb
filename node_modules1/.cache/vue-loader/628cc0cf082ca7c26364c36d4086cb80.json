{"remainingRequest":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\何小龙\\Desktop\\platformweb-fb\\src\\components\\SelectTree.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\src\\components\\SelectTree.vue","mtime":1694505521442},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgeyBkZWZpbmVDb21wb25lbnQsIHJlYWN0aXZlLCB3YXRjaCwgcmVmLCB1bnJlZiwgbmV4dFRpY2sgfSBmcm9tICdAdnVlL2NvbXBvc2l0aW9uLWFwaScNCmV4cG9ydCBkZWZhdWx0IGRlZmluZUNvbXBvbmVudCh7DQogIHByb3BzOiB7DQogICAgLy8gdi1tb2RlbOe7keWumg0KICAgIHZhbHVlOiB7DQogICAgICB0eXBlOiBbU3RyaW5nLCBOdW1iZXJdLA0KICAgICAgZGVmYXVsdDogJycNCiAgICB9LA0KICAgIC8vIOagkeW9oueahOaVsOaNrg0KICAgIGRhdGE6IHsNCiAgICAgIHR5cGU6IEFycmF5LA0KICAgICAgZGVmYXVsdDogZnVuY3Rpb24gKCkgew0KICAgICAgICByZXR1cm4gW10NCiAgICAgIH0NCiAgICB9LA0KICAgIHNpemU6IHsNCiAgICAgIHR5cGU6IFN0cmluZywNCiAgICAgIGRlZmF1bHQ6ICcnDQogICAgfSwNCiAgICAvLyDmr4/kuKrmoJHoioLngrnnlKjmnaXkvZzkuLrllK/kuIDmoIfor4bnmoTlsZ7mgKcNCiAgICBub2RlS2V5OiB7DQogICAgICB0eXBlOiBbU3RyaW5nLCBOdW1iZXJdLA0KICAgICAgZGVmYXVsdDogJ2NvZGUnDQogICAgfSwNCiAgICBmaWx0ZXI6IHsNCiAgICAgIHR5cGU6IEJvb2xlYW4sDQogICAgICBkZWZhdWx0OiBmYWxzZQ0KICAgIH0sDQogICAgLy8gdHJlZeeahHByb3Bz6YWN572uDQogICAgcHJvcHM6IHsNCiAgICAgIHR5cGU6IE9iamVjdCwNCiAgICAgIGRlZmF1bHQ6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICBsYWJlbDogJ2xhYmVsJywNCiAgICAgICAgICBjaGlsZHJlbjogJ2NoaWxkcmVuJw0KICAgICAgICB9DQogICAgICB9DQogICAgfSwNCiAgICB0cmVlUHJvcHM6IHsNCiAgICAgIHR5cGU6IE9iamVjdCwNCiAgICAgIGRlZmF1bHQ6ICgpID0+ICh7fSkNCiAgICB9DQogIH0sDQogIHNldHVwKHByb3BzLCB7IGVtaXQgfSkgew0KICAgIGNvbnN0IGZpbHRlclRleHQgPSByZWYoJycpDQogICAgY29uc3Qgb3B0aW9uRGF0YSA9IHJlYWN0aXZlKHsNCiAgICAgIGlkOiAnJywNCiAgICAgIG5hbWU6ICcnDQogICAgfSkNCiAgICBjb25zdCBbc2VsZWN0UmVmLCBvcHRpb25SZWYsIHRyZWVSZWZdID0gW3JlZihudWxsKSwgcmVmKG51bGwpLCByZWYobnVsbCldDQogICAgLy8g5piv5ZCm5Li656m6DQogICAgY29uc3QgaXNFbXB0eSA9ICh2YWwpID0+IHsNCiAgICAgIGZvciAobGV0IGtleSBpbiB2YWwpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlDQogICAgICB9DQogICAgICByZXR1cm4gdHJ1ZQ0KICAgIH0NCiAgICAvLyDmoJHoioLngrnngrnlh7sNCiAgICBjb25zdCBoYW5kbGVOb2RlQ2xpY2sgPSAoZGF0YSkgPT4gew0KICAgICAgZW1pdCgnaW5wdXQnLCBkYXRhW3Byb3BzLm5vZGVLZXldKQ0KICAgICAgc2VsZWN0UmVmLnZhbHVlLnZpc2libGUgPSBmYWxzZQ0KICAgIH0NCiAgICAvLyDov4fmu6Tlm57osIMNCiAgICBjb25zdCBmaWx0ZXJOb2RlID0gKHZhbHVlLCBkYXRhKSA9PiB7DQogICAgICBpZiAoIXZhbHVlKSByZXR1cm4gdHJ1ZQ0KICAgICAgcmV0dXJuIGRhdGEubGFiZWwuaW5kZXhPZih2YWx1ZSkgIT09IC0xDQogICAgfQ0KICAgIC8vIOWIneWni+WMlg0KICAgIGNvbnN0IGluaXQgPSAodmFsKSA9PiB7DQogICAgICBpZiAodmFsKSB7DQogICAgICAgIG5leHRUaWNrKCgpID0+IHsNCiAgICAgICAgICB0cmVlUmVmLnZhbHVlPy5zZXRDdXJyZW50S2V5KHZhbCkNCiAgICAgICAgICBjb25zdCBub2RlID0gdHJlZVJlZi52YWx1ZT8uZ2V0Tm9kZSh2YWwpDQogICAgICAgICAgb3B0aW9uRGF0YS5pZCA9IHZhbA0KICAgICAgICAgIG9wdGlvbkRhdGEubmFtZSA9IG5vZGUubGFiZWwNCiAgICAgICAgfSkNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHRyZWVSZWYudmFsdWU/LnNldEN1cnJlbnRLZXkobnVsbCkNCiAgICAgIH0NCiAgICB9DQogICAgLy8g5qCR55qE5pi+6ZqQ5pS55Y+YDQogICAgY29uc3QgdmlzaWJsZUNoYW5nZSA9IChlKSA9PiB7DQogICAgICBpZiAoZSkgew0KICAgICAgICBsZXQgc2VsZWN0RG9tID0gdHJlZVJlZi52YWx1ZT8uJGVsLnF1ZXJ5U2VsZWN0b3IoJy5pcy1jdXJyZW50JykNCiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7DQogICAgICAgICAgc2VsZWN0UmVmLnZhbHVlPy5zY3JvbGxUb09wdGlvbih7ICRlbDogc2VsZWN0RG9tIH0pDQogICAgICAgIH0sIDApDQogICAgICB9DQogICAgfQ0KICAgIC8vIOi/h+a7pOaVsOaNruahhuiBmueEpg0KICAgIGNvbnN0IGlucHV0Rm9jdXMgPSAoKSA9PiB7DQogICAgICBzZWxlY3RSZWYudmFsdWUudmlzaWJsZSA9IHRydWUNCiAgICB9DQogICAgLy8g5riF6ZmkDQogICAgY29uc3QgY2xlYXIgPSAoKSA9PiB7DQogICAgICBlbWl0KCdpbnB1dCcsICcnKQ0KICAgIH0NCiAgICAvLyDnm5HlkKzpu5jorqTlgLwNCiAgICB3YXRjaCgoKSA9PiBwcm9wcy52YWx1ZSwgKHZhbCkgPT4gew0KICAgICAgaWYgKCFpc0VtcHR5KHByb3BzLmRhdGEpKSB7DQogICAgICAgIGluaXQodmFsKQ0KICAgICAgfQ0KICAgIH0sIHsgaW1tZWRpYXRlOiB0cnVlIH0pDQogICAgLy8g55uR5ZCs5pWw5o2u5rqQDQogICAgd2F0Y2goKCkgPT4gcHJvcHMuZGF0YSwgKHZhbCkgPT4gew0KICAgICAgaWYgKCFpc0VtcHR5KHZhbCkpIHsNCiAgICAgICAgaW5pdChwcm9wcy52YWx1ZSkNCiAgICAgIH0NCiAgICB9LCB7IGltbWVkaWF0ZTogdHJ1ZSB9KQ0KICAgIC8vIOebkeWQrOi/h+a7pA0KICAgIHdhdGNoKGZpbHRlclRleHQsICh2YWwpID0+IHsNCiAgICAgIHRyZWVSZWYudmFsdWU/LmZpbHRlcih1bnJlZih2YWwpKQ0KICAgIH0pDQogICAgcmV0dXJuIHsNCiAgICAgIG9wdGlvbkRhdGEsDQogICAgICBzZWxlY3RSZWYsDQogICAgICBvcHRpb25SZWYsDQogICAgICB0cmVlUmVmLA0KICAgICAgdmlzaWJsZUNoYW5nZSwNCiAgICAgIGNsZWFyLA0KICAgICAgaGFuZGxlTm9kZUNsaWNrLA0KICAgICAgZmlsdGVyTm9kZSwNCiAgICAgIGZpbHRlclRleHQsDQogICAgICBpbnB1dEZvY3VzDQogICAgfQ0KICB9DQp9KQ0K"},{"version":3,"sources":["SelectTree.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"SelectTree.vue","sourceRoot":"src/components","sourcesContent":["<template>\r\n  <el-select\r\n    ref=\"selectRef\"\r\n    :value=\"value\"\r\n    placeholder=\"财政区划\"\r\n    clearable\r\n    :size=\"size\"\r\n    style=\"width: 100%;\"\r\n    @visible-change=\"visibleChange\"\r\n    @clear=\"clear\"\r\n  >\r\n    <el-option\r\n      ref=\"optionRef\"\r\n      class=\"option\"\r\n      :value=\"optionData.id\"\r\n      :label=\"optionData.name\"\r\n      @focus=\"inputFocus\"\r\n    >\r\n      <el-input\r\n        v-if=\"filter\"\r\n        v-model=\"filterText\"\r\n        placeholder=\"输入关键字进行过滤\"\r\n      />\r\n      <el-tree\r\n        ref=\"treeRef\"\r\n        class=\"tree\"\r\n        :node-key=\"nodeKey\"\r\n        :data=\"data\"\r\n        :props=\"props\"\r\n        :default-expanded-keys=\"[value]\"\r\n        highlight-current\r\n        :expand-on-click-node=\"false\"\r\n        :filter-node-method=\"filterNode\"\r\n        v-bind=\"treeProps\"\r\n        @node-click=\"handleNodeClick\"\r\n        v-on=\"$listeners\"\r\n      />\r\n    </el-option>\r\n  </el-select>\r\n\r\n</template>\r\n\r\n<script>\r\nimport { defineComponent, reactive, watch, ref, unref, nextTick } from '@vue/composition-api'\r\nexport default defineComponent({\r\n  props: {\r\n    // v-model绑定\r\n    value: {\r\n      type: [String, Number],\r\n      default: ''\r\n    },\r\n    // 树形的数据\r\n    data: {\r\n      type: Array,\r\n      default: function () {\r\n        return []\r\n      }\r\n    },\r\n    size: {\r\n      type: String,\r\n      default: ''\r\n    },\r\n    // 每个树节点用来作为唯一标识的属性\r\n    nodeKey: {\r\n      type: [String, Number],\r\n      default: 'code'\r\n    },\r\n    filter: {\r\n      type: Boolean,\r\n      default: false\r\n    },\r\n    // tree的props配置\r\n    props: {\r\n      type: Object,\r\n      default: function () {\r\n        return {\r\n          label: 'label',\r\n          children: 'children'\r\n        }\r\n      }\r\n    },\r\n    treeProps: {\r\n      type: Object,\r\n      default: () => ({})\r\n    }\r\n  },\r\n  setup(props, { emit }) {\r\n    const filterText = ref('')\r\n    const optionData = reactive({\r\n      id: '',\r\n      name: ''\r\n    })\r\n    const [selectRef, optionRef, treeRef] = [ref(null), ref(null), ref(null)]\r\n    // 是否为空\r\n    const isEmpty = (val) => {\r\n      for (let key in val) {\r\n        return false\r\n      }\r\n      return true\r\n    }\r\n    // 树节点点击\r\n    const handleNodeClick = (data) => {\r\n      emit('input', data[props.nodeKey])\r\n      selectRef.value.visible = false\r\n    }\r\n    // 过滤回调\r\n    const filterNode = (value, data) => {\r\n      if (!value) return true\r\n      return data.label.indexOf(value) !== -1\r\n    }\r\n    // 初始化\r\n    const init = (val) => {\r\n      if (val) {\r\n        nextTick(() => {\r\n          treeRef.value?.setCurrentKey(val)\r\n          const node = treeRef.value?.getNode(val)\r\n          optionData.id = val\r\n          optionData.name = node.label\r\n        })\r\n      } else {\r\n        treeRef.value?.setCurrentKey(null)\r\n      }\r\n    }\r\n    // 树的显隐改变\r\n    const visibleChange = (e) => {\r\n      if (e) {\r\n        let selectDom = treeRef.value?.$el.querySelector('.is-current')\r\n        setTimeout(() => {\r\n          selectRef.value?.scrollToOption({ $el: selectDom })\r\n        }, 0)\r\n      }\r\n    }\r\n    // 过滤数据框聚焦\r\n    const inputFocus = () => {\r\n      selectRef.value.visible = true\r\n    }\r\n    // 清除\r\n    const clear = () => {\r\n      emit('input', '')\r\n    }\r\n    // 监听默认值\r\n    watch(() => props.value, (val) => {\r\n      if (!isEmpty(props.data)) {\r\n        init(val)\r\n      }\r\n    }, { immediate: true })\r\n    // 监听数据源\r\n    watch(() => props.data, (val) => {\r\n      if (!isEmpty(val)) {\r\n        init(props.value)\r\n      }\r\n    }, { immediate: true })\r\n    // 监听过滤\r\n    watch(filterText, (val) => {\r\n      treeRef.value?.filter(unref(val))\r\n    })\r\n    return {\r\n      optionData,\r\n      selectRef,\r\n      optionRef,\r\n      treeRef,\r\n      visibleChange,\r\n      clear,\r\n      handleNodeClick,\r\n      filterNode,\r\n      filterText,\r\n      inputFocus\r\n    }\r\n  }\r\n})\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.option {\r\n  height: auto;\r\n  line-height: 1;\r\n  padding: 0;\r\n  background-color: #fff;\r\n}\r\n\r\n.tree {\r\n  padding: 4px 20px;\r\n  height: auto;\r\n  font-weight: 400;\r\n}\r\n</style>\r\n"]}]}