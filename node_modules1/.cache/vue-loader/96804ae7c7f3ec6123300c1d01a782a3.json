{"remainingRequest":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\何小龙\\Desktop\\platformweb-fb\\src\\directive\\html2canvasDirective\\DownHtml.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\src\\directive\\html2canvasDirective\\DownHtml.vue","mtime":1694505522119},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\babel-loader\\lib\\index.js","mtime":456789000000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\何小龙\\Desktop\\platformweb-fb\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgaHRtbDJjYW52YXMgZnJvbSAnaHRtbDJjYW52YXMnDQoNCmV4cG9ydCBkZWZhdWx0IHsNCiAgbmFtZTogJ0Rvd25IdG1sJywNCiAgcHJvcHM6IHsNCiAgICAvLyDkv53lrZjnmoTmlofku7blkI3np7ANCiAgICBmaWxlTmFtZTogew0KICAgICAgdHlwZTogU3RyaW5nLA0KICAgICAgZGVmYXVsdDogJ2VjaGFydHMnDQogICAgfQ0KICB9LA0KICBkYXRhKCkgew0KICAgIHJldHVybiB7DQogICAgfQ0KICB9LA0KICBtZXRob2RzOiB7DQogICAgLy8g54K55Ye75LiL6L295oyJ6ZKu6Kem5Y+R5ZmoDQogICAgYXN5bmMgZG93blRyaWdnZXIoKSB7DQogICAgICBpZiAoIXRoaXMuJGVsPy5wYXJlbnRFbGVtZW50KSByZXR1cm4NCiAgICAgIGF3YWl0IHRoaXMuJG5leHRUaWNrKCkNCiAgICAgIHRyeSB7DQogICAgICAgIHRoaXMuaHRtbFRvQ2FudmFzKCkNCiAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgY29uc29sZS5sb2coZSkNCiAgICAgIH0NCiAgICB9LA0KICAgIGh0bWxUb0NhbnZhcyAoKSB7DQogICAgICAvLyDojrflj5bpnIDopoHovaxjYW52YXPlhYPntKDnmoTlrr3pq5gNCiAgICAgIGNvbnN0IHsgd2lkdGgsIGhlaWdodCB9ID0gdGhpcy4kZWwucGFyZW50RWxlbWVudD8uZ2V0Qm91bmRpbmdDbGllbnRSZWN0Py4oKQ0KICAgICAgLy8g5byA5aeL6L2s5o2iDQogICAgICBodG1sMmNhbnZhcyh0aGlzLiRlbC5wYXJlbnRFbGVtZW50LCB7DQogICAgICAgIHdpZHRoLA0KICAgICAgICBoZWlnaHQsDQogICAgICAgIC8vIOi/h+a7pOaOieS4jemcgOimgeeahOWFg+e0oA0KICAgICAgICBpZ25vcmVFbGVtZW50czogZWxlbWVudCA9PiB7DQogICAgICAgICAgLy8gY29tcGFyZURvY3VtZW50UG9zaXRpb27mr5TovoPoioLngrnkuI7mjIflrproioLngrnnm7jlr7nkvY3nva4NCiAgICAgICAgICAvLyDkvovlpoLvvJpQMS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihQMikNCiAgICAgICAgICAvLyAw77ya6Ieq6LqrDQogICAgICAgICAgLy8gMe+8muayoeacieWFs+ezu++8jOi/meS4pOS4quiKgueCueS4jeWxnuS6juWQjOS4gOS4quaWh+aho+OAgg0KICAgICAgICAgIC8vIDLvvJrnrKzkuIDoioLngrnvvIhQMe+8ieS9jeS6juesrOS6jOS4quiKgueCueWQju+8iFAy77yJ44CCDQogICAgICAgICAgLy8gNO+8muesrOS4gOiKgueCue+8iFAx77yJ5a6a5L2N5Zyo56ys5LqM6IqC54K577yIUDLvvInliY3jgIINCiAgICAgICAgICAvLyA477ya56ys5LiA6IqC54K577yIUDHvvInkvY3kuo7nrKzkuozoioLngrnlhoXvvIhQMu+8ieOAgg0KICAgICAgICAgIC8vIDE277ya56ys5LqM6IqC54K577yIUDLvvInkvY3kuo7nrKzkuIDoioLngrnlhoXvvIhQMe+8ieOAgg0KICAgICAgICAgIGNvbnN0IHBvc2l0aW9uSW5kZXggPSB0aGlzLiRlbD8ucGFyZW50RWxlbWVudD8uY29tcGFyZURvY3VtZW50UG9zaXRpb24/LihlbGVtZW50KQ0KDQogICAgICAgICAgLy8g6YeN6KaB77yB77yB77yBDQogICAgICAgICAgLy8g5L+d55WZ5qC35byP44CC5Zug5Li65qC35byP5ZyoaGVhZOagh+etvuWGhe+8jOaJgOS7peimgeWwhmh0bWzjgIFoZWFk5Lmf6KaB5L+d55WZ77yM5ZCm5YiZ5LiL6L2955qE5Zu+54mH5qC35byP5pyJ5Lii5aSxDQogICAgICAgICAgY29uc3Qgd2hpdGVOb2RlTmFtZXMgPSBbJ1NUWUxFJywgJ0hUTUwnLCAnSEVBRCddDQogICAgICAgICAgY29uc3Qgbm9kZVR5cGUgPSBlbGVtZW50Lm5vZGVOYW1lPy50b1VwcGVyQ2FzZT8uKCkNCg0KICAgICAgICAgIC8vIOi/h+a7pGh0bWwyY2FudmFzLWlnbm9yZeexu+WQjeeahOWFg+e0oA0KICAgICAgICAgIGNvbnN0IGhhc0NsYXNzID0gZWxlbWVudC5jbGFzc0xpc3Q/LmNvbnRhaW5zPy4oJ2h0bWwyY2FudmFzLWlnbm9yZScpDQoNCiAgICAgICAgICByZXR1cm4gd2hpdGVOb2RlTmFtZXMuaW5jbHVkZXMobm9kZVR5cGUpID8gZmFsc2UgOiAocG9zaXRpb25JbmRleCAhPT0gMCAmJiBwb3NpdGlvbkluZGV4IDwgOCkgfHwgaGFzQ2xhc3MNCiAgICAgICAgfQ0KICAgICAgfSkNCiAgICAgICAgLnRoZW4oY2FudmFzID0+IHsNCiAgICAgICAgICB0aGlzLmRvd25Mb2FkKGNhbnZhcykNCiAgICAgICAgfSkNCiAgICB9LA0KICAgIC8vIOWwhmNhbnZhc+i9rGRhdGFVcmzvvIzlubbliKnnlKhh5qCH562+5LiL6L29DQogICAgZG93bkxvYWQoY2FudmFzKSB7DQogICAgICBjb25zdCBkYXRhVXJsID0gY2FudmFzLnRvRGF0YVVSTCgnaW1hZ2UvcG5nJywgMS4wKQ0KICAgICAgY29uc3QgdGVtcExpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJykNCiAgICAgIHRlbXBMaW5rLnN0eWxlLmRpc3BsYXkgPSAnbm9uZScNCiAgICAgIHRlbXBMaW5rLmhyZWYgPSBkYXRhVXJsDQogICAgICB0ZW1wTGluay5zZXRBdHRyaWJ1dGUoJ2Rvd25sb2FkJywgYCR7dGhpcy5maWxlTmFtZX0ucG5nYCkNCiAgICAgIC8vIOS4jeaUr+aMgeWwseWPpuW8gOmhteetvuW8gOaJkw0KICAgICAgaWYgKHR5cGVvZiB0ZW1wTGluay5kb3dubG9hZCA9PT0gJ3VuZGVmaW5lZCcpIHsNCiAgICAgICAgdGVtcExpbmsuc2V0QXR0cmlidXRlKCd0YXJnZXQnLCAnX2JsYW5rJykNCiAgICAgIH0NCiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGVtcExpbmspDQogICAgICB0ZW1wTGluay5jbGljaygpDQogICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRlbXBMaW5rKQ0KICAgIH0NCiAgfQ0KfQ0K"},{"version":3,"sources":["DownHtml.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAuBA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"DownHtml.vue","sourceRoot":"src/directive/html2canvasDirective","sourcesContent":["<template>\r\n  <div\r\n    class=\"down-icon-wrapper html2canvas-ignore\"\r\n    title=\"下载为图片\"\r\n    @click=\"downTrigger\"\r\n  >\r\n    <svg\r\n      t=\"1675996435068\"\r\n      class=\"icon download-icon\"\r\n      viewBox=\"0 0 1024 1024\"\r\n      version=\"1.1\"\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n      p-id=\"6832\"\r\n      xmlns:xlink=\"http://www.w3.org/1999/xlink\"\r\n      width=\"32\"\r\n      height=\"32\"\r\n    >\r\n      <path d=\"M372.8 0.256v366.144H189.76l305.088 366.144L800 366.4H616.96V0.256zM128.64 901.76h732.288v121.984H128.64z\" fill=\"#2A8BFD\" p-id=\"6833\" />\r\n    </svg>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport html2canvas from 'html2canvas'\r\n\r\nexport default {\r\n  name: 'DownHtml',\r\n  props: {\r\n    // 保存的文件名称\r\n    fileName: {\r\n      type: String,\r\n      default: 'echarts'\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n    }\r\n  },\r\n  methods: {\r\n    // 点击下载按钮触发器\r\n    async downTrigger() {\r\n      if (!this.$el?.parentElement) return\r\n      await this.$nextTick()\r\n      try {\r\n        this.htmlToCanvas()\r\n      } catch (e) {\r\n        console.log(e)\r\n      }\r\n    },\r\n    htmlToCanvas () {\r\n      // 获取需要转canvas元素的宽高\r\n      const { width, height } = this.$el.parentElement?.getBoundingClientRect?.()\r\n      // 开始转换\r\n      html2canvas(this.$el.parentElement, {\r\n        width,\r\n        height,\r\n        // 过滤掉不需要的元素\r\n        ignoreElements: element => {\r\n          // compareDocumentPosition比较节点与指定节点相对位置\r\n          // 例如：P1.compareDocumentPosition(P2)\r\n          // 0：自身\r\n          // 1：没有关系，这两个节点不属于同一个文档。\r\n          // 2：第一节点（P1）位于第二个节点后（P2）。\r\n          // 4：第一节点（P1）定位在第二节点（P2）前。\r\n          // 8：第一节点（P1）位于第二节点内（P2）。\r\n          // 16：第二节点（P2）位于第一节点内（P1）。\r\n          const positionIndex = this.$el?.parentElement?.compareDocumentPosition?.(element)\r\n\r\n          // 重要！！！\r\n          // 保留样式。因为样式在head标签内，所以要将html、head也要保留，否则下载的图片样式有丢失\r\n          const whiteNodeNames = ['STYLE', 'HTML', 'HEAD']\r\n          const nodeType = element.nodeName?.toUpperCase?.()\r\n\r\n          // 过滤html2canvas-ignore类名的元素\r\n          const hasClass = element.classList?.contains?.('html2canvas-ignore')\r\n\r\n          return whiteNodeNames.includes(nodeType) ? false : (positionIndex !== 0 && positionIndex < 8) || hasClass\r\n        }\r\n      })\r\n        .then(canvas => {\r\n          this.downLoad(canvas)\r\n        })\r\n    },\r\n    // 将canvas转dataUrl，并利用a标签下载\r\n    downLoad(canvas) {\r\n      const dataUrl = canvas.toDataURL('image/png', 1.0)\r\n      const tempLink = document.createElement('a')\r\n      tempLink.style.display = 'none'\r\n      tempLink.href = dataUrl\r\n      tempLink.setAttribute('download', `${this.fileName}.png`)\r\n      // 不支持就另开页签开打\r\n      if (typeof tempLink.download === 'undefined') {\r\n        tempLink.setAttribute('target', '_blank')\r\n      }\r\n      document.body.appendChild(tempLink)\r\n      tempLink.click()\r\n      document.body.removeChild(tempLink)\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.down-icon-wrapper {\r\n  position: absolute;\r\n  right: 2px;\r\n  top: 4px;\r\n  cursor: pointer;\r\n  zIndex: 10;\r\n}\r\n.download-icon {\r\n  width: 16px;\r\n}\r\n</style>\r\n"]}]}