### 1、基本数据结构

1、获取校验结果

```json
{
    "info": [
        {
            "mode": "error",
            "message": "报错消息",
            "errorRef": [],
            "isPass": false,
            "ruler": "D29='JB02'!C5",
            "ref": "No142",
            "sheet": "JB01"
        },
        {
            "mode": "warn",
            "message": "报错消息",
            "errorRef": [],
            "isPass": false,
            "ruler": "D27=1",
            "ref": "No141",
            "sheet": "JB01"
        },
    ],
    "result": false
}
```



2、getExamineRecord 审核记录接口的需要的返回值

```json
{
    "data": [
        {
            "position": "A1",
            "sheet": "sheet1",
            "modifyTime": "",
            "modifyUser": "",
            "comments":"审核意见"
        },
        {
            "position": "A1",
            "sheet": "sheet2",
            "modifyTime": "",
            "modifyUser": "",
            "comments":"审核意见2"
        },
    ]
}
```



3、saveExamineRecord 新增审核记录

抛出的参数

```json
{
	"position": "C2",
	"comments": "123",
	"sheetName": "sheet1",
	"modifyField": "price",
	"tableName": "demo_pro.local_test_goods",
	"keyName": "id",
	"keyValue": 2,
	"databaseName": "demo_pro",
	"sheetConfig": {}
}
```

需要返回的结果

```json
{
    "data": true
}
```

字段说明

| 字段名称          | 说明                 | 格式        |
| ----------------- | -------------------- | ----------- |
| position          | 单元格坐标           | 例如 ："A1" |
| comments          | 审核意见             |             |
| sheetName         | sheet页名称          |             |
| modifyField       | 当前单元格绑定的字段 |             |
| tableName         | 表名                 |             |
| keyName           | 主键对应字段         |             |
| keyValue          | 主键对应值           |             |
| databaseName      | 数据库名             |             |
| sheetConfig | sheet页配置         |             |



### 2、props注入

1、公式相关

```vue
<report-view :formulaType="formulaType" :formulaPassList="formulaPassList"></report-view>
```

| 字段名称        | 说明                         | 格式                                                         |
| --------------- | ---------------------------- | ------------------------------------------------------------ |
| formulaType     | 分类                         | 审核公式review，校验公式check                                |
| formulaPassList | 核实性公式通过状态持久化列表 | [{ref:'', isPass:true, formulaId:'', sheet:'', remark:"备注说明"}] |

---

2、审核记录

```vue
<report-view 
  :getExamineRecord ="getExamineRecord" 
  :saveExamineRecord="saveExamineRecord" 
  :showExamineRecordAdd="showExamineRecordAdd"
></report-view>
```

| 字段名称             | 说明                             | 格式                                              |
| -------------------- | -------------------------------- | ------------------------------------------------- |
| getExamineRecord     | 获取审核记录，无入参             |                                                   |
| saveExamineRecord    | 新增审核记录                     | 需要返回审核结果{data:true}成功，{data:false}失败 |
| showExamineRecordAdd | 控制审核记录面板是否显示新增按钮 | true/false                                        |



### 3、API

| 接口名称            | 入参          | 出参                   | 说明                                                  |
| ------------------- | ------------- | ---------------------- | ----------------------------------------------------- |
| getCheckoutResult() |               | {info:[],result:false} | 获取当前校验结果                                      |
| checkWarnFormula()  | sheetName数组 | {info:[],result:false} | 全表校验，核实性公式校验，返回校验结果                |
| checkErrorFormula() | sheetName数组 | {info:[],result:false} | 全表校验，逻辑性公式校验，返回校验结果                |
| checkFormula()      | sheetName数组 | {info:[],result:false} | 全表校验，核实性公式校验+逻辑性公式校验，返回校验结果 |
| getSheetNames()     |               | ['sheet1','sheet2']    | 字符串数组                                                      |
| getCurSheetName()   |               | 'sheet1'               | 字符串                                                      |
|                     |               |                        |                                                       |

### 3、事件

@pass-change

审核公式，【通过/取消通过】后冒泡的事件，捕获值，需要存储公式通过状态，更新formulaPassList

```json
{
	"formulaId": "",
    "ref": "",
    "sheet": "",
    "remark":"",
    "isPass": true
}
```



使用

```vue
<template>
    <div class="report">
      <ReportView ref="report_view" :formulaType="formulaType" :formulaPassList="formulaPassList" @pass-change="handlePassChange" ></ReportView>
    </div>
</template>
<script>
  methods: {
	async handlePassChange(obj, cb) {
      console.log('获取到的参数', obj);
      console.log('回调函数', cb);
      // 新增/更新 公式状态
      let saveResult = await saveItem(obj);
      // 更新 formulaPassList
      let result = await getList();
      // 回调
      cb();
    },

    getCurSheetData() {
      let result = this.$refs.report_view.getSpreadsheet().data;
      console.log('当前sheet页信息', result);
    },
    getAllSheetDatas() {
      let result = this.$refs.report_view.getSpreadsheet().datas;
      console.log('所有sheet页信息', result);
    },
  }
</script>

```



