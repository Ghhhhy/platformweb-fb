[TOC]



## 1、单元格弹出框



***需要在报表设计器面板开启单元格弹出框配置***，可以配置是否手动调用显示隐藏，默认为点击单元格后自动显示



API：

​	1、手动显示/隐藏单元格弹出框***setCellPopoverShow*** ：入参 true(展开)、false(关闭)



使用

```vue
<template>
    <div class="report">
      <ReportView 
        ref="report_view"
        @bind-data-click="bindDataClick"
      >
        <!-- slot插槽名 -->
        <div slot="cell-popover" style="width:300px;height:200px;background:#ffffff;overflow:auto" @click="close">
          {{ cellData }}
        </div>
      </ReportView>
    </div>
</template>
<script>
    data() {
      return {
        cellData:{}
      }  
    },
    methods: {
      bindDataClick(data) {
         this.cellData = data
      },
      close(){
        this.$refs.report_view.setCellPopoverShow(false);
      }
    }
</script>
```



## 2、初始化设置单元格背景颜色



需要配置props： ***cellBgList***

```js
[
  {
    sheet: 'sheet1',
    position: 'A2',
    bgColor: 'red'
  },
  {
    sheet: 'sheet1',
    position: 'B3',
    bgColor: '#1e70eb'
  }
];
```



## 3、单元格业务参数



***props配置***： ***cellCustomConfigList***

```js
[
  {
    label: '是否汇总',
    type: 'switch',
    key: 'isSummary'
  },
  {
    label: '下拉选测试',
    type: 'select',
    key: 'selectKey',
    options: [{ label: '1', value: '111' }]
  },
  {
    label: '普通输入测试',
    type: 'input',
    key: 'str'
  },
  {
    label: '数字输入测试',
    type: 'numberInput',
    key: 'num'
  }
]
```



| 字段    | 说明                         | 取值                                                         |
| ------- | ---------------------------- | ------------------------------------------------------------ |
| label   | 显示名                       |                                                              |
| type    | 组件类型                     | switch：开关、select：下拉选、numberInput：数字输入框、input：输入框 |
| key     | customConfig对象中的key      |                                                              |
| options | type为下拉选时需要配置的选项 | [{ label: '', value: '' }]                                   |



***事件配置***：

@cellCustomCfgInit="cellCustomCfgInit"     获取customConfig时冒泡，用于初始化动态***cellCustomConfigList***

@cellCustomCfgChange="cellCustomCfgChange"   值改变时冒泡的事件，用于联动

示例

```vue
<template>
  <div style="width: 100%;height: 100%;">
    <report-design
      ref="excelDesign"
      :cellCustomConfigList="getCellCustomConfig()"
      @cellCustomCfgInit="cellCustomCfgInit"
      @cellCustomCfgChange="cellCustomCfgChange"
    ></report-design>
  </div>
</template>
<script>
export default {
  mixins: [mixin],
  components: {
    SaveTemplateDialog
  },
  data() {
    return {
      reportOptions: [],
      sheetOptions: [],
    };
  },

  methods: {
    getCellCustomConfig() {
      return [
        {
          label: '非汇总项',
          type: 'switch',
          key: 'noSummary'
        },
        {
          label: '汇总报表',
          type: 'select',
          key: 'summaryExcelId',
          options: this.reportOptions
        },
        {
          label: '汇总Sheet页',
          type: 'select',
          key: 'summarySheetId',
          options: this.sheetOptions
        },
        {
          label: '汇总字段',
          type: 'input',
          key: 'summaryFieldName'
        },
        {
          label: '字段标识',
          type: 'input',
          key: 'summaryIdentifierValue'
        }
      ];
    },
    cellCustomCfgInit(obj) {
      console.log("入参为该单元格所设置的customConfig对象",obj)
    },
    cellCustomCfgChange(obj, updateKey, cb) {
      console.log("customConfig对象",obj)
      console.log("当前更改的值",updateKey)
      console.log("回调函数",cb)
      let summarySheetId = obj.summarySheetId;
      let summarySheetName = '';
      if (updateKey === 'summaryExcelId') {
        summarySheetId = '';
        this.sheetOptions = [];
        if (obj.summaryExcelId) {
          ...略;
        }
      }

      if (summarySheetId) {
        let find = this.sheetOptions.find(i => i.value === summarySheetId);
        summarySheetName = find.label;
      }
      let summaryIdentifierKey = obj.summaryIdentifierValue ? '联动值' : '';
       
      // 联动更新列表
      let updateParamsList = [
        { key: 'summarySheetId', value: summarySheetId },
        { key: 'summarySheetName', value: summarySheetName },
        { key: 'summaryIdentifierKey', value: summaryIdentifierKey }
      ];
      // 调用回调函数
      cb && cb(updateParamsList);
    },

  },
};
</script>
```



getExcelData方法中，会返回对应数据

```json
{
	"customConfig": {
		"isSummary": false,
		"selectKey": "111",
		"str": "",
		"num": 123
	}
}
```



