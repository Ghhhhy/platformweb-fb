### 1、返回数据格式

1、getSubmitFillDataBySheets

```json
[
	{
		"sheetName": "Sheet1",
		"sheetConfig": {}, // sheet页配置
		"compareResult": {
			"add": [],
			"update": [],
			"delete": []
		}
	},
	{
		"sheetName": "sheet2",
		"sheetConfig": {},
		"compareResult": {
			"add": [],
			"update": [],
			"delete": []
		}
	},
	{
		"sheetName": "sheet3",
		"sheetConfig": {},
		"compareResult": {
			"add": [],
			"update": [],
			"delete": []
		}
	}
]
```



2、@fill-submit 修改记录

```json
[
	{
		"sheetConfig": {},
		"sheetName": "",
		"updateRecord": [
			{
				"tableName": "demo_pro.local_test_goods",
				"keyName": "id",
				"databaseName": "demo_pro",
				"keyValue": "1",
				"modifyField": "price",
				"reason": "2",
				"beforeModify": "",
				"afterModify": "1",
				"position": "C1"
			}
		]
	}
]
```





### 2、API/props

1、分sheet页获取填报保存数据：**getSubmitFillDataBySheets()**

2、判断是否开启修改记录功能：**getIsOpenRecord()**，开启为 **true**

3、新增事件：   **@fill-submit**  开启修改记录功能后，从改事件获取数据

4、需要配置props：***getModifyRecord*** 传入一个获取修改记录的接口

5、新增事件：   ***@bind-data-click***  点击单元格后冒泡绑定的字段数据

调用:

```vue
<template>
	<el-button type="primary" @click="submit">提交</el-button>
    <div class="report">
      <ReportView 
        ref="report_view" 
        :getModifyRecord="fetchModifyRecord" 
        @fill-submit="fillSubmit" 
        @bind-data-click="bindDataClick"
      ></ReportView>
    </div>
</template>
<script>
    methods: {
        // 接口
        ...mapActions('datavModule/excelReport', [ 'getModifyRecord', 'saveModifyRecord']),
        submit() {
            let data = this.$refs.report_view.getSubmitFillDataBySheets();
            let openRecord = this.$refs.report_view.getIsOpenRecord();

            if (!openRecord) {
               // 没开启时，有返回值，开启之后，从@fill-submit事件获取
              console.log('获取到的数据', data);
            }
      		
        },
        async fillSubmit(data, records) {
            console.log('获取到的填报数据', data);
            console.log('修改记录数据', records);
            let result = await this.save(data);
            if (result.code === '200') {
              this.$message.success('保存成功！');
              // 保存修改记录数据 
              await this.saveModifyRecord(records);
            } else {
              this.$message.error('保存失败！');
            }
        },
        getCurSheetData() {
			let result = this.$refs.report_view.getSpreadsheet().data;
      		console.log('当前sheet页信息', result);
        },
        bindDataClick(data) {
            console.log('单元格绑定的字段数据', data);
        },
        fetchModifyRecord(data) {
          let newData = {...data,a:'自己的参数'}
          return this.getModifyRecord(newData);
        },
    }
</script>

```



props：***getModifyRecord*** 接口：

报表插件**提供的参数**有，可自行塞入业务参数

| 字段              | 字段说明       | 备注             |
| ----------------- | -------------- | ---------------- |
| modifyField       | 绑定的数据字段 |                  |
| tableName         | 表名           |                  |
| keyName           | 主键名         |                  |
| keyValue          | 主键值         |                  |
| databaseName      | 数据库名       |                  |
| sheetName         | sheet页名称    |                  |
| sheetConfig | sheet页配置       |  |



需要返回的结构数据

```json
{
	"data": [
		{
			"modifyTime": "",
			"modifyUser": "",
			"beforeModify": "",
			"afterModify": "",
			"reason": ""
		}
	]
}
```

| 字段         | 字段说明 | 备注 |
| ------------ | -------- | ---- |
| modifyTime   | 修改时间 |      |
| modifyUser   | 修改人   |      |
| beforeModify | 修改前值 |      |
| afterModify  | 修改后值 |      |
| reason       | 修改原因 |      |







***@bind-data-click*** 冒泡的单元格绑定的字段数据

| 字段              | 字段说明          | 备注              |
| ----------------- | ----------------- | ----------------- |
| databaseName      | 数据库名          |                   |
| tableName         | 表名              |                   |
| keyName           | 主键名            |                   |
| keyValue          | 主键值            |                   |
| modifyField       | 绑定数据字段      |                   |
| identifierKey     | 标识符的字段名    |                   |
| identifierValue   | 标识符的值        |                   |
| sheetConfig | sheet页配置          |   |
| sheetName         | 当前sheet页的名称 |  |

