# 报表插件使用说明

## 设置博思 CNPM 私服

使用 yarn 设置私服

```cmd
yarn config set registry http://58.22.61.222:14873/
```

使用 npm 设置私服

```cmd
npm config set registry http://58.22.61.222:14873/
```

## 安装报表插件

使用 YARN 安装

```cmd
yarn add @platform/report

yarn add @platform/charts-grid-layout  //依赖包

yarn add @platform/boss-interactive  //依赖包
```

使用 NPM 安装

```cmd
npm install @platform/report --save

npm install @platform/charts-grid-layout --save  //依赖包

npm install @platform/boss-interactive --save  //依赖包
```

## 引入报表插件

```javascript
import Report from '@platform/report';
import GridLayout from '@platform/charts-grid-layout';
import BossInteractive from '@platform/boss-interactive';

Vue.use(Report);
Vue.use(GridLayout);
Vue.use(BossInteractive);
```

## 代理设置

```javascript
devServer:{
    hot: true,
    proxy: {
      '/datav': {
        target: 'http://172.18.172.206:8086/', //数据可视化服务地址
        changOrigin: true, //允许跨域
      }
    }
}

```


## 使用 code 获取报表，向插件传递参数显示报表

```javascript
<template>
  <ReportView :codes="code" :initParams="initParams"  :initSearchData="initSearchData" :initBusinessContext="initBusinessContext"></ReportView>
</template>

<script>
export default {
  data() {
    return {
      code: 'multiple_test',// 设计端对应的报表code
      paramsObj: {
        city: '福州'
      },
      searchObj: {
        time: '2023-04-12'
      },
      businessContext: {
        token: '' //应用的上下文信息，字段和取值由应用前后端规定
      }
    };
  },
  methods: {
    /**
     * initParams方法进行报表内容替换和搜索条件初始值设置 ，
     * 例如设计端报表设置了占位符 #{city},等待应用端渲染完成后excel内容含有#{city}的占位符将替换成'福州'，
     */
    initParams(params) {
      return new Promise(resolve => {
        let paramsTemp = { ...this.paramsObj };
        Object.keys(params).map(key => {
          if (Object.hasOwnProperty.call(this.paramsObj, key)) {
            paramsTemp[key] = this.paramsObj[key];
          }
        });
        resolve(paramsTemp);
      });
    },
    /**
     * initSearchData方法进行报表查询条件初始值设置 ，
     * 例如设计端报表设置了字段time的查询组件,等待应用端渲染完成后excel的查询组件值将替换成'2023-04-12'，
     */
    initSearchData(searchObj) {
      return new Promise(resolve => {
        let searchObjTemp = { ...this.searchObj };
        Object.keys(searchObj).map(key => {
          if (Object.hasOwnProperty.call(this.searchObj, key)) {
            searchObjTemp[key] = this.searchObj[key];
          }
        });
        resolve(searchObjTemp);
      });
    },
    /**
     * 若无权限控制，则插件中不需要绑定该方法
     * 设置业务上下文信息businessContext
     * 上下文信息会在数据获取时传递给应用后端进行权限控制
     **/
    initBusinessContext() {
      return new Promise(resolve => {
        resolve(this.businessContext);
      });
    },
  }
};
</script>

```

## 使用 mode 属性区分独立展示备注及草案说明修改
```javascript
<template>
  <div>
    <ReportView ref="report_view" :codes="code"  :mode="mode" :modeEditable="modeEditable" />

  </div>

</template>

<script>
export default {
  data(){
    return {
      code:'',
      modeEditable:true,// 当draft与remark模式时，草案与备注编辑为不可编辑
      mode:'draft'// draft: 草案说明修改, remark: 备注修改
    }
  }
};
</script>
```
## 客户端导出 excel 对接

```javascript
1、配置customConfigFile.json文件中的serviceUrl设置为数据可视化后端服务地址
2、配置customConfigFile.json文件中的clientExport设置为true（用于开启客户端导出按钮）
3、应用端使用报表插件时需要public文件夹添加app-plugin.src.js、app.plugin.min.css、jquery.js三个文件，index.html引入三个文件：
<!DOCTYPE html>
<html lang="en">
  <head>
    ...
    <link href="./app.plugin.min.css" rel="stylesheet" type="text/css"/>
    ...
  </head>
  <body>
	...
    <script src="./jquery.js"></script>
    <script src="./app-plugin.src.js"></script>
  </body>
</html>

4、应用端需要加载插件时初始化方法window.bossJS.init()，并且实现导出按钮的回调方法@export-excel="exportExcel"：
<template>
  <report-view ref="reportView" :excelId="excelId" @export-excel="exportExcel"></report-view>
</template>

<script>

export default {
  data() {
    return {
      excelId: this.$route.query.excelId
    };
  },
  methods: {
    getInstance() {
      var Xsheet = window.bossJS.Xsheet;
      return Xsheet.getInstance({
        config: {
          appId: 'gov-aims'
        }
      });
    },

    exportExcel(options) {
      let instance = this.getInstance();
      let exportPages = instance.printingSheetRequest(options);
      let _this = this;
      exportPages
        .done(function(data) {
          _this.$refs.reportView.exportExcelDone();
          console.log('export excel success',data);
        })
        .fail(function(obj) {
          _this.$refs.reportView.exportExcelFail();
          console.log('export excel error', obj);
        });
    }
  },
  mounted() {
    window.bossJS.init();
  }
};
</script>
```

## 批量打印方法调用

```javascript
<template>
  <div>
    <ReportView ref="report_view" :codes="code" @print-pdf="printPdf" />
  </div>

</template>

<script>
export default {
  methods: {
    getInstance() {
      var Xsheet = window.bossJS.Xsheet;
      return Xsheet.getInstance({
        config: {
          appId: 'gov-aims'
        }
      });
    },

    printPdf(options) {
      let instance = this.getInstance();
      let exportPages = instance.printingSheetRequest(options);
      let _this = this;
      exportPages
        .done(function(data) {
          _this.$refs.report_view.batchPrintDone();
          console.log('print pdf success',data);
        })
        .fail(function(obj) {
          _this.$refs.report_view.batchPrintFail();
          console.log('print pdf error', obj);
        });
    }
  },
};
</script>
```

## reportview 自定义钻取控制

```javascript
// excelLinkDisabled: true, 钻取都禁用默认为false
// isCustomExcelLink 自定义钻取处理
<template>
  <div>
    <ReportView :excelLinkDisabled="true" ref="report_view" :codes="code"  :isCustomExcelLink="true" @custom-excel-link="excelLinkHandle"  />
  </div>

</template>
<script>

export default {
  methods: {
    /**
    * 自定义excel钻取
    */
    excelLinkHandle(payload) {
      const {origin={},target={}}=payload
      const { excelCode, excelId, excelSheet:{sheetName,sheetConfig}, cell}=origin
      const { excelCode, excelId, excelSheet:{sheetName,sheetConfig}, excelLinkParams}=target
      // excelCode 报表编码
      // excelId 报表id
      // sheetName  报表标签页
      // sheetConfig 报表配置
      // excelLinkParams 钻取参数
      // cell 单元格信息
    }
  },
};
</script>
```

## reportview 组件加载完成回调事件

```javascript
<template>
  <div>
    <ReportView ref="report_view" :codes="code"    @load-end="loadEndHandle" />

  </div>

</template>

<script>
export default {
  methods: {
    loadEndHandle(isLoading) {
      // doing isLoading=true 加载完成 ， isLoading=false加载失败
    }
  },
};
</script>
```

## 报表查询、打印、导出 Excel  导出 PDF、批量导出 Excel、批量导出 PDF、setParams 方法、fetchData 取数、获取 excel 密码密文 ,setUnit 单位切换, exportExcelByServiceBefore，exportExcelByServiceAfter为服务端导出的回调事件 

```javascript
<template>
  <div>
    <ReportView ref="report_view" :codes="code"     @exportExcelByServiceBefore="exportExcelByServiceBefore"
    @exportExcelByServiceAfter="exportExcelByServiceAfter" :userCode="userCode" />
  </div>

</template>

<script>
export default {
  data() {
    return {
      code: 'multiple_test',// 设计端对应的报表code
      userCode: '101' // 标识用户编码，不传或传空时使用默认配置
    };
  },
  methods: {
    exportExcelByServiceBefore() {
      console.log("exportExcelByServiceBefore");
    },
    exportExcelByServiceAfter() {
      console.log("exportExcelByServiceAfter");
    },
    setParams(){
      let params={cityCode:'350526'};
      this.$refs.report_view.setParams(params);
    },
    searchData() {
      let params={};
      this.$refs.report_view.searchData(params); // 查询当前报表数据
    },
    print() {
     this.$refs.report_view.print(); // 打印当前报表
    },
    exportExcel() {
     this.$refs.report_view.exportExcel(); // 当前报表导出成Excel
    },
    exportPDF() {
     this.$refs.report_view.exportPDF(); // 当前报表导出成PDF
    },
    batchExportExcel(excelParams) {
     this.$refs.report_view.batchExportExcel(excelParams); // 选中报表批量导出成Excel，excelParams说明请参考以下【excelParams结构说明】
    },
    getSheetValidateList(){
      type SheetValidateItemType = {
        sheetName: string;  // sheet名
        required: boolean, // 没有绑定不需要校验值为false,否则需要校验值为true
        validate: boolean, // 校验结果，通过（至少一个绑定字段有值）为true，不通过（所有绑定字段都没值）为false
        allNotFilled: boolean, // true（绑定的字段都没填）/false（绑定的字段至少有一个填了）
        validateMsg:Array<{
            cell: string; // 具体单元格
            message:  string; // 提示信息
        }>
      }
      // 获取excel的校验
      const osheetValidateList: Array<SheetValidateItemType> = this.$refs.report_view.getSheetValidateList();
      // [{
      //     sheetName: 'sheet1',
      //     required: true,
      //     validate: true,
      //     allNotFilled: true,
      //     validateMsg: [{
      //         cell: 'C5',
      //         message: '字符长度超过64'
      //     }]
      // }]
    },
    batchExportPDF(excelParams) {
     this.$refs.report_view.batchExportPDF(excelParams); // 选中报表批量导出成PDF，excelParams说明请参考以下【excelParams结构说明】
    },
    batchPrint(excelParams) {
     this.$refs.report_view.batchPrint(excelParams); // 选中报表批量打印，，excelParams说明请参考以下【excelParams结构说明】
    },
    fetchData(){
      this.$refs.report_view.fetchData(); // 调用取数规则配置的数据集进行取数
    },
    encodeExcelPassword() {
      let password = 'abcdefghij'
      let pwd = this.$refs.report_view.excelPasswordEncode(password); // 获取excel密码密文
      console.log(pwd);
    },
    setUnit(unit="1"){
      this.$refs.report_view.setUnit(unit); // "1"|"100"|"1000"|"10000"|"100000000"
    }
  },
  mounted() {
    window.bossJS.init();
  }
};
</script>
```

#### excelParams 结构说明

```
[
  {
      "folderList": ['012','012上海市现代管理研究中心'],
      "editPasswordEnabled": true,
      "editPassword": "C71F",
      "excelName": "中央组织部预算表",
      "excels": [
          {
              "excelCode": "111",
              "userCode": "110",
              "sheetName": "收入表",
              "params": {
                  "agency": "101"
              }
          },
          {
              "excelCode": "222",
              "sheetName": "支出表",
              "params": {
                  "agency": "101"
              }
          },
          {
              "excelCode": "333",
              "userCode": "130",
              "sheetName": "汇总表",
              "params": {
                  "agency": "101"
              }
          }
      ]
  }
]
```

| 字段名              | 字段名    | 注释              | 数据类型 | 客户端使用 | 必传 | 默认值 | 取值范围   | 说明                                              |
| ------------------- | --------- | ----------------- | -------- | ---------- | ---- | ------ | ---------- | ------------------------------------------------- |
| folderList          |           | 文件夹列表        | array    | Y          | N    | []     |            | 相同层级的文件夹名称不重复创建                    |
| editPasswordEnabled |           | 是否设置密码      | boolean  | Y          | N    | false  | true/false | 不传时认为没有设置密码                            |
| editPassword        |           | 编辑密码          | string   | Y          | N    | ""     |            | 需要调用 excelPasswordEncode 方法转换为密文再传入 |
| excelName           |           | 输出文件名称      | string   | Y          | Y    | “”     |            |                                                   |
| excels              |           | excel 数组        | array    | Y          | Y    | []     |            |                                                   |
|                     | excelCode | 报表 code         | string   | Y          | Y    | ""     |            |                                                   |
|                     | userCode  | 用户 code         | string   | Y          | N    | ""     |            | 标识用户编码，不传或传空时使用默认配置            |
|                     | sheetName | 输出 sheet 页名称 | string   | Y          | Y    | ""     |            |                                                   |
|                     | params    | 报表参数对象      | object   | Y          | Y    | {}     |            | 用于报表参数传递                                  |

## 导出草案书exportDraft、批量导出草案书batchExportDraft方法调用

```javascript
<template>
  <div>
    <ReportView ref="report_view" :codes="code" @export-draft="exportDraftRsp" @batch-export-draft="batchExportDraftRsp" />
  </div>

</template>

<script>
export default {
  methods: {
    getInstance() {
      var Xsheet = window.bossJS.Xsheet;
      return Xsheet.getInstance({
        config: {
          appId: 'gov-aims'
        }
      });
    },
    exportDraft(draftList, draftConfig, fileType ) {
      // fileType可选值为'pdf'或'word'，不传则默认为'pdf'
     this.$refs.report_view.exportDraft(draftList, draftConfig, fileType ); // 选中报表导出成草案书，draftList说明请参考以下【draftList结构说明】
    },
    exportDraftRsp(options) {
      let instance = this.getInstance();
      let exportPages = instance.exportDraftRequest(options);
      let _this = this;
      const { fileType } = options;
      exportPages
        .done(function(data) {
          if (fileType === 'pdf') {
            _this.$refs.report_view.exportPdfDone();
          } else if (fileType === 'word') {
            _this.$refs.report_view.downWord();
          }
          console.log('export success', data);
        })
        .fail(function(obj) {
          _this.$refs.report_view.exportPdfFail();
          console.log('export error', obj);
        });
    },
    batchExportDraft(fileList) {
     this.$refs.report_view.batchExportDraft(fileList); // 批量导出草案书，fileList说明请参考以下【fileList结构说明】
    },
    batchExportDraftRsp(options) {
      let instance = this.getInstance();
      let exportPages = instance.batchExportDraftRequest(options);
      let _this = this;
      exportPages
        .done(function(data) {
          _this.$refs.report_view.batchExportDraftDone();
          console.log('export success', data);
        })
        .fail(function(obj) {
          _this.$refs.report_view.batchExportDraftFail();
          console.log('export error', obj);
        });
    }
  },
};
</script>
```

#### fileList 结构说明

```
[
    {
        fileType: 'pdf',
        draftName: '草案说明',
        draftList: [],
        draftConfig: {
            titleName: '目录',
            titleFontSize: '18px',
            titleFontFamily: '宋体',
            titleFontWeight: 'bold',
            titleMarginBottom: '20px',
            lineHeight: 1,
            marginTop: '50px',
            marginBottom: '50px',
            marginLeft: '50px',
            marginRight: '50px',
            showPagination: 'true',
            paginationType: '60',
            paginationFontSize: '12px',
            paginationFontFamily: '宋体',
            paginationPaddingTop: '10px'
        },
    }
]
```

| 字段名   | 字段名      | 注释     | 数据类型 | 客户端使用 | 必传 | 默认值 | 取值范围  | 说明                          |
| -------- | ----------- | -------- | -------- | ---------- | ---- | ------ | --------- | ----------------------------- |
| fileList |             | 文件数组 | array    | Y          | Y    | []     | 无        |                               |
|          | fileType    | 文件类型 | string   | Y          | Y    | excel  | pdf\|word | 文件类型pdf,word              |
|          | draftName   | 草案名称 | string   | Y          | Y    | ""     | 无        |                               |
|          | draftList   | 草案数组 | array    | Y          | Y    | []     | 无        | 详细见【draftList结构说明】   |
|          | draftConfig | 草案配置 | object   | Y          | Y    | 无     | 无        | 详细见【draftConfig结构说明】 |

#### draftList 结构说明

```
[
            {
                catalogueName: '一、2022年中央部门预算编制说明',
                showPage: true,
                pageSize: 2,
                fontSize: '16px',
                fontFamily: '宋体',
                fontWeight: 'bold',
                children: [],
                excels: [
                	{
                        excelCode: '1',
              			userCode: '110',
                		outputType: 2,
                        params: {
                        	enableRowReadableAuthority: true,
                            page: true,
                            pageNum: 0,
                            pageSize: 0,
                            paramMap: {
                                agencyCode: '10101'
                            },
                            searchMap: {}
                        }
                	}
                ],
            },
            {
                catalogueName: '二、2022年中央本级一般公共预算支出汇总表',
                showPage: true,
                fontSize: '16px',
                fontFamily: '宋体',
                fontWeight: 'bold',
                children: [],
                excels: [
                	{
                        excelCode: '2',
                		outputType: 0,
                        params: {
                            paramMap: {
                                agencyCode: '101'
                            }
                        }
                	}
                ]
            },
            {
                catalogueName: '五、2022年中央部门预算明细表及说明文字',
                showPage: false,
                fontSize: '16px',
                fontFamily: '宋体',
                fontWeight: 'bold',
                excels: [],
                children: [
                    {
                        catalogueName: '中共中央组织部',
                        showPage: true,
                        fontSize: '14px',
                        fontFamily: '宋体',
                        fontWeight: '',
                        excels: [
                        	{
                                excelCode: '111',
              					userCode: '111',
                				outputType: 1,
                                params: {
                                    paramMap: {
                                        agencyCode: '10101'
                                    }
                                }
                        	},
                        	{
                                excelCode: '222',
              					userCode: '222',
                				outputType: 1,
                                params: {
                                    paramMap: {
                                        agencyCode: '10101'
                                    }
                                }
                        	},
                        	{
                                excelCode: '111',
              					userCode: '111',
                				outputType: 2,
                                params: {
                                    paramMap: {
                                        agencyCode: '10101'
                                    }
                                }
                        	},
                        	{
                                excelCode: '222',
              					userCode: '222',
                				outputType: 2,
                                params: {
                                    paramMap: {
                                        agencyCode: '10101'
                                    }
                                }
                        	}
                        ],
                        children: []
                    },
                    {
                        catalogueName: '中共中央宣传部',
                        showPage: true,
                        fontSize: '14px',
                        fontFamily: '宋体',
                        fontWeight: '',
                        excels: [
                        	{
                                excelCode: '111',
                				outputType: 1,
                                params: {
                                    paramMap: {
                                        agencyCode: '10102'
                                    }
                                }
                        	},
                        	{
                                excelCode: '222',
                				outputType: 1,
                                params: {
                                    paramMap: {
                                        agencyCode: '10102'
                                    }
                                }
                        	}
                        ],
                        children: []
                    },
                    {
                        catalogueName: '中共网络安全和信息化委员会办公室',
                        showPage: true,
                        fontSize: '14px',
                        fontFamily: '宋体',
                        fontWeight: '',
                        excels: [
                        	{
                                excelCode: '111',
                				outputType: 1,
                                params: {
                                    paramMap: {
                                        agencyCode: '10103'
                                    }
                                }
                        	},
                        	{
                                excelCode: '222',
                				outputType: 1,
                                params: {
                                    paramMap: {
                                        agencyCode: '10103'
                                    }
                                }
                        	}
                        ],
                        children: []
                    }
                ]
            }
]
```

| 字段名        | 字段名     | 字段名                     | 注释         | 数据类型 | 客户端使用 | 必传 | 默认值 | 取值范围       | 说明                                           |
| ------------- | ---------- | -------------------------- | ------------ | -------- | ---------- | ---- | ------ | -------------- | ---------------------------------------------- |
| catalogueName |            |                            | 目录名称     | string   | Y          | Y    | []     | 无             |                                                |
| showPage      |            |                            | 显示页码     | boolean  | Y          | Y    | true   | true/false     |                                                |
| pageSize      |            |                            | 内容页数     | number   | Y          | Y    | null   | null/0/1/2/... | 内容页数，有数值就用数值，没有数值用解析的页数 |
| fontSize      |            |                            | 目录字号     | string   | Y          | N    | '14px' | 无             |                                                |
| fontFamily    |            |                            | 目录字体     | string   | Y          | N    | '宋体' | 无             |                                                |
| fontWeight    |            |                            | 目录字宽     | string   | Y          | N    | ''     | ''/'bold'      |                                                |
| excels        |            |                            | 报表列表     | array    | Y          | Y    | []     | 无             | 该目录对应的报表                               |
|               | excelCode  |                            | 报表 code    | string   | Y          | Y    | ""     | 无             | 报表 code，可能有重复的场景                    |
|               | userCode   |                            | 用户code     | string   | Y          | N    | ""     | 无             | 标识用户编码，不传或传空时使用默认配置         |
|               | outputType |                            | 输出类型     | number   | Y          | Y    | 0      | 0/1/2          | 0：全展示 1：只展示表 2： 只展示说明           |
|               | params     |                            | 报表参数对象 | object   | Y          | Y    | {}     | 无             | 用于报表参数传递                               |
|               |            | enableRowReadableAuthority | 行可读权限   | boolean  | Y          | N    | false  | true/false     |                                                |
|               |            | page                       | 是否分页     | boolean  | Y          | N    | false  | true/false     |                                                |
|               |            | pageNum                    | 页码         | number   | Y          | N    | 0      | 0/1/2/...      |                                                |
|               |            | pageSize                   | 单页条数     | number   | Y          | N    | 0      | 0/1/2/...      |                                                |
|               |            | paramMap                   | 报表参数     | object   | Y          | N    | {}     | 无             |                                                |
|               |            | searchMap                  | 查询参数     | object   | Y          | N    | {}     | 无             |                                                |
| children      |            |                            | 子目录信息   | array    | Y          | Y    | []     | 无             | 数组对象为本结构，层级嵌套实现目录层级         |
#### draftConfig 结构说明
| 字段名      | 字段名               | 注释           | 数据类型 | 客户端使用 | 必传 | 默认值 | 取值范围                                                     | 说明                     |
| ----------- | -------------------- | -------------- | -------- | ---------- | ---- | ------ | ------------------------------------------------------------ | ------------------------ |
| draftConfig |                      | 草案配置       | object   | Y          | Y    | 无     | 无                                                           |                          |
|             | titleName            | 标题名称       | string   | Y          | N    | '目录' | 无                                                           |                          |
|             | titleFontSize        | 标题字号       | string   | Y          | N    | '20px' | 无                                                           |                          |
|             | titleFontFamily      | 标题字体       | string   | Y          | N    | '黑体' | 无                                                           |                          |
|             | titleFontWeight      | 标题字宽       | string   | Y          | N    | 'bold' | ''/'bold'                                                    |                          |
|             | titleMarginBottom    | 标题下边距     | string   | Y          | N    | '20px' | 无                                                           | 标题距离第一条目录的距离 |
|             | lineHeight           | 整体行高       | string   | Y          | N    | 1      | 1/1.5/2/2.5/3                                                |                          |
|             | showPagination       | 是否显示页码   | boolean  | Y          | N    | true   | true/false                                                   |                          |
|             | paginationType       | 页码类型       | string   | Y          | N    | '60'   | 【'10'】'1，2，3...'<br/>【'20'】'- 1 -，- 2 - ，- 3 -...'<br/>【'30'】'一，二，三...'<br/>【'40'】'第1页，第2页，第3页...'<br/>【'50'】'第一页，第二页，第三页...'<br/>【'60'】'I，II，III...'<br/>【'70'】'第I页，第II页，第III页...' |                          |
|             | paginationFontSize   | 页码字号       | string   | Y          | N    | '12px' | 无                                                           |                          |
|             | paginationFontFamily | 页码字体       | string   | Y          | N    | '宋体' | 无                                                           |                          |
|             | paginationPaddingTop | 页码顶部偏移量 | string   | Y          | N    | '20px' | 无                                                           |                          |
|             | marginTop            | 上边距         | string   | Y          | N    | '50px' | 无                                                           |                          |
|             | marginBottom         | 下边距         | string   | Y          | N    | '50px' | 无                                                           |                          |
|             | marginLeft           | 左边距         | string   | Y          | N    | '50px' | 无                                                           |                          |
|             | marginRight          | 右边距         | string   | Y          | N    | '50px' | 无                                                           |                          |

## 填报数据对接

```vue
<template>
  <div class="home">
    <div class="banner">
      <el-button type="primary" @click="submit">提交</el-button>
    </div>
    <div class="report">
      <ReportView ref="report_view" :codes="code"></ReportView>
    </div>
  </div>
</template>

<script>

export default {
  name: 'datav-excelReport',
  data() {
    return {
      code: '7dc5a66003e611ed940ae96ca2195cb2', // 设计端对应的报表code
    };
  },
  methods: {
    async submit() {
      let data = this.$refs.report_view.getSubmitFillData(); // 提交前调用报表插件的getSubmitFillData方法，获取到填报后变化的数据结构
      console.log(data);
      this.$apis.user.dataExecute(data).then((result) => {  // 发送提交数据的接口到应用后端，进行数据入库，并处理后续判断逻辑
        if (result.code == 200) {
          this.$message.success('保存成功！');
        } else {
          this.$message.error('保存失败！');
        }
      })
      .catch(() => {
        this.$message.error('保存失败！');
      })
    }
  }
};
</script>

```

## 填报表设置不可编辑（editable 设置为 false）

```javascript
<template>
  <div>
    <ReportView ref="report_view" :codes="code" :editable="false" />
  </div>
</template>

```

## 填报表校验

> 确定是否有绑定字段,如果绑定一个字段就要校验，都没有绑定不需要校验

```javascript
// 需要注意旧的数据问题，模板需要进行保存后,才可进行校验
<script>
export default {
  methods: {
    getSheetValidateList() {
      type sheetValidateItem = {
        sheetName: string, // sheet名
        required: boolean, // 没有绑定不需要校验值为false,否则需要校验值为true
        validate: boolean, // 校验结果，通过（至少一个绑定字段有值）为true，不通过（所有绑定字段都没值）为false
        allNotFilled: boolean, // true（绑定的字段都没填）/false（绑定的字段至少有一个填了）
        validateMsg: Array<{
          cell: string, // 具体单元格
          message: string, // 提示信息
        }>,
      };
      // 获取excel的校验
      const sheetValidateList: Array<sheetValidateItem> =
        this.$refs.report_view.getSheetValidateList();
      // [{
      //     sheetName: 'sheet1',
      //     required: true,
      //     validate: true,
      //     allNotFilled: true,
      //     validateMsg: [{
      //         cell: 'C5',
      //         message: '字符长度超过64'
      //     }]
      // }]
    },
  },
};
</script>
```

## 获取报表数据集相关信息

```vue
<template>
  <div class="home">
    <div class="banner">
      <el-button type="primary" @click="getInfo">获取数据集信息</el-button>
    </div>
    <div class="report">
      <ReportView ref="report_view" :codes="code"></ReportView>
    </div>
  </div>
</template>
export default {
  name: 'datav-excelReport',
  data() {
    return {
      code: '7dc5a66003e611ed940ae96ca2195cb2', // 设计端对应的报表code
    };
  },
  methods: {
    async getInfo() {
      const dasetInfos = await this.$refs.report_view.getDatasetDetailInfo(); // 调用方式一，未传参数时默认取当前渲染的报表数据集相关信息
	  // const dasetInfos = await this.$refs.report_view.getDatasetDetailInfo({ code: this.code });  // 调用方式二，指定code
	  // dasetInfos 说明请参考以下【dasetInfos结构说明】
    }
  }
};
</script>
```

#### dasetInfos结构说明

```json
[
    {
        "datasetId": "4c26a09c0be144628b3faa69f0539727",
        "datasetName": "数据集1",
        "sourceType": "SQL",
        "tableName": "",
        "sourceSql": "select ID,SEQ_NO,DW_CODE,DW_NAME from test_table where DW_CODE = '#{dwCode}'",
        "datasetConfig": {
            "datasetParameterConfigs": [
                {
                    "defaultValue": "1", // 默认值
                    "parameterKey": "dwCode", // 占位符参数KEY
                    "parameterName": "单位编码", // 占位符参数名称
                    "type": "string" // 默认值类型
                }
            ],
            "datasetParameterDefaultValues": {
                "dwCode": "1"
            }
        }
    },
    {
        "datasetId": "05abcb7729a347efabf72b73c19abc83",
        "datasetName": "数据集2",
        "sourceType": "TABLE",
        "tableName": "demo_pro.wdy_number_change_4",
        "sourceSql": "",
        "datasetConfig": {
            "datasetParameterConfigs": [],
            "datasetParameterDefaultValues": {}
        }
    },
]
```

| 字段名        | 字段名                        | 类型   | 说明                                                         |
| ------------- | ----------------------------- | ------ | ------------------------------------------------------------ |
| datasetId     |                               | String | 数据集ID                                                     |
| datasetName   |                               | String | 数据集名称                                                   |
| sourceType    |                               | String | 数据集类型，"SQL"为自定义SQL语句的数据集，"TABLE"为选择表的数据集 |
| tableName     |                               | String | 表名                                                         |
| sourceSql     |                               | String | SQL语句                                                      |
| datasetConfig |                               | Object | 数据集配置信息                                               |
|               | datasetParameterConfigs       | Array  | SQL占位符参数信息                                            |
|               | datasetParameterDefaultValues | Object | SQL占位符参数默认值MAP对象                                   |



## 报表比对组件对接

```javascript
<template>
  <div>
    <compare-view ref="reportView" code="code" targetCode="targetCode"/>
  </div>
</template>

<script>
export default {
  data() {
    return {
        code: '1be468b0099e11eda363112608501fb4',      // 左侧报表对应的code
        targetCode: '0c4bcb50099e11eda363112608501fb4' // 右侧报表对应的code
    };
  },
  methods: {},
  mounted() {}
};
</script>

```

## 外链引入

```html
<meta charset="utf-8" />
<!-- 先引入 Vue -->
<script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
<!-- 引入样式 -->
<link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css" />
<!-- 引入组件库 -->
<script src="https://unpkg.com/element-ui/lib/index.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/axios/0.21.1/axios.min.js"></script>
<script src="./report.umd.js"></script>

<body>
  <div id="app">
    <report-view codes="cccc"></report-view>
  </div>
</body>
<script>
  Vue.use(report);
  new Vue({
    el: '#app',
    data: function() {
      return { visible: false };
    },
    mounted() {}
  });
</script>
```
